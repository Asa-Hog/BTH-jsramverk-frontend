{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar React = require(\"react\");\n\nvar TrixEditor = function (_super) {\n  __extends(TrixEditor, _super);\n\n  function TrixEditor(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.container = null;\n    _this.editor = null;\n    _this.d = null;\n    _this.id = _this.generateId();\n    _this.state = {\n      showMergeTags: false,\n      tags: []\n    };\n    return _this;\n  }\n\n  TrixEditor.prototype.generateId = function () {\n    var dt = new Date().getTime();\n    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n      var r = (dt + Math.random() * 16) % 16 | 0;\n      dt = Math.floor(dt / 16);\n      return (c == 'x' ? r : r & 0x3 | 0x8).toString(16);\n    });\n    return \"T\" + uuid;\n  };\n\n  TrixEditor.prototype.componentDidMount = function () {\n    var _this = this;\n\n    var props = this.props;\n    this.container = document.getElementById(\"editor-\" + this.id);\n\n    if (this.container) {\n      this.container.addEventListener(\"trix-initialize\", function () {\n        _this.editor = _this.container.editor;\n\n        if (!_this.editor) {\n          console.error(\"cannot  find trix editor\");\n        }\n\n        if (props.onEditorReady && typeof props.onEditorReady == \"function\") {\n          props.onEditorReady(_this.editor);\n        }\n      }, false);\n      this.container.addEventListener('trix-change', this.handleChange.bind(this), false);\n\n      if (props.uploadURL) {\n        this.container.addEventListener(\"trix-attachment-add\", this.handleUpload.bind(this));\n      }\n    } else {\n      console.error(\"editor not found\");\n    }\n  };\n\n  TrixEditor.prototype.componentWillUnmount = function () {\n    this.container.removeEventListener(\"trix-initialize\", this.handleChange);\n    this.container.removeEventListener(\"trix-change\", this.handleChange);\n\n    if (this.props.uploadURL) {\n      this.container.removeEventListener(\"trix-attachment-add\", this.handleUpload);\n    }\n  };\n\n  TrixEditor.prototype.handleChange = function (e) {\n    var props = this.props;\n    var state = this.state;\n    var text = e.target.innerText;\n\n    if (props.onChange) {\n      props.onChange(e.target.innerHTML, text);\n    }\n\n    var range = this.editor.getSelectedRange();\n\n    if (text && range[0] == range[1]) {\n      if (props.mergeTags) {\n        var lastChar = range[0] - 1;\n\n        if (lastChar >= 0 && lastChar < text.length) {\n          var trigger = text[lastChar];\n\n          for (var i = 0; i < props.mergeTags.length; i++) {\n            if (trigger == props.mergeTags[i].trigger) {\n              state.showMergeTags = true;\n              state.tags = props.mergeTags[i].tags;\n              this.setState(state);\n              break;\n            }\n          }\n        }\n      }\n    }\n  };\n\n  TrixEditor.prototype.handleUpload = function (e) {\n    var attachment = e.attachment;\n\n    if (attachment.file) {\n      return this.uploadAttachment(attachment);\n    }\n  };\n\n  TrixEditor.prototype.uploadAttachment = function (attachment) {\n    var file, form, xhr;\n    file = attachment.file;\n    form = new FormData();\n\n    if (this.props.uploadData) {\n      for (var k in this.props.uploadData) {\n        form.append(k, this.props.uploadData[k]);\n      }\n    }\n\n    form.append(this.props.fileParamName || \"file\", file);\n    xhr = new XMLHttpRequest();\n    xhr.open(\"POST\", this.props.uploadURL, true);\n\n    xhr.upload.onprogress = function (event) {\n      var progress = event.loaded / event.total * 100;\n      return attachment.setUploadProgress(progress);\n    };\n\n    xhr.onload = function () {\n      var href, url;\n\n      if (xhr.status >= 200 && xhr.status < 300) {\n        url = href = xhr.responseText;\n        return attachment.setAttributes({\n          url: url,\n          href: href\n        });\n      }\n    };\n\n    return xhr.send(form);\n  };\n\n  TrixEditor.prototype.handleTagSelected = function (t, e) {\n    e.preventDefault();\n    var state = this.state;\n    state.showMergeTags = false;\n    this.setState(state);\n    this.editor.expandSelectionInDirection(\"backward\");\n    this.editor.insertString(t.tag);\n  };\n\n  TrixEditor.prototype.renderTagSelector = function (tags) {\n    var _this = this;\n\n    if (!tags || !this.editor) {\n      return null;\n    }\n\n    var editorPosition = document.getElementById(\"trix-editor-top-level-\" + this.id).getBoundingClientRect();\n    var rect = this.editor.getClientRectAtPosition(this.editor.getSelectedRange()[0]);\n    var boxStyle = {\n      \"position\": \"absolute\",\n      \"top\": rect.top + 25 - editorPosition.top,\n      \"left\": rect.left + 25 - editorPosition.left,\n      \"width\": \"250px\",\n      \"boxSizing\": \"border-box\",\n      \"padding\": 0,\n      \"margin\": \".2em 0 0\",\n      \"backgroundColor\": \"hsla(0,0%,100%,.9)\",\n      \"borderRadius\": \".3em\",\n      \"background\": \"linear-gradient(to bottom right, white, hsla(0,0%,100%,.8))\",\n      \"border\": \"1px solid rgba(0,0,0,.3)\",\n      \"boxShadow\": \".05em .2em .6em rgba(0,0,0,.2)\",\n      \"textShadow\": \"none\"\n    };\n    var tagStyle = {\n      \"display\": \"block\",\n      \"padding\": \".2em .5em\",\n      \"cursor\": \"pointer\"\n    };\n    return React.createElement(\"div\", {\n      style: boxStyle,\n      className: \"react-trix-suggestions\"\n    }, tags.map(function (t) {\n      return React.createElement(\"a\", {\n        key: t.name,\n        style: tagStyle,\n        href: \"#\",\n        onClick: _this.handleTagSelected.bind(_this, t)\n      }, t.name);\n    }));\n  };\n\n  TrixEditor.prototype.render = function () {\n    var _this = this;\n\n    var state = this.state;\n    var props = this.props;\n    var attributes = {\n      \"id\": \"editor-\" + this.id,\n      \"input\": \"input-\" + this.id\n    };\n\n    if (props.className) {\n      attributes[\"class\"] = props.className;\n    }\n\n    if (props.autoFocus) {\n      attributes[\"autofocus\"] = props.autoFocus.toString();\n    }\n\n    if (props.placeholder) {\n      attributes[\"placeholder\"] = props.placeholder;\n    }\n\n    if (props.toolbar) {\n      attributes[\"toolbar\"] = props.toolbar;\n    }\n\n    var mergetags = null;\n\n    if (state.showMergeTags) {\n      mergetags = this.renderTagSelector(state.tags);\n    }\n\n    return React.createElement(\"div\", {\n      id: \"trix-editor-top-level-\" + this.id,\n      ref: function ref(d) {\n        return _this.d = d;\n      },\n      style: {\n        \"position\": \"relative\"\n      }\n    }, React.createElement(\"trix-editor\", attributes), React.createElement(\"input\", {\n      type: \"hidden\",\n      id: \"input-\" + this.id,\n      value: this.props.value\n    }), mergetags);\n  };\n\n  return TrixEditor;\n}(React.Component);\n\nexports.TrixEditor = TrixEditor;","map":{"version":3,"mappings":"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","names":["__extends","props","_super","_this","id","generateId","state","showMergeTags","tags","TrixEditor","dt","Date","getTime","uuid","replace","c","r","Math","random","floor","toString","container","document","getElementById","addEventListener","editor","console","error","onEditorReady","handleChange","bind","uploadURL","handleUpload","removeEventListener","e","text","target","innerText","onChange","innerHTML","range","getSelectedRange","mergeTags","lastChar","length","trigger","i","setState","attachment","file","uploadAttachment","form","xhr","FormData","uploadData","k","append","fileParamName","XMLHttpRequest","open","upload","onprogress","event","progress","loaded","total","setUploadProgress","onload","href","url","status","responseText","setAttributes","send","t","preventDefault","expandSelectionInDirection","insertString","tag","editorPosition","getBoundingClientRect","rect","getClientRectAtPosition","boxStyle","top","left","tagStyle","React","style","className","map","key","name","onClick","handleTagSelected","attributes","autoFocus","placeholder","toolbar","mergetags","renderTagSelector","ref","d","createElement","type","value","Component","exports"],"sources":["../src/react-trix.tsx"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}