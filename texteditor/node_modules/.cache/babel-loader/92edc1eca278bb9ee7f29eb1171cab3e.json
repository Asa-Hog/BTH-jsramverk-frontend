{"ast":null,"code":"/*\nTrix 2.0.0-alpha.1\nCopyright © 2022 Basecamp, LLC\n */\nvar name = \"trix\";\nvar version = \"2.0.0-alpha.1\";\nvar description = \"A rich text editor for everyday writing\";\nvar main = \"dist/trix.umd.js\";\nvar module = \"dist/trix.js\";\nvar style = \"dist/trix.css\";\nvar files = [\"dist/*.css\", \"dist/*.js\"];\nvar repository = {\n  type: \"git\",\n  url: \"git+https://github.com/basecamp/trix.git\"\n};\nvar keywords = [\"rich text\", \"wysiwyg\", \"editor\"];\nvar author = \"Basecamp, LLC\";\nvar license = \"MIT\";\nvar bugs = {\n  url: \"https://github.com/basecamp/trix/issues\"\n};\nvar homepage = \"https://trix-editor.org/\";\nvar devDependencies = {\n  \"@babel/core\": \"^7.16.0\",\n  \"@babel/preset-env\": \"^7.16.4\",\n  \"@rollup/plugin-babel\": \"^5.3.0\",\n  \"@rollup/plugin-json\": \"^4.1.0\",\n  \"babel-eslint\": \"^10.1.0\",\n  eslint: \"^7.32.0\",\n  esm: \"^3.2.25\",\n  karma: \"5.0.2\",\n  \"karma-chrome-launcher\": \"3.1.0\",\n  \"karma-qunit\": \"^4.1.2\",\n  \"karma-sauce-launcher\": \"^4.3.6\",\n  \"node-sass\": \"^7.0.1\",\n  qunit: \"2.9.3\",\n  rangy: \"^1.3.0\",\n  rollup: \"^2.56.3\",\n  \"rollup-plugin-commonjs\": \"^10.1.0\",\n  \"rollup-plugin-includepaths\": \"^0.2.4\",\n  \"rollup-plugin-node-resolve\": \"^5.2.0\",\n  \"rollup-plugin-terser\": \"^7.0.2\",\n  svgo: \"^2.8.0\"\n};\nvar scripts = {\n  \"build-css\": \"node-sass --functions=./assets/trix/stylesheets/functions assets/trix.scss dist/trix.css\",\n  \"build-js\": \"rollup -c\",\n  \"build-assets\": \"cp -f assets/*.html dist/\",\n  build: \"yarn run build-js && yarn run build-css && yarn run build-assets\",\n  watch: \"rollup -c -w\",\n  lint: \"eslint .\",\n  pretest: \"yarn run lint && yarn run build\",\n  test: \"karma start\",\n  postversion: \"git push && git push --tags\",\n  release: \"yarn test && npm adduser && yarn version && npm publish\"\n};\nvar dependencies = {};\nvar _package = {\n  name: name,\n  version: version,\n  description: description,\n  main: main,\n  module: module,\n  style: style,\n  files: files,\n  repository: repository,\n  keywords: keywords,\n  author: author,\n  license: license,\n  bugs: bugs,\n  homepage: homepage,\n  devDependencies: devDependencies,\n  scripts: scripts,\n  dependencies: dependencies\n};\nconst attachmentSelector = \"[data-trix-attachment]\";\nconst attachments = {\n  preview: {\n    presentation: \"gallery\",\n    caption: {\n      name: true,\n      size: true\n    }\n  },\n  file: {\n    caption: {\n      size: true\n    }\n  }\n};\nconst attributes = {\n  default: {\n    tagName: \"div\",\n    parse: false\n  },\n  quote: {\n    tagName: \"blockquote\",\n    nestable: true\n  },\n  heading1: {\n    tagName: \"h1\",\n    terminal: true,\n    breakOnReturn: true,\n    group: false\n  },\n  code: {\n    tagName: \"pre\",\n    terminal: true,\n    text: {\n      plaintext: true\n    }\n  },\n  bulletList: {\n    tagName: \"ul\",\n    parse: false\n  },\n  bullet: {\n    tagName: \"li\",\n    listAttribute: \"bulletList\",\n    group: false,\n    nestable: true,\n\n    test(element) {\n      return tagName$1(element.parentNode) === attributes[this.listAttribute].tagName;\n    }\n\n  },\n  numberList: {\n    tagName: \"ol\",\n    parse: false\n  },\n  number: {\n    tagName: \"li\",\n    listAttribute: \"numberList\",\n    group: false,\n    nestable: true,\n\n    test(element) {\n      return tagName$1(element.parentNode) === attributes[this.listAttribute].tagName;\n    }\n\n  },\n  attachmentGallery: {\n    tagName: \"div\",\n    exclusive: true,\n    terminal: true,\n    parse: false,\n    group: false\n  }\n};\n\nconst tagName$1 = element => {\n  var _element$tagName;\n\n  return element === null || element === void 0 ? void 0 : (_element$tagName = element.tagName) === null || _element$tagName === void 0 ? void 0 : _element$tagName.toLowerCase();\n};\n\nvar browser$1 = {\n  // Android emits composition events when moving the cursor through existing text\n  // Introduced in Chrome 65: https://bugs.chromium.org/p/chromium/issues/detail?id=764439#c9\n  composesExistingText: /Android.*Chrome/.test(navigator.userAgent),\n  // IE 11 activates resizing handles on editable elements that have \"layout\"\n  forcesObjectResizing: /Trident.*rv:11/.test(navigator.userAgent),\n  // https://www.w3.org/TR/input-events-1/ + https://www.w3.org/TR/input-events-2/\n  supportsInputEvents: function () {\n    if (typeof InputEvent === \"undefined\") {\n      return false;\n    }\n\n    for (const property of [\"data\", \"getTargetRanges\", \"inputType\"]) {\n      if (!(property in InputEvent.prototype)) {\n        return false;\n      }\n    }\n\n    return true;\n  }()\n};\nvar css$3 = {\n  attachment: \"attachment\",\n  attachmentCaption: \"attachment__caption\",\n  attachmentCaptionEditor: \"attachment__caption-editor\",\n  attachmentMetadata: \"attachment__metadata\",\n  attachmentMetadataContainer: \"attachment__metadata-container\",\n  attachmentName: \"attachment__name\",\n  attachmentProgress: \"attachment__progress\",\n  attachmentSize: \"attachment__size\",\n  attachmentToolbar: \"attachment__toolbar\",\n  attachmentGallery: \"attachment-gallery\"\n};\nvar lang$1 = {\n  attachFiles: \"Attach Files\",\n  bold: \"Bold\",\n  bullets: \"Bullets\",\n  byte: \"Byte\",\n  bytes: \"Bytes\",\n  captionPlaceholder: \"Add a caption…\",\n  code: \"Code\",\n  heading1: \"Heading\",\n  indent: \"Increase Level\",\n  italic: \"Italic\",\n  link: \"Link\",\n  numbers: \"Numbers\",\n  outdent: \"Decrease Level\",\n  quote: \"Quote\",\n  redo: \"Redo\",\n  remove: \"Remove\",\n  strike: \"Strikethrough\",\n  undo: \"Undo\",\n  unlink: \"Unlink\",\n  url: \"URL\",\n  urlPlaceholder: \"Enter a URL…\",\n  GB: \"GB\",\n  KB: \"KB\",\n  MB: \"MB\",\n  PB: \"PB\",\n  TB: \"TB\"\n};\n/* eslint-disable\n    no-case-declarations,\n*/\n\nconst sizes = [lang$1.bytes, lang$1.KB, lang$1.MB, lang$1.GB, lang$1.TB, lang$1.PB];\nvar fileSize = {\n  prefix: \"IEC\",\n  precision: 2,\n\n  formatter(number) {\n    switch (number) {\n      case 0:\n        return \"0 \".concat(lang$1.bytes);\n\n      case 1:\n        return \"1 \".concat(lang$1.byte);\n\n      default:\n        let base;\n\n        if (this.prefix === \"SI\") {\n          base = 1000;\n        } else if (this.prefix === \"IEC\") {\n          base = 1024;\n        }\n\n        const exp = Math.floor(Math.log(number) / Math.log(base));\n        const humanSize = number / Math.pow(base, exp);\n        const string = humanSize.toFixed(this.precision);\n        const withoutInsignificantZeros = string.replace(/0*$/, \"\").replace(/\\.$/, \"\");\n        return \"\".concat(withoutInsignificantZeros, \" \").concat(sizes[exp]);\n    }\n  }\n\n};\nconst ZERO_WIDTH_SPACE = \"\\uFEFF\";\nconst NON_BREAKING_SPACE = \"\\u00A0\";\nconst OBJECT_REPLACEMENT_CHARACTER = \"\\uFFFC\";\n\nconst extend = function (properties) {\n  for (const key in properties) {\n    const value = properties[key];\n    this[key] = value;\n  }\n\n  return this;\n};\n\nconst html = document.documentElement;\nconst match = html.matches;\n\nconst handleEvent = function (eventName) {\n  let {\n    onElement,\n    matchingSelector,\n    withCallback,\n    inPhase,\n    preventDefault,\n    times\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const element = onElement ? onElement : html;\n  const selector = matchingSelector;\n  const useCapture = inPhase === \"capturing\";\n\n  const handler = function (event) {\n    if (times != null && --times === 0) {\n      handler.destroy();\n    }\n\n    const target = findClosestElementFromNode(event.target, {\n      matchingSelector: selector\n    });\n\n    if (target != null) {\n      withCallback === null || withCallback === void 0 ? void 0 : withCallback.call(target, event, target);\n\n      if (preventDefault) {\n        event.preventDefault();\n      }\n    }\n  };\n\n  handler.destroy = () => element.removeEventListener(eventName, handler, useCapture);\n\n  element.addEventListener(eventName, handler, useCapture);\n  return handler;\n};\n\nconst handleEventOnce = function (eventName) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  options.times = 1;\n  return handleEvent(eventName, options);\n};\n\nconst triggerEvent = function (eventName) {\n  let {\n    onElement,\n    bubbles,\n    cancelable,\n    attributes\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const element = onElement != null ? onElement : html;\n  bubbles = bubbles !== false;\n  cancelable = cancelable !== false;\n  const event = document.createEvent(\"Events\");\n  event.initEvent(eventName, bubbles, cancelable);\n\n  if (attributes != null) {\n    extend.call(event, attributes);\n  }\n\n  return element.dispatchEvent(event);\n};\n\nconst elementMatchesSelector = function (element, selector) {\n  if ((element === null || element === void 0 ? void 0 : element.nodeType) === 1) {\n    return match.call(element, selector);\n  }\n};\n\nconst findClosestElementFromNode = function (node) {\n  let {\n    matchingSelector,\n    untilNode\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  while (node && node.nodeType !== Node.ELEMENT_NODE) {\n    node = node.parentNode;\n  }\n\n  if (node == null) {\n    return;\n  }\n\n  if (matchingSelector != null) {\n    if (node.closest && untilNode == null) {\n      return node.closest(matchingSelector);\n    } else {\n      while (node && node !== untilNode) {\n        if (elementMatchesSelector(node, matchingSelector)) {\n          return node;\n        }\n\n        node = node.parentNode;\n      }\n    }\n  } else {\n    return node;\n  }\n};\n\nconst findInnerElement = function (element) {\n  while ((_element = element) !== null && _element !== void 0 && _element.firstElementChild) {\n    var _element;\n\n    element = element.firstElementChild;\n  }\n\n  return element;\n};\n\nconst innerElementIsActive = element => document.activeElement !== element && elementContainsNode(element, document.activeElement);\n\nconst elementContainsNode = function (element, node) {\n  if (!element || !node) {\n    return;\n  }\n\n  while (node) {\n    if (node === element) {\n      return true;\n    }\n\n    node = node.parentNode;\n  }\n};\n\nconst findNodeFromContainerAndOffset = function (container, offset) {\n  if (!container) {\n    return;\n  }\n\n  if (container.nodeType === Node.TEXT_NODE) {\n    return container;\n  } else if (offset === 0) {\n    return container.firstChild != null ? container.firstChild : container;\n  } else {\n    return container.childNodes.item(offset - 1);\n  }\n};\n\nconst findElementFromContainerAndOffset = function (container, offset) {\n  const node = findNodeFromContainerAndOffset(container, offset);\n  return findClosestElementFromNode(node);\n};\n\nconst findChildIndexOfNode = function (node) {\n  var _node;\n\n  if (!((_node = node) !== null && _node !== void 0 && _node.parentNode)) {\n    return;\n  }\n\n  let childIndex = 0;\n  node = node.previousSibling;\n\n  while (node) {\n    childIndex++;\n    node = node.previousSibling;\n  }\n\n  return childIndex;\n};\n\nconst removeNode = node => {\n  var _node$parentNode;\n\n  return node === null || node === void 0 ? void 0 : (_node$parentNode = node.parentNode) === null || _node$parentNode === void 0 ? void 0 : _node$parentNode.removeChild(node);\n};\n\nconst walkTree = function (tree) {\n  let {\n    onlyNodesOfType,\n    usingFilter,\n    expandEntityReferences\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  const whatToShow = (() => {\n    switch (onlyNodesOfType) {\n      case \"element\":\n        return NodeFilter.SHOW_ELEMENT;\n\n      case \"text\":\n        return NodeFilter.SHOW_TEXT;\n\n      case \"comment\":\n        return NodeFilter.SHOW_COMMENT;\n\n      default:\n        return NodeFilter.SHOW_ALL;\n    }\n  })();\n\n  return document.createTreeWalker(tree, whatToShow, usingFilter != null ? usingFilter : null, expandEntityReferences === true);\n};\n\nconst tagName = element => {\n  var _element$tagName;\n\n  return element === null || element === void 0 ? void 0 : (_element$tagName = element.tagName) === null || _element$tagName === void 0 ? void 0 : _element$tagName.toLowerCase();\n};\n\nconst makeElement = function (tag) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  let key, value;\n\n  if (typeof tag === \"object\") {\n    options = tag;\n    tag = options.tagName;\n  } else {\n    options = {\n      attributes: options\n    };\n  }\n\n  const element = document.createElement(tag);\n\n  if (options.editable != null) {\n    if (options.attributes == null) {\n      options.attributes = {};\n    }\n\n    options.attributes.contenteditable = options.editable;\n  }\n\n  if (options.attributes) {\n    for (key in options.attributes) {\n      value = options.attributes[key];\n      element.setAttribute(key, value);\n    }\n  }\n\n  if (options.style) {\n    for (key in options.style) {\n      value = options.style[key];\n      element.style[key] = value;\n    }\n  }\n\n  if (options.data) {\n    for (key in options.data) {\n      value = options.data[key];\n      element.dataset[key] = value;\n    }\n  }\n\n  if (options.className) {\n    options.className.split(\" \").forEach(className => {\n      element.classList.add(className);\n    });\n  }\n\n  if (options.textContent) {\n    element.textContent = options.textContent;\n  }\n\n  if (options.childNodes) {\n    [].concat(options.childNodes).forEach(childNode => {\n      element.appendChild(childNode);\n    });\n  }\n\n  return element;\n};\n\nlet blockTagNames = undefined;\n\nconst getBlockTagNames = function () {\n  if (blockTagNames != null) {\n    return blockTagNames;\n  }\n\n  blockTagNames = [];\n\n  for (const key in attributes) {\n    const attributes$1 = attributes[key];\n\n    if (attributes$1.tagName) {\n      blockTagNames.push(attributes$1.tagName);\n    }\n  }\n\n  return blockTagNames;\n};\n\nconst nodeIsBlockContainer = node => nodeIsBlockStartComment(node === null || node === void 0 ? void 0 : node.firstChild);\n\nconst nodeProbablyIsBlockContainer = function (node) {\n  return getBlockTagNames().includes(tagName(node)) && !getBlockTagNames().includes(tagName(node.firstChild));\n};\n\nconst nodeIsBlockStart = function (node) {\n  let {\n    strict\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n    strict: true\n  };\n\n  if (strict) {\n    return nodeIsBlockStartComment(node);\n  } else {\n    return nodeIsBlockStartComment(node) || !nodeIsBlockStartComment(node.firstChild) && nodeProbablyIsBlockContainer(node);\n  }\n};\n\nconst nodeIsBlockStartComment = node => nodeIsCommentNode(node) && (node === null || node === void 0 ? void 0 : node.data) === \"block\";\n\nconst nodeIsCommentNode = node => (node === null || node === void 0 ? void 0 : node.nodeType) === Node.COMMENT_NODE;\n\nconst nodeIsCursorTarget = function (node) {\n  let {\n    name\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  if (!node) {\n    return;\n  }\n\n  if (nodeIsTextNode(node)) {\n    if (node.data === ZERO_WIDTH_SPACE) {\n      if (name) {\n        return node.parentNode.dataset.trixCursorTarget === name;\n      } else {\n        return true;\n      }\n    }\n  } else {\n    return nodeIsCursorTarget(node.firstChild);\n  }\n};\n\nconst nodeIsAttachmentElement = node => elementMatchesSelector(node, attachmentSelector);\n\nconst nodeIsEmptyTextNode = node => nodeIsTextNode(node) && (node === null || node === void 0 ? void 0 : node.data) === \"\";\n\nconst nodeIsTextNode = node => (node === null || node === void 0 ? void 0 : node.nodeType) === Node.TEXT_NODE;\n\nconst input = {\n  level2Enabled: true,\n\n  getLevel() {\n    if (this.level2Enabled && browser$1.supportsInputEvents) {\n      return 2;\n    } else {\n      return 0;\n    }\n  },\n\n  pickFiles(callback) {\n    const input = makeElement(\"input\", {\n      type: \"file\",\n      multiple: true,\n      hidden: true,\n      id: this.fileInputId\n    });\n    input.addEventListener(\"change\", () => {\n      callback(input.files);\n      removeNode(input);\n    });\n    removeNode(document.getElementById(this.fileInputId));\n    document.body.appendChild(input);\n    input.click();\n  }\n\n};\nvar keyNames$2 = {\n  8: \"backspace\",\n  9: \"tab\",\n  13: \"return\",\n  27: \"escape\",\n  37: \"left\",\n  39: \"right\",\n  46: \"delete\",\n  68: \"d\",\n  72: \"h\",\n  79: \"o\"\n};\nvar textAttributes = {\n  bold: {\n    tagName: \"strong\",\n    inheritable: true,\n\n    parser(element) {\n      const style = window.getComputedStyle(element);\n      return style.fontWeight === \"bold\" || style.fontWeight >= 600;\n    }\n\n  },\n  italic: {\n    tagName: \"em\",\n    inheritable: true,\n\n    parser(element) {\n      const style = window.getComputedStyle(element);\n      return style.fontStyle === \"italic\";\n    }\n\n  },\n  href: {\n    groupTagName: \"a\",\n\n    parser(element) {\n      const matchingSelector = \"a:not(\".concat(attachmentSelector, \")\");\n      const link = element.closest(matchingSelector);\n\n      if (link) {\n        return link.getAttribute(\"href\");\n      }\n    }\n\n  },\n  strike: {\n    tagName: \"del\",\n    inheritable: true\n  },\n  frozen: {\n    style: {\n      backgroundColor: \"highlight\"\n    }\n  }\n};\nvar toolbar = {\n  getDefaultHTML() {\n    return \"<div class=\\\"trix-button-row\\\">\\n      <span class=\\\"trix-button-group trix-button-group--text-tools\\\" data-trix-button-group=\\\"text-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-bold\\\" data-trix-attribute=\\\"bold\\\" data-trix-key=\\\"b\\\" title=\\\"\".concat(lang$1.bold, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.bold, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-italic\\\" data-trix-attribute=\\\"italic\\\" data-trix-key=\\\"i\\\" title=\\\"\").concat(lang$1.italic, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.italic, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-strike\\\" data-trix-attribute=\\\"strike\\\" title=\\\"\").concat(lang$1.strike, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.strike, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-link\\\" data-trix-attribute=\\\"href\\\" data-trix-action=\\\"link\\\" data-trix-key=\\\"k\\\" title=\\\"\").concat(lang$1.link, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.link, \"</button>\\n      </span>\\n\\n      <span class=\\\"trix-button-group trix-button-group--block-tools\\\" data-trix-button-group=\\\"block-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-heading-1\\\" data-trix-attribute=\\\"heading1\\\" title=\\\"\").concat(lang$1.heading1, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.heading1, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-quote\\\" data-trix-attribute=\\\"quote\\\" title=\\\"\").concat(lang$1.quote, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.quote, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-code\\\" data-trix-attribute=\\\"code\\\" title=\\\"\").concat(lang$1.code, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.code, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-bullet-list\\\" data-trix-attribute=\\\"bullet\\\" title=\\\"\").concat(lang$1.bullets, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.bullets, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-number-list\\\" data-trix-attribute=\\\"number\\\" title=\\\"\").concat(lang$1.numbers, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.numbers, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-decrease-nesting-level\\\" data-trix-action=\\\"decreaseNestingLevel\\\" title=\\\"\").concat(lang$1.outdent, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.outdent, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-increase-nesting-level\\\" data-trix-action=\\\"increaseNestingLevel\\\" title=\\\"\").concat(lang$1.indent, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.indent, \"</button>\\n      </span>\\n\\n      <span class=\\\"trix-button-group trix-button-group--file-tools\\\" data-trix-button-group=\\\"file-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-attach\\\" data-trix-action=\\\"attachFiles\\\" title=\\\"\").concat(lang$1.attachFiles, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.attachFiles, \"</button>\\n      </span>\\n\\n      <span class=\\\"trix-button-group-spacer\\\"></span>\\n\\n      <span class=\\\"trix-button-group trix-button-group--history-tools\\\" data-trix-button-group=\\\"history-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-undo\\\" data-trix-action=\\\"undo\\\" data-trix-key=\\\"z\\\" title=\\\"\").concat(lang$1.undo, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.undo, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-redo\\\" data-trix-action=\\\"redo\\\" data-trix-key=\\\"shift+z\\\" title=\\\"\").concat(lang$1.redo, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.redo, \"</button>\\n      </span>\\n    </div>\\n\\n    <div class=\\\"trix-dialogs\\\" data-trix-dialogs>\\n      <div class=\\\"trix-dialog trix-dialog--link\\\" data-trix-dialog=\\\"href\\\" data-trix-dialog-attribute=\\\"href\\\">\\n        <div class=\\\"trix-dialog__link-fields\\\">\\n          <input type=\\\"url\\\" name=\\\"href\\\" class=\\\"trix-input trix-input--dialog\\\" placeholder=\\\"\").concat(lang$1.urlPlaceholder, \"\\\" aria-label=\\\"\").concat(lang$1.url, \"\\\" required data-trix-input>\\n          <div class=\\\"trix-button-group\\\">\\n            <input type=\\\"button\\\" class=\\\"trix-button trix-button--dialog\\\" value=\\\"\").concat(lang$1.link, \"\\\" data-trix-method=\\\"setAttribute\\\">\\n            <input type=\\\"button\\\" class=\\\"trix-button trix-button--dialog\\\" value=\\\"\").concat(lang$1.unlink, \"\\\" data-trix-method=\\\"removeAttribute\\\">\\n          </div>\\n        </div>\\n      </div>\\n    </div>\");\n  }\n\n};\nconst undoInterval = 5000;\nconst config = {\n  attachments,\n  blockAttributes: attributes,\n  browser: browser$1,\n  css: css$3,\n  fileSize,\n  input,\n  keyNames: keyNames$2,\n  lang: lang$1,\n  textAttributes,\n  toolbar,\n  undoInterval\n};\n\nfunction createMetadataMethodsForProperty(metadataMap, kind, property, decoratorFinishedRef) {\n  return {\n    getMetadata: function (key) {\n      assertNotFinished(decoratorFinishedRef, \"getMetadata\"), assertMetadataKey(key);\n      var metadataForKey = metadataMap[key];\n      if (void 0 !== metadataForKey) if (1 === kind) {\n        var pub = metadataForKey.public;\n        if (void 0 !== pub) return pub[property];\n      } else if (2 === kind) {\n        var priv = metadataForKey.private;\n        if (void 0 !== priv) return priv.get(property);\n      } else if (Object.hasOwnProperty.call(metadataForKey, \"constructor\")) return metadataForKey.constructor;\n    },\n    setMetadata: function (key, value) {\n      assertNotFinished(decoratorFinishedRef, \"setMetadata\"), assertMetadataKey(key);\n      var metadataForKey = metadataMap[key];\n\n      if (void 0 === metadataForKey && (metadataForKey = metadataMap[key] = {}), 1 === kind) {\n        var pub = metadataForKey.public;\n        void 0 === pub && (pub = metadataForKey.public = {}), pub[property] = value;\n      } else if (2 === kind) {\n        var priv = metadataForKey.priv;\n        void 0 === priv && (priv = metadataForKey.private = new Map()), priv.set(property, value);\n      } else metadataForKey.constructor = value;\n    }\n  };\n}\n\nfunction convertMetadataMapToFinal(obj, metadataMap) {\n  var parentMetadataMap = obj[Symbol.metadata || Symbol.for(\"Symbol.metadata\")],\n      metadataKeys = Object.getOwnPropertySymbols(metadataMap);\n\n  if (0 !== metadataKeys.length) {\n    for (var i = 0; i < metadataKeys.length; i++) {\n      var key = metadataKeys[i],\n          metaForKey = metadataMap[key],\n          parentMetaForKey = parentMetadataMap ? parentMetadataMap[key] : null,\n          pub = metaForKey.public,\n          parentPub = parentMetaForKey ? parentMetaForKey.public : null;\n      pub && parentPub && Object.setPrototypeOf(pub, parentPub);\n      var priv = metaForKey.private;\n\n      if (priv) {\n        var privArr = Array.from(priv.values()),\n            parentPriv = parentMetaForKey ? parentMetaForKey.private : null;\n        parentPriv && (privArr = privArr.concat(parentPriv)), metaForKey.private = privArr;\n      }\n\n      parentMetaForKey && Object.setPrototypeOf(metaForKey, parentMetaForKey);\n    }\n\n    parentMetadataMap && Object.setPrototypeOf(metadataMap, parentMetadataMap), obj[Symbol.metadata || Symbol.for(\"Symbol.metadata\")] = metadataMap;\n  }\n}\n\nfunction createAddInitializerMethod(initializers, decoratorFinishedRef) {\n  return function (initializer) {\n    assertNotFinished(decoratorFinishedRef, \"addInitializer\"), assertCallable(initializer, \"An initializer\"), initializers.push(initializer);\n  };\n}\n\nfunction memberDec(dec, name, desc, metadataMap, initializers, kind, isStatic, isPrivate, value) {\n  var kindStr;\n\n  switch (kind) {\n    case 1:\n      kindStr = \"accessor\";\n      break;\n\n    case 2:\n      kindStr = \"method\";\n      break;\n\n    case 3:\n      kindStr = \"getter\";\n      break;\n\n    case 4:\n      kindStr = \"setter\";\n      break;\n\n    default:\n      kindStr = \"field\";\n  }\n\n  var metadataKind,\n      metadataName,\n      ctx = {\n    kind: kindStr,\n    name: isPrivate ? \"#\" + name : name,\n    isStatic: isStatic,\n    isPrivate: isPrivate\n  },\n      decoratorFinishedRef = {\n    v: !1\n  };\n\n  if (0 !== kind && (ctx.addInitializer = createAddInitializerMethod(initializers, decoratorFinishedRef)), isPrivate) {\n    metadataKind = 2, metadataName = Symbol(name);\n    var access = {};\n    0 === kind ? (access.get = desc.get, access.set = desc.set) : 2 === kind ? access.get = function () {\n      return desc.value;\n    } : (1 !== kind && 3 !== kind || (access.get = function () {\n      return desc.get.call(this);\n    }), 1 !== kind && 4 !== kind || (access.set = function (v) {\n      desc.set.call(this, v);\n    })), ctx.access = access;\n  } else metadataKind = 1, metadataName = name;\n\n  try {\n    return dec(value, Object.assign(ctx, createMetadataMethodsForProperty(metadataMap, metadataKind, metadataName, decoratorFinishedRef)));\n  } finally {\n    decoratorFinishedRef.v = !0;\n  }\n}\n\nfunction assertNotFinished(decoratorFinishedRef, fnName) {\n  if (decoratorFinishedRef.v) throw new Error(\"attempted to call \" + fnName + \" after decoration was finished\");\n}\n\nfunction assertMetadataKey(key) {\n  if (\"symbol\" != typeof key) throw new TypeError(\"Metadata keys must be symbols, received: \" + key);\n}\n\nfunction assertCallable(fn, hint) {\n  if (\"function\" != typeof fn) throw new TypeError(hint + \" must be a function\");\n}\n\nfunction assertValidReturnValue(kind, value) {\n  var type = typeof value;\n\n  if (1 === kind) {\n    if (\"object\" !== type || null === value) throw new TypeError(\"accessor decorators must return an object with get, set, or init properties or void 0\");\n    void 0 !== value.get && assertCallable(value.get, \"accessor.get\"), void 0 !== value.set && assertCallable(value.set, \"accessor.set\"), void 0 !== value.init && assertCallable(value.init, \"accessor.init\"), void 0 !== value.initializer && assertCallable(value.initializer, \"accessor.initializer\");\n  } else if (\"function\" !== type) {\n    var hint;\n    throw hint = 0 === kind ? \"field\" : 10 === kind ? \"class\" : \"method\", new TypeError(hint + \" decorators must return a function or void 0\");\n  }\n}\n\nfunction getInit(desc) {\n  var initializer;\n  return null == (initializer = desc.init) && (initializer = desc.initializer) && \"undefined\" != typeof console && console.warn(\".initializer has been renamed to .init as of March 2022\"), initializer;\n}\n\nfunction applyMemberDec(ret, base, decInfo, name, kind, isStatic, isPrivate, metadataMap, initializers) {\n  var desc,\n      initializer,\n      value,\n      newValue,\n      get,\n      set,\n      decs = decInfo[0];\n  if (isPrivate ? desc = 0 === kind || 1 === kind ? {\n    get: decInfo[3],\n    set: decInfo[4]\n  } : 3 === kind ? {\n    get: decInfo[3]\n  } : 4 === kind ? {\n    set: decInfo[3]\n  } : {\n    value: decInfo[3]\n  } : 0 !== kind && (desc = Object.getOwnPropertyDescriptor(base, name)), 1 === kind ? value = {\n    get: desc.get,\n    set: desc.set\n  } : 2 === kind ? value = desc.value : 3 === kind ? value = desc.get : 4 === kind && (value = desc.set), \"function\" == typeof decs) void 0 !== (newValue = memberDec(decs, name, desc, metadataMap, initializers, kind, isStatic, isPrivate, value)) && (assertValidReturnValue(kind, newValue), 0 === kind ? initializer = newValue : 1 === kind ? (initializer = getInit(newValue), get = newValue.get || value.get, set = newValue.set || value.set, value = {\n    get: get,\n    set: set\n  }) : value = newValue);else for (var i = decs.length - 1; i >= 0; i--) {\n    var newInit;\n    if (void 0 !== (newValue = memberDec(decs[i], name, desc, metadataMap, initializers, kind, isStatic, isPrivate, value))) assertValidReturnValue(kind, newValue), 0 === kind ? newInit = newValue : 1 === kind ? (newInit = getInit(newValue), get = newValue.get || value.get, set = newValue.set || value.set, value = {\n      get: get,\n      set: set\n    }) : value = newValue, void 0 !== newInit && (void 0 === initializer ? initializer = newInit : \"function\" == typeof initializer ? initializer = [initializer, newInit] : initializer.push(newInit));\n  }\n\n  if (0 === kind || 1 === kind) {\n    if (void 0 === initializer) initializer = function (instance, init) {\n      return init;\n    };else if (\"function\" != typeof initializer) {\n      var ownInitializers = initializer;\n\n      initializer = function (instance, init) {\n        for (var value = init, i = 0; i < ownInitializers.length; i++) value = ownInitializers[i].call(instance, value);\n\n        return value;\n      };\n    } else {\n      var originalInitializer = initializer;\n\n      initializer = function (instance, init) {\n        return originalInitializer.call(instance, init);\n      };\n    }\n    ret.push(initializer);\n  }\n\n  0 !== kind && (1 === kind ? (desc.get = value.get, desc.set = value.set) : 2 === kind ? desc.value = value : 3 === kind ? desc.get = value : 4 === kind && (desc.set = value), isPrivate ? 1 === kind ? (ret.push(function (instance, args) {\n    return value.get.call(instance, args);\n  }), ret.push(function (instance, args) {\n    return value.set.call(instance, args);\n  })) : 2 === kind ? ret.push(value) : ret.push(function (instance, args) {\n    return value.call(instance, args);\n  }) : Object.defineProperty(base, name, desc));\n}\n\nfunction applyMemberDecs(ret, Class, protoMetadataMap, staticMetadataMap, decInfos) {\n  for (var protoInitializers, staticInitializers, existingProtoNonFields = new Map(), existingStaticNonFields = new Map(), i = 0; i < decInfos.length; i++) {\n    var decInfo = decInfos[i];\n\n    if (Array.isArray(decInfo)) {\n      var base,\n          metadataMap,\n          initializers,\n          kind = decInfo[1],\n          name = decInfo[2],\n          isPrivate = decInfo.length > 3,\n          isStatic = kind >= 5;\n\n      if (isStatic ? (base = Class, metadataMap = staticMetadataMap, 0 !== (kind -= 5) && (initializers = staticInitializers = staticInitializers || [])) : (base = Class.prototype, metadataMap = protoMetadataMap, 0 !== kind && (initializers = protoInitializers = protoInitializers || [])), 0 !== kind && !isPrivate) {\n        var existingNonFields = isStatic ? existingStaticNonFields : existingProtoNonFields,\n            existingKind = existingNonFields.get(name) || 0;\n        if (!0 === existingKind || 3 === existingKind && 4 !== kind || 4 === existingKind && 3 !== kind) throw new Error(\"Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: \" + name);\n        !existingKind && kind > 2 ? existingNonFields.set(name, kind) : existingNonFields.set(name, !0);\n      }\n\n      applyMemberDec(ret, base, decInfo, name, kind, isStatic, isPrivate, metadataMap, initializers);\n    }\n  }\n\n  pushInitializers(ret, protoInitializers), pushInitializers(ret, staticInitializers);\n}\n\nfunction pushInitializers(ret, initializers) {\n  initializers && ret.push(function (instance) {\n    for (var i = 0; i < initializers.length; i++) initializers[i].call(instance);\n\n    return instance;\n  });\n}\n\nfunction applyClassDecs(ret, targetClass, metadataMap, classDecs) {\n  if (classDecs.length > 0) {\n    for (var initializers = [], newClass = targetClass, name = targetClass.name, i = classDecs.length - 1; i >= 0; i--) {\n      var decoratorFinishedRef = {\n        v: !1\n      };\n\n      try {\n        var ctx = Object.assign({\n          kind: \"class\",\n          name: name,\n          addInitializer: createAddInitializerMethod(initializers, decoratorFinishedRef)\n        }, createMetadataMethodsForProperty(metadataMap, 0, name, decoratorFinishedRef)),\n            nextNewClass = classDecs[i](newClass, ctx);\n      } finally {\n        decoratorFinishedRef.v = !0;\n      }\n\n      void 0 !== nextNewClass && (assertValidReturnValue(10, nextNewClass), newClass = nextNewClass);\n    }\n\n    ret.push(newClass, function () {\n      for (var i = 0; i < initializers.length; i++) initializers[i].call(newClass);\n    });\n  }\n}\n\nfunction _applyDecs(targetClass, memberDecs, classDecs) {\n  var ret = [],\n      staticMetadataMap = {},\n      protoMetadataMap = {};\n  return applyMemberDecs(ret, targetClass, protoMetadataMap, staticMetadataMap, memberDecs), convertMetadataMapToFinal(targetClass.prototype, protoMetadataMap), applyClassDecs(ret, targetClass, staticMetadataMap, classDecs), convertMetadataMapToFinal(targetClass, staticMetadataMap), ret;\n}\n\nfunction _asyncIterator(iterable) {\n  var method,\n      async,\n      sync,\n      retry = 2;\n\n  for (\"undefined\" != typeof Symbol && (async = Symbol.asyncIterator, sync = Symbol.iterator); retry--;) {\n    if (async && null != (method = iterable[async])) return method.call(iterable);\n    if (sync && null != (method = iterable[sync])) return new AsyncFromSyncIterator(method.call(iterable));\n    async = \"@@asyncIterator\", sync = \"@@iterator\";\n  }\n\n  throw new TypeError(\"Object is not async iterable\");\n}\n\nfunction AsyncFromSyncIterator(s) {\n  function AsyncFromSyncIteratorContinuation(r) {\n    if (Object(r) !== r) return Promise.reject(new TypeError(r + \" is not an object.\"));\n    var done = r.done;\n    return Promise.resolve(r.value).then(function (value) {\n      return {\n        value: value,\n        done: done\n      };\n    });\n  }\n\n  return AsyncFromSyncIterator = function (s) {\n    this.s = s, this.n = s.next;\n  }, AsyncFromSyncIterator.prototype = {\n    s: null,\n    n: null,\n    next: function () {\n      return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments));\n    },\n    return: function (value) {\n      var ret = this.s.return;\n      return void 0 === ret ? Promise.resolve({\n        value: value,\n        done: !0\n      }) : AsyncFromSyncIteratorContinuation(ret.apply(this.s, arguments));\n    },\n    throw: function (value) {\n      var thr = this.s.return;\n      return void 0 === thr ? Promise.reject(value) : AsyncFromSyncIteratorContinuation(thr.apply(this.s, arguments));\n    }\n  }, new AsyncFromSyncIterator(s);\n}\n\nvar REACT_ELEMENT_TYPE;\n\nfunction _jsx(type, props, key, children) {\n  REACT_ELEMENT_TYPE || (REACT_ELEMENT_TYPE = \"function\" == typeof Symbol && Symbol.for && Symbol.for(\"react.element\") || 60103);\n  var defaultProps = type && type.defaultProps,\n      childrenLength = arguments.length - 3;\n  if (props || 0 === childrenLength || (props = {\n    children: void 0\n  }), 1 === childrenLength) props.children = children;else if (childrenLength > 1) {\n    for (var childArray = new Array(childrenLength), i = 0; i < childrenLength; i++) childArray[i] = arguments[i + 3];\n\n    props.children = childArray;\n  }\n  if (props && defaultProps) for (var propName in defaultProps) void 0 === props[propName] && (props[propName] = defaultProps[propName]);else props || (props = defaultProps || {});\n  return {\n    $$typeof: REACT_ELEMENT_TYPE,\n    type: type,\n    key: void 0 === key ? null : \"\" + key,\n    ref: null,\n    props: props,\n    _owner: null\n  };\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n\nfunction _wrapRegExp() {\n  _wrapRegExp = function (re, groups) {\n    return new BabelRegExp(re, void 0, groups);\n  };\n\n  var _super = RegExp.prototype,\n      _groups = new WeakMap();\n\n  function BabelRegExp(re, flags, groups) {\n    var _this = new RegExp(re, flags);\n\n    return _groups.set(_this, groups || _groups.get(re)), _setPrototypeOf(_this, BabelRegExp.prototype);\n  }\n\n  function buildGroups(result, re) {\n    var g = _groups.get(re);\n\n    return Object.keys(g).reduce(function (groups, name) {\n      return groups[name] = result[g[name]], groups;\n    }, Object.create(null));\n  }\n\n  return _inherits(BabelRegExp, RegExp), BabelRegExp.prototype.exec = function (str) {\n    var result = _super.exec.call(this, str);\n\n    return result && (result.groups = buildGroups(result, this)), result;\n  }, BabelRegExp.prototype[Symbol.replace] = function (str, substitution) {\n    if (\"string\" == typeof substitution) {\n      var groups = _groups.get(this);\n\n      return _super[Symbol.replace].call(this, str, substitution.replace(/\\$<([^>]+)>/g, function (_, name) {\n        return \"$\" + groups[name];\n      }));\n    }\n\n    if (\"function\" == typeof substitution) {\n      var _this = this;\n\n      return _super[Symbol.replace].call(this, str, function () {\n        var args = arguments;\n        return \"object\" != typeof args[args.length - 1] && (args = [].slice.call(args)).push(buildGroups(args, _this)), substitution.apply(this, args);\n      });\n    }\n\n    return _super[Symbol.replace].call(this, str, substitution);\n  }, _wrapRegExp.apply(this, arguments);\n}\n\nfunction _AwaitValue(value) {\n  this.wrapped = value;\n}\n\nfunction _AsyncGenerator(gen) {\n  var front, back;\n\n  function send(key, arg) {\n    return new Promise(function (resolve, reject) {\n      var request = {\n        key: key,\n        arg: arg,\n        resolve: resolve,\n        reject: reject,\n        next: null\n      };\n\n      if (back) {\n        back = back.next = request;\n      } else {\n        front = back = request;\n        resume(key, arg);\n      }\n    });\n  }\n\n  function resume(key, arg) {\n    try {\n      var result = gen[key](arg);\n      var value = result.value;\n      var wrappedAwait = value instanceof _AwaitValue;\n      Promise.resolve(wrappedAwait ? value.wrapped : value).then(function (arg) {\n        if (wrappedAwait) {\n          resume(key === \"return\" ? \"return\" : \"next\", arg);\n          return;\n        }\n\n        settle(result.done ? \"return\" : \"normal\", arg);\n      }, function (err) {\n        resume(\"throw\", err);\n      });\n    } catch (err) {\n      settle(\"throw\", err);\n    }\n  }\n\n  function settle(type, value) {\n    switch (type) {\n      case \"return\":\n        front.resolve({\n          value: value,\n          done: true\n        });\n        break;\n\n      case \"throw\":\n        front.reject(value);\n        break;\n\n      default:\n        front.resolve({\n          value: value,\n          done: false\n        });\n        break;\n    }\n\n    front = front.next;\n\n    if (front) {\n      resume(front.key, front.arg);\n    } else {\n      back = null;\n    }\n  }\n\n  this._invoke = send;\n\n  if (typeof gen.return !== \"function\") {\n    this.return = undefined;\n  }\n}\n\n_AsyncGenerator.prototype[typeof Symbol === \"function\" && Symbol.asyncIterator || \"@@asyncIterator\"] = function () {\n  return this;\n};\n\n_AsyncGenerator.prototype.next = function (arg) {\n  return this._invoke(\"next\", arg);\n};\n\n_AsyncGenerator.prototype.throw = function (arg) {\n  return this._invoke(\"throw\", arg);\n};\n\n_AsyncGenerator.prototype.return = function (arg) {\n  return this._invoke(\"return\", arg);\n};\n\nfunction _wrapAsyncGenerator(fn) {\n  return function () {\n    return new _AsyncGenerator(fn.apply(this, arguments));\n  };\n}\n\nfunction _awaitAsyncGenerator(value) {\n  return new _AwaitValue(value);\n}\n\nfunction _asyncGeneratorDelegate(inner, awaitWrap) {\n  var iter = {},\n      waiting = false;\n\n  function pump(key, value) {\n    waiting = true;\n    value = new Promise(function (resolve) {\n      resolve(inner[key](value));\n    });\n    return {\n      done: false,\n      value: awaitWrap(value)\n    };\n  }\n\n  ;\n\n  iter[typeof Symbol !== \"undefined\" && Symbol.iterator || \"@@iterator\"] = function () {\n    return this;\n  };\n\n  iter.next = function (value) {\n    if (waiting) {\n      waiting = false;\n      return value;\n    }\n\n    return pump(\"next\", value);\n  };\n\n  if (typeof inner.throw === \"function\") {\n    iter.throw = function (value) {\n      if (waiting) {\n        waiting = false;\n        throw value;\n      }\n\n      return pump(\"throw\", value);\n    };\n  }\n\n  if (typeof inner.return === \"function\") {\n    iter.return = function (value) {\n      if (waiting) {\n        waiting = false;\n        return value;\n      }\n\n      return pump(\"return\", value);\n    };\n  }\n\n  return iter;\n}\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nfunction _defineEnumerableProperties(obj, descs) {\n  for (var key in descs) {\n    var desc = descs[key];\n    desc.configurable = desc.enumerable = true;\n    if (\"value\" in desc) desc.writable = true;\n    Object.defineProperty(obj, key, desc);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    var objectSymbols = Object.getOwnPropertySymbols(descs);\n\n    for (var i = 0; i < objectSymbols.length; i++) {\n      var sym = objectSymbols[i];\n      var desc = descs[sym];\n      desc.configurable = desc.enumerable = true;\n      if (\"value\" in desc) desc.writable = true;\n      Object.defineProperty(obj, sym, desc);\n    }\n  }\n\n  return obj;\n}\n\nfunction _defaults(obj, defaults) {\n  var keys = Object.getOwnPropertyNames(defaults);\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n    if (value && value.configurable && obj[key] === undefined) {\n      Object.defineProperty(obj, key, value);\n    }\n  }\n\n  return obj;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? Object(arguments[i]) : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys.push.apply(ownKeys, Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n\n  _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _isNativeFunction(fn) {\n  return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n}\n\nfunction _wrapNativeSuper(Class) {\n  var _cache = typeof Map === \"function\" ? new Map() : undefined;\n\n  _wrapNativeSuper = function _wrapNativeSuper(Class) {\n    if (Class === null || !_isNativeFunction(Class)) return Class;\n\n    if (typeof Class !== \"function\") {\n      throw new TypeError(\"Super expression must either be null or a function\");\n    }\n\n    if (typeof _cache !== \"undefined\") {\n      if (_cache.has(Class)) return _cache.get(Class);\n\n      _cache.set(Class, Wrapper);\n    }\n\n    function Wrapper() {\n      return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n    }\n\n    Wrapper.prototype = Object.create(Class.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    return _setPrototypeOf(Wrapper, Class);\n  };\n\n  return _wrapNativeSuper(Class);\n}\n\nfunction _instanceof(left, right) {\n  if (right != null && typeof Symbol !== \"undefined\" && right[Symbol.hasInstance]) {\n    return !!right[Symbol.hasInstance](left);\n  } else {\n    return left instanceof right;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function (nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\n\nfunction _interopRequireWildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache(nodeInterop);\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj.default = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction _newArrowCheck(innerThis, boundThis) {\n  if (innerThis !== boundThis) {\n    throw new TypeError(\"Cannot instantiate an arrow function\");\n  }\n}\n\nfunction _objectDestructuringEmpty(obj) {\n  if (obj == null) throw new TypeError(\"Cannot destructure undefined\");\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nfunction _get() {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(arguments.length < 3 ? target : receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get.apply(this, arguments);\n}\n\nfunction set(target, property, value, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.set) {\n    set = Reflect.set;\n  } else {\n    set = function set(target, property, value, receiver) {\n      var base = _superPropBase(target, property);\n\n      var desc;\n\n      if (base) {\n        desc = Object.getOwnPropertyDescriptor(base, property);\n\n        if (desc.set) {\n          desc.set.call(receiver, value);\n          return true;\n        } else if (!desc.writable) {\n          return false;\n        }\n      }\n\n      desc = Object.getOwnPropertyDescriptor(receiver, property);\n\n      if (desc) {\n        if (!desc.writable) {\n          return false;\n        }\n\n        desc.value = value;\n        Object.defineProperty(receiver, property, desc);\n      } else {\n        _defineProperty(receiver, property, value);\n      }\n\n      return true;\n    };\n  }\n\n  return set(target, property, value, receiver);\n}\n\nfunction _set(target, property, value, receiver, isStrict) {\n  var s = set(target, property, value, receiver || target);\n\n  if (!s && isStrict) {\n    throw new Error('failed to set property');\n  }\n\n  return value;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  return Object.freeze(Object.defineProperties(strings, {\n    raw: {\n      value: Object.freeze(raw)\n    }\n  }));\n}\n\nfunction _taggedTemplateLiteralLoose(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  strings.raw = raw;\n  return strings;\n}\n\nfunction _readOnlyError(name) {\n  throw new TypeError(\"\\\"\" + name + \"\\\" is read-only\");\n}\n\nfunction _writeOnlyError(name) {\n  throw new TypeError(\"\\\"\" + name + \"\\\" is write-only\");\n}\n\nfunction _classNameTDZError(name) {\n  throw new Error(\"Class \\\"\" + name + \"\\\" cannot be referenced in computed property keys.\");\n}\n\nfunction _temporalUndefined() {}\n\nfunction _tdz(name) {\n  throw new ReferenceError(name + \" is not defined - temporal dead zone\");\n}\n\nfunction _temporalRef(val, name) {\n  return val === _temporalUndefined ? _tdz(name) : val;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _slicedToArrayLoose(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimitLoose(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toArray(arr) {\n  return _arrayWithHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _maybeArrayLike(next, arr, i) {\n  if (arr && !Array.isArray(arr) && typeof arr.length === \"number\") {\n    var len = arr.length;\n    return _arrayLikeToArray(arr, i !== void 0 && i < len ? i : len);\n  }\n\n  return next(arr, i);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _iterableToArrayLimitLoose(arr, i) {\n  var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]);\n\n  if (_i == null) return;\n  var _arr = [];\n\n  for (_i = _i.call(arr), _step; !(_step = _i.next()).done;) {\n    _arr.push(_step.value);\n\n    if (i && _arr.length === i) break;\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function () {};\n\n      return {\n        s: F,\n        n: function () {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function (e) {\n          throw e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function () {\n      it = it.call(o);\n    },\n    n: function () {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function (e) {\n      didErr = true;\n      err = e;\n    },\n    f: function () {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (it) return (it = it.call(o)).next.bind(it);\n\n  if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n    if (it) o = it;\n    var i = 0;\n    return function () {\n      if (i >= o.length) return {\n        done: true\n      };\n      return {\n        done: false,\n        value: o[i++]\n      };\n    };\n  }\n\n  throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _skipFirstGeneratorNext(fn) {\n  return function () {\n    var it = fn.apply(this, arguments);\n    it.next();\n    return it;\n  };\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nfunction _initializerWarningHelper(descriptor, context) {\n  throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and runs after the decorators transform.');\n}\n\nfunction _initializerDefineProperty(target, property, descriptor, context) {\n  if (!descriptor) return;\n  Object.defineProperty(target, property, {\n    enumerable: descriptor.enumerable,\n    configurable: descriptor.configurable,\n    writable: descriptor.writable,\n    value: descriptor.initializer ? descriptor.initializer.call(context) : void 0\n  });\n}\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n  var desc = {};\n  Object.keys(descriptor).forEach(function (key) {\n    desc[key] = descriptor[key];\n  });\n  desc.enumerable = !!desc.enumerable;\n  desc.configurable = !!desc.configurable;\n\n  if ('value' in desc || desc.initializer) {\n    desc.writable = true;\n  }\n\n  desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n    return decorator(target, property, desc) || desc;\n  }, desc);\n\n  if (context && desc.initializer !== void 0) {\n    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n    desc.initializer = undefined;\n  }\n\n  if (desc.initializer === void 0) {\n    Object.defineProperty(target, property, desc);\n    desc = null;\n  }\n\n  return desc;\n}\n\nvar id$2 = 0;\n\nfunction _classPrivateFieldLooseKey(name) {\n  return \"__private_\" + id$2++ + \"_\" + name;\n}\n\nfunction _classPrivateFieldLooseBase(receiver, privateKey) {\n  if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n    throw new TypeError(\"attempted to use private field on non-instance\");\n  }\n\n  return receiver;\n}\n\nfunction _classPrivateFieldGet(receiver, privateMap) {\n  var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"get\");\n\n  return _classApplyDescriptorGet(receiver, descriptor);\n}\n\nfunction _classPrivateFieldSet(receiver, privateMap, value) {\n  var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"set\");\n\n  _classApplyDescriptorSet(receiver, descriptor, value);\n\n  return value;\n}\n\nfunction _classPrivateFieldDestructureSet(receiver, privateMap) {\n  var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"set\");\n\n  return _classApplyDescriptorDestructureSet(receiver, descriptor);\n}\n\nfunction _classExtractFieldDescriptor(receiver, privateMap, action) {\n  if (!privateMap.has(receiver)) {\n    throw new TypeError(\"attempted to \" + action + \" private field on non-instance\");\n  }\n\n  return privateMap.get(receiver);\n}\n\nfunction _classStaticPrivateFieldSpecGet(receiver, classConstructor, descriptor) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  _classCheckPrivateStaticFieldDescriptor(descriptor, \"get\");\n\n  return _classApplyDescriptorGet(receiver, descriptor);\n}\n\nfunction _classStaticPrivateFieldSpecSet(receiver, classConstructor, descriptor, value) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  _classCheckPrivateStaticFieldDescriptor(descriptor, \"set\");\n\n  _classApplyDescriptorSet(receiver, descriptor, value);\n\n  return value;\n}\n\nfunction _classStaticPrivateMethodGet(receiver, classConstructor, method) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  return method;\n}\n\nfunction _classStaticPrivateMethodSet() {\n  throw new TypeError(\"attempted to set read only static private field\");\n}\n\nfunction _classApplyDescriptorGet(receiver, descriptor) {\n  if (descriptor.get) {\n    return descriptor.get.call(receiver);\n  }\n\n  return descriptor.value;\n}\n\nfunction _classApplyDescriptorSet(receiver, descriptor, value) {\n  if (descriptor.set) {\n    descriptor.set.call(receiver, value);\n  } else {\n    if (!descriptor.writable) {\n      throw new TypeError(\"attempted to set read only private field\");\n    }\n\n    descriptor.value = value;\n  }\n}\n\nfunction _classApplyDescriptorDestructureSet(receiver, descriptor) {\n  if (descriptor.set) {\n    if (!(\"__destrObj\" in descriptor)) {\n      descriptor.__destrObj = {\n        set value(v) {\n          descriptor.set.call(receiver, v);\n        }\n\n      };\n    }\n\n    return descriptor.__destrObj;\n  } else {\n    if (!descriptor.writable) {\n      throw new TypeError(\"attempted to set read only private field\");\n    }\n\n    return descriptor;\n  }\n}\n\nfunction _classStaticPrivateFieldDestructureSet(receiver, classConstructor, descriptor) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  _classCheckPrivateStaticFieldDescriptor(descriptor, \"set\");\n\n  return _classApplyDescriptorDestructureSet(receiver, descriptor);\n}\n\nfunction _classCheckPrivateStaticAccess(receiver, classConstructor) {\n  if (receiver !== classConstructor) {\n    throw new TypeError(\"Private static access of wrong provenance\");\n  }\n}\n\nfunction _classCheckPrivateStaticFieldDescriptor(descriptor, action) {\n  if (descriptor === undefined) {\n    throw new TypeError(\"attempted to \" + action + \" private static field before its declaration\");\n  }\n}\n\nfunction _decorate(decorators, factory, superClass, mixins) {\n  var api = _getDecoratorsApi();\n\n  if (mixins) {\n    for (var i = 0; i < mixins.length; i++) {\n      api = mixins[i](api);\n    }\n  }\n\n  var r = factory(function initialize(O) {\n    api.initializeInstanceElements(O, decorated.elements);\n  }, superClass);\n  var decorated = api.decorateClass(_coalesceClassElements(r.d.map(_createElementDescriptor)), decorators);\n  api.initializeClassElements(r.F, decorated.elements);\n  return api.runClassFinishers(r.F, decorated.finishers);\n}\n\nfunction _getDecoratorsApi() {\n  _getDecoratorsApi = function () {\n    return api;\n  };\n\n  var api = {\n    elementsDefinitionOrder: [[\"method\"], [\"field\"]],\n    initializeInstanceElements: function (O, elements) {\n      [\"method\", \"field\"].forEach(function (kind) {\n        elements.forEach(function (element) {\n          if (element.kind === kind && element.placement === \"own\") {\n            this.defineClassElement(O, element);\n          }\n        }, this);\n      }, this);\n    },\n    initializeClassElements: function (F, elements) {\n      var proto = F.prototype;\n      [\"method\", \"field\"].forEach(function (kind) {\n        elements.forEach(function (element) {\n          var placement = element.placement;\n\n          if (element.kind === kind && (placement === \"static\" || placement === \"prototype\")) {\n            var receiver = placement === \"static\" ? F : proto;\n            this.defineClassElement(receiver, element);\n          }\n        }, this);\n      }, this);\n    },\n    defineClassElement: function (receiver, element) {\n      var descriptor = element.descriptor;\n\n      if (element.kind === \"field\") {\n        var initializer = element.initializer;\n        descriptor = {\n          enumerable: descriptor.enumerable,\n          writable: descriptor.writable,\n          configurable: descriptor.configurable,\n          value: initializer === void 0 ? void 0 : initializer.call(receiver)\n        };\n      }\n\n      Object.defineProperty(receiver, element.key, descriptor);\n    },\n    decorateClass: function (elements, decorators) {\n      var newElements = [];\n      var finishers = [];\n      var placements = {\n        static: [],\n        prototype: [],\n        own: []\n      };\n      elements.forEach(function (element) {\n        this.addElementPlacement(element, placements);\n      }, this);\n      elements.forEach(function (element) {\n        if (!_hasDecorators(element)) return newElements.push(element);\n        var elementFinishersExtras = this.decorateElement(element, placements);\n        newElements.push(elementFinishersExtras.element);\n        newElements.push.apply(newElements, elementFinishersExtras.extras);\n        finishers.push.apply(finishers, elementFinishersExtras.finishers);\n      }, this);\n\n      if (!decorators) {\n        return {\n          elements: newElements,\n          finishers: finishers\n        };\n      }\n\n      var result = this.decorateConstructor(newElements, decorators);\n      finishers.push.apply(finishers, result.finishers);\n      result.finishers = finishers;\n      return result;\n    },\n    addElementPlacement: function (element, placements, silent) {\n      var keys = placements[element.placement];\n\n      if (!silent && keys.indexOf(element.key) !== -1) {\n        throw new TypeError(\"Duplicated element (\" + element.key + \")\");\n      }\n\n      keys.push(element.key);\n    },\n    decorateElement: function (element, placements) {\n      var extras = [];\n      var finishers = [];\n\n      for (var decorators = element.decorators, i = decorators.length - 1; i >= 0; i--) {\n        var keys = placements[element.placement];\n        keys.splice(keys.indexOf(element.key), 1);\n        var elementObject = this.fromElementDescriptor(element);\n        var elementFinisherExtras = this.toElementFinisherExtras((0, decorators[i])(elementObject) || elementObject);\n        element = elementFinisherExtras.element;\n        this.addElementPlacement(element, placements);\n\n        if (elementFinisherExtras.finisher) {\n          finishers.push(elementFinisherExtras.finisher);\n        }\n\n        var newExtras = elementFinisherExtras.extras;\n\n        if (newExtras) {\n          for (var j = 0; j < newExtras.length; j++) {\n            this.addElementPlacement(newExtras[j], placements);\n          }\n\n          extras.push.apply(extras, newExtras);\n        }\n      }\n\n      return {\n        element: element,\n        finishers: finishers,\n        extras: extras\n      };\n    },\n    decorateConstructor: function (elements, decorators) {\n      var finishers = [];\n\n      for (var i = decorators.length - 1; i >= 0; i--) {\n        var obj = this.fromClassDescriptor(elements);\n        var elementsAndFinisher = this.toClassDescriptor((0, decorators[i])(obj) || obj);\n\n        if (elementsAndFinisher.finisher !== undefined) {\n          finishers.push(elementsAndFinisher.finisher);\n        }\n\n        if (elementsAndFinisher.elements !== undefined) {\n          elements = elementsAndFinisher.elements;\n\n          for (var j = 0; j < elements.length - 1; j++) {\n            for (var k = j + 1; k < elements.length; k++) {\n              if (elements[j].key === elements[k].key && elements[j].placement === elements[k].placement) {\n                throw new TypeError(\"Duplicated element (\" + elements[j].key + \")\");\n              }\n            }\n          }\n        }\n      }\n\n      return {\n        elements: elements,\n        finishers: finishers\n      };\n    },\n    fromElementDescriptor: function (element) {\n      var obj = {\n        kind: element.kind,\n        key: element.key,\n        placement: element.placement,\n        descriptor: element.descriptor\n      };\n      var desc = {\n        value: \"Descriptor\",\n        configurable: true\n      };\n      Object.defineProperty(obj, Symbol.toStringTag, desc);\n      if (element.kind === \"field\") obj.initializer = element.initializer;\n      return obj;\n    },\n    toElementDescriptors: function (elementObjects) {\n      if (elementObjects === undefined) return;\n      return _toArray(elementObjects).map(function (elementObject) {\n        var element = this.toElementDescriptor(elementObject);\n        this.disallowProperty(elementObject, \"finisher\", \"An element descriptor\");\n        this.disallowProperty(elementObject, \"extras\", \"An element descriptor\");\n        return element;\n      }, this);\n    },\n    toElementDescriptor: function (elementObject) {\n      var kind = String(elementObject.kind);\n\n      if (kind !== \"method\" && kind !== \"field\") {\n        throw new TypeError('An element descriptor\\'s .kind property must be either \"method\" or' + ' \"field\", but a decorator created an element descriptor with' + ' .kind \"' + kind + '\"');\n      }\n\n      var key = _toPropertyKey(elementObject.key);\n\n      var placement = String(elementObject.placement);\n\n      if (placement !== \"static\" && placement !== \"prototype\" && placement !== \"own\") {\n        throw new TypeError('An element descriptor\\'s .placement property must be one of \"static\",' + ' \"prototype\" or \"own\", but a decorator created an element descriptor' + ' with .placement \"' + placement + '\"');\n      }\n\n      var descriptor = elementObject.descriptor;\n      this.disallowProperty(elementObject, \"elements\", \"An element descriptor\");\n      var element = {\n        kind: kind,\n        key: key,\n        placement: placement,\n        descriptor: Object.assign({}, descriptor)\n      };\n\n      if (kind !== \"field\") {\n        this.disallowProperty(elementObject, \"initializer\", \"A method descriptor\");\n      } else {\n        this.disallowProperty(descriptor, \"get\", \"The property descriptor of a field descriptor\");\n        this.disallowProperty(descriptor, \"set\", \"The property descriptor of a field descriptor\");\n        this.disallowProperty(descriptor, \"value\", \"The property descriptor of a field descriptor\");\n        element.initializer = elementObject.initializer;\n      }\n\n      return element;\n    },\n    toElementFinisherExtras: function (elementObject) {\n      var element = this.toElementDescriptor(elementObject);\n\n      var finisher = _optionalCallableProperty(elementObject, \"finisher\");\n\n      var extras = this.toElementDescriptors(elementObject.extras);\n      return {\n        element: element,\n        finisher: finisher,\n        extras: extras\n      };\n    },\n    fromClassDescriptor: function (elements) {\n      var obj = {\n        kind: \"class\",\n        elements: elements.map(this.fromElementDescriptor, this)\n      };\n      var desc = {\n        value: \"Descriptor\",\n        configurable: true\n      };\n      Object.defineProperty(obj, Symbol.toStringTag, desc);\n      return obj;\n    },\n    toClassDescriptor: function (obj) {\n      var kind = String(obj.kind);\n\n      if (kind !== \"class\") {\n        throw new TypeError('A class descriptor\\'s .kind property must be \"class\", but a decorator' + ' created a class descriptor with .kind \"' + kind + '\"');\n      }\n\n      this.disallowProperty(obj, \"key\", \"A class descriptor\");\n      this.disallowProperty(obj, \"placement\", \"A class descriptor\");\n      this.disallowProperty(obj, \"descriptor\", \"A class descriptor\");\n      this.disallowProperty(obj, \"initializer\", \"A class descriptor\");\n      this.disallowProperty(obj, \"extras\", \"A class descriptor\");\n\n      var finisher = _optionalCallableProperty(obj, \"finisher\");\n\n      var elements = this.toElementDescriptors(obj.elements);\n      return {\n        elements: elements,\n        finisher: finisher\n      };\n    },\n    runClassFinishers: function (constructor, finishers) {\n      for (var i = 0; i < finishers.length; i++) {\n        var newConstructor = (0, finishers[i])(constructor);\n\n        if (newConstructor !== undefined) {\n          if (typeof newConstructor !== \"function\") {\n            throw new TypeError(\"Finishers must return a constructor.\");\n          }\n\n          constructor = newConstructor;\n        }\n      }\n\n      return constructor;\n    },\n    disallowProperty: function (obj, name, objectType) {\n      if (obj[name] !== undefined) {\n        throw new TypeError(objectType + \" can't have a .\" + name + \" property.\");\n      }\n    }\n  };\n  return api;\n}\n\nfunction _createElementDescriptor(def) {\n  var key = _toPropertyKey(def.key);\n\n  var descriptor;\n\n  if (def.kind === \"method\") {\n    descriptor = {\n      value: def.value,\n      writable: true,\n      configurable: true,\n      enumerable: false\n    };\n  } else if (def.kind === \"get\") {\n    descriptor = {\n      get: def.value,\n      configurable: true,\n      enumerable: false\n    };\n  } else if (def.kind === \"set\") {\n    descriptor = {\n      set: def.value,\n      configurable: true,\n      enumerable: false\n    };\n  } else if (def.kind === \"field\") {\n    descriptor = {\n      configurable: true,\n      writable: true,\n      enumerable: true\n    };\n  }\n\n  var element = {\n    kind: def.kind === \"field\" ? \"field\" : \"method\",\n    key: key,\n    placement: def.static ? \"static\" : def.kind === \"field\" ? \"own\" : \"prototype\",\n    descriptor: descriptor\n  };\n  if (def.decorators) element.decorators = def.decorators;\n  if (def.kind === \"field\") element.initializer = def.value;\n  return element;\n}\n\nfunction _coalesceGetterSetter(element, other) {\n  if (element.descriptor.get !== undefined) {\n    other.descriptor.get = element.descriptor.get;\n  } else {\n    other.descriptor.set = element.descriptor.set;\n  }\n}\n\nfunction _coalesceClassElements(elements) {\n  var newElements = [];\n\n  var isSameElement = function (other) {\n    return other.kind === \"method\" && other.key === element.key && other.placement === element.placement;\n  };\n\n  for (var i = 0; i < elements.length; i++) {\n    var element = elements[i];\n    var other;\n\n    if (element.kind === \"method\" && (other = newElements.find(isSameElement))) {\n      if (_isDataDescriptor(element.descriptor) || _isDataDescriptor(other.descriptor)) {\n        if (_hasDecorators(element) || _hasDecorators(other)) {\n          throw new ReferenceError(\"Duplicated methods (\" + element.key + \") can't be decorated.\");\n        }\n\n        other.descriptor = element.descriptor;\n      } else {\n        if (_hasDecorators(element)) {\n          if (_hasDecorators(other)) {\n            throw new ReferenceError(\"Decorators can't be placed on different accessors with for \" + \"the same property (\" + element.key + \").\");\n          }\n\n          other.decorators = element.decorators;\n        }\n\n        _coalesceGetterSetter(element, other);\n      }\n    } else {\n      newElements.push(element);\n    }\n  }\n\n  return newElements;\n}\n\nfunction _hasDecorators(element) {\n  return element.decorators && element.decorators.length;\n}\n\nfunction _isDataDescriptor(desc) {\n  return desc !== undefined && !(desc.value === undefined && desc.writable === undefined);\n}\n\nfunction _optionalCallableProperty(obj, name) {\n  var value = obj[name];\n\n  if (value !== undefined && typeof value !== \"function\") {\n    throw new TypeError(\"Expected '\" + name + \"' to be a function\");\n  }\n\n  return value;\n}\n\nfunction _classPrivateMethodGet(receiver, privateSet, fn) {\n  if (!privateSet.has(receiver)) {\n    throw new TypeError(\"attempted to get private field on non-instance\");\n  }\n\n  return fn;\n}\n\nfunction _checkPrivateRedeclaration(obj, privateCollection) {\n  if (privateCollection.has(obj)) {\n    throw new TypeError(\"Cannot initialize the same private elements twice on an object\");\n  }\n}\n\nfunction _classPrivateFieldInitSpec(obj, privateMap, value) {\n  _checkPrivateRedeclaration(obj, privateMap);\n\n  privateMap.set(obj, value);\n}\n\nfunction _classPrivateMethodInitSpec(obj, privateSet) {\n  _checkPrivateRedeclaration(obj, privateSet);\n\n  privateSet.add(obj);\n}\n\nfunction _classPrivateMethodSet() {\n  throw new TypeError(\"attempted to reassign private method\");\n}\n\nfunction _identity(x) {\n  return x;\n}\n\nclass BasicObject {\n  static proxyMethod(expression) {\n    const {\n      name,\n      toMethod,\n      toProperty,\n      optional\n    } = parseProxyMethodExpression(expression);\n\n    this.prototype[name] = function () {\n      let subject;\n      let object;\n\n      if (toMethod) {\n        if (optional) {\n          var _this$toMethod;\n\n          object = (_this$toMethod = this[toMethod]) === null || _this$toMethod === void 0 ? void 0 : _this$toMethod.call(this);\n        } else {\n          object = this[toMethod]();\n        }\n      } else if (toProperty) {\n        object = this[toProperty];\n      }\n\n      if (optional) {\n        var _object;\n\n        subject = (_object = object) === null || _object === void 0 ? void 0 : _object[name];\n\n        if (subject) {\n          return apply.call(subject, object, arguments);\n        }\n      } else {\n        subject = object[name];\n        return apply.call(subject, object, arguments);\n      }\n    };\n  }\n\n}\n\nconst parseProxyMethodExpression = function (expression) {\n  const match = expression.match(proxyMethodExpressionPattern);\n\n  if (!match) {\n    throw new Error(\"can't parse @proxyMethod expression: \".concat(expression));\n  }\n\n  const args = {\n    name: match[4]\n  };\n\n  if (match[2] != null) {\n    args.toMethod = match[1];\n  } else {\n    args.toProperty = match[1];\n  }\n\n  if (match[3] != null) {\n    args.optional = true;\n  }\n\n  return args;\n};\n\nconst {\n  apply\n} = Function.prototype;\nconst proxyMethodExpressionPattern = new RegExp(\"\\\n^\\\n(.+?)\\\n(\\\\(\\\\))?\\\n(\\\\?)?\\\n\\\\.\\\n(.+?)\\\n$\\\n\");\n\nvar _Array$from, _$codePointAt$1, _$1, _String$fromCodePoint;\n\nclass UTF16String extends BasicObject {\n  static box() {\n    let value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n\n    if (value instanceof this) {\n      return value;\n    } else {\n      return this.fromUCS2String(value === null || value === void 0 ? void 0 : value.toString());\n    }\n  }\n\n  static fromUCS2String(ucs2String) {\n    return new this(ucs2String, ucs2decode(ucs2String));\n  }\n\n  static fromCodepoints(codepoints) {\n    return new this(ucs2encode(codepoints), codepoints);\n  }\n\n  constructor(ucs2String, codepoints) {\n    super(...arguments);\n    this.ucs2String = ucs2String;\n    this.codepoints = codepoints;\n    this.length = this.codepoints.length;\n    this.ucs2Length = this.ucs2String.length;\n  }\n\n  offsetToUCS2Offset(offset) {\n    return ucs2encode(this.codepoints.slice(0, Math.max(0, offset))).length;\n  }\n\n  offsetFromUCS2Offset(ucs2Offset) {\n    return ucs2decode(this.ucs2String.slice(0, Math.max(0, ucs2Offset))).length;\n  }\n\n  slice() {\n    return this.constructor.fromCodepoints(this.codepoints.slice(...arguments));\n  }\n\n  charAt(offset) {\n    return this.slice(offset, offset + 1);\n  }\n\n  isEqualTo(value) {\n    return this.constructor.box(value).ucs2String === this.ucs2String;\n  }\n\n  toJSON() {\n    return this.ucs2String;\n  }\n\n  getCacheKey() {\n    return this.ucs2String;\n  }\n\n  toString() {\n    return this.ucs2String;\n  }\n\n}\n\nconst hasArrayFrom = ((_Array$from = Array.from) === null || _Array$from === void 0 ? void 0 : _Array$from.call(Array, \"\\ud83d\\udc7c\").length) === 1;\nconst hasStringCodePointAt$1 = ((_$codePointAt$1 = (_$1 = \" \").codePointAt) === null || _$codePointAt$1 === void 0 ? void 0 : _$codePointAt$1.call(_$1, 0)) != null;\nconst hasStringFromCodePoint = ((_String$fromCodePoint = String.fromCodePoint) === null || _String$fromCodePoint === void 0 ? void 0 : _String$fromCodePoint.call(String, 32, 128124)) === \" \\ud83d\\udc7c\"; // UCS-2 conversion helpers ported from Mathias Bynens' Punycode.js:\n// https://github.com/bestiejs/punycode.js#punycodeucs2\n\nlet ucs2decode, ucs2encode; // Creates an array containing the numeric code points of each Unicode\n// character in the string. While JavaScript uses UCS-2 internally,\n// this function will convert a pair of surrogate halves (each of which\n// UCS-2 exposes as separate characters) into a single code point,\n// matching UTF-16.\n\nif (hasArrayFrom && hasStringCodePointAt$1) {\n  ucs2decode = string => Array.from(string).map(char => char.codePointAt(0));\n} else {\n  ucs2decode = function (string) {\n    const output = [];\n    let counter = 0;\n    const {\n      length\n    } = string;\n\n    while (counter < length) {\n      let value = string.charCodeAt(counter++);\n\n      if (0xd800 <= value && value <= 0xdbff && counter < length) {\n        // high surrogate, and there is a next character\n        const extra = string.charCodeAt(counter++);\n\n        if ((extra & 0xfc00) === 0xdc00) {\n          // low surrogate\n          value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n        } else {\n          // unmatched surrogate; only append this code unit, in case the\n          // next code unit is the high surrogate of a surrogate pair\n          counter--;\n        }\n      }\n\n      output.push(value);\n    }\n\n    return output;\n  };\n} // Creates a string based on an array of numeric code points.\n\n\nif (hasStringFromCodePoint) {\n  ucs2encode = array => String.fromCodePoint(...Array.from(array || []));\n} else {\n  ucs2encode = function (array) {\n    const characters = (() => {\n      const result = [];\n      Array.from(array).forEach(value => {\n        let output = \"\";\n\n        if (value > 0xffff) {\n          value -= 0x10000;\n          output += String.fromCharCode(value >>> 10 & 0x3ff | 0xd800);\n          value = 0xdc00 | value & 0x3ff;\n        }\n\n        result.push(output + String.fromCharCode(value));\n      });\n      return result;\n    })();\n\n    return characters.join(\"\");\n  };\n}\n\nlet id$1 = 0;\n\nclass TrixObject extends BasicObject {\n  static fromJSONString(jsonString) {\n    return this.fromJSON(JSON.parse(jsonString));\n  }\n\n  constructor() {\n    super(...arguments);\n    this.id = ++id$1;\n  }\n\n  hasSameConstructorAs(object) {\n    return this.constructor === (object === null || object === void 0 ? void 0 : object.constructor);\n  }\n\n  isEqualTo(object) {\n    return this === object;\n  }\n\n  inspect() {\n    const parts = [];\n    const contents = this.contentsForInspection() || {};\n\n    for (const key in contents) {\n      const value = contents[key];\n      parts.push(\"\".concat(key, \"=\").concat(value));\n    }\n\n    return \"#<\".concat(this.constructor.name, \":\").concat(this.id).concat(parts.length ? \" \".concat(parts.join(\", \")) : \"\", \">\");\n  }\n\n  contentsForInspection() {}\n\n  toJSONString() {\n    return JSON.stringify(this);\n  }\n\n  toUTF16String() {\n    return UTF16String.box(this);\n  }\n\n  getCacheKey() {\n    return this.id.toString();\n  }\n\n}\n/* eslint-disable\n    id-length,\n*/\n\n\nconst arraysAreEqual = function () {\n  let a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  let b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  if (a.length !== b.length) {\n    return false;\n  }\n\n  for (let index = 0; index < a.length; index++) {\n    const value = a[index];\n\n    if (value !== b[index]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nconst arrayStartsWith = function () {\n  let a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  let b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return arraysAreEqual(a.slice(0, b.length), b);\n};\n\nconst spliceArray = function (array) {\n  const result = array.slice(0);\n\n  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    args[_key - 1] = arguments[_key];\n  }\n\n  result.splice(...args);\n  return result;\n};\n\nconst summarizeArrayChange = function () {\n  let oldArray = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  let newArray = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  const added = [];\n  const removed = [];\n  const existingValues = new Set();\n  oldArray.forEach(value => {\n    existingValues.add(value);\n  });\n  const currentValues = new Set();\n  newArray.forEach(value => {\n    currentValues.add(value);\n\n    if (!existingValues.has(value)) {\n      added.push(value);\n    }\n  });\n  oldArray.forEach(value => {\n    if (!currentValues.has(value)) {\n      removed.push(value);\n    }\n  });\n  return {\n    added,\n    removed\n  };\n};\n\nconst RTL_PATTERN = /[\\u05BE\\u05C0\\u05C3\\u05D0-\\u05EA\\u05F0-\\u05F4\\u061B\\u061F\\u0621-\\u063A\\u0640-\\u064A\\u066D\\u0671-\\u06B7\\u06BA-\\u06BE\\u06C0-\\u06CE\\u06D0-\\u06D5\\u06E5\\u06E6\\u200F\\u202B\\u202E\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE72\\uFE74\\uFE76-\\uFEFC]/;\n\nconst getDirection = function () {\n  const input = makeElement(\"input\", {\n    dir: \"auto\",\n    name: \"x\",\n    dirName: \"x.dir\"\n  });\n  const form = makeElement(\"form\");\n  form.appendChild(input);\n\n  const supportsDirName = function () {\n    try {\n      return new FormData(form).has(input.dirName);\n    } catch (error) {\n      return false;\n    }\n  }();\n\n  const supportsDirSelector = function () {\n    try {\n      return input.matches(\":dir(ltr),:dir(rtl)\");\n    } catch (error) {\n      return false;\n    }\n  }();\n\n  if (supportsDirName) {\n    return function (string) {\n      input.value = string;\n      return new FormData(form).get(input.dirName);\n    };\n  } else if (supportsDirSelector) {\n    return function (string) {\n      input.value = string;\n\n      if (input.matches(\":dir(rtl)\")) {\n        return \"rtl\";\n      } else {\n        return \"ltr\";\n      }\n    };\n  } else {\n    return function (string) {\n      const char = string.trim().charAt(0);\n\n      if (RTL_PATTERN.test(char)) {\n        return \"rtl\";\n      } else {\n        return \"ltr\";\n      }\n    };\n  }\n}();\n\nlet allAttributeNames = null;\nlet blockAttributeNames = null;\nlet textAttributeNames = null;\nlet listAttributeNames = null;\n\nconst getAllAttributeNames = () => {\n  if (!allAttributeNames) {\n    allAttributeNames = getTextAttributeNames().concat(getBlockAttributeNames());\n  }\n\n  return allAttributeNames;\n};\n\nconst getBlockConfig = attributeName => config.blockAttributes[attributeName];\n\nconst getBlockAttributeNames = () => {\n  if (!blockAttributeNames) {\n    blockAttributeNames = Object.keys(config.blockAttributes);\n  }\n\n  return blockAttributeNames;\n};\n\nconst getTextConfig = attributeName => config.textAttributes[attributeName];\n\nconst getTextAttributeNames = () => {\n  if (!textAttributeNames) {\n    textAttributeNames = Object.keys(config.textAttributes);\n  }\n\n  return textAttributeNames;\n};\n\nconst getListAttributeNames = () => {\n  if (!listAttributeNames) {\n    listAttributeNames = [];\n\n    for (const key in config.blockAttributes) {\n      const {\n        listAttribute\n      } = config.blockAttributes[key];\n\n      if (listAttribute != null) {\n        listAttributeNames.push(listAttribute);\n      }\n    }\n  }\n\n  return listAttributeNames;\n};\n/* eslint-disable\n*/\n\n\nconst installDefaultCSSForTagName = function (tagName, defaultCSS) {\n  const styleElement = insertStyleElementForTagName(tagName);\n  styleElement.textContent = defaultCSS.replace(/%t/g, tagName);\n};\n\nconst insertStyleElementForTagName = function (tagName) {\n  const element = document.createElement(\"style\");\n  element.setAttribute(\"type\", \"text/css\");\n  element.setAttribute(\"data-tag-name\", tagName.toLowerCase());\n  const nonce = getCSPNonce();\n\n  if (nonce) {\n    element.setAttribute(\"nonce\", nonce);\n  }\n\n  document.head.insertBefore(element, document.head.firstChild);\n  return element;\n};\n\nconst getCSPNonce = function () {\n  const element = getMetaElement(\"trix-csp-nonce\") || getMetaElement(\"csp-nonce\");\n\n  if (element) {\n    return element.getAttribute(\"content\");\n  }\n};\n\nconst getMetaElement = name => document.head.querySelector(\"meta[name=\".concat(name, \"]\"));\n\nconst testTransferData = {\n  \"application/x-trix-feature-detection\": \"test\"\n};\n\nconst dataTransferIsPlainText = function (dataTransfer) {\n  const text = dataTransfer.getData(\"text/plain\");\n  const html = dataTransfer.getData(\"text/html\");\n\n  if (text && html) {\n    const {\n      body\n    } = new DOMParser().parseFromString(html, \"text/html\");\n\n    if (body.textContent === text) {\n      return !body.querySelector(\"*\");\n    }\n  } else {\n    return text === null || text === void 0 ? void 0 : text.length;\n  }\n};\n\nconst dataTransferIsWritable = function (dataTransfer) {\n  if (!(dataTransfer !== null && dataTransfer !== void 0 && dataTransfer.setData)) return false;\n\n  for (const key in testTransferData) {\n    const value = testTransferData[key];\n\n    try {\n      dataTransfer.setData(key, value);\n      if (!dataTransfer.getData(key) === value) return false;\n    } catch (error) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nconst keyEventIsKeyboardCommand = function () {\n  if (/Mac|^iP/.test(navigator.platform)) {\n    return event => event.metaKey;\n  } else {\n    return event => event.ctrlKey;\n  }\n}();\n\nconst defer = fn => setTimeout(fn, 1);\n/* eslint-disable\n    id-length,\n*/\n\n\nconst copyObject = function () {\n  let object = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  const result = {};\n\n  for (const key in object) {\n    const value = object[key];\n    result[key] = value;\n  }\n\n  return result;\n};\n\nconst objectsAreEqual = function () {\n  let a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  let b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  if (Object.keys(a).length !== Object.keys(b).length) {\n    return false;\n  }\n\n  for (const key in a) {\n    const value = a[key];\n\n    if (value !== b[key]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nconst normalizeRange = function (range) {\n  if (range == null) return;\n\n  if (!Array.isArray(range)) {\n    range = [range, range];\n  }\n\n  return [copyValue(range[0]), copyValue(range[1] != null ? range[1] : range[0])];\n};\n\nconst rangeIsCollapsed = function (range) {\n  if (range == null) return;\n  const [start, end] = normalizeRange(range);\n  return rangeValuesAreEqual(start, end);\n};\n\nconst rangesAreEqual = function (leftRange, rightRange) {\n  if (leftRange == null || rightRange == null) return;\n  const [leftStart, leftEnd] = normalizeRange(leftRange);\n  const [rightStart, rightEnd] = normalizeRange(rightRange);\n  return rangeValuesAreEqual(leftStart, rightStart) && rangeValuesAreEqual(leftEnd, rightEnd);\n};\n\nconst copyValue = function (value) {\n  if (typeof value === \"number\") {\n    return value;\n  } else {\n    return copyObject(value);\n  }\n};\n\nconst rangeValuesAreEqual = function (left, right) {\n  if (typeof left === \"number\") {\n    return left === right;\n  } else {\n    return objectsAreEqual(left, right);\n  }\n};\n/* eslint-disable\n    id-length,\n*/\n\n\nclass SelectionChangeObserver extends BasicObject {\n  constructor() {\n    super(...arguments);\n    this.update = this.update.bind(this);\n    this.run = this.run.bind(this);\n    this.selectionManagers = [];\n  }\n\n  start() {\n    if (!this.started) {\n      this.started = true;\n\n      if (\"onselectionchange\" in document) {\n        return document.addEventListener(\"selectionchange\", this.update, true);\n      } else {\n        return this.run();\n      }\n    }\n  }\n\n  stop() {\n    if (this.started) {\n      this.started = false;\n      return document.removeEventListener(\"selectionchange\", this.update, true);\n    }\n  }\n\n  registerSelectionManager(selectionManager) {\n    if (!this.selectionManagers.includes(selectionManager)) {\n      this.selectionManagers.push(selectionManager);\n      return this.start();\n    }\n  }\n\n  unregisterSelectionManager(selectionManager) {\n    this.selectionManagers = this.selectionManagers.filter(s => s !== selectionManager);\n\n    if (this.selectionManagers.length === 0) {\n      return this.stop();\n    }\n  }\n\n  notifySelectionManagersOfSelectionChange() {\n    return this.selectionManagers.map(selectionManager => selectionManager.selectionDidChange());\n  }\n\n  update() {\n    const domRange = getDOMRange();\n\n    if (!domRangesAreEqual(domRange, this.domRange)) {\n      this.domRange = domRange;\n      return this.notifySelectionManagersOfSelectionChange();\n    }\n  }\n\n  reset() {\n    this.domRange = null;\n    return this.update();\n  } // Private\n\n\n  run() {\n    if (this.started) {\n      this.update();\n      return requestAnimationFrame(this.run);\n    }\n  }\n\n}\n\nconst domRangesAreEqual = (left, right) => (left === null || left === void 0 ? void 0 : left.startContainer) === (right === null || right === void 0 ? void 0 : right.startContainer) && (left === null || left === void 0 ? void 0 : left.startOffset) === (right === null || right === void 0 ? void 0 : right.startOffset) && (left === null || left === void 0 ? void 0 : left.endContainer) === (right === null || right === void 0 ? void 0 : right.endContainer) && (left === null || left === void 0 ? void 0 : left.endOffset) === (right === null || right === void 0 ? void 0 : right.endOffset);\n\nconst selectionChangeObserver = new SelectionChangeObserver();\n\nconst getDOMSelection = function () {\n  const selection = window.getSelection();\n\n  if (selection.rangeCount > 0) {\n    return selection;\n  }\n};\n\nconst getDOMRange = function () {\n  var _getDOMSelection;\n\n  const domRange = (_getDOMSelection = getDOMSelection()) === null || _getDOMSelection === void 0 ? void 0 : _getDOMSelection.getRangeAt(0);\n\n  if (domRange) {\n    if (!domRangeIsPrivate(domRange)) {\n      return domRange;\n    }\n  }\n};\n\nconst setDOMRange = function (domRange) {\n  const selection = window.getSelection();\n  selection.removeAllRanges();\n  selection.addRange(domRange);\n  return selectionChangeObserver.update();\n}; // In Firefox, clicking certain <input> elements changes the selection to a\n// private element used to draw its UI. Attempting to access properties of those\n// elements throws an error.\n// https://bugzilla.mozilla.org/show_bug.cgi?id=208427\n\n\nconst domRangeIsPrivate = domRange => nodeIsPrivate(domRange.startContainer) || nodeIsPrivate(domRange.endContainer);\n\nconst nodeIsPrivate = node => !Object.getPrototypeOf(node);\n/* eslint-disable\n    id-length,\n    no-useless-escape,\n*/\n\n\nconst normalizeSpaces = string => string.replace(new RegExp(\"\".concat(ZERO_WIDTH_SPACE), \"g\"), \"\").replace(new RegExp(\"\".concat(NON_BREAKING_SPACE), \"g\"), \" \");\n\nconst normalizeNewlines = string => string.replace(/\\r\\n/g, \"\\n\");\n\nconst breakableWhitespacePattern = new RegExp(\"[^\\\\S\".concat(NON_BREAKING_SPACE, \"]\"));\n\nconst squishBreakableWhitespace = string => string // Replace all breakable whitespace characters with a space\n.replace(new RegExp(\"\".concat(breakableWhitespacePattern.source), \"g\"), \" \") // Replace two or more spaces with a single space\n.replace(/\\ {2,}/g, \" \");\n\nconst summarizeStringChange = function (oldString, newString) {\n  let added, removed;\n  oldString = UTF16String.box(oldString);\n  newString = UTF16String.box(newString);\n\n  if (newString.length < oldString.length) {\n    [removed, added] = utf16StringDifferences(oldString, newString);\n  } else {\n    [added, removed] = utf16StringDifferences(newString, oldString);\n  }\n\n  return {\n    added,\n    removed\n  };\n};\n\nconst utf16StringDifferences = function (a, b) {\n  if (a.isEqualTo(b)) {\n    return [\"\", \"\"];\n  }\n\n  const diffA = utf16StringDifference(a, b);\n  const {\n    length\n  } = diffA.utf16String;\n  let diffB;\n\n  if (length) {\n    const {\n      offset\n    } = diffA;\n    const codepoints = a.codepoints.slice(0, offset).concat(a.codepoints.slice(offset + length));\n    diffB = utf16StringDifference(b, UTF16String.fromCodepoints(codepoints));\n  } else {\n    diffB = utf16StringDifference(b, a);\n  }\n\n  return [diffA.utf16String.toString(), diffB.utf16String.toString()];\n};\n\nconst utf16StringDifference = function (a, b) {\n  let leftIndex = 0;\n  let rightIndexA = a.length;\n  let rightIndexB = b.length;\n\n  while (leftIndex < rightIndexA && a.charAt(leftIndex).isEqualTo(b.charAt(leftIndex))) {\n    leftIndex++;\n  }\n\n  while (rightIndexA > leftIndex + 1 && a.charAt(rightIndexA - 1).isEqualTo(b.charAt(rightIndexB - 1))) {\n    rightIndexA--;\n    rightIndexB--;\n  }\n\n  return {\n    utf16String: a.slice(leftIndex, rightIndexA),\n    offset: leftIndex\n  };\n};\n\nclass Hash extends TrixObject {\n  static fromCommonAttributesOfObjects() {\n    let objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n    if (!objects.length) {\n      return new this();\n    }\n\n    let hash = box(objects[0]);\n    let keys = hash.getKeys();\n    objects.slice(1).forEach(object => {\n      keys = hash.getKeysCommonToHash(box(object));\n      hash = hash.slice(keys);\n    });\n    return hash;\n  }\n\n  static box(values) {\n    return box(values);\n  }\n\n  constructor() {\n    let values = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super(...arguments);\n    this.values = copy(values);\n  }\n\n  add(key, value) {\n    return this.merge(object(key, value));\n  }\n\n  remove(key) {\n    return new Hash(copy(this.values, key));\n  }\n\n  get(key) {\n    return this.values[key];\n  }\n\n  has(key) {\n    return key in this.values;\n  }\n\n  merge(values) {\n    return new Hash(merge(this.values, unbox(values)));\n  }\n\n  slice(keys) {\n    const values = {};\n    keys.forEach(key => {\n      if (this.has(key)) {\n        values[key] = this.values[key];\n      }\n    });\n    return new Hash(values);\n  }\n\n  getKeys() {\n    return Object.keys(this.values);\n  }\n\n  getKeysCommonToHash(hash) {\n    hash = box(hash);\n    return this.getKeys().filter(key => this.values[key] === hash.values[key]);\n  }\n\n  isEqualTo(values) {\n    return arraysAreEqual(this.toArray(), box(values).toArray());\n  }\n\n  isEmpty() {\n    return this.getKeys().length === 0;\n  }\n\n  toArray() {\n    if (!this.array) {\n      const result = [];\n\n      for (const key in this.values) {\n        const value = this.values[key];\n        result.push(result.push(key, value));\n      }\n\n      this.array = result.slice(0);\n    }\n\n    return this.array;\n  }\n\n  toObject() {\n    return copy(this.values);\n  }\n\n  toJSON() {\n    return this.toObject();\n  }\n\n  contentsForInspection() {\n    return {\n      values: JSON.stringify(this.values)\n    };\n  }\n\n}\n\nconst object = function (key, value) {\n  const result = {};\n  result[key] = value;\n  return result;\n};\n\nconst merge = function (object, values) {\n  const result = copy(object);\n\n  for (const key in values) {\n    const value = values[key];\n    result[key] = value;\n  }\n\n  return result;\n};\n\nconst copy = function (object, keyToRemove) {\n  const result = {};\n  const sortedKeys = Object.keys(object).sort();\n  sortedKeys.forEach(key => {\n    if (key !== keyToRemove) {\n      result[key] = object[key];\n    }\n  });\n  return result;\n};\n\nconst box = function (object) {\n  if (object instanceof Hash) {\n    return object;\n  } else {\n    return new Hash(object);\n  }\n};\n\nconst unbox = function (object) {\n  if (object instanceof Hash) {\n    return object.values;\n  } else {\n    return object;\n  }\n};\n\nclass Operation extends BasicObject {\n  isPerforming() {\n    return this.performing === true;\n  }\n\n  hasPerformed() {\n    return this.performed === true;\n  }\n\n  hasSucceeded() {\n    return this.performed && this.succeeded;\n  }\n\n  hasFailed() {\n    return this.performed && !this.succeeded;\n  }\n\n  getPromise() {\n    if (!this.promise) {\n      this.promise = new Promise((resolve, reject) => {\n        this.performing = true;\n        return this.perform((succeeded, result) => {\n          this.succeeded = succeeded;\n          this.performing = false;\n          this.performed = true;\n\n          if (this.succeeded) {\n            resolve(result);\n          } else {\n            reject(result);\n          }\n        });\n      });\n    }\n\n    return this.promise;\n  }\n\n  perform(callback) {\n    return callback(false);\n  }\n\n  release() {\n    var _this$promise, _this$promise$cancel;\n\n    (_this$promise = this.promise) === null || _this$promise === void 0 ? void 0 : (_this$promise$cancel = _this$promise.cancel) === null || _this$promise$cancel === void 0 ? void 0 : _this$promise$cancel.call(_this$promise);\n    this.promise = null;\n    this.performing = null;\n    this.performed = null;\n    this.succeeded = null;\n  }\n\n}\n\nOperation.proxyMethod(\"getPromise().then\");\nOperation.proxyMethod(\"getPromise().catch\");\n\nclass ImagePreloadOperation extends Operation {\n  constructor(url) {\n    super(...arguments);\n    this.url = url;\n  }\n\n  perform(callback) {\n    const image = new Image();\n\n    image.onload = () => {\n      image.width = this.width = image.naturalWidth;\n      image.height = this.height = image.naturalHeight;\n      return callback(true, image);\n    };\n\n    image.onerror = () => callback(false);\n\n    image.src = this.url;\n  }\n\n}\n\nclass Attachment extends TrixObject {\n  static attachmentForFile(file) {\n    const attributes = this.attributesForFile(file);\n    const attachment = new this(attributes);\n    attachment.setFile(file);\n    return attachment;\n  }\n\n  static attributesForFile(file) {\n    return new Hash({\n      filename: file.name,\n      filesize: file.size,\n      contentType: file.type\n    });\n  }\n\n  static fromJSON(attachmentJSON) {\n    return new this(attachmentJSON);\n  }\n\n  constructor() {\n    let attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super(attributes);\n    this.releaseFile = this.releaseFile.bind(this);\n    this.attributes = Hash.box(attributes);\n    this.didChangeAttributes();\n  }\n\n  getAttribute(attribute) {\n    return this.attributes.get(attribute);\n  }\n\n  hasAttribute(attribute) {\n    return this.attributes.has(attribute);\n  }\n\n  getAttributes() {\n    return this.attributes.toObject();\n  }\n\n  setAttributes() {\n    let attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const newAttributes = this.attributes.merge(attributes);\n\n    if (!this.attributes.isEqualTo(newAttributes)) {\n      var _this$previewDelegate, _this$previewDelegate2, _this$delegate, _this$delegate$attach;\n\n      this.attributes = newAttributes;\n      this.didChangeAttributes();\n      (_this$previewDelegate = this.previewDelegate) === null || _this$previewDelegate === void 0 ? void 0 : (_this$previewDelegate2 = _this$previewDelegate.attachmentDidChangeAttributes) === null || _this$previewDelegate2 === void 0 ? void 0 : _this$previewDelegate2.call(_this$previewDelegate, this);\n      return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$attach = _this$delegate.attachmentDidChangeAttributes) === null || _this$delegate$attach === void 0 ? void 0 : _this$delegate$attach.call(_this$delegate, this);\n    }\n  }\n\n  didChangeAttributes() {\n    if (this.isPreviewable()) {\n      return this.preloadURL();\n    }\n  }\n\n  isPending() {\n    return this.file != null && !(this.getURL() || this.getHref());\n  }\n\n  isPreviewable() {\n    if (this.attributes.has(\"previewable\")) {\n      return this.attributes.get(\"previewable\");\n    } else {\n      return Attachment.previewablePattern.test(this.getContentType());\n    }\n  }\n\n  getType() {\n    if (this.hasContent()) {\n      return \"content\";\n    } else if (this.isPreviewable()) {\n      return \"preview\";\n    } else {\n      return \"file\";\n    }\n  }\n\n  getURL() {\n    return this.attributes.get(\"url\");\n  }\n\n  getHref() {\n    return this.attributes.get(\"href\");\n  }\n\n  getFilename() {\n    return this.attributes.get(\"filename\") || \"\";\n  }\n\n  getFilesize() {\n    return this.attributes.get(\"filesize\");\n  }\n\n  getFormattedFilesize() {\n    const filesize = this.attributes.get(\"filesize\");\n\n    if (typeof filesize === \"number\") {\n      return config.fileSize.formatter(filesize);\n    } else {\n      return \"\";\n    }\n  }\n\n  getExtension() {\n    var _this$getFilename$mat;\n\n    return (_this$getFilename$mat = this.getFilename().match(/\\.(\\w+)$/)) === null || _this$getFilename$mat === void 0 ? void 0 : _this$getFilename$mat[1].toLowerCase();\n  }\n\n  getContentType() {\n    return this.attributes.get(\"contentType\");\n  }\n\n  hasContent() {\n    return this.attributes.has(\"content\");\n  }\n\n  getContent() {\n    return this.attributes.get(\"content\");\n  }\n\n  getWidth() {\n    return this.attributes.get(\"width\");\n  }\n\n  getHeight() {\n    return this.attributes.get(\"height\");\n  }\n\n  getFile() {\n    return this.file;\n  }\n\n  setFile(file) {\n    this.file = file;\n\n    if (this.isPreviewable()) {\n      return this.preloadFile();\n    }\n  }\n\n  releaseFile() {\n    this.releasePreloadedFile();\n    this.file = null;\n  }\n\n  getUploadProgress() {\n    return this.uploadProgress != null ? this.uploadProgress : 0;\n  }\n\n  setUploadProgress(value) {\n    if (this.uploadProgress !== value) {\n      var _this$uploadProgressD, _this$uploadProgressD2;\n\n      this.uploadProgress = value;\n      return (_this$uploadProgressD = this.uploadProgressDelegate) === null || _this$uploadProgressD === void 0 ? void 0 : (_this$uploadProgressD2 = _this$uploadProgressD.attachmentDidChangeUploadProgress) === null || _this$uploadProgressD2 === void 0 ? void 0 : _this$uploadProgressD2.call(_this$uploadProgressD, this);\n    }\n  }\n\n  toJSON() {\n    return this.getAttributes();\n  }\n\n  getCacheKey() {\n    return [super.getCacheKey(...arguments), this.attributes.getCacheKey(), this.getPreviewURL()].join(\"/\");\n  } // Previewable\n\n\n  getPreviewURL() {\n    return this.previewURL || this.preloadingURL;\n  }\n\n  setPreviewURL(url) {\n    if (url !== this.getPreviewURL()) {\n      var _this$previewDelegate3, _this$previewDelegate4, _this$delegate2, _this$delegate2$attac;\n\n      this.previewURL = url;\n      (_this$previewDelegate3 = this.previewDelegate) === null || _this$previewDelegate3 === void 0 ? void 0 : (_this$previewDelegate4 = _this$previewDelegate3.attachmentDidChangeAttributes) === null || _this$previewDelegate4 === void 0 ? void 0 : _this$previewDelegate4.call(_this$previewDelegate3, this);\n      return (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$attac = _this$delegate2.attachmentDidChangePreviewURL) === null || _this$delegate2$attac === void 0 ? void 0 : _this$delegate2$attac.call(_this$delegate2, this);\n    }\n  }\n\n  preloadURL() {\n    return this.preload(this.getURL(), this.releaseFile);\n  }\n\n  preloadFile() {\n    if (this.file) {\n      this.fileObjectURL = URL.createObjectURL(this.file);\n      return this.preload(this.fileObjectURL);\n    }\n  }\n\n  releasePreloadedFile() {\n    if (this.fileObjectURL) {\n      URL.revokeObjectURL(this.fileObjectURL);\n      this.fileObjectURL = null;\n    }\n  }\n\n  preload(url, callback) {\n    if (url && url !== this.getPreviewURL()) {\n      this.preloadingURL = url;\n      const operation = new ImagePreloadOperation(url);\n      return operation.then(_ref => {\n        let {\n          width,\n          height\n        } = _ref;\n\n        if (!this.getWidth() || !this.getHeight()) {\n          this.setAttributes({\n            width,\n            height\n          });\n        }\n\n        this.preloadingURL = null;\n        this.setPreviewURL(url);\n        return callback === null || callback === void 0 ? void 0 : callback();\n      }).catch(() => {\n        this.preloadingURL = null;\n        return callback === null || callback === void 0 ? void 0 : callback();\n      });\n    }\n  }\n\n}\n\n_defineProperty(Attachment, \"previewablePattern\", /^image(\\/(gif|png|jpe?g)|$)/);\n\nclass ManagedAttachment extends BasicObject {\n  constructor(attachmentManager, attachment) {\n    super(...arguments);\n    this.attachmentManager = attachmentManager;\n    this.attachment = attachment;\n    this.id = this.attachment.id;\n    this.file = this.attachment.file;\n  }\n\n  remove() {\n    return this.attachmentManager.requestRemovalOfAttachment(this.attachment);\n  }\n\n}\n\nManagedAttachment.proxyMethod(\"attachment.getAttribute\");\nManagedAttachment.proxyMethod(\"attachment.hasAttribute\");\nManagedAttachment.proxyMethod(\"attachment.setAttribute\");\nManagedAttachment.proxyMethod(\"attachment.getAttributes\");\nManagedAttachment.proxyMethod(\"attachment.setAttributes\");\nManagedAttachment.proxyMethod(\"attachment.isPending\");\nManagedAttachment.proxyMethod(\"attachment.isPreviewable\");\nManagedAttachment.proxyMethod(\"attachment.getURL\");\nManagedAttachment.proxyMethod(\"attachment.getHref\");\nManagedAttachment.proxyMethod(\"attachment.getFilename\");\nManagedAttachment.proxyMethod(\"attachment.getFilesize\");\nManagedAttachment.proxyMethod(\"attachment.getFormattedFilesize\");\nManagedAttachment.proxyMethod(\"attachment.getExtension\");\nManagedAttachment.proxyMethod(\"attachment.getContentType\");\nManagedAttachment.proxyMethod(\"attachment.getFile\");\nManagedAttachment.proxyMethod(\"attachment.setFile\");\nManagedAttachment.proxyMethod(\"attachment.releaseFile\");\nManagedAttachment.proxyMethod(\"attachment.getUploadProgress\");\nManagedAttachment.proxyMethod(\"attachment.setUploadProgress\");\n\nclass AttachmentManager extends BasicObject {\n  constructor() {\n    let attachments = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n    this.managedAttachments = {};\n    Array.from(attachments).forEach(attachment => {\n      this.manageAttachment(attachment);\n    });\n  }\n\n  getAttachments() {\n    const result = [];\n\n    for (const id in this.managedAttachments) {\n      const attachment = this.managedAttachments[id];\n      result.push(attachment);\n    }\n\n    return result;\n  }\n\n  manageAttachment(attachment) {\n    if (!this.managedAttachments[attachment.id]) {\n      this.managedAttachments[attachment.id] = new ManagedAttachment(this, attachment);\n    }\n\n    return this.managedAttachments[attachment.id];\n  }\n\n  attachmentIsManaged(attachment) {\n    return attachment.id in this.managedAttachments;\n  }\n\n  requestRemovalOfAttachment(attachment) {\n    if (this.attachmentIsManaged(attachment)) {\n      var _this$delegate, _this$delegate$attach;\n\n      return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$attach = _this$delegate.attachmentManagerDidRequestRemovalOfAttachment) === null || _this$delegate$attach === void 0 ? void 0 : _this$delegate$attach.call(_this$delegate, attachment);\n    }\n  }\n\n  unmanageAttachment(attachment) {\n    const managedAttachment = this.managedAttachments[attachment.id];\n    delete this.managedAttachments[attachment.id];\n    return managedAttachment;\n  }\n\n}\n\nclass Piece extends TrixObject {\n  static registerType(type, constructor) {\n    constructor.type = type;\n    this.types[type] = constructor;\n  }\n\n  static fromJSON(pieceJSON) {\n    const constructor = this.types[pieceJSON.type];\n\n    if (constructor) {\n      return constructor.fromJSON(pieceJSON);\n    }\n  }\n\n  constructor(value) {\n    let attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super(...arguments);\n    this.attributes = Hash.box(attributes);\n  }\n\n  copyWithAttributes(attributes) {\n    return new this.constructor(this.getValue(), attributes);\n  }\n\n  copyWithAdditionalAttributes(attributes) {\n    return this.copyWithAttributes(this.attributes.merge(attributes));\n  }\n\n  copyWithoutAttribute(attribute) {\n    return this.copyWithAttributes(this.attributes.remove(attribute));\n  }\n\n  copy() {\n    return this.copyWithAttributes(this.attributes);\n  }\n\n  getAttribute(attribute) {\n    return this.attributes.get(attribute);\n  }\n\n  getAttributesHash() {\n    return this.attributes;\n  }\n\n  getAttributes() {\n    return this.attributes.toObject();\n  }\n\n  hasAttribute(attribute) {\n    return this.attributes.has(attribute);\n  }\n\n  hasSameStringValueAsPiece(piece) {\n    return piece && this.toString() === piece.toString();\n  }\n\n  hasSameAttributesAsPiece(piece) {\n    return piece && (this.attributes === piece.attributes || this.attributes.isEqualTo(piece.attributes));\n  }\n\n  isBlockBreak() {\n    return false;\n  }\n\n  isEqualTo(piece) {\n    return super.isEqualTo(...arguments) || this.hasSameConstructorAs(piece) && this.hasSameStringValueAsPiece(piece) && this.hasSameAttributesAsPiece(piece);\n  }\n\n  isEmpty() {\n    return this.length === 0;\n  }\n\n  isSerializable() {\n    return true;\n  }\n\n  toJSON() {\n    return {\n      type: this.constructor.type,\n      attributes: this.getAttributes()\n    };\n  }\n\n  contentsForInspection() {\n    return {\n      type: this.constructor.type,\n      attributes: this.attributes.inspect()\n    };\n  } // Grouping\n\n\n  canBeGrouped() {\n    return this.hasAttribute(\"href\");\n  }\n\n  canBeGroupedWith(piece) {\n    return this.getAttribute(\"href\") === piece.getAttribute(\"href\");\n  } // Splittable\n\n\n  getLength() {\n    return this.length;\n  }\n\n  canBeConsolidatedWith(piece) {\n    return false;\n  }\n\n}\n\n_defineProperty(Piece, \"types\", {});\n\nclass AttachmentPiece extends Piece {\n  static fromJSON(pieceJSON) {\n    return new this(Attachment.fromJSON(pieceJSON.attachment), pieceJSON.attributes);\n  }\n\n  constructor(attachment) {\n    super(...arguments);\n    this.attachment = attachment;\n    this.length = 1;\n    this.ensureAttachmentExclusivelyHasAttribute(\"href\");\n\n    if (!this.attachment.hasContent()) {\n      this.removeProhibitedAttributes();\n    }\n  }\n\n  ensureAttachmentExclusivelyHasAttribute(attribute) {\n    if (this.hasAttribute(attribute)) {\n      if (!this.attachment.hasAttribute(attribute)) {\n        this.attachment.setAttributes(this.attributes.slice(attribute));\n      }\n\n      this.attributes = this.attributes.remove(attribute);\n    }\n  }\n\n  removeProhibitedAttributes() {\n    const attributes = this.attributes.slice(AttachmentPiece.permittedAttributes);\n\n    if (!attributes.isEqualTo(this.attributes)) {\n      this.attributes = attributes;\n    }\n  }\n\n  getValue() {\n    return this.attachment;\n  }\n\n  isSerializable() {\n    return !this.attachment.isPending();\n  }\n\n  getCaption() {\n    return this.attributes.get(\"caption\") || \"\";\n  }\n\n  isEqualTo(piece) {\n    var _piece$attachment;\n\n    return super.isEqualTo(piece) && this.attachment.id === (piece === null || piece === void 0 ? void 0 : (_piece$attachment = piece.attachment) === null || _piece$attachment === void 0 ? void 0 : _piece$attachment.id);\n  }\n\n  toString() {\n    return OBJECT_REPLACEMENT_CHARACTER;\n  }\n\n  toJSON() {\n    const json = super.toJSON(...arguments);\n    json.attachment = this.attachment;\n    return json;\n  }\n\n  getCacheKey() {\n    return [super.getCacheKey(...arguments), this.attachment.getCacheKey()].join(\"/\");\n  }\n\n  toConsole() {\n    return JSON.stringify(this.toString());\n  }\n\n}\n\n_defineProperty(AttachmentPiece, \"permittedAttributes\", [\"caption\", \"presentation\"]);\n\nPiece.registerType(\"attachment\", AttachmentPiece);\n\nclass StringPiece extends Piece {\n  static fromJSON(pieceJSON) {\n    return new this(pieceJSON.string, pieceJSON.attributes);\n  }\n\n  constructor(string) {\n    super(...arguments);\n    this.string = normalizeNewlines(string);\n    this.length = this.string.length;\n  }\n\n  getValue() {\n    return this.string;\n  }\n\n  toString() {\n    return this.string.toString();\n  }\n\n  isBlockBreak() {\n    return this.toString() === \"\\n\" && this.getAttribute(\"blockBreak\") === true;\n  }\n\n  toJSON() {\n    const result = super.toJSON(...arguments);\n    result.string = this.string;\n    return result;\n  } // Splittable\n\n\n  canBeConsolidatedWith(piece) {\n    return piece && this.hasSameConstructorAs(piece) && this.hasSameAttributesAsPiece(piece);\n  }\n\n  consolidateWith(piece) {\n    return new this.constructor(this.toString() + piece.toString(), this.attributes);\n  }\n\n  splitAtOffset(offset) {\n    let left, right;\n\n    if (offset === 0) {\n      left = null;\n      right = this;\n    } else if (offset === this.length) {\n      left = this;\n      right = null;\n    } else {\n      left = new this.constructor(this.string.slice(0, offset), this.attributes);\n      right = new this.constructor(this.string.slice(offset), this.attributes);\n    }\n\n    return [left, right];\n  }\n\n  toConsole() {\n    let {\n      string\n    } = this;\n\n    if (string.length > 15) {\n      string = string.slice(0, 14) + \"…\";\n    }\n\n    return JSON.stringify(string.toString());\n  }\n\n}\n\nPiece.registerType(\"string\", StringPiece);\n/* eslint-disable\n    prefer-const,\n*/\n\nclass SplittableList extends TrixObject {\n  static box(objects) {\n    if (objects instanceof this) {\n      return objects;\n    } else {\n      return new this(objects);\n    }\n  }\n\n  constructor() {\n    let objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n    this.objects = objects.slice(0);\n    this.length = this.objects.length;\n  }\n\n  indexOf(object) {\n    return this.objects.indexOf(object);\n  }\n\n  splice() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return new this.constructor(spliceArray(this.objects, ...args));\n  }\n\n  eachObject(callback) {\n    return this.objects.map((object, index) => callback(object, index));\n  }\n\n  insertObjectAtIndex(object, index) {\n    return this.splice(index, 0, object);\n  }\n\n  insertSplittableListAtIndex(splittableList, index) {\n    return this.splice(index, 0, ...splittableList.objects);\n  }\n\n  insertSplittableListAtPosition(splittableList, position) {\n    const [objects, index] = this.splitObjectAtPosition(position);\n    return new this.constructor(objects).insertSplittableListAtIndex(splittableList, index);\n  }\n\n  editObjectAtIndex(index, callback) {\n    return this.replaceObjectAtIndex(callback(this.objects[index]), index);\n  }\n\n  replaceObjectAtIndex(object, index) {\n    return this.splice(index, 1, object);\n  }\n\n  removeObjectAtIndex(index) {\n    return this.splice(index, 1);\n  }\n\n  getObjectAtIndex(index) {\n    return this.objects[index];\n  }\n\n  getSplittableListInRange(range) {\n    const [objects, leftIndex, rightIndex] = this.splitObjectsAtRange(range);\n    return new this.constructor(objects.slice(leftIndex, rightIndex + 1));\n  }\n\n  selectSplittableList(test) {\n    const objects = this.objects.filter(object => test(object));\n    return new this.constructor(objects);\n  }\n\n  removeObjectsInRange(range) {\n    const [objects, leftIndex, rightIndex] = this.splitObjectsAtRange(range);\n    return new this.constructor(objects).splice(leftIndex, rightIndex - leftIndex + 1);\n  }\n\n  transformObjectsInRange(range, transform) {\n    const [objects, leftIndex, rightIndex] = this.splitObjectsAtRange(range);\n    const transformedObjects = objects.map((object, index) => leftIndex <= index && index <= rightIndex ? transform(object) : object);\n    return new this.constructor(transformedObjects);\n  }\n\n  splitObjectsAtRange(range) {\n    let rightOuterIndex;\n    let [objects, leftInnerIndex, offset] = this.splitObjectAtPosition(startOfRange(range));\n    [objects, rightOuterIndex] = new this.constructor(objects).splitObjectAtPosition(endOfRange(range) + offset);\n    return [objects, leftInnerIndex, rightOuterIndex - 1];\n  }\n\n  getObjectAtPosition(position) {\n    const {\n      index\n    } = this.findIndexAndOffsetAtPosition(position);\n    return this.objects[index];\n  }\n\n  splitObjectAtPosition(position) {\n    let splitIndex, splitOffset;\n    const {\n      index,\n      offset\n    } = this.findIndexAndOffsetAtPosition(position);\n    const objects = this.objects.slice(0);\n\n    if (index != null) {\n      if (offset === 0) {\n        splitIndex = index;\n        splitOffset = 0;\n      } else {\n        const object = this.getObjectAtIndex(index);\n        const [leftObject, rightObject] = object.splitAtOffset(offset);\n        objects.splice(index, 1, leftObject, rightObject);\n        splitIndex = index + 1;\n        splitOffset = leftObject.getLength() - offset;\n      }\n    } else {\n      splitIndex = objects.length;\n      splitOffset = 0;\n    }\n\n    return [objects, splitIndex, splitOffset];\n  }\n\n  consolidate() {\n    const objects = [];\n    let pendingObject = this.objects[0];\n    this.objects.slice(1).forEach(object => {\n      var _pendingObject$canBeC, _pendingObject;\n\n      if ((_pendingObject$canBeC = (_pendingObject = pendingObject).canBeConsolidatedWith) !== null && _pendingObject$canBeC !== void 0 && _pendingObject$canBeC.call(_pendingObject, object)) {\n        pendingObject = pendingObject.consolidateWith(object);\n      } else {\n        objects.push(pendingObject);\n        pendingObject = object;\n      }\n    });\n\n    if (pendingObject) {\n      objects.push(pendingObject);\n    }\n\n    return new this.constructor(objects);\n  }\n\n  consolidateFromIndexToIndex(startIndex, endIndex) {\n    const objects = this.objects.slice(0);\n    const objectsInRange = objects.slice(startIndex, endIndex + 1);\n    const consolidatedInRange = new this.constructor(objectsInRange).consolidate().toArray();\n    return this.splice(startIndex, objectsInRange.length, ...consolidatedInRange);\n  }\n\n  findIndexAndOffsetAtPosition(position) {\n    let index;\n    let currentPosition = 0;\n\n    for (index = 0; index < this.objects.length; index++) {\n      const object = this.objects[index];\n      const nextPosition = currentPosition + object.getLength();\n\n      if (currentPosition <= position && position < nextPosition) {\n        return {\n          index,\n          offset: position - currentPosition\n        };\n      }\n\n      currentPosition = nextPosition;\n    }\n\n    return {\n      index: null,\n      offset: null\n    };\n  }\n\n  findPositionAtIndexAndOffset(index, offset) {\n    let position = 0;\n\n    for (let currentIndex = 0; currentIndex < this.objects.length; currentIndex++) {\n      const object = this.objects[currentIndex];\n\n      if (currentIndex < index) {\n        position += object.getLength();\n      } else if (currentIndex === index) {\n        position += offset;\n        break;\n      }\n    }\n\n    return position;\n  }\n\n  getEndPosition() {\n    if (this.endPosition == null) {\n      this.endPosition = 0;\n      this.objects.forEach(object => this.endPosition += object.getLength());\n    }\n\n    return this.endPosition;\n  }\n\n  toString() {\n    return this.objects.join(\"\");\n  }\n\n  toArray() {\n    return this.objects.slice(0);\n  }\n\n  toJSON() {\n    return this.toArray();\n  }\n\n  isEqualTo(splittableList) {\n    return super.isEqualTo(...arguments) || objectArraysAreEqual(this.objects, splittableList === null || splittableList === void 0 ? void 0 : splittableList.objects);\n  }\n\n  contentsForInspection() {\n    return {\n      objects: \"[\".concat(this.objects.map(object => object.inspect()).join(\", \"), \"]\")\n    };\n  }\n\n}\n\nconst objectArraysAreEqual = function (left) {\n  let right = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  if (left.length !== right.length) {\n    return false;\n  }\n\n  let result = true;\n\n  for (let index = 0; index < left.length; index++) {\n    const object = left[index];\n\n    if (result && !object.isEqualTo(right[index])) {\n      result = false;\n    }\n  }\n\n  return result;\n};\n\nconst startOfRange = range => range[0];\n\nconst endOfRange = range => range[1];\n\nclass Text extends TrixObject {\n  static textForAttachmentWithAttributes(attachment, attributes) {\n    const piece = new AttachmentPiece(attachment, attributes);\n    return new this([piece]);\n  }\n\n  static textForStringWithAttributes(string, attributes) {\n    const piece = new StringPiece(string, attributes);\n    return new this([piece]);\n  }\n\n  static fromJSON(textJSON) {\n    const pieces = Array.from(textJSON).map(pieceJSON => Piece.fromJSON(pieceJSON));\n    return new this(pieces);\n  }\n\n  constructor() {\n    let pieces = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n    const notEmpty = pieces.filter(piece => !piece.isEmpty());\n    this.pieceList = new SplittableList(notEmpty);\n  }\n\n  copy() {\n    return this.copyWithPieceList(this.pieceList);\n  }\n\n  copyWithPieceList(pieceList) {\n    return new this.constructor(pieceList.consolidate().toArray());\n  }\n\n  copyUsingObjectMap(objectMap) {\n    const pieces = this.getPieces().map(piece => objectMap.find(piece) || piece);\n    return new this.constructor(pieces);\n  }\n\n  appendText(text) {\n    return this.insertTextAtPosition(text, this.getLength());\n  }\n\n  insertTextAtPosition(text, position) {\n    return this.copyWithPieceList(this.pieceList.insertSplittableListAtPosition(text.pieceList, position));\n  }\n\n  removeTextAtRange(range) {\n    return this.copyWithPieceList(this.pieceList.removeObjectsInRange(range));\n  }\n\n  replaceTextAtRange(text, range) {\n    return this.removeTextAtRange(range).insertTextAtPosition(text, range[0]);\n  }\n\n  moveTextFromRangeToPosition(range, position) {\n    if (range[0] <= position && position <= range[1]) return;\n    const text = this.getTextAtRange(range);\n    const length = text.getLength();\n\n    if (range[0] < position) {\n      position -= length;\n    }\n\n    return this.removeTextAtRange(range).insertTextAtPosition(text, position);\n  }\n\n  addAttributeAtRange(attribute, value, range) {\n    const attributes = {};\n    attributes[attribute] = value;\n    return this.addAttributesAtRange(attributes, range);\n  }\n\n  addAttributesAtRange(attributes, range) {\n    return this.copyWithPieceList(this.pieceList.transformObjectsInRange(range, piece => piece.copyWithAdditionalAttributes(attributes)));\n  }\n\n  removeAttributeAtRange(attribute, range) {\n    return this.copyWithPieceList(this.pieceList.transformObjectsInRange(range, piece => piece.copyWithoutAttribute(attribute)));\n  }\n\n  setAttributesAtRange(attributes, range) {\n    return this.copyWithPieceList(this.pieceList.transformObjectsInRange(range, piece => piece.copyWithAttributes(attributes)));\n  }\n\n  getAttributesAtPosition(position) {\n    var _this$pieceList$getOb;\n\n    return ((_this$pieceList$getOb = this.pieceList.getObjectAtPosition(position)) === null || _this$pieceList$getOb === void 0 ? void 0 : _this$pieceList$getOb.getAttributes()) || {};\n  }\n\n  getCommonAttributes() {\n    const objects = Array.from(this.pieceList.toArray()).map(piece => piece.getAttributes());\n    return Hash.fromCommonAttributesOfObjects(objects).toObject();\n  }\n\n  getCommonAttributesAtRange(range) {\n    return this.getTextAtRange(range).getCommonAttributes() || {};\n  }\n\n  getExpandedRangeForAttributeAtOffset(attributeName, offset) {\n    let right;\n    let left = right = offset;\n    const length = this.getLength();\n\n    while (left > 0 && this.getCommonAttributesAtRange([left - 1, right])[attributeName]) {\n      left--;\n    }\n\n    while (right < length && this.getCommonAttributesAtRange([offset, right + 1])[attributeName]) {\n      right++;\n    }\n\n    return [left, right];\n  }\n\n  getTextAtRange(range) {\n    return this.copyWithPieceList(this.pieceList.getSplittableListInRange(range));\n  }\n\n  getStringAtRange(range) {\n    return this.pieceList.getSplittableListInRange(range).toString();\n  }\n\n  getStringAtPosition(position) {\n    return this.getStringAtRange([position, position + 1]);\n  }\n\n  startsWithString(string) {\n    return this.getStringAtRange([0, string.length]) === string;\n  }\n\n  endsWithString(string) {\n    const length = this.getLength();\n    return this.getStringAtRange([length - string.length, length]) === string;\n  }\n\n  getAttachmentPieces() {\n    return this.pieceList.toArray().filter(piece => !!piece.attachment);\n  }\n\n  getAttachments() {\n    return this.getAttachmentPieces().map(piece => piece.attachment);\n  }\n\n  getAttachmentAndPositionById(attachmentId) {\n    let position = 0;\n\n    for (const piece of this.pieceList.toArray()) {\n      var _piece$attachment;\n\n      if (((_piece$attachment = piece.attachment) === null || _piece$attachment === void 0 ? void 0 : _piece$attachment.id) === attachmentId) {\n        return {\n          attachment: piece.attachment,\n          position\n        };\n      }\n\n      position += piece.length;\n    }\n\n    return {\n      attachment: null,\n      position: null\n    };\n  }\n\n  getAttachmentById(attachmentId) {\n    const {\n      attachment\n    } = this.getAttachmentAndPositionById(attachmentId);\n    return attachment;\n  }\n\n  getRangeOfAttachment(attachment) {\n    const attachmentAndPosition = this.getAttachmentAndPositionById(attachment.id);\n    const position = attachmentAndPosition.position;\n    attachment = attachmentAndPosition.attachment;\n\n    if (attachment) {\n      return [position, position + 1];\n    }\n  }\n\n  updateAttributesForAttachment(attributes, attachment) {\n    const range = this.getRangeOfAttachment(attachment);\n\n    if (range) {\n      return this.addAttributesAtRange(attributes, range);\n    } else {\n      return this;\n    }\n  }\n\n  getLength() {\n    return this.pieceList.getEndPosition();\n  }\n\n  isEmpty() {\n    return this.getLength() === 0;\n  }\n\n  isEqualTo(text) {\n    var _text$pieceList;\n\n    return super.isEqualTo(text) || (text === null || text === void 0 ? void 0 : (_text$pieceList = text.pieceList) === null || _text$pieceList === void 0 ? void 0 : _text$pieceList.isEqualTo(this.pieceList));\n  }\n\n  isBlockBreak() {\n    return this.getLength() === 1 && this.pieceList.getObjectAtIndex(0).isBlockBreak();\n  }\n\n  eachPiece(callback) {\n    return this.pieceList.eachObject(callback);\n  }\n\n  getPieces() {\n    return this.pieceList.toArray();\n  }\n\n  getPieceAtPosition(position) {\n    return this.pieceList.getObjectAtPosition(position);\n  }\n\n  contentsForInspection() {\n    return {\n      pieceList: this.pieceList.inspect()\n    };\n  }\n\n  toSerializableText() {\n    const pieceList = this.pieceList.selectSplittableList(piece => piece.isSerializable());\n    return this.copyWithPieceList(pieceList);\n  }\n\n  toString() {\n    return this.pieceList.toString();\n  }\n\n  toJSON() {\n    return this.pieceList.toJSON();\n  }\n\n  toConsole() {\n    return JSON.stringify(this.pieceList.toArray().map(piece => JSON.parse(piece.toConsole())));\n  } // BIDI\n\n\n  getDirection() {\n    return getDirection(this.toString());\n  }\n\n  isRTL() {\n    return this.getDirection() === \"rtl\";\n  }\n\n}\n\nclass Block extends TrixObject {\n  static fromJSON(blockJSON) {\n    const text = Text.fromJSON(blockJSON.text);\n    return new this(text, blockJSON.attributes);\n  }\n\n  constructor(text, attributes) {\n    super(...arguments);\n    this.text = applyBlockBreakToText(text || new Text());\n    this.attributes = attributes || [];\n  }\n\n  isEmpty() {\n    return this.text.isBlockBreak();\n  }\n\n  isEqualTo(block) {\n    if (super.isEqualTo(block)) return true;\n    return this.text.isEqualTo(block === null || block === void 0 ? void 0 : block.text) && arraysAreEqual(this.attributes, block === null || block === void 0 ? void 0 : block.attributes);\n  }\n\n  copyWithText(text) {\n    return new Block(text, this.attributes);\n  }\n\n  copyWithoutText() {\n    return this.copyWithText(null);\n  }\n\n  copyWithAttributes(attributes) {\n    return new Block(this.text, attributes);\n  }\n\n  copyWithoutAttributes() {\n    return this.copyWithAttributes(null);\n  }\n\n  copyUsingObjectMap(objectMap) {\n    const mappedText = objectMap.find(this.text);\n\n    if (mappedText) {\n      return this.copyWithText(mappedText);\n    } else {\n      return this.copyWithText(this.text.copyUsingObjectMap(objectMap));\n    }\n  }\n\n  addAttribute(attribute) {\n    const attributes = this.attributes.concat(expandAttribute(attribute));\n    return this.copyWithAttributes(attributes);\n  }\n\n  removeAttribute(attribute) {\n    const {\n      listAttribute\n    } = getBlockConfig(attribute);\n    const attributes = removeLastValue(removeLastValue(this.attributes, attribute), listAttribute);\n    return this.copyWithAttributes(attributes);\n  }\n\n  removeLastAttribute() {\n    return this.removeAttribute(this.getLastAttribute());\n  }\n\n  getLastAttribute() {\n    return getLastElement(this.attributes);\n  }\n\n  getAttributes() {\n    return this.attributes.slice(0);\n  }\n\n  getAttributeLevel() {\n    return this.attributes.length;\n  }\n\n  getAttributeAtLevel(level) {\n    return this.attributes[level - 1];\n  }\n\n  hasAttribute(attributeName) {\n    return this.attributes.includes(attributeName);\n  }\n\n  hasAttributes() {\n    return this.getAttributeLevel() > 0;\n  }\n\n  getLastNestableAttribute() {\n    return getLastElement(this.getNestableAttributes());\n  }\n\n  getNestableAttributes() {\n    return this.attributes.filter(attribute => getBlockConfig(attribute).nestable);\n  }\n\n  getNestingLevel() {\n    return this.getNestableAttributes().length;\n  }\n\n  decreaseNestingLevel() {\n    const attribute = this.getLastNestableAttribute();\n\n    if (attribute) {\n      return this.removeAttribute(attribute);\n    } else {\n      return this;\n    }\n  }\n\n  increaseNestingLevel() {\n    const attribute = this.getLastNestableAttribute();\n\n    if (attribute) {\n      const index = this.attributes.lastIndexOf(attribute);\n      const attributes = spliceArray(this.attributes, index + 1, 0, ...expandAttribute(attribute));\n      return this.copyWithAttributes(attributes);\n    } else {\n      return this;\n    }\n  }\n\n  getListItemAttributes() {\n    return this.attributes.filter(attribute => getBlockConfig(attribute).listAttribute);\n  }\n\n  isListItem() {\n    var _getBlockConfig;\n\n    return (_getBlockConfig = getBlockConfig(this.getLastAttribute())) === null || _getBlockConfig === void 0 ? void 0 : _getBlockConfig.listAttribute;\n  }\n\n  isTerminalBlock() {\n    var _getBlockConfig2;\n\n    return (_getBlockConfig2 = getBlockConfig(this.getLastAttribute())) === null || _getBlockConfig2 === void 0 ? void 0 : _getBlockConfig2.terminal;\n  }\n\n  breaksOnReturn() {\n    var _getBlockConfig3;\n\n    return (_getBlockConfig3 = getBlockConfig(this.getLastAttribute())) === null || _getBlockConfig3 === void 0 ? void 0 : _getBlockConfig3.breakOnReturn;\n  }\n\n  findLineBreakInDirectionFromPosition(direction, position) {\n    const string = this.toString();\n    let result;\n\n    switch (direction) {\n      case \"forward\":\n        result = string.indexOf(\"\\n\", position);\n        break;\n\n      case \"backward\":\n        result = string.slice(0, position).lastIndexOf(\"\\n\");\n    }\n\n    if (result !== -1) {\n      return result;\n    }\n  }\n\n  contentsForInspection() {\n    return {\n      text: this.text.inspect(),\n      attributes: this.attributes\n    };\n  }\n\n  toString() {\n    return this.text.toString();\n  }\n\n  toJSON() {\n    return {\n      text: this.text,\n      attributes: this.attributes\n    };\n  } // BIDI\n\n\n  getDirection() {\n    return this.text.getDirection();\n  }\n\n  isRTL() {\n    return this.text.isRTL();\n  } // Splittable\n\n\n  getLength() {\n    return this.text.getLength();\n  }\n\n  canBeConsolidatedWith(block) {\n    return !this.hasAttributes() && !block.hasAttributes() && this.getDirection() === block.getDirection();\n  }\n\n  consolidateWith(block) {\n    const newlineText = Text.textForStringWithAttributes(\"\\n\");\n    const text = this.getTextWithoutBlockBreak().appendText(newlineText);\n    return this.copyWithText(text.appendText(block.text));\n  }\n\n  splitAtOffset(offset) {\n    let left, right;\n\n    if (offset === 0) {\n      left = null;\n      right = this;\n    } else if (offset === this.getLength()) {\n      left = this;\n      right = null;\n    } else {\n      left = this.copyWithText(this.text.getTextAtRange([0, offset]));\n      right = this.copyWithText(this.text.getTextAtRange([offset, this.getLength()]));\n    }\n\n    return [left, right];\n  }\n\n  getBlockBreakPosition() {\n    return this.text.getLength() - 1;\n  }\n\n  getTextWithoutBlockBreak() {\n    if (textEndsInBlockBreak(this.text)) {\n      return this.text.getTextAtRange([0, this.getBlockBreakPosition()]);\n    } else {\n      return this.text.copy();\n    }\n  } // Grouping\n\n\n  canBeGrouped(depth) {\n    return this.attributes[depth];\n  }\n\n  canBeGroupedWith(otherBlock, depth) {\n    const otherAttributes = otherBlock.getAttributes();\n    const otherAttribute = otherAttributes[depth];\n    const attribute = this.attributes[depth];\n    return attribute === otherAttribute && !(getBlockConfig(attribute).group === false && !getListAttributeNames().includes(otherAttributes[depth + 1])) && (this.getDirection() === otherBlock.getDirection() || otherBlock.isEmpty());\n  }\n\n} // Block breaks\n\n\nconst applyBlockBreakToText = function (text) {\n  text = unmarkExistingInnerBlockBreaksInText(text);\n  text = addBlockBreakToText(text);\n  return text;\n};\n\nconst unmarkExistingInnerBlockBreaksInText = function (text) {\n  let modified = false;\n  const pieces = text.getPieces();\n  let innerPieces = pieces.slice(0, pieces.length - 1);\n  const lastPiece = pieces[pieces.length - 1];\n  if (!lastPiece) return text;\n  innerPieces = innerPieces.map(piece => {\n    if (piece.isBlockBreak()) {\n      modified = true;\n      return unmarkBlockBreakPiece(piece);\n    } else {\n      return piece;\n    }\n  });\n\n  if (modified) {\n    return new Text([...innerPieces, lastPiece]);\n  } else {\n    return text;\n  }\n};\n\nconst blockBreakText = Text.textForStringWithAttributes(\"\\n\", {\n  blockBreak: true\n});\n\nconst addBlockBreakToText = function (text) {\n  if (textEndsInBlockBreak(text)) {\n    return text;\n  } else {\n    return text.appendText(blockBreakText);\n  }\n};\n\nconst textEndsInBlockBreak = function (text) {\n  const length = text.getLength();\n\n  if (length === 0) {\n    return false;\n  }\n\n  const endText = text.getTextAtRange([length - 1, length]);\n  return endText.isBlockBreak();\n};\n\nconst unmarkBlockBreakPiece = piece => piece.copyWithoutAttribute(\"blockBreak\"); // Attributes\n\n\nconst expandAttribute = function (attribute) {\n  const {\n    listAttribute\n  } = getBlockConfig(attribute);\n\n  if (listAttribute) {\n    return [listAttribute, attribute];\n  } else {\n    return [attribute];\n  }\n}; // Array helpers\n\n\nconst getLastElement = array => array.slice(-1)[0];\n\nconst removeLastValue = function (array, value) {\n  const index = array.lastIndexOf(value);\n\n  if (index === -1) {\n    return array;\n  } else {\n    return spliceArray(array, index, 1);\n  }\n};\n\nclass ObjectMap extends BasicObject {\n  constructor() {\n    let objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n    this.objects = {};\n    Array.from(objects).forEach(object => {\n      const hash = JSON.stringify(object);\n\n      if (this.objects[hash] == null) {\n        this.objects[hash] = object;\n      }\n    });\n  }\n\n  find(object) {\n    const hash = JSON.stringify(object);\n    return this.objects[hash];\n  }\n\n}\n\nclass Document extends TrixObject {\n  static fromJSON(documentJSON) {\n    const blocks = Array.from(documentJSON).map(blockJSON => Block.fromJSON(blockJSON));\n    return new this(blocks);\n  }\n\n  static fromString(string, textAttributes) {\n    const text = Text.textForStringWithAttributes(string, textAttributes);\n    return new this([new Block(text)]);\n  }\n\n  constructor() {\n    let blocks = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n\n    if (blocks.length === 0) {\n      blocks = [new Block()];\n    }\n\n    this.blockList = SplittableList.box(blocks);\n  }\n\n  isEmpty() {\n    const block = this.getBlockAtIndex(0);\n    return this.blockList.length === 1 && block.isEmpty() && !block.hasAttributes();\n  }\n\n  copy() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const blocks = options.consolidateBlocks ? this.blockList.consolidate().toArray() : this.blockList.toArray();\n    return new this.constructor(blocks);\n  }\n\n  copyUsingObjectsFromDocument(sourceDocument) {\n    const objectMap = new ObjectMap(sourceDocument.getObjects());\n    return this.copyUsingObjectMap(objectMap);\n  }\n\n  copyUsingObjectMap(objectMap) {\n    const blocks = this.getBlocks().map(block => {\n      const mappedBlock = objectMap.find(block);\n      return mappedBlock || block.copyUsingObjectMap(objectMap);\n    });\n    return new this.constructor(blocks);\n  }\n\n  copyWithBaseBlockAttributes() {\n    let blockAttributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    const blocks = this.getBlocks().map(block => {\n      const attributes = blockAttributes.concat(block.getAttributes());\n      return block.copyWithAttributes(attributes);\n    });\n    return new this.constructor(blocks);\n  }\n\n  replaceBlock(oldBlock, newBlock) {\n    const index = this.blockList.indexOf(oldBlock);\n\n    if (index === -1) {\n      return this;\n    }\n\n    return new this.constructor(this.blockList.replaceObjectAtIndex(newBlock, index));\n  }\n\n  insertDocumentAtRange(document, range) {\n    const {\n      blockList\n    } = document;\n    range = normalizeRange(range);\n    let [position] = range;\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    let result = this;\n    const block = this.getBlockAtPosition(position);\n\n    if (rangeIsCollapsed(range) && block.isEmpty() && !block.hasAttributes()) {\n      result = new this.constructor(result.blockList.removeObjectAtIndex(index));\n    } else if (block.getBlockBreakPosition() === offset) {\n      position++;\n    }\n\n    result = result.removeTextAtRange(range);\n    return new this.constructor(result.blockList.insertSplittableListAtPosition(blockList, position));\n  }\n\n  mergeDocumentAtRange(document, range) {\n    let formattedDocument, result;\n    range = normalizeRange(range);\n    const [startPosition] = range;\n    const startLocation = this.locationFromPosition(startPosition);\n    const blockAttributes = this.getBlockAtIndex(startLocation.index).getAttributes();\n    const baseBlockAttributes = document.getBaseBlockAttributes();\n    const trailingBlockAttributes = blockAttributes.slice(-baseBlockAttributes.length);\n\n    if (arraysAreEqual(baseBlockAttributes, trailingBlockAttributes)) {\n      const leadingBlockAttributes = blockAttributes.slice(0, -baseBlockAttributes.length);\n      formattedDocument = document.copyWithBaseBlockAttributes(leadingBlockAttributes);\n    } else {\n      formattedDocument = document.copy({\n        consolidateBlocks: true\n      }).copyWithBaseBlockAttributes(blockAttributes);\n    }\n\n    const blockCount = formattedDocument.getBlockCount();\n    const firstBlock = formattedDocument.getBlockAtIndex(0);\n\n    if (arraysAreEqual(blockAttributes, firstBlock.getAttributes())) {\n      const firstText = firstBlock.getTextWithoutBlockBreak();\n      result = this.insertTextAtRange(firstText, range);\n\n      if (blockCount > 1) {\n        formattedDocument = new this.constructor(formattedDocument.getBlocks().slice(1));\n        const position = startPosition + firstText.getLength();\n        result = result.insertDocumentAtRange(formattedDocument, position);\n      }\n    } else {\n      result = this.insertDocumentAtRange(formattedDocument, range);\n    }\n\n    return result;\n  }\n\n  insertTextAtRange(text, range) {\n    range = normalizeRange(range);\n    const [startPosition] = range;\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(startPosition);\n    const document = this.removeTextAtRange(range);\n    return new this.constructor(document.blockList.editObjectAtIndex(index, block => block.copyWithText(block.text.insertTextAtPosition(text, offset))));\n  }\n\n  removeTextAtRange(range) {\n    let blocks;\n    range = normalizeRange(range);\n    const [leftPosition, rightPosition] = range;\n\n    if (rangeIsCollapsed(range)) {\n      return this;\n    }\n\n    const [leftLocation, rightLocation] = Array.from(this.locationRangeFromRange(range));\n    const leftIndex = leftLocation.index;\n    const leftOffset = leftLocation.offset;\n    const leftBlock = this.getBlockAtIndex(leftIndex);\n    const rightIndex = rightLocation.index;\n    const rightOffset = rightLocation.offset;\n    const rightBlock = this.getBlockAtIndex(rightIndex);\n    const removeRightNewline = rightPosition - leftPosition === 1 && leftBlock.getBlockBreakPosition() === leftOffset && rightBlock.getBlockBreakPosition() !== rightOffset && rightBlock.text.getStringAtPosition(rightOffset) === \"\\n\";\n\n    if (removeRightNewline) {\n      blocks = this.blockList.editObjectAtIndex(rightIndex, block => block.copyWithText(block.text.removeTextAtRange([rightOffset, rightOffset + 1])));\n    } else {\n      let block;\n      const leftText = leftBlock.text.getTextAtRange([0, leftOffset]);\n      const rightText = rightBlock.text.getTextAtRange([rightOffset, rightBlock.getLength()]);\n      const text = leftText.appendText(rightText);\n      const removingLeftBlock = leftIndex !== rightIndex && leftOffset === 0;\n      const useRightBlock = removingLeftBlock && leftBlock.getAttributeLevel() >= rightBlock.getAttributeLevel();\n\n      if (useRightBlock) {\n        block = rightBlock.copyWithText(text);\n      } else {\n        block = leftBlock.copyWithText(text);\n      }\n\n      const affectedBlockCount = rightIndex + 1 - leftIndex;\n      blocks = this.blockList.splice(leftIndex, affectedBlockCount, block);\n    }\n\n    return new this.constructor(blocks);\n  }\n\n  moveTextFromRangeToPosition(range, position) {\n    let text;\n    range = normalizeRange(range);\n    const [startPosition, endPosition] = range;\n\n    if (startPosition <= position && position <= endPosition) {\n      return this;\n    }\n\n    let document = this.getDocumentAtRange(range);\n    let result = this.removeTextAtRange(range);\n    const movingRightward = startPosition < position;\n\n    if (movingRightward) {\n      position -= document.getLength();\n    }\n\n    const [firstBlock, ...blocks] = document.getBlocks();\n\n    if (blocks.length === 0) {\n      text = firstBlock.getTextWithoutBlockBreak();\n\n      if (movingRightward) {\n        position += 1;\n      }\n    } else {\n      text = firstBlock.text;\n    }\n\n    result = result.insertTextAtRange(text, position);\n\n    if (blocks.length === 0) {\n      return result;\n    }\n\n    document = new this.constructor(blocks);\n    position += text.getLength();\n    return result.insertDocumentAtRange(document, position);\n  }\n\n  addAttributeAtRange(attribute, value, range) {\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, (block, textRange, index) => blockList = blockList.editObjectAtIndex(index, function () {\n      if (getBlockConfig(attribute)) {\n        return block.addAttribute(attribute, value);\n      } else {\n        if (textRange[0] === textRange[1]) {\n          return block;\n        } else {\n          return block.copyWithText(block.text.addAttributeAtRange(attribute, value, textRange));\n        }\n      }\n    }));\n    return new this.constructor(blockList);\n  }\n\n  addAttribute(attribute, value) {\n    let {\n      blockList\n    } = this;\n    this.eachBlock((block, index) => blockList = blockList.editObjectAtIndex(index, () => block.addAttribute(attribute, value)));\n    return new this.constructor(blockList);\n  }\n\n  removeAttributeAtRange(attribute, range) {\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, function (block, textRange, index) {\n      if (getBlockConfig(attribute)) {\n        blockList = blockList.editObjectAtIndex(index, () => block.removeAttribute(attribute));\n      } else if (textRange[0] !== textRange[1]) {\n        blockList = blockList.editObjectAtIndex(index, () => block.copyWithText(block.text.removeAttributeAtRange(attribute, textRange)));\n      }\n    });\n    return new this.constructor(blockList);\n  }\n\n  updateAttributesForAttachment(attributes, attachment) {\n    const range = this.getRangeOfAttachment(attachment);\n    const [startPosition] = Array.from(range);\n    const {\n      index\n    } = this.locationFromPosition(startPosition);\n    const text = this.getTextAtIndex(index);\n    return new this.constructor(this.blockList.editObjectAtIndex(index, block => block.copyWithText(text.updateAttributesForAttachment(attributes, attachment))));\n  }\n\n  removeAttributeForAttachment(attribute, attachment) {\n    const range = this.getRangeOfAttachment(attachment);\n    return this.removeAttributeAtRange(attribute, range);\n  }\n\n  insertBlockBreakAtRange(range) {\n    let blocks;\n    range = normalizeRange(range);\n    const [startPosition] = range;\n    const {\n      offset\n    } = this.locationFromPosition(startPosition);\n    const document = this.removeTextAtRange(range);\n\n    if (offset === 0) {\n      blocks = [new Block()];\n    }\n\n    return new this.constructor(document.blockList.insertSplittableListAtPosition(new SplittableList(blocks), startPosition));\n  }\n\n  applyBlockAttributeAtRange(attributeName, value, range) {\n    const expanded = this.expandRangeToLineBreaksAndSplitBlocks(range);\n    let document = expanded.document;\n    range = expanded.range;\n    const blockConfig = getBlockConfig(attributeName);\n\n    if (blockConfig.listAttribute) {\n      document = document.removeLastListAttributeAtRange(range, {\n        exceptAttributeName: attributeName\n      });\n      const converted = document.convertLineBreaksToBlockBreaksInRange(range);\n      document = converted.document;\n      range = converted.range;\n    } else if (blockConfig.exclusive) {\n      document = document.removeBlockAttributesAtRange(range);\n    } else if (blockConfig.terminal) {\n      document = document.removeLastTerminalAttributeAtRange(range);\n    } else {\n      document = document.consolidateBlocksAtRange(range);\n    }\n\n    return document.addAttributeAtRange(attributeName, value, range);\n  }\n\n  removeLastListAttributeAtRange(range) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, function (block, textRange, index) {\n      const lastAttributeName = block.getLastAttribute();\n\n      if (!lastAttributeName) {\n        return;\n      }\n\n      if (!getBlockConfig(lastAttributeName).listAttribute) {\n        return;\n      }\n\n      if (lastAttributeName === options.exceptAttributeName) {\n        return;\n      }\n\n      blockList = blockList.editObjectAtIndex(index, () => block.removeAttribute(lastAttributeName));\n    });\n    return new this.constructor(blockList);\n  }\n\n  removeLastTerminalAttributeAtRange(range) {\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, function (block, textRange, index) {\n      const lastAttributeName = block.getLastAttribute();\n\n      if (!lastAttributeName) {\n        return;\n      }\n\n      if (!getBlockConfig(lastAttributeName).terminal) {\n        return;\n      }\n\n      blockList = blockList.editObjectAtIndex(index, () => block.removeAttribute(lastAttributeName));\n    });\n    return new this.constructor(blockList);\n  }\n\n  removeBlockAttributesAtRange(range) {\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, function (block, textRange, index) {\n      if (block.hasAttributes()) {\n        blockList = blockList.editObjectAtIndex(index, () => block.copyWithoutAttributes());\n      }\n    });\n    return new this.constructor(blockList);\n  }\n\n  expandRangeToLineBreaksAndSplitBlocks(range) {\n    let position;\n    range = normalizeRange(range);\n    let [startPosition, endPosition] = range;\n    const startLocation = this.locationFromPosition(startPosition);\n    const endLocation = this.locationFromPosition(endPosition);\n    let document = this;\n    const startBlock = document.getBlockAtIndex(startLocation.index);\n    startLocation.offset = startBlock.findLineBreakInDirectionFromPosition(\"backward\", startLocation.offset);\n\n    if (startLocation.offset != null) {\n      position = document.positionFromLocation(startLocation);\n      document = document.insertBlockBreakAtRange([position, position + 1]);\n      endLocation.index += 1;\n      endLocation.offset -= document.getBlockAtIndex(startLocation.index).getLength();\n      startLocation.index += 1;\n    }\n\n    startLocation.offset = 0;\n\n    if (endLocation.offset === 0 && endLocation.index > startLocation.index) {\n      endLocation.index -= 1;\n      endLocation.offset = document.getBlockAtIndex(endLocation.index).getBlockBreakPosition();\n    } else {\n      const endBlock = document.getBlockAtIndex(endLocation.index);\n\n      if (endBlock.text.getStringAtRange([endLocation.offset - 1, endLocation.offset]) === \"\\n\") {\n        endLocation.offset -= 1;\n      } else {\n        endLocation.offset = endBlock.findLineBreakInDirectionFromPosition(\"forward\", endLocation.offset);\n      }\n\n      if (endLocation.offset !== endBlock.getBlockBreakPosition()) {\n        position = document.positionFromLocation(endLocation);\n        document = document.insertBlockBreakAtRange([position, position + 1]);\n      }\n    }\n\n    startPosition = document.positionFromLocation(startLocation);\n    endPosition = document.positionFromLocation(endLocation);\n    range = normalizeRange([startPosition, endPosition]);\n    return {\n      document,\n      range\n    };\n  }\n\n  convertLineBreaksToBlockBreaksInRange(range) {\n    range = normalizeRange(range);\n    let [position] = range;\n    const string = this.getStringAtRange(range).slice(0, -1);\n    let document = this;\n    string.replace(/.*?\\n/g, function (match) {\n      position += match.length;\n      document = document.insertBlockBreakAtRange([position - 1, position]);\n    });\n    return {\n      document,\n      range\n    };\n  }\n\n  consolidateBlocksAtRange(range) {\n    range = normalizeRange(range);\n    const [startPosition, endPosition] = range;\n    const startIndex = this.locationFromPosition(startPosition).index;\n    const endIndex = this.locationFromPosition(endPosition).index;\n    return new this.constructor(this.blockList.consolidateFromIndexToIndex(startIndex, endIndex));\n  }\n\n  getDocumentAtRange(range) {\n    range = normalizeRange(range);\n    const blocks = this.blockList.getSplittableListInRange(range).toArray();\n    return new this.constructor(blocks);\n  }\n\n  getStringAtRange(range) {\n    let endIndex;\n    const array = range = normalizeRange(range),\n          endPosition = array[array.length - 1];\n\n    if (endPosition !== this.getLength()) {\n      endIndex = -1;\n    }\n\n    return this.getDocumentAtRange(range).toString().slice(0, endIndex);\n  }\n\n  getBlockAtIndex(index) {\n    return this.blockList.getObjectAtIndex(index);\n  }\n\n  getBlockAtPosition(position) {\n    const {\n      index\n    } = this.locationFromPosition(position);\n    return this.getBlockAtIndex(index);\n  }\n\n  getTextAtIndex(index) {\n    var _this$getBlockAtIndex;\n\n    return (_this$getBlockAtIndex = this.getBlockAtIndex(index)) === null || _this$getBlockAtIndex === void 0 ? void 0 : _this$getBlockAtIndex.text;\n  }\n\n  getTextAtPosition(position) {\n    const {\n      index\n    } = this.locationFromPosition(position);\n    return this.getTextAtIndex(index);\n  }\n\n  getPieceAtPosition(position) {\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    return this.getTextAtIndex(index).getPieceAtPosition(offset);\n  }\n\n  getCharacterAtPosition(position) {\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    return this.getTextAtIndex(index).getStringAtRange([offset, offset + 1]);\n  }\n\n  getLength() {\n    return this.blockList.getEndPosition();\n  }\n\n  getBlocks() {\n    return this.blockList.toArray();\n  }\n\n  getBlockCount() {\n    return this.blockList.length;\n  }\n\n  getEditCount() {\n    return this.editCount;\n  }\n\n  eachBlock(callback) {\n    return this.blockList.eachObject(callback);\n  }\n\n  eachBlockAtRange(range, callback) {\n    let block, textRange;\n    range = normalizeRange(range);\n    const [startPosition, endPosition] = range;\n    const startLocation = this.locationFromPosition(startPosition);\n    const endLocation = this.locationFromPosition(endPosition);\n\n    if (startLocation.index === endLocation.index) {\n      block = this.getBlockAtIndex(startLocation.index);\n      textRange = [startLocation.offset, endLocation.offset];\n      return callback(block, textRange, startLocation.index);\n    } else {\n      for (let index = startLocation.index; index <= endLocation.index; index++) {\n        block = this.getBlockAtIndex(index);\n\n        if (block) {\n          switch (index) {\n            case startLocation.index:\n              textRange = [startLocation.offset, block.text.getLength()];\n              break;\n\n            case endLocation.index:\n              textRange = [0, endLocation.offset];\n              break;\n\n            default:\n              textRange = [0, block.text.getLength()];\n          }\n\n          callback(block, textRange, index);\n        }\n      }\n    }\n  }\n\n  getCommonAttributesAtRange(range) {\n    range = normalizeRange(range);\n    const [startPosition] = range;\n\n    if (rangeIsCollapsed(range)) {\n      return this.getCommonAttributesAtPosition(startPosition);\n    } else {\n      const textAttributes = [];\n      const blockAttributes = [];\n      this.eachBlockAtRange(range, function (block, textRange) {\n        if (textRange[0] !== textRange[1]) {\n          textAttributes.push(block.text.getCommonAttributesAtRange(textRange));\n          return blockAttributes.push(attributesForBlock(block));\n        }\n      });\n      return Hash.fromCommonAttributesOfObjects(textAttributes).merge(Hash.fromCommonAttributesOfObjects(blockAttributes)).toObject();\n    }\n  }\n\n  getCommonAttributesAtPosition(position) {\n    let key, value;\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    const block = this.getBlockAtIndex(index);\n\n    if (!block) {\n      return {};\n    }\n\n    const commonAttributes = attributesForBlock(block);\n    const attributes = block.text.getAttributesAtPosition(offset);\n    const attributesLeft = block.text.getAttributesAtPosition(offset - 1);\n    const inheritableAttributes = Object.keys(config.textAttributes).filter(key => {\n      return config.textAttributes[key].inheritable;\n    });\n\n    for (key in attributesLeft) {\n      value = attributesLeft[key];\n\n      if (value === attributes[key] || inheritableAttributes.includes(key)) {\n        commonAttributes[key] = value;\n      }\n    }\n\n    return commonAttributes;\n  }\n\n  getRangeOfCommonAttributeAtPosition(attributeName, position) {\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    const text = this.getTextAtIndex(index);\n    const [startOffset, endOffset] = Array.from(text.getExpandedRangeForAttributeAtOffset(attributeName, offset));\n    const start = this.positionFromLocation({\n      index,\n      offset: startOffset\n    });\n    const end = this.positionFromLocation({\n      index,\n      offset: endOffset\n    });\n    return normalizeRange([start, end]);\n  }\n\n  getBaseBlockAttributes() {\n    let baseBlockAttributes = this.getBlockAtIndex(0).getAttributes();\n\n    for (let blockIndex = 1; blockIndex < this.getBlockCount(); blockIndex++) {\n      const blockAttributes = this.getBlockAtIndex(blockIndex).getAttributes();\n      const lastAttributeIndex = Math.min(baseBlockAttributes.length, blockAttributes.length);\n\n      baseBlockAttributes = (() => {\n        const result = [];\n\n        for (let index = 0; index < lastAttributeIndex; index++) {\n          if (blockAttributes[index] !== baseBlockAttributes[index]) {\n            break;\n          }\n\n          result.push(blockAttributes[index]);\n        }\n\n        return result;\n      })();\n    }\n\n    return baseBlockAttributes;\n  }\n\n  getAttachmentById(attachmentId) {\n    for (const attachment of this.getAttachments()) {\n      if (attachment.id === attachmentId) {\n        return attachment;\n      }\n    }\n  }\n\n  getAttachmentPieces() {\n    let attachmentPieces = [];\n    this.blockList.eachObject(_ref => {\n      let {\n        text\n      } = _ref;\n      return attachmentPieces = attachmentPieces.concat(text.getAttachmentPieces());\n    });\n    return attachmentPieces;\n  }\n\n  getAttachments() {\n    return this.getAttachmentPieces().map(piece => piece.attachment);\n  }\n\n  getRangeOfAttachment(attachment) {\n    let position = 0;\n    const iterable = this.blockList.toArray();\n\n    for (let index = 0; index < iterable.length; index++) {\n      const {\n        text\n      } = iterable[index];\n      const textRange = text.getRangeOfAttachment(attachment);\n\n      if (textRange) {\n        return normalizeRange([position + textRange[0], position + textRange[1]]);\n      }\n\n      position += text.getLength();\n    }\n  }\n\n  getLocationRangeOfAttachment(attachment) {\n    const range = this.getRangeOfAttachment(attachment);\n    return this.locationRangeFromRange(range);\n  }\n\n  getAttachmentPieceForAttachment(attachment) {\n    for (const piece of this.getAttachmentPieces()) {\n      if (piece.attachment === attachment) {\n        return piece;\n      }\n    }\n  }\n\n  findRangesForBlockAttribute(attributeName) {\n    let position = 0;\n    const ranges = [];\n    this.getBlocks().forEach(block => {\n      const length = block.getLength();\n\n      if (block.hasAttribute(attributeName)) {\n        ranges.push([position, position + length]);\n      }\n\n      position += length;\n    });\n    return ranges;\n  }\n\n  findRangesForTextAttribute(attributeName) {\n    let {\n      withValue\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let position = 0;\n    let range = [];\n    const ranges = [];\n\n    const match = function (piece) {\n      if (withValue) {\n        return piece.getAttribute(attributeName) === withValue;\n      } else {\n        return piece.hasAttribute(attributeName);\n      }\n    };\n\n    this.getPieces().forEach(piece => {\n      const length = piece.getLength();\n\n      if (match(piece)) {\n        if (range[1] === position) {\n          range[1] = position + length;\n        } else {\n          ranges.push(range = [position, position + length]);\n        }\n      }\n\n      position += length;\n    });\n    return ranges;\n  }\n\n  locationFromPosition(position) {\n    const location = this.blockList.findIndexAndOffsetAtPosition(Math.max(0, position));\n\n    if (location.index != null) {\n      return location;\n    } else {\n      const blocks = this.getBlocks();\n      return {\n        index: blocks.length - 1,\n        offset: blocks[blocks.length - 1].getLength()\n      };\n    }\n  }\n\n  positionFromLocation(location) {\n    return this.blockList.findPositionAtIndexAndOffset(location.index, location.offset);\n  }\n\n  locationRangeFromPosition(position) {\n    return normalizeRange(this.locationFromPosition(position));\n  }\n\n  locationRangeFromRange(range) {\n    range = normalizeRange(range);\n    if (!range) return;\n    const [startPosition, endPosition] = Array.from(range);\n    const startLocation = this.locationFromPosition(startPosition);\n    const endLocation = this.locationFromPosition(endPosition);\n    return normalizeRange([startLocation, endLocation]);\n  }\n\n  rangeFromLocationRange(locationRange) {\n    let rightPosition;\n    locationRange = normalizeRange(locationRange);\n    const leftPosition = this.positionFromLocation(locationRange[0]);\n\n    if (!rangeIsCollapsed(locationRange)) {\n      rightPosition = this.positionFromLocation(locationRange[1]);\n    }\n\n    return normalizeRange([leftPosition, rightPosition]);\n  }\n\n  isEqualTo(document) {\n    return this.blockList.isEqualTo(document === null || document === void 0 ? void 0 : document.blockList);\n  }\n\n  getTexts() {\n    return this.getBlocks().map(block => block.text);\n  }\n\n  getPieces() {\n    const pieces = [];\n    Array.from(this.getTexts()).forEach(text => {\n      pieces.push(...Array.from(text.getPieces() || []));\n    });\n    return pieces;\n  }\n\n  getObjects() {\n    return this.getBlocks().concat(this.getTexts()).concat(this.getPieces());\n  }\n\n  toSerializableDocument() {\n    const blocks = [];\n    this.blockList.eachObject(block => blocks.push(block.copyWithText(block.text.toSerializableText())));\n    return new this.constructor(blocks);\n  }\n\n  toString() {\n    return this.blockList.toString();\n  }\n\n  toJSON() {\n    return this.blockList.toJSON();\n  }\n\n  toConsole() {\n    return JSON.stringify(this.blockList.toArray()).map(block => JSON.parse(block.text.toConsole()));\n  }\n\n}\n\nconst attributesForBlock = function (block) {\n  const attributes = {};\n  const attributeName = block.getLastAttribute();\n\n  if (attributeName) {\n    attributes[attributeName] = true;\n  }\n\n  return attributes;\n};\n\nconst DEFAULT_ALLOWED_ATTRIBUTES = \"style href src width height class\".split(\" \");\nconst DEFAULT_FORBIDDEN_PROTOCOLS = \"javascript:\".split(\" \");\nconst DEFAULT_FORBIDDEN_ELEMENTS = \"script iframe\".split(\" \");\n\nclass HTMLSanitizer extends BasicObject {\n  static sanitize(html, options) {\n    const sanitizer = new this(html, options);\n    sanitizer.sanitize();\n    return sanitizer;\n  }\n\n  constructor(html) {\n    let {\n      allowedAttributes,\n      forbiddenProtocols,\n      forbiddenElements\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super(...arguments);\n    this.allowedAttributes = allowedAttributes || DEFAULT_ALLOWED_ATTRIBUTES;\n    this.forbiddenProtocols = forbiddenProtocols || DEFAULT_FORBIDDEN_PROTOCOLS;\n    this.forbiddenElements = forbiddenElements || DEFAULT_FORBIDDEN_ELEMENTS;\n    this.body = createBodyElementForHTML(html);\n  }\n\n  sanitize() {\n    this.sanitizeElements();\n    return this.normalizeListElementNesting();\n  }\n\n  getHTML() {\n    return this.body.innerHTML;\n  }\n\n  getBody() {\n    return this.body;\n  } // Private\n\n\n  sanitizeElements() {\n    const walker = walkTree(this.body);\n    const nodesToRemove = [];\n\n    while (walker.nextNode()) {\n      const node = walker.currentNode;\n\n      switch (node.nodeType) {\n        case Node.ELEMENT_NODE:\n          if (this.elementIsRemovable(node)) {\n            nodesToRemove.push(node);\n          } else {\n            this.sanitizeElement(node);\n          }\n\n          break;\n\n        case Node.COMMENT_NODE:\n          nodesToRemove.push(node);\n          break;\n      }\n    }\n\n    nodesToRemove.forEach(node => removeNode(node));\n    return this.body;\n  }\n\n  sanitizeElement(element) {\n    if (element.hasAttribute(\"href\")) {\n      if (this.forbiddenProtocols.includes(element.protocol)) {\n        element.removeAttribute(\"href\");\n      }\n    }\n\n    Array.from(element.attributes).forEach(_ref => {\n      let {\n        name\n      } = _ref;\n\n      if (!this.allowedAttributes.includes(name) && name.indexOf(\"data-trix\") !== 0) {\n        element.removeAttribute(name);\n      }\n    });\n    return element;\n  }\n\n  normalizeListElementNesting() {\n    Array.from(this.body.querySelectorAll(\"ul,ol\")).forEach(listElement => {\n      const previousElement = listElement.previousElementSibling;\n\n      if (previousElement) {\n        if (tagName(previousElement) === \"li\") {\n          previousElement.appendChild(listElement);\n        }\n      }\n    });\n    return this.body;\n  }\n\n  elementIsRemovable(element) {\n    if ((element === null || element === void 0 ? void 0 : element.nodeType) !== Node.ELEMENT_NODE) return;\n    return this.elementIsForbidden(element) || this.elementIsntSerializable(element);\n  }\n\n  elementIsForbidden(element) {\n    return this.forbiddenElements.includes(tagName(element));\n  }\n\n  elementIsntSerializable(element) {\n    return element.getAttribute(\"data-trix-serialize\") === \"false\" && !nodeIsAttachmentElement(element);\n  }\n\n}\n\nconst createBodyElementForHTML = function () {\n  let html = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\"; // Remove everything after </html>\n\n  html = html.replace(/<\\/html[^>]*>[^]*$/i, \"</html>\");\n  const doc = document.implementation.createHTMLDocument(\"\");\n  doc.documentElement.innerHTML = html;\n  Array.from(doc.head.querySelectorAll(\"style\")).forEach(element => {\n    doc.body.appendChild(element);\n  });\n  return doc.body;\n};\n/* eslint-disable\n    no-case-declarations,\n    no-irregular-whitespace,\n*/\n\n\nconst pieceForString = function (string) {\n  let attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const type = \"string\";\n  string = normalizeSpaces(string);\n  return {\n    string,\n    attributes,\n    type\n  };\n};\n\nconst pieceForAttachment = function (attachment) {\n  let attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const type = \"attachment\";\n  return {\n    attachment,\n    attributes,\n    type\n  };\n};\n\nconst blockForAttributes = function () {\n  let attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  const text = [];\n  return {\n    text,\n    attributes\n  };\n};\n\nconst parseTrixDataAttribute = (element, name) => {\n  try {\n    return JSON.parse(element.getAttribute(\"data-trix-\".concat(name)));\n  } catch (error) {\n    return {};\n  }\n};\n\nconst getImageDimensions = element => {\n  const width = element.getAttribute(\"width\");\n  const height = element.getAttribute(\"height\");\n  const dimensions = {};\n\n  if (width) {\n    dimensions.width = parseInt(width, 10);\n  }\n\n  if (height) {\n    dimensions.height = parseInt(height, 10);\n  }\n\n  return dimensions;\n};\n\nclass HTMLParser extends BasicObject {\n  static parse(html, options) {\n    const parser = new this(html, options);\n    parser.parse();\n    return parser;\n  }\n\n  constructor(html) {\n    let {\n      referenceElement\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super(...arguments);\n    this.html = html;\n    this.referenceElement = referenceElement;\n    this.blocks = [];\n    this.blockElements = [];\n    this.processedElements = [];\n  }\n\n  getDocument() {\n    return Document.fromJSON(this.blocks);\n  } // HTML parsing\n\n\n  parse() {\n    try {\n      this.createHiddenContainer();\n      const html = HTMLSanitizer.sanitize(this.html).getHTML();\n      this.containerElement.innerHTML = html;\n      const walker = walkTree(this.containerElement, {\n        usingFilter: nodeFilter\n      });\n\n      while (walker.nextNode()) {\n        this.processNode(walker.currentNode);\n      }\n\n      return this.translateBlockElementMarginsToNewlines();\n    } finally {\n      this.removeHiddenContainer();\n    }\n  }\n\n  createHiddenContainer() {\n    if (this.referenceElement) {\n      this.containerElement = this.referenceElement.cloneNode(false);\n      this.containerElement.removeAttribute(\"id\");\n      this.containerElement.setAttribute(\"data-trix-internal\", \"\");\n      this.containerElement.style.display = \"none\";\n      return this.referenceElement.parentNode.insertBefore(this.containerElement, this.referenceElement.nextSibling);\n    } else {\n      this.containerElement = makeElement({\n        tagName: \"div\",\n        style: {\n          display: \"none\"\n        }\n      });\n      return document.body.appendChild(this.containerElement);\n    }\n  }\n\n  removeHiddenContainer() {\n    return removeNode(this.containerElement);\n  }\n\n  processNode(node) {\n    switch (node.nodeType) {\n      case Node.TEXT_NODE:\n        if (!this.isInsignificantTextNode(node)) {\n          this.appendBlockForTextNode(node);\n          return this.processTextNode(node);\n        }\n\n        break;\n\n      case Node.ELEMENT_NODE:\n        this.appendBlockForElement(node);\n        return this.processElement(node);\n    }\n  }\n\n  appendBlockForTextNode(node) {\n    const element = node.parentNode;\n\n    if (element === this.currentBlockElement && this.isBlockElement(node.previousSibling)) {\n      return this.appendStringWithAttributes(\"\\n\");\n    } else if (element === this.containerElement || this.isBlockElement(element)) {\n      var _this$currentBlock;\n\n      const attributes = this.getBlockAttributes(element);\n\n      if (!arraysAreEqual(attributes, (_this$currentBlock = this.currentBlock) === null || _this$currentBlock === void 0 ? void 0 : _this$currentBlock.attributes)) {\n        this.currentBlock = this.appendBlockForAttributesWithElement(attributes, element);\n        this.currentBlockElement = element;\n      }\n    }\n  }\n\n  appendBlockForElement(element) {\n    const elementIsBlockElement = this.isBlockElement(element);\n    const currentBlockContainsElement = elementContainsNode(this.currentBlockElement, element);\n\n    if (elementIsBlockElement && !this.isBlockElement(element.firstChild)) {\n      if (!this.isInsignificantTextNode(element.firstChild) || !this.isBlockElement(element.firstElementChild)) {\n        const attributes = this.getBlockAttributes(element);\n\n        if (element.firstChild) {\n          if (!(currentBlockContainsElement && arraysAreEqual(attributes, this.currentBlock.attributes))) {\n            this.currentBlock = this.appendBlockForAttributesWithElement(attributes, element);\n            this.currentBlockElement = element;\n          } else {\n            return this.appendStringWithAttributes(\"\\n\");\n          }\n        }\n      }\n    } else if (this.currentBlockElement && !currentBlockContainsElement && !elementIsBlockElement) {\n      const parentBlockElement = this.findParentBlockElement(element);\n\n      if (parentBlockElement) {\n        return this.appendBlockForElement(parentBlockElement);\n      } else {\n        this.currentBlock = this.appendEmptyBlock();\n        this.currentBlockElement = null;\n      }\n    }\n  }\n\n  findParentBlockElement(element) {\n    let {\n      parentElement\n    } = element;\n\n    while (parentElement && parentElement !== this.containerElement) {\n      if (this.isBlockElement(parentElement) && this.blockElements.includes(parentElement)) {\n        return parentElement;\n      } else {\n        parentElement = parentElement.parentElement;\n      }\n    }\n\n    return null;\n  }\n\n  processTextNode(node) {\n    let string = node.data;\n\n    if (!elementCanDisplayPreformattedText(node.parentNode)) {\n      var _node$previousSibling;\n\n      string = squishBreakableWhitespace(string);\n\n      if (stringEndsWithWhitespace((_node$previousSibling = node.previousSibling) === null || _node$previousSibling === void 0 ? void 0 : _node$previousSibling.textContent)) {\n        string = leftTrimBreakableWhitespace(string);\n      }\n    }\n\n    return this.appendStringWithAttributes(string, this.getTextAttributes(node.parentNode));\n  }\n\n  processElement(element) {\n    let attributes;\n\n    if (nodeIsAttachmentElement(element)) {\n      attributes = parseTrixDataAttribute(element, \"attachment\");\n\n      if (Object.keys(attributes).length) {\n        const textAttributes = this.getTextAttributes(element);\n        this.appendAttachmentWithAttributes(attributes, textAttributes); // We have everything we need so avoid processing inner nodes\n\n        element.innerHTML = \"\";\n      }\n\n      return this.processedElements.push(element);\n    } else {\n      switch (tagName(element)) {\n        case \"br\":\n          if (!this.isExtraBR(element) && !this.isBlockElement(element.nextSibling)) {\n            this.appendStringWithAttributes(\"\\n\", this.getTextAttributes(element));\n          }\n\n          return this.processedElements.push(element);\n\n        case \"img\":\n          attributes = {\n            url: element.getAttribute(\"src\"),\n            contentType: \"image\"\n          };\n          const object = getImageDimensions(element);\n\n          for (const key in object) {\n            const value = object[key];\n            attributes[key] = value;\n          }\n\n          this.appendAttachmentWithAttributes(attributes, this.getTextAttributes(element));\n          return this.processedElements.push(element);\n\n        case \"tr\":\n          if (element.parentNode.firstChild !== element) {\n            return this.appendStringWithAttributes(\"\\n\");\n          }\n\n          break;\n\n        case \"td\":\n          if (element.parentNode.firstChild !== element) {\n            return this.appendStringWithAttributes(\" | \");\n          }\n\n          break;\n      }\n    }\n  } // Document construction\n\n\n  appendBlockForAttributesWithElement(attributes, element) {\n    this.blockElements.push(element);\n    const block = blockForAttributes(attributes);\n    this.blocks.push(block);\n    return block;\n  }\n\n  appendEmptyBlock() {\n    return this.appendBlockForAttributesWithElement([], null);\n  }\n\n  appendStringWithAttributes(string, attributes) {\n    return this.appendPiece(pieceForString(string, attributes));\n  }\n\n  appendAttachmentWithAttributes(attachment, attributes) {\n    return this.appendPiece(pieceForAttachment(attachment, attributes));\n  }\n\n  appendPiece(piece) {\n    if (this.blocks.length === 0) {\n      this.appendEmptyBlock();\n    }\n\n    return this.blocks[this.blocks.length - 1].text.push(piece);\n  }\n\n  appendStringToTextAtIndex(string, index) {\n    const {\n      text\n    } = this.blocks[index];\n    const piece = text[text.length - 1];\n\n    if ((piece === null || piece === void 0 ? void 0 : piece.type) === \"string\") {\n      piece.string += string;\n    } else {\n      return text.push(pieceForString(string));\n    }\n  }\n\n  prependStringToTextAtIndex(string, index) {\n    const {\n      text\n    } = this.blocks[index];\n    const piece = text[0];\n\n    if ((piece === null || piece === void 0 ? void 0 : piece.type) === \"string\") {\n      piece.string = string + piece.string;\n    } else {\n      return text.unshift(pieceForString(string));\n    }\n  } // Attribute parsing\n\n\n  getTextAttributes(element) {\n    let value;\n    const attributes = {};\n\n    for (const attribute in config.textAttributes) {\n      const configAttr = config.textAttributes[attribute];\n\n      if (configAttr.tagName && findClosestElementFromNode(element, {\n        matchingSelector: configAttr.tagName,\n        untilNode: this.containerElement\n      })) {\n        attributes[attribute] = true;\n      } else if (configAttr.parser) {\n        value = configAttr.parser(element);\n\n        if (value) {\n          let attributeInheritedFromBlock = false;\n\n          for (const blockElement of this.findBlockElementAncestors(element)) {\n            if (configAttr.parser(blockElement) === value) {\n              attributeInheritedFromBlock = true;\n              break;\n            }\n          }\n\n          if (!attributeInheritedFromBlock) {\n            attributes[attribute] = value;\n          }\n        }\n      } else if (configAttr.styleProperty) {\n        value = element.style[configAttr.styleProperty];\n\n        if (value) {\n          attributes[attribute] = value;\n        }\n      }\n    }\n\n    if (nodeIsAttachmentElement(element)) {\n      const object = parseTrixDataAttribute(element, \"attributes\");\n\n      for (const key in object) {\n        value = object[key];\n        attributes[key] = value;\n      }\n    }\n\n    return attributes;\n  }\n\n  getBlockAttributes(element) {\n    const attributes = [];\n\n    while (element && element !== this.containerElement) {\n      for (const attribute in config.blockAttributes) {\n        const attrConfig = config.blockAttributes[attribute];\n\n        if (attrConfig.parse !== false) {\n          if (tagName(element) === attrConfig.tagName) {\n            var _attrConfig$test;\n\n            if ((_attrConfig$test = attrConfig.test) !== null && _attrConfig$test !== void 0 && _attrConfig$test.call(attrConfig, element) || !attrConfig.test) {\n              attributes.push(attribute);\n\n              if (attrConfig.listAttribute) {\n                attributes.push(attrConfig.listAttribute);\n              }\n            }\n          }\n        }\n      }\n\n      element = element.parentNode;\n    }\n\n    return attributes.reverse();\n  }\n\n  findBlockElementAncestors(element) {\n    const ancestors = [];\n\n    while (element && element !== this.containerElement) {\n      const tag = tagName(element);\n\n      if (getBlockTagNames().includes(tag)) {\n        ancestors.push(element);\n      }\n\n      element = element.parentNode;\n    }\n\n    return ancestors;\n  } // Element inspection\n\n\n  isBlockElement(element) {\n    if ((element === null || element === void 0 ? void 0 : element.nodeType) !== Node.ELEMENT_NODE) return;\n    if (nodeIsAttachmentElement(element)) return;\n    if (findClosestElementFromNode(element, {\n      matchingSelector: \"td\",\n      untilNode: this.containerElement\n    })) return;\n    return getBlockTagNames().includes(tagName(element)) || window.getComputedStyle(element).display === \"block\";\n  }\n\n  isInsignificantTextNode(node) {\n    if ((node === null || node === void 0 ? void 0 : node.nodeType) !== Node.TEXT_NODE) return;\n    if (!stringIsAllBreakableWhitespace(node.data)) return;\n    const {\n      parentNode,\n      previousSibling,\n      nextSibling\n    } = node;\n    if (nodeEndsWithNonWhitespace(parentNode.previousSibling) && !this.isBlockElement(parentNode.previousSibling)) return;\n    if (elementCanDisplayPreformattedText(parentNode)) return;\n    return !previousSibling || this.isBlockElement(previousSibling) || !nextSibling || this.isBlockElement(nextSibling);\n  }\n\n  isExtraBR(element) {\n    return tagName(element) === \"br\" && this.isBlockElement(element.parentNode) && element.parentNode.lastChild === element;\n  } // Margin translation\n\n\n  translateBlockElementMarginsToNewlines() {\n    const defaultMargin = this.getMarginOfDefaultBlockElement();\n\n    for (let index = 0; index < this.blocks.length; index++) {\n      const margin = this.getMarginOfBlockElementAtIndex(index);\n\n      if (margin) {\n        if (margin.top > defaultMargin.top * 2) {\n          this.prependStringToTextAtIndex(\"\\n\", index);\n        }\n\n        if (margin.bottom > defaultMargin.bottom * 2) {\n          this.appendStringToTextAtIndex(\"\\n\", index);\n        }\n      }\n    }\n  }\n\n  getMarginOfBlockElementAtIndex(index) {\n    const element = this.blockElements[index];\n\n    if (element) {\n      if (element.textContent) {\n        if (!getBlockTagNames().includes(tagName(element)) && !this.processedElements.includes(element)) {\n          return getBlockElementMargin(element);\n        }\n      }\n    }\n  }\n\n  getMarginOfDefaultBlockElement() {\n    const element = makeElement(config.blockAttributes.default.tagName);\n    this.containerElement.appendChild(element);\n    return getBlockElementMargin(element);\n  }\n\n} // Helpers\n\n\nconst elementCanDisplayPreformattedText = function (element) {\n  const {\n    whiteSpace\n  } = window.getComputedStyle(element);\n  return [\"pre\", \"pre-wrap\", \"pre-line\"].includes(whiteSpace);\n};\n\nconst nodeEndsWithNonWhitespace = node => node && !stringEndsWithWhitespace(node.textContent);\n\nconst getBlockElementMargin = function (element) {\n  const style = window.getComputedStyle(element);\n\n  if (style.display === \"block\") {\n    return {\n      top: parseInt(style.marginTop),\n      bottom: parseInt(style.marginBottom)\n    };\n  }\n};\n\nconst nodeFilter = function (node) {\n  if (tagName(node) === \"style\") {\n    return NodeFilter.FILTER_REJECT;\n  } else {\n    return NodeFilter.FILTER_ACCEPT;\n  }\n}; // Whitespace\n\n\nconst leftTrimBreakableWhitespace = string => string.replace(new RegExp(\"^\".concat(breakableWhitespacePattern.source, \"+\")), \"\");\n\nconst stringIsAllBreakableWhitespace = string => new RegExp(\"^\".concat(breakableWhitespacePattern.source, \"*$\")).test(string);\n\nconst stringEndsWithWhitespace = string => /\\s$/.test(string);\n\nclass LineBreakInsertion {\n  constructor(composition) {\n    this.composition = composition;\n    this.document = this.composition.document;\n    const selectedRange = this.composition.getSelectedRange();\n    this.startPosition = selectedRange[0];\n    this.endPosition = selectedRange[1];\n    this.startLocation = this.document.locationFromPosition(this.startPosition);\n    this.endLocation = this.document.locationFromPosition(this.endPosition);\n    this.block = this.document.getBlockAtIndex(this.endLocation.index);\n    this.breaksOnReturn = this.block.breaksOnReturn();\n    this.previousCharacter = this.block.text.getStringAtPosition(this.endLocation.offset - 1);\n    this.nextCharacter = this.block.text.getStringAtPosition(this.endLocation.offset);\n  }\n\n  shouldInsertBlockBreak() {\n    if (this.block.hasAttributes() && this.block.isListItem() && !this.block.isEmpty()) {\n      return this.startLocation.offset !== 0;\n    } else {\n      return this.breaksOnReturn && this.nextCharacter !== \"\\n\";\n    }\n  }\n\n  shouldBreakFormattedBlock() {\n    return this.block.hasAttributes() && !this.block.isListItem() && (this.breaksOnReturn && this.nextCharacter === \"\\n\" || this.previousCharacter === \"\\n\");\n  }\n\n  shouldDecreaseListLevel() {\n    return this.block.hasAttributes() && this.block.isListItem() && this.block.isEmpty();\n  }\n\n  shouldPrependListItem() {\n    return this.block.isListItem() && this.startLocation.offset === 0 && !this.block.isEmpty();\n  }\n\n  shouldRemoveLastBlockAttribute() {\n    return this.block.hasAttributes() && !this.block.isListItem() && this.block.isEmpty();\n  }\n\n}\n\nconst PLACEHOLDER = \" \";\n\nclass Composition extends BasicObject {\n  constructor() {\n    super(...arguments);\n    this.document = new Document();\n    this.attachments = [];\n    this.currentAttributes = {};\n    this.revision = 0;\n  }\n\n  setDocument(document) {\n    if (!document.isEqualTo(this.document)) {\n      var _this$delegate, _this$delegate$compos;\n\n      this.document = document;\n      this.refreshAttachments();\n      this.revision++;\n      return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$compos = _this$delegate.compositionDidChangeDocument) === null || _this$delegate$compos === void 0 ? void 0 : _this$delegate$compos.call(_this$delegate, document);\n    }\n  } // Snapshots\n\n\n  getSnapshot() {\n    return {\n      document: this.document,\n      selectedRange: this.getSelectedRange()\n    };\n  }\n\n  loadSnapshot(_ref) {\n    var _this$delegate2, _this$delegate2$compo, _this$delegate3, _this$delegate3$compo;\n\n    let {\n      document,\n      selectedRange\n    } = _ref;\n    (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$compo = _this$delegate2.compositionWillLoadSnapshot) === null || _this$delegate2$compo === void 0 ? void 0 : _this$delegate2$compo.call(_this$delegate2);\n    this.setDocument(document != null ? document : new Document());\n    this.setSelection(selectedRange != null ? selectedRange : [0, 0]);\n    return (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : (_this$delegate3$compo = _this$delegate3.compositionDidLoadSnapshot) === null || _this$delegate3$compo === void 0 ? void 0 : _this$delegate3$compo.call(_this$delegate3);\n  } // Responder protocol\n\n\n  insertText(text) {\n    let {\n      updatePosition\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      updatePosition: true\n    };\n    const selectedRange = this.getSelectedRange();\n    this.setDocument(this.document.insertTextAtRange(text, selectedRange));\n    const startPosition = selectedRange[0];\n    const endPosition = startPosition + text.getLength();\n\n    if (updatePosition) {\n      this.setSelection(endPosition);\n    }\n\n    return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n  }\n\n  insertBlock() {\n    let block = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Block();\n    const document = new Document([block]);\n    return this.insertDocument(document);\n  }\n\n  insertDocument() {\n    let document = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Document();\n    const selectedRange = this.getSelectedRange();\n    this.setDocument(this.document.insertDocumentAtRange(document, selectedRange));\n    const startPosition = selectedRange[0];\n    const endPosition = startPosition + document.getLength();\n    this.setSelection(endPosition);\n    return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n  }\n\n  insertString(string, options) {\n    const attributes = this.getCurrentTextAttributes();\n    const text = Text.textForStringWithAttributes(string, attributes);\n    return this.insertText(text, options);\n  }\n\n  insertBlockBreak() {\n    const selectedRange = this.getSelectedRange();\n    this.setDocument(this.document.insertBlockBreakAtRange(selectedRange));\n    const startPosition = selectedRange[0];\n    const endPosition = startPosition + 1;\n    this.setSelection(endPosition);\n    return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n  }\n\n  insertLineBreak() {\n    const insertion = new LineBreakInsertion(this);\n\n    if (insertion.shouldDecreaseListLevel()) {\n      this.decreaseListLevel();\n      return this.setSelection(insertion.startPosition);\n    } else if (insertion.shouldPrependListItem()) {\n      const document = new Document([insertion.block.copyWithoutText()]);\n      return this.insertDocument(document);\n    } else if (insertion.shouldInsertBlockBreak()) {\n      return this.insertBlockBreak();\n    } else if (insertion.shouldRemoveLastBlockAttribute()) {\n      return this.removeLastBlockAttribute();\n    } else if (insertion.shouldBreakFormattedBlock()) {\n      return this.breakFormattedBlock(insertion);\n    } else {\n      return this.insertString(\"\\n\");\n    }\n  }\n\n  insertHTML(html) {\n    const document = HTMLParser.parse(html).getDocument();\n    const selectedRange = this.getSelectedRange();\n    this.setDocument(this.document.mergeDocumentAtRange(document, selectedRange));\n    const startPosition = selectedRange[0];\n    const endPosition = startPosition + document.getLength() - 1;\n    this.setSelection(endPosition);\n    return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n  }\n\n  replaceHTML(html) {\n    const document = HTMLParser.parse(html).getDocument().copyUsingObjectsFromDocument(this.document);\n    const locationRange = this.getLocationRange({\n      strict: false\n    });\n    const selectedRange = this.document.rangeFromLocationRange(locationRange);\n    this.setDocument(document);\n    return this.setSelection(selectedRange);\n  }\n\n  insertFile(file) {\n    return this.insertFiles([file]);\n  }\n\n  insertFiles(files) {\n    const attachments = [];\n    Array.from(files).forEach(file => {\n      var _this$delegate4;\n\n      if ((_this$delegate4 = this.delegate) !== null && _this$delegate4 !== void 0 && _this$delegate4.compositionShouldAcceptFile(file)) {\n        const attachment = Attachment.attachmentForFile(file);\n        attachments.push(attachment);\n      }\n    });\n    return this.insertAttachments(attachments);\n  }\n\n  insertAttachment(attachment) {\n    return this.insertAttachments([attachment]);\n  }\n\n  insertAttachments(attachments) {\n    let text = new Text();\n    Array.from(attachments).forEach(attachment => {\n      var _config$attachments$t;\n\n      const type = attachment.getType();\n      const presentation = (_config$attachments$t = config.attachments[type]) === null || _config$attachments$t === void 0 ? void 0 : _config$attachments$t.presentation;\n      const attributes = this.getCurrentTextAttributes();\n\n      if (presentation) {\n        attributes.presentation = presentation;\n      }\n\n      const attachmentText = Text.textForAttachmentWithAttributes(attachment, attributes);\n      text = text.appendText(attachmentText);\n    });\n    return this.insertText(text);\n  }\n\n  shouldManageDeletingInDirection(direction) {\n    const locationRange = this.getLocationRange();\n\n    if (rangeIsCollapsed(locationRange)) {\n      if (direction === \"backward\" && locationRange[0].offset === 0) {\n        return true;\n      }\n\n      if (this.shouldManageMovingCursorInDirection(direction)) {\n        return true;\n      }\n    } else {\n      if (locationRange[0].index !== locationRange[1].index) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  deleteInDirection(direction) {\n    let {\n      length\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let attachment, deletingIntoPreviousBlock, selectionSpansBlocks;\n    const locationRange = this.getLocationRange();\n    let range = this.getSelectedRange();\n    const selectionIsCollapsed = rangeIsCollapsed(range);\n\n    if (selectionIsCollapsed) {\n      deletingIntoPreviousBlock = direction === \"backward\" && locationRange[0].offset === 0;\n    } else {\n      selectionSpansBlocks = locationRange[0].index !== locationRange[1].index;\n    }\n\n    if (deletingIntoPreviousBlock) {\n      if (this.canDecreaseBlockAttributeLevel()) {\n        const block = this.getBlock();\n\n        if (block.isListItem()) {\n          this.decreaseListLevel();\n        } else {\n          this.decreaseBlockAttributeLevel();\n        }\n\n        this.setSelection(range[0]);\n\n        if (block.isEmpty()) {\n          return false;\n        }\n      }\n    }\n\n    if (selectionIsCollapsed) {\n      range = this.getExpandedRangeInDirection(direction, {\n        length\n      });\n\n      if (direction === \"backward\") {\n        attachment = this.getAttachmentAtRange(range);\n      }\n    }\n\n    if (attachment) {\n      this.editAttachment(attachment);\n      return false;\n    } else {\n      this.setDocument(this.document.removeTextAtRange(range));\n      this.setSelection(range[0]);\n\n      if (deletingIntoPreviousBlock || selectionSpansBlocks) {\n        return false;\n      }\n    }\n  }\n\n  moveTextFromRange(range) {\n    const [position] = Array.from(this.getSelectedRange());\n    this.setDocument(this.document.moveTextFromRangeToPosition(range, position));\n    return this.setSelection(position);\n  }\n\n  removeAttachment(attachment) {\n    const range = this.document.getRangeOfAttachment(attachment);\n\n    if (range) {\n      this.stopEditingAttachment();\n      this.setDocument(this.document.removeTextAtRange(range));\n      return this.setSelection(range[0]);\n    }\n  }\n\n  removeLastBlockAttribute() {\n    const [startPosition, endPosition] = Array.from(this.getSelectedRange());\n    const block = this.document.getBlockAtPosition(endPosition);\n    this.removeCurrentAttribute(block.getLastAttribute());\n    return this.setSelection(startPosition);\n  }\n\n  insertPlaceholder() {\n    this.placeholderPosition = this.getPosition();\n    return this.insertString(PLACEHOLDER);\n  }\n\n  selectPlaceholder() {\n    if (this.placeholderPosition != null) {\n      this.setSelectedRange([this.placeholderPosition, this.placeholderPosition + PLACEHOLDER.length]);\n      return this.getSelectedRange();\n    }\n  }\n\n  forgetPlaceholder() {\n    this.placeholderPosition = null;\n  } // Current attributes\n\n\n  hasCurrentAttribute(attributeName) {\n    const value = this.currentAttributes[attributeName];\n    return value != null && value !== false;\n  }\n\n  toggleCurrentAttribute(attributeName) {\n    const value = !this.currentAttributes[attributeName];\n\n    if (value) {\n      return this.setCurrentAttribute(attributeName, value);\n    } else {\n      return this.removeCurrentAttribute(attributeName);\n    }\n  }\n\n  canSetCurrentAttribute(attributeName) {\n    if (getBlockConfig(attributeName)) {\n      return this.canSetCurrentBlockAttribute(attributeName);\n    } else {\n      return this.canSetCurrentTextAttribute(attributeName);\n    }\n  }\n\n  canSetCurrentTextAttribute(attributeName) {\n    const document = this.getSelectedDocument();\n    if (!document) return;\n\n    for (const attachment of Array.from(document.getAttachments())) {\n      if (!attachment.hasContent()) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  canSetCurrentBlockAttribute(attributeName) {\n    const block = this.getBlock();\n    if (!block) return;\n    return !block.isTerminalBlock();\n  }\n\n  setCurrentAttribute(attributeName, value) {\n    if (getBlockConfig(attributeName)) {\n      return this.setBlockAttribute(attributeName, value);\n    } else {\n      this.setTextAttribute(attributeName, value);\n      this.currentAttributes[attributeName] = value;\n      return this.notifyDelegateOfCurrentAttributesChange();\n    }\n  }\n\n  setTextAttribute(attributeName, value) {\n    const selectedRange = this.getSelectedRange();\n    if (!selectedRange) return;\n    const [startPosition, endPosition] = Array.from(selectedRange);\n\n    if (startPosition === endPosition) {\n      if (attributeName === \"href\") {\n        const text = Text.textForStringWithAttributes(value, {\n          href: value\n        });\n        return this.insertText(text);\n      }\n    } else {\n      return this.setDocument(this.document.addAttributeAtRange(attributeName, value, selectedRange));\n    }\n  }\n\n  setBlockAttribute(attributeName, value) {\n    const selectedRange = this.getSelectedRange();\n\n    if (this.canSetCurrentAttribute(attributeName)) {\n      this.setDocument(this.document.applyBlockAttributeAtRange(attributeName, value, selectedRange));\n      return this.setSelection(selectedRange);\n    }\n  }\n\n  removeCurrentAttribute(attributeName) {\n    if (getBlockConfig(attributeName)) {\n      this.removeBlockAttribute(attributeName);\n      return this.updateCurrentAttributes();\n    } else {\n      this.removeTextAttribute(attributeName);\n      delete this.currentAttributes[attributeName];\n      return this.notifyDelegateOfCurrentAttributesChange();\n    }\n  }\n\n  removeTextAttribute(attributeName) {\n    const selectedRange = this.getSelectedRange();\n    if (!selectedRange) return;\n    return this.setDocument(this.document.removeAttributeAtRange(attributeName, selectedRange));\n  }\n\n  removeBlockAttribute(attributeName) {\n    const selectedRange = this.getSelectedRange();\n    if (!selectedRange) return;\n    return this.setDocument(this.document.removeAttributeAtRange(attributeName, selectedRange));\n  }\n\n  canDecreaseNestingLevel() {\n    var _this$getBlock;\n\n    return ((_this$getBlock = this.getBlock()) === null || _this$getBlock === void 0 ? void 0 : _this$getBlock.getNestingLevel()) > 0;\n  }\n\n  canIncreaseNestingLevel() {\n    var _getBlockConfig;\n\n    const block = this.getBlock();\n    if (!block) return;\n\n    if ((_getBlockConfig = getBlockConfig(block.getLastNestableAttribute())) !== null && _getBlockConfig !== void 0 && _getBlockConfig.listAttribute) {\n      const previousBlock = this.getPreviousBlock();\n\n      if (previousBlock) {\n        return arrayStartsWith(previousBlock.getListItemAttributes(), block.getListItemAttributes());\n      }\n    } else {\n      return block.getNestingLevel() > 0;\n    }\n  }\n\n  decreaseNestingLevel() {\n    const block = this.getBlock();\n    if (!block) return;\n    return this.setDocument(this.document.replaceBlock(block, block.decreaseNestingLevel()));\n  }\n\n  increaseNestingLevel() {\n    const block = this.getBlock();\n    if (!block) return;\n    return this.setDocument(this.document.replaceBlock(block, block.increaseNestingLevel()));\n  }\n\n  canDecreaseBlockAttributeLevel() {\n    var _this$getBlock2;\n\n    return ((_this$getBlock2 = this.getBlock()) === null || _this$getBlock2 === void 0 ? void 0 : _this$getBlock2.getAttributeLevel()) > 0;\n  }\n\n  decreaseBlockAttributeLevel() {\n    var _this$getBlock3;\n\n    const attribute = (_this$getBlock3 = this.getBlock()) === null || _this$getBlock3 === void 0 ? void 0 : _this$getBlock3.getLastAttribute();\n\n    if (attribute) {\n      return this.removeCurrentAttribute(attribute);\n    }\n  }\n\n  decreaseListLevel() {\n    let [startPosition] = Array.from(this.getSelectedRange());\n    const {\n      index\n    } = this.document.locationFromPosition(startPosition);\n    let endIndex = index;\n    const attributeLevel = this.getBlock().getAttributeLevel();\n    let block = this.document.getBlockAtIndex(endIndex + 1);\n\n    while (block) {\n      if (!block.isListItem() || block.getAttributeLevel() <= attributeLevel) {\n        break;\n      }\n\n      endIndex++;\n      block = this.document.getBlockAtIndex(endIndex + 1);\n    }\n\n    startPosition = this.document.positionFromLocation({\n      index,\n      offset: 0\n    });\n    const endPosition = this.document.positionFromLocation({\n      index: endIndex,\n      offset: 0\n    });\n    return this.setDocument(this.document.removeLastListAttributeAtRange([startPosition, endPosition]));\n  }\n\n  updateCurrentAttributes() {\n    const selectedRange = this.getSelectedRange({\n      ignoreLock: true\n    });\n\n    if (selectedRange) {\n      const currentAttributes = this.document.getCommonAttributesAtRange(selectedRange);\n      Array.from(getAllAttributeNames()).forEach(attributeName => {\n        if (!currentAttributes[attributeName]) {\n          if (!this.canSetCurrentAttribute(attributeName)) {\n            currentAttributes[attributeName] = false;\n          }\n        }\n      });\n\n      if (!objectsAreEqual(currentAttributes, this.currentAttributes)) {\n        this.currentAttributes = currentAttributes;\n        return this.notifyDelegateOfCurrentAttributesChange();\n      }\n    }\n  }\n\n  getCurrentAttributes() {\n    return extend.call({}, this.currentAttributes);\n  }\n\n  getCurrentTextAttributes() {\n    const attributes = {};\n\n    for (const key in this.currentAttributes) {\n      const value = this.currentAttributes[key];\n\n      if (value !== false) {\n        if (getTextConfig(key)) {\n          attributes[key] = value;\n        }\n      }\n    }\n\n    return attributes;\n  } // Selection freezing\n\n\n  freezeSelection() {\n    return this.setCurrentAttribute(\"frozen\", true);\n  }\n\n  thawSelection() {\n    return this.removeCurrentAttribute(\"frozen\");\n  }\n\n  hasFrozenSelection() {\n    return this.hasCurrentAttribute(\"frozen\");\n  }\n\n  setSelection(selectedRange) {\n    var _this$delegate5;\n\n    const locationRange = this.document.locationRangeFromRange(selectedRange);\n    return (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.compositionDidRequestChangingSelectionToLocationRange(locationRange);\n  }\n\n  getSelectedRange() {\n    const locationRange = this.getLocationRange();\n\n    if (locationRange) {\n      return this.document.rangeFromLocationRange(locationRange);\n    }\n  }\n\n  setSelectedRange(selectedRange) {\n    const locationRange = this.document.locationRangeFromRange(selectedRange);\n    return this.getSelectionManager().setLocationRange(locationRange);\n  }\n\n  getPosition() {\n    const locationRange = this.getLocationRange();\n\n    if (locationRange) {\n      return this.document.positionFromLocation(locationRange[0]);\n    }\n  }\n\n  getLocationRange(options) {\n    if (this.targetLocationRange) {\n      return this.targetLocationRange;\n    } else {\n      return this.getSelectionManager().getLocationRange(options) || normalizeRange({\n        index: 0,\n        offset: 0\n      });\n    }\n  }\n\n  withTargetLocationRange(locationRange, fn) {\n    let result;\n    this.targetLocationRange = locationRange;\n\n    try {\n      result = fn();\n    } finally {\n      this.targetLocationRange = null;\n    }\n\n    return result;\n  }\n\n  withTargetRange(range, fn) {\n    const locationRange = this.document.locationRangeFromRange(range);\n    return this.withTargetLocationRange(locationRange, fn);\n  }\n\n  withTargetDOMRange(domRange, fn) {\n    const locationRange = this.createLocationRangeFromDOMRange(domRange, {\n      strict: false\n    });\n    return this.withTargetLocationRange(locationRange, fn);\n  }\n\n  getExpandedRangeInDirection(direction) {\n    let {\n      length\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let [startPosition, endPosition] = Array.from(this.getSelectedRange());\n\n    if (direction === \"backward\") {\n      if (length) {\n        startPosition -= length;\n      } else {\n        startPosition = this.translateUTF16PositionFromOffset(startPosition, -1);\n      }\n    } else {\n      if (length) {\n        endPosition += length;\n      } else {\n        endPosition = this.translateUTF16PositionFromOffset(endPosition, 1);\n      }\n    }\n\n    return normalizeRange([startPosition, endPosition]);\n  }\n\n  shouldManageMovingCursorInDirection(direction) {\n    if (this.editingAttachment) {\n      return true;\n    }\n\n    const range = this.getExpandedRangeInDirection(direction);\n    return this.getAttachmentAtRange(range) != null;\n  }\n\n  moveCursorInDirection(direction) {\n    let canEditAttachment, range;\n\n    if (this.editingAttachment) {\n      range = this.document.getRangeOfAttachment(this.editingAttachment);\n    } else {\n      const selectedRange = this.getSelectedRange();\n      range = this.getExpandedRangeInDirection(direction);\n      canEditAttachment = !rangesAreEqual(selectedRange, range);\n    }\n\n    if (direction === \"backward\") {\n      this.setSelectedRange(range[0]);\n    } else {\n      this.setSelectedRange(range[1]);\n    }\n\n    if (canEditAttachment) {\n      const attachment = this.getAttachmentAtRange(range);\n\n      if (attachment) {\n        return this.editAttachment(attachment);\n      }\n    }\n  }\n\n  expandSelectionInDirection(direction) {\n    let {\n      length\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const range = this.getExpandedRangeInDirection(direction, {\n      length\n    });\n    return this.setSelectedRange(range);\n  }\n\n  expandSelectionForEditing() {\n    if (this.hasCurrentAttribute(\"href\")) {\n      return this.expandSelectionAroundCommonAttribute(\"href\");\n    }\n  }\n\n  expandSelectionAroundCommonAttribute(attributeName) {\n    const position = this.getPosition();\n    const range = this.document.getRangeOfCommonAttributeAtPosition(attributeName, position);\n    return this.setSelectedRange(range);\n  }\n\n  selectionContainsAttachments() {\n    var _this$getSelectedAtta;\n\n    return ((_this$getSelectedAtta = this.getSelectedAttachments()) === null || _this$getSelectedAtta === void 0 ? void 0 : _this$getSelectedAtta.length) > 0;\n  }\n\n  selectionIsInCursorTarget() {\n    return this.editingAttachment || this.positionIsCursorTarget(this.getPosition());\n  }\n\n  positionIsCursorTarget(position) {\n    const location = this.document.locationFromPosition(position);\n\n    if (location) {\n      return this.locationIsCursorTarget(location);\n    }\n  }\n\n  positionIsBlockBreak(position) {\n    var _this$document$getPie;\n\n    return (_this$document$getPie = this.document.getPieceAtPosition(position)) === null || _this$document$getPie === void 0 ? void 0 : _this$document$getPie.isBlockBreak();\n  }\n\n  getSelectedDocument() {\n    const selectedRange = this.getSelectedRange();\n\n    if (selectedRange) {\n      return this.document.getDocumentAtRange(selectedRange);\n    }\n  }\n\n  getSelectedAttachments() {\n    var _this$getSelectedDocu;\n\n    return (_this$getSelectedDocu = this.getSelectedDocument()) === null || _this$getSelectedDocu === void 0 ? void 0 : _this$getSelectedDocu.getAttachments();\n  } // Attachments\n\n\n  getAttachments() {\n    return this.attachments.slice(0);\n  }\n\n  refreshAttachments() {\n    const attachments = this.document.getAttachments();\n    const {\n      added,\n      removed\n    } = summarizeArrayChange(this.attachments, attachments);\n    this.attachments = attachments;\n    Array.from(removed).forEach(attachment => {\n      var _this$delegate6, _this$delegate6$compo;\n\n      attachment.delegate = null;\n      (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : (_this$delegate6$compo = _this$delegate6.compositionDidRemoveAttachment) === null || _this$delegate6$compo === void 0 ? void 0 : _this$delegate6$compo.call(_this$delegate6, attachment);\n    });\n    return (() => {\n      const result = [];\n      Array.from(added).forEach(attachment => {\n        var _this$delegate7, _this$delegate7$compo;\n\n        attachment.delegate = this;\n        result.push((_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : (_this$delegate7$compo = _this$delegate7.compositionDidAddAttachment) === null || _this$delegate7$compo === void 0 ? void 0 : _this$delegate7$compo.call(_this$delegate7, attachment));\n      });\n      return result;\n    })();\n  } // Attachment delegate\n\n\n  attachmentDidChangeAttributes(attachment) {\n    var _this$delegate8, _this$delegate8$compo;\n\n    this.revision++;\n    return (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : (_this$delegate8$compo = _this$delegate8.compositionDidEditAttachment) === null || _this$delegate8$compo === void 0 ? void 0 : _this$delegate8$compo.call(_this$delegate8, attachment);\n  }\n\n  attachmentDidChangePreviewURL(attachment) {\n    var _this$delegate9, _this$delegate9$compo;\n\n    this.revision++;\n    return (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : (_this$delegate9$compo = _this$delegate9.compositionDidChangeAttachmentPreviewURL) === null || _this$delegate9$compo === void 0 ? void 0 : _this$delegate9$compo.call(_this$delegate9, attachment);\n  } // Attachment editing\n\n\n  editAttachment(attachment, options) {\n    var _this$delegate10, _this$delegate10$comp;\n\n    if (attachment === this.editingAttachment) return;\n    this.stopEditingAttachment();\n    this.editingAttachment = attachment;\n    return (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : (_this$delegate10$comp = _this$delegate10.compositionDidStartEditingAttachment) === null || _this$delegate10$comp === void 0 ? void 0 : _this$delegate10$comp.call(_this$delegate10, this.editingAttachment, options);\n  }\n\n  stopEditingAttachment() {\n    var _this$delegate11, _this$delegate11$comp;\n\n    if (!this.editingAttachment) return;\n    (_this$delegate11 = this.delegate) === null || _this$delegate11 === void 0 ? void 0 : (_this$delegate11$comp = _this$delegate11.compositionDidStopEditingAttachment) === null || _this$delegate11$comp === void 0 ? void 0 : _this$delegate11$comp.call(_this$delegate11, this.editingAttachment);\n    this.editingAttachment = null;\n  }\n\n  updateAttributesForAttachment(attributes, attachment) {\n    return this.setDocument(this.document.updateAttributesForAttachment(attributes, attachment));\n  }\n\n  removeAttributeForAttachment(attribute, attachment) {\n    return this.setDocument(this.document.removeAttributeForAttachment(attribute, attachment));\n  } // Private\n\n\n  breakFormattedBlock(insertion) {\n    let {\n      document\n    } = insertion;\n    const {\n      block\n    } = insertion;\n    let position = insertion.startPosition;\n    let range = [position - 1, position];\n\n    if (block.getBlockBreakPosition() === insertion.startLocation.offset) {\n      if (block.breaksOnReturn() && insertion.nextCharacter === \"\\n\") {\n        position += 1;\n      } else {\n        document = document.removeTextAtRange(range);\n      }\n\n      range = [position, position];\n    } else if (insertion.nextCharacter === \"\\n\") {\n      if (insertion.previousCharacter === \"\\n\") {\n        range = [position - 1, position + 1];\n      } else {\n        range = [position, position + 1];\n        position += 1;\n      }\n    } else if (insertion.startLocation.offset - 1 !== 0) {\n      position += 1;\n    }\n\n    const newDocument = new Document([block.removeLastAttribute().copyWithoutText()]);\n    this.setDocument(document.insertDocumentAtRange(newDocument, range));\n    return this.setSelection(position);\n  }\n\n  getPreviousBlock() {\n    const locationRange = this.getLocationRange();\n\n    if (locationRange) {\n      const {\n        index\n      } = locationRange[0];\n\n      if (index > 0) {\n        return this.document.getBlockAtIndex(index - 1);\n      }\n    }\n  }\n\n  getBlock() {\n    const locationRange = this.getLocationRange();\n\n    if (locationRange) {\n      return this.document.getBlockAtIndex(locationRange[0].index);\n    }\n  }\n\n  getAttachmentAtRange(range) {\n    const document = this.document.getDocumentAtRange(range);\n\n    if (document.toString() === \"\".concat(OBJECT_REPLACEMENT_CHARACTER, \"\\n\")) {\n      return document.getAttachments()[0];\n    }\n  }\n\n  notifyDelegateOfCurrentAttributesChange() {\n    var _this$delegate12, _this$delegate12$comp;\n\n    return (_this$delegate12 = this.delegate) === null || _this$delegate12 === void 0 ? void 0 : (_this$delegate12$comp = _this$delegate12.compositionDidChangeCurrentAttributes) === null || _this$delegate12$comp === void 0 ? void 0 : _this$delegate12$comp.call(_this$delegate12, this.currentAttributes);\n  }\n\n  notifyDelegateOfInsertionAtRange(range) {\n    var _this$delegate13, _this$delegate13$comp;\n\n    return (_this$delegate13 = this.delegate) === null || _this$delegate13 === void 0 ? void 0 : (_this$delegate13$comp = _this$delegate13.compositionDidPerformInsertionAtRange) === null || _this$delegate13$comp === void 0 ? void 0 : _this$delegate13$comp.call(_this$delegate13, range);\n  }\n\n  translateUTF16PositionFromOffset(position, offset) {\n    const utf16string = this.document.toUTF16String();\n    const utf16position = utf16string.offsetFromUCS2Offset(position);\n    return utf16string.offsetToUCS2Offset(utf16position + offset);\n  }\n\n}\n\nComposition.proxyMethod(\"getSelectionManager().getPointRange\");\nComposition.proxyMethod(\"getSelectionManager().setLocationRangeFromPointRange\");\nComposition.proxyMethod(\"getSelectionManager().createLocationRangeFromDOMRange\");\nComposition.proxyMethod(\"getSelectionManager().locationIsCursorTarget\");\nComposition.proxyMethod(\"getSelectionManager().selectionIsExpanded\");\nComposition.proxyMethod(\"delegate?.getSelectionManager\");\n\nclass UndoManager extends BasicObject {\n  constructor(composition) {\n    super(...arguments);\n    this.composition = composition;\n    this.undoEntries = [];\n    this.redoEntries = [];\n  }\n\n  recordUndoEntry(description) {\n    let {\n      context,\n      consolidatable\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const previousEntry = this.undoEntries.slice(-1)[0];\n\n    if (!consolidatable || !entryHasDescriptionAndContext(previousEntry, description, context)) {\n      const undoEntry = this.createEntry({\n        description,\n        context\n      });\n      this.undoEntries.push(undoEntry);\n      this.redoEntries = [];\n    }\n  }\n\n  undo() {\n    const undoEntry = this.undoEntries.pop();\n\n    if (undoEntry) {\n      const redoEntry = this.createEntry(undoEntry);\n      this.redoEntries.push(redoEntry);\n      return this.composition.loadSnapshot(undoEntry.snapshot);\n    }\n  }\n\n  redo() {\n    const redoEntry = this.redoEntries.pop();\n\n    if (redoEntry) {\n      const undoEntry = this.createEntry(redoEntry);\n      this.undoEntries.push(undoEntry);\n      return this.composition.loadSnapshot(redoEntry.snapshot);\n    }\n  }\n\n  canUndo() {\n    return this.undoEntries.length > 0;\n  }\n\n  canRedo() {\n    return this.redoEntries.length > 0;\n  } // Private\n\n\n  createEntry() {\n    let {\n      description,\n      context\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    return {\n      description: description === null || description === void 0 ? void 0 : description.toString(),\n      context: JSON.stringify(context),\n      snapshot: this.composition.getSnapshot()\n    };\n  }\n\n}\n\nconst entryHasDescriptionAndContext = (entry, description, context) => (entry === null || entry === void 0 ? void 0 : entry.description) === (description === null || description === void 0 ? void 0 : description.toString()) && (entry === null || entry === void 0 ? void 0 : entry.context) === JSON.stringify(context);\n\nconst attachmentGalleryFilter = function (snapshot) {\n  const filter = new Filter(snapshot);\n  filter.perform();\n  return filter.getSnapshot();\n};\n\nconst BLOCK_ATTRIBUTE_NAME = \"attachmentGallery\";\nconst TEXT_ATTRIBUTE_NAME = \"presentation\";\nconst TEXT_ATTRIBUTE_VALUE = \"gallery\";\n\nclass Filter {\n  constructor(snapshot) {\n    this.document = snapshot.document;\n    this.selectedRange = snapshot.selectedRange;\n  }\n\n  perform() {\n    this.removeBlockAttribute();\n    return this.applyBlockAttribute();\n  }\n\n  getSnapshot() {\n    return {\n      document: this.document,\n      selectedRange: this.selectedRange\n    };\n  } // Private\n\n\n  removeBlockAttribute() {\n    return this.findRangesOfBlocks().map(range => this.document = this.document.removeAttributeAtRange(BLOCK_ATTRIBUTE_NAME, range));\n  }\n\n  applyBlockAttribute() {\n    let offset = 0;\n    this.findRangesOfPieces().forEach(range => {\n      if (range[1] - range[0] > 1) {\n        range[0] += offset;\n        range[1] += offset;\n\n        if (this.document.getCharacterAtPosition(range[1]) !== \"\\n\") {\n          this.document = this.document.insertBlockBreakAtRange(range[1]);\n\n          if (range[1] < this.selectedRange[1]) {\n            this.moveSelectedRangeForward();\n          }\n\n          range[1]++;\n          offset++;\n        }\n\n        if (range[0] !== 0) {\n          if (this.document.getCharacterAtPosition(range[0] - 1) !== \"\\n\") {\n            this.document = this.document.insertBlockBreakAtRange(range[0]);\n\n            if (range[0] < this.selectedRange[0]) {\n              this.moveSelectedRangeForward();\n            }\n\n            range[0]++;\n            offset++;\n          }\n        }\n\n        this.document = this.document.applyBlockAttributeAtRange(BLOCK_ATTRIBUTE_NAME, true, range);\n      }\n    });\n  }\n\n  findRangesOfBlocks() {\n    return this.document.findRangesForBlockAttribute(BLOCK_ATTRIBUTE_NAME);\n  }\n\n  findRangesOfPieces() {\n    return this.document.findRangesForTextAttribute(TEXT_ATTRIBUTE_NAME, {\n      withValue: TEXT_ATTRIBUTE_VALUE\n    });\n  }\n\n  moveSelectedRangeForward() {\n    this.selectedRange[0] += 1;\n    this.selectedRange[1] += 1;\n  }\n\n}\n\nconst DEFAULT_FILTERS = [attachmentGalleryFilter];\n\nclass Editor {\n  constructor(composition, selectionManager, element) {\n    this.insertFiles = this.insertFiles.bind(this);\n    this.composition = composition;\n    this.selectionManager = selectionManager;\n    this.element = element;\n    this.undoManager = new UndoManager(this.composition);\n    this.filters = DEFAULT_FILTERS.slice(0);\n  }\n\n  loadDocument(document) {\n    return this.loadSnapshot({\n      document,\n      selectedRange: [0, 0]\n    });\n  }\n\n  loadHTML() {\n    let html = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n    const document = HTMLParser.parse(html, {\n      referenceElement: this.element\n    }).getDocument();\n    return this.loadDocument(document);\n  }\n\n  loadJSON(_ref) {\n    let {\n      document,\n      selectedRange\n    } = _ref;\n    document = Document.fromJSON(document);\n    return this.loadSnapshot({\n      document,\n      selectedRange\n    });\n  }\n\n  loadSnapshot(snapshot) {\n    this.undoManager = new UndoManager(this.composition);\n    return this.composition.loadSnapshot(snapshot);\n  }\n\n  getDocument() {\n    return this.composition.document;\n  }\n\n  getSelectedDocument() {\n    return this.composition.getSelectedDocument();\n  }\n\n  getSnapshot() {\n    return this.composition.getSnapshot();\n  }\n\n  toJSON() {\n    return this.getSnapshot();\n  } // Document manipulation\n\n\n  deleteInDirection(direction) {\n    return this.composition.deleteInDirection(direction);\n  }\n\n  insertAttachment(attachment) {\n    return this.composition.insertAttachment(attachment);\n  }\n\n  insertAttachments(attachments) {\n    return this.composition.insertAttachments(attachments);\n  }\n\n  insertDocument(document) {\n    return this.composition.insertDocument(document);\n  }\n\n  insertFile(file) {\n    return this.composition.insertFile(file);\n  }\n\n  insertFiles(files) {\n    return this.composition.insertFiles(files);\n  }\n\n  insertHTML(html) {\n    return this.composition.insertHTML(html);\n  }\n\n  insertString(string) {\n    return this.composition.insertString(string);\n  }\n\n  insertText(text) {\n    return this.composition.insertText(text);\n  }\n\n  insertLineBreak() {\n    return this.composition.insertLineBreak();\n  } // Selection\n\n\n  getSelectedRange() {\n    return this.composition.getSelectedRange();\n  }\n\n  getPosition() {\n    return this.composition.getPosition();\n  }\n\n  getClientRectAtPosition(position) {\n    const locationRange = this.getDocument().locationRangeFromRange([position, position + 1]);\n    return this.selectionManager.getClientRectAtLocationRange(locationRange);\n  }\n\n  expandSelectionInDirection(direction) {\n    return this.composition.expandSelectionInDirection(direction);\n  }\n\n  moveCursorInDirection(direction) {\n    return this.composition.moveCursorInDirection(direction);\n  }\n\n  setSelectedRange(selectedRange) {\n    return this.composition.setSelectedRange(selectedRange);\n  } // Attributes\n\n\n  activateAttribute(name) {\n    let value = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    return this.composition.setCurrentAttribute(name, value);\n  }\n\n  attributeIsActive(name) {\n    return this.composition.hasCurrentAttribute(name);\n  }\n\n  canActivateAttribute(name) {\n    return this.composition.canSetCurrentAttribute(name);\n  }\n\n  deactivateAttribute(name) {\n    return this.composition.removeCurrentAttribute(name);\n  } // Nesting level\n\n\n  canDecreaseNestingLevel() {\n    return this.composition.canDecreaseNestingLevel();\n  }\n\n  canIncreaseNestingLevel() {\n    return this.composition.canIncreaseNestingLevel();\n  }\n\n  decreaseNestingLevel() {\n    if (this.canDecreaseNestingLevel()) {\n      return this.composition.decreaseNestingLevel();\n    }\n  }\n\n  increaseNestingLevel() {\n    if (this.canIncreaseNestingLevel()) {\n      return this.composition.increaseNestingLevel();\n    }\n  } // Undo/redo\n\n\n  canRedo() {\n    return this.undoManager.canRedo();\n  }\n\n  canUndo() {\n    return this.undoManager.canUndo();\n  }\n\n  recordUndoEntry(description) {\n    let {\n      context,\n      consolidatable\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.undoManager.recordUndoEntry(description, {\n      context,\n      consolidatable\n    });\n  }\n\n  redo() {\n    if (this.canRedo()) {\n      return this.undoManager.redo();\n    }\n  }\n\n  undo() {\n    if (this.canUndo()) {\n      return this.undoManager.undo();\n    }\n  }\n\n}\n/* eslint-disable\n    no-var,\n    prefer-const,\n*/\n\n\nclass LocationMapper {\n  constructor(element) {\n    this.element = element;\n  }\n\n  findLocationFromContainerAndOffset(container, offset) {\n    let {\n      strict\n    } = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {\n      strict: true\n    };\n    let childIndex = 0;\n    let foundBlock = false;\n    const location = {\n      index: 0,\n      offset: 0\n    };\n    const attachmentElement = this.findAttachmentElementParentForNode(container);\n\n    if (attachmentElement) {\n      container = attachmentElement.parentNode;\n      offset = findChildIndexOfNode(attachmentElement);\n    }\n\n    const walker = walkTree(this.element, {\n      usingFilter: rejectAttachmentContents\n    });\n\n    while (walker.nextNode()) {\n      const node = walker.currentNode;\n\n      if (node === container && nodeIsTextNode(container)) {\n        if (!nodeIsCursorTarget(node)) {\n          location.offset += offset;\n        }\n\n        break;\n      } else {\n        if (node.parentNode === container) {\n          if (childIndex++ === offset) {\n            break;\n          }\n        } else if (!elementContainsNode(container, node)) {\n          if (childIndex > 0) {\n            break;\n          }\n        }\n\n        if (nodeIsBlockStart(node, {\n          strict\n        })) {\n          if (foundBlock) {\n            location.index++;\n          }\n\n          location.offset = 0;\n          foundBlock = true;\n        } else {\n          location.offset += nodeLength(node);\n        }\n      }\n    }\n\n    return location;\n  }\n\n  findContainerAndOffsetFromLocation(location) {\n    let container, offset;\n\n    if (location.index === 0 && location.offset === 0) {\n      container = this.element;\n      offset = 0;\n\n      while (container.firstChild) {\n        container = container.firstChild;\n\n        if (nodeIsBlockContainer(container)) {\n          offset = 1;\n          break;\n        }\n      }\n\n      return [container, offset];\n    }\n\n    let [node, nodeOffset] = this.findNodeAndOffsetFromLocation(location);\n    if (!node) return;\n\n    if (nodeIsTextNode(node)) {\n      if (nodeLength(node) === 0) {\n        container = node.parentNode.parentNode;\n        offset = findChildIndexOfNode(node.parentNode);\n\n        if (nodeIsCursorTarget(node, {\n          name: \"right\"\n        })) {\n          offset++;\n        }\n      } else {\n        container = node;\n        offset = location.offset - nodeOffset;\n      }\n    } else {\n      container = node.parentNode;\n\n      if (!nodeIsBlockStart(node.previousSibling)) {\n        if (!nodeIsBlockContainer(container)) {\n          while (node === container.lastChild) {\n            node = container;\n            container = container.parentNode;\n\n            if (nodeIsBlockContainer(container)) {\n              break;\n            }\n          }\n        }\n      }\n\n      offset = findChildIndexOfNode(node);\n\n      if (location.offset !== 0) {\n        offset++;\n      }\n    }\n\n    return [container, offset];\n  }\n\n  findNodeAndOffsetFromLocation(location) {\n    let node, nodeOffset;\n    let offset = 0;\n\n    for (const currentNode of this.getSignificantNodesForIndex(location.index)) {\n      const length = nodeLength(currentNode);\n\n      if (location.offset <= offset + length) {\n        if (nodeIsTextNode(currentNode)) {\n          node = currentNode;\n          nodeOffset = offset;\n\n          if (location.offset === nodeOffset && nodeIsCursorTarget(node)) {\n            break;\n          }\n        } else if (!node) {\n          node = currentNode;\n          nodeOffset = offset;\n        }\n      }\n\n      offset += length;\n\n      if (offset > location.offset) {\n        break;\n      }\n    }\n\n    return [node, nodeOffset];\n  } // Private\n\n\n  findAttachmentElementParentForNode(node) {\n    while (node && node !== this.element) {\n      if (nodeIsAttachmentElement(node)) {\n        return node;\n      }\n\n      node = node.parentNode;\n    }\n  }\n\n  getSignificantNodesForIndex(index) {\n    const nodes = [];\n    const walker = walkTree(this.element, {\n      usingFilter: acceptSignificantNodes\n    });\n    let recordingNodes = false;\n\n    while (walker.nextNode()) {\n      const node = walker.currentNode;\n\n      if (nodeIsBlockStartComment(node)) {\n        var blockIndex;\n\n        if (blockIndex != null) {\n          blockIndex++;\n        } else {\n          blockIndex = 0;\n        }\n\n        if (blockIndex === index) {\n          recordingNodes = true;\n        } else if (recordingNodes) {\n          break;\n        }\n      } else if (recordingNodes) {\n        nodes.push(node);\n      }\n    }\n\n    return nodes;\n  }\n\n}\n\nconst nodeLength = function (node) {\n  if (node.nodeType === Node.TEXT_NODE) {\n    if (nodeIsCursorTarget(node)) {\n      return 0;\n    } else {\n      const string = node.textContent;\n      return string.length;\n    }\n  } else if (tagName(node) === \"br\" || nodeIsAttachmentElement(node)) {\n    return 1;\n  } else {\n    return 0;\n  }\n};\n\nconst acceptSignificantNodes = function (node) {\n  if (rejectEmptyTextNodes(node) === NodeFilter.FILTER_ACCEPT) {\n    return rejectAttachmentContents(node);\n  } else {\n    return NodeFilter.FILTER_REJECT;\n  }\n};\n\nconst rejectEmptyTextNodes = function (node) {\n  if (nodeIsEmptyTextNode(node)) {\n    return NodeFilter.FILTER_REJECT;\n  } else {\n    return NodeFilter.FILTER_ACCEPT;\n  }\n};\n\nconst rejectAttachmentContents = function (node) {\n  if (nodeIsAttachmentElement(node.parentNode)) {\n    return NodeFilter.FILTER_REJECT;\n  } else {\n    return NodeFilter.FILTER_ACCEPT;\n  }\n};\n/* eslint-disable\n    id-length,\n    no-empty,\n*/\n\n\nclass PointMapper {\n  createDOMRangeFromPoint(_ref) {\n    let {\n      x,\n      y\n    } = _ref;\n    let domRange;\n\n    if (document.caretPositionFromPoint) {\n      const {\n        offsetNode,\n        offset\n      } = document.caretPositionFromPoint(x, y);\n      domRange = document.createRange();\n      domRange.setStart(offsetNode, offset);\n      return domRange;\n    } else if (document.caretRangeFromPoint) {\n      return document.caretRangeFromPoint(x, y);\n    } else if (document.body.createTextRange) {\n      const originalDOMRange = getDOMRange();\n\n      try {\n        // IE 11 throws \"Unspecified error\" when using moveToPoint\n        // during a drag-and-drop operation.\n        const textRange = document.body.createTextRange();\n        textRange.moveToPoint(x, y);\n        textRange.select();\n      } catch (error) {}\n\n      domRange = getDOMRange();\n      setDOMRange(originalDOMRange);\n      return domRange;\n    }\n  }\n\n  getClientRectsForDOMRange(domRange) {\n    const array = Array.from(domRange.getClientRects());\n    const start = array[0];\n    const end = array[array.length - 1];\n    return [start, end];\n  }\n\n}\n/* eslint-disable\n*/\n\n\nclass SelectionManager extends BasicObject {\n  constructor(element) {\n    super(...arguments);\n    this.didMouseDown = this.didMouseDown.bind(this);\n    this.selectionDidChange = this.selectionDidChange.bind(this);\n    this.element = element;\n    this.locationMapper = new LocationMapper(this.element);\n    this.pointMapper = new PointMapper();\n    this.lockCount = 0;\n    handleEvent(\"mousedown\", {\n      onElement: this.element,\n      withCallback: this.didMouseDown\n    });\n  }\n\n  getLocationRange() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    if (options.strict === false) {\n      return this.createLocationRangeFromDOMRange(getDOMRange());\n    } else if (options.ignoreLock) {\n      return this.currentLocationRange;\n    } else if (this.lockedLocationRange) {\n      return this.lockedLocationRange;\n    } else {\n      return this.currentLocationRange;\n    }\n  }\n\n  setLocationRange(locationRange) {\n    if (this.lockedLocationRange) return;\n    locationRange = normalizeRange(locationRange);\n    const domRange = this.createDOMRangeFromLocationRange(locationRange);\n\n    if (domRange) {\n      setDOMRange(domRange);\n      this.updateCurrentLocationRange(locationRange);\n    }\n  }\n\n  setLocationRangeFromPointRange(pointRange) {\n    pointRange = normalizeRange(pointRange);\n    const startLocation = this.getLocationAtPoint(pointRange[0]);\n    const endLocation = this.getLocationAtPoint(pointRange[1]);\n    this.setLocationRange([startLocation, endLocation]);\n  }\n\n  getClientRectAtLocationRange(locationRange) {\n    const domRange = this.createDOMRangeFromLocationRange(locationRange);\n\n    if (domRange) {\n      return this.getClientRectsForDOMRange(domRange)[1];\n    }\n  }\n\n  locationIsCursorTarget(location) {\n    const node = Array.from(this.findNodeAndOffsetFromLocation(location))[0];\n    return nodeIsCursorTarget(node);\n  }\n\n  lock() {\n    if (this.lockCount++ === 0) {\n      this.updateCurrentLocationRange();\n      this.lockedLocationRange = this.getLocationRange();\n    }\n  }\n\n  unlock() {\n    if (--this.lockCount === 0) {\n      const {\n        lockedLocationRange\n      } = this;\n      this.lockedLocationRange = null;\n\n      if (lockedLocationRange != null) {\n        return this.setLocationRange(lockedLocationRange);\n      }\n    }\n  }\n\n  clearSelection() {\n    var _getDOMSelection;\n\n    return (_getDOMSelection = getDOMSelection()) === null || _getDOMSelection === void 0 ? void 0 : _getDOMSelection.removeAllRanges();\n  }\n\n  selectionIsCollapsed() {\n    var _getDOMRange;\n\n    return ((_getDOMRange = getDOMRange()) === null || _getDOMRange === void 0 ? void 0 : _getDOMRange.collapsed) === true;\n  }\n\n  selectionIsExpanded() {\n    return !this.selectionIsCollapsed();\n  }\n\n  createLocationRangeFromDOMRange(domRange, options) {\n    if (domRange == null || !this.domRangeWithinElement(domRange)) return;\n    const start = this.findLocationFromContainerAndOffset(domRange.startContainer, domRange.startOffset, options);\n    if (!start) return;\n    const end = domRange.collapsed ? undefined : this.findLocationFromContainerAndOffset(domRange.endContainer, domRange.endOffset, options);\n    return normalizeRange([start, end]);\n  }\n\n  didMouseDown() {\n    return this.pauseTemporarily();\n  }\n\n  pauseTemporarily() {\n    let resumeHandlers;\n    this.paused = true;\n\n    const resume = () => {\n      this.paused = false;\n      clearTimeout(resumeTimeout);\n      Array.from(resumeHandlers).forEach(handler => {\n        handler.destroy();\n      });\n\n      if (elementContainsNode(document, this.element)) {\n        return this.selectionDidChange();\n      }\n    };\n\n    const resumeTimeout = setTimeout(resume, 200);\n    resumeHandlers = [\"mousemove\", \"keydown\"].map(eventName => handleEvent(eventName, {\n      onElement: document,\n      withCallback: resume\n    }));\n  }\n\n  selectionDidChange() {\n    if (!this.paused && !innerElementIsActive(this.element)) {\n      return this.updateCurrentLocationRange();\n    }\n  }\n\n  updateCurrentLocationRange(locationRange) {\n    if (locationRange != null ? locationRange : locationRange = this.createLocationRangeFromDOMRange(getDOMRange())) {\n      if (!rangesAreEqual(locationRange, this.currentLocationRange)) {\n        var _this$delegate, _this$delegate$locati;\n\n        this.currentLocationRange = locationRange;\n        return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$locati = _this$delegate.locationRangeDidChange) === null || _this$delegate$locati === void 0 ? void 0 : _this$delegate$locati.call(_this$delegate, this.currentLocationRange.slice(0));\n      }\n    }\n  }\n\n  createDOMRangeFromLocationRange(locationRange) {\n    const rangeStart = this.findContainerAndOffsetFromLocation(locationRange[0]);\n    const rangeEnd = rangeIsCollapsed(locationRange) ? rangeStart : this.findContainerAndOffsetFromLocation(locationRange[1]) || rangeStart;\n\n    if (rangeStart != null && rangeEnd != null) {\n      const domRange = document.createRange();\n      domRange.setStart(...Array.from(rangeStart || []));\n      domRange.setEnd(...Array.from(rangeEnd || []));\n      return domRange;\n    }\n  }\n\n  getLocationAtPoint(point) {\n    const domRange = this.createDOMRangeFromPoint(point);\n\n    if (domRange) {\n      var _this$createLocationR;\n\n      return (_this$createLocationR = this.createLocationRangeFromDOMRange(domRange)) === null || _this$createLocationR === void 0 ? void 0 : _this$createLocationR[0];\n    }\n  }\n\n  domRangeWithinElement(domRange) {\n    if (domRange.collapsed) {\n      return elementContainsNode(this.element, domRange.startContainer);\n    } else {\n      return elementContainsNode(this.element, domRange.startContainer) && elementContainsNode(this.element, domRange.endContainer);\n    }\n  }\n\n}\n\nSelectionManager.proxyMethod(\"locationMapper.findLocationFromContainerAndOffset\");\nSelectionManager.proxyMethod(\"locationMapper.findContainerAndOffsetFromLocation\");\nSelectionManager.proxyMethod(\"locationMapper.findNodeAndOffsetFromLocation\");\nSelectionManager.proxyMethod(\"pointMapper.createDOMRangeFromPoint\");\nSelectionManager.proxyMethod(\"pointMapper.getClientRectsForDOMRange\");\nvar models = {\n  Attachment,\n  AttachmentManager,\n  AttachmentPiece,\n  Block,\n  Composition,\n  Cocument: Document,\n  Editor,\n  HTMLParser,\n  HTMLSanitizer,\n  LineBreakInsertion,\n  LocationMapper,\n  ManagedAttachment,\n  Piece,\n  PointMapper,\n  SelectionManager,\n  SplittableList,\n  StringPiece,\n  Text,\n  UndoManager\n};\nconst Trix = {\n  VERSION: version,\n  config\n};\nObject.assign(Trix, models);\nwindow.Trix = Trix;\n\nclass ObjectGroup {\n  static groupObjects() {\n    let ungroupedObjects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    let {\n      depth,\n      asTree\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let group;\n\n    if (asTree) {\n      if (depth == null) {\n        depth = 0;\n      }\n    }\n\n    const objects = [];\n    Array.from(ungroupedObjects).forEach(object => {\n      var _object$canBeGrouped2;\n\n      if (group) {\n        var _object$canBeGrouped, _group$canBeGroupedWi, _group;\n\n        if ((_object$canBeGrouped = object.canBeGrouped) !== null && _object$canBeGrouped !== void 0 && _object$canBeGrouped.call(object, depth) && (_group$canBeGroupedWi = (_group = group[group.length - 1]).canBeGroupedWith) !== null && _group$canBeGroupedWi !== void 0 && _group$canBeGroupedWi.call(_group, object, depth)) {\n          group.push(object);\n          return;\n        } else {\n          objects.push(new this(group, {\n            depth,\n            asTree\n          }));\n          group = null;\n        }\n      }\n\n      if ((_object$canBeGrouped2 = object.canBeGrouped) !== null && _object$canBeGrouped2 !== void 0 && _object$canBeGrouped2.call(object, depth)) {\n        group = [object];\n      } else {\n        objects.push(object);\n      }\n    });\n\n    if (group) {\n      objects.push(new this(group, {\n        depth,\n        asTree\n      }));\n    }\n\n    return objects;\n  }\n\n  constructor() {\n    let objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    let {\n      depth,\n      asTree\n    } = arguments.length > 1 ? arguments[1] : undefined;\n    this.objects = objects;\n\n    if (asTree) {\n      this.depth = depth;\n      this.objects = this.constructor.groupObjects(this.objects, {\n        asTree,\n        depth: this.depth + 1\n      });\n    }\n  }\n\n  getObjects() {\n    return this.objects;\n  }\n\n  getDepth() {\n    return this.depth;\n  }\n\n  getCacheKey() {\n    const keys = [\"objectGroup\"];\n    Array.from(this.getObjects()).forEach(object => {\n      keys.push(object.getCacheKey());\n    });\n    return keys.join(\"/\");\n  }\n\n}\n\nclass ElementStore {\n  constructor(elements) {\n    this.reset(elements);\n  }\n\n  add(element) {\n    const key = getKey(element);\n    this.elements[key] = element;\n  }\n\n  remove(element) {\n    const key = getKey(element);\n    const value = this.elements[key];\n\n    if (value) {\n      delete this.elements[key];\n      return value;\n    }\n  }\n\n  reset() {\n    let elements = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    this.elements = {};\n    Array.from(elements).forEach(element => {\n      this.add(element);\n    });\n    return elements;\n  }\n\n}\n\nconst getKey = element => element.dataset.trixStoreKey;\n\nclass ObjectView extends BasicObject {\n  constructor(object) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super(...arguments);\n    this.object = object;\n    this.options = options;\n    this.childViews = [];\n    this.rootView = this;\n  }\n\n  getNodes() {\n    if (!this.nodes) {\n      this.nodes = this.createNodes();\n    }\n\n    return this.nodes.map(node => node.cloneNode(true));\n  }\n\n  invalidate() {\n    var _this$parentView;\n\n    this.nodes = null;\n    this.childViews = [];\n    return (_this$parentView = this.parentView) === null || _this$parentView === void 0 ? void 0 : _this$parentView.invalidate();\n  }\n\n  invalidateViewForObject(object) {\n    var _this$findViewForObje;\n\n    return (_this$findViewForObje = this.findViewForObject(object)) === null || _this$findViewForObje === void 0 ? void 0 : _this$findViewForObje.invalidate();\n  }\n\n  findOrCreateCachedChildView(viewClass, object, options) {\n    let view = this.getCachedViewForObject(object);\n\n    if (view) {\n      this.recordChildView(view);\n    } else {\n      view = this.createChildView(...arguments);\n      this.cacheViewForObject(view, object);\n    }\n\n    return view;\n  }\n\n  createChildView(viewClass, object) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    if (object instanceof ObjectGroup) {\n      options.viewClass = viewClass;\n      viewClass = ObjectGroupView;\n    }\n\n    const view = new viewClass(object, options);\n    return this.recordChildView(view);\n  }\n\n  recordChildView(view) {\n    view.parentView = this;\n    view.rootView = this.rootView;\n    this.childViews.push(view);\n    return view;\n  }\n\n  getAllChildViews() {\n    let views = [];\n    this.childViews.forEach(childView => {\n      views.push(childView);\n      views = views.concat(childView.getAllChildViews());\n    });\n    return views;\n  }\n\n  findElement() {\n    return this.findElementForObject(this.object);\n  }\n\n  findElementForObject(object) {\n    const id = object === null || object === void 0 ? void 0 : object.id;\n\n    if (id) {\n      return this.rootView.element.querySelector(\"[data-trix-id='\".concat(id, \"']\"));\n    }\n  }\n\n  findViewForObject(object) {\n    for (const view of this.getAllChildViews()) {\n      if (view.object === object) {\n        return view;\n      }\n    }\n  }\n\n  getViewCache() {\n    if (this.rootView === this) {\n      if (this.isViewCachingEnabled()) {\n        if (!this.viewCache) {\n          this.viewCache = {};\n        }\n\n        return this.viewCache;\n      }\n    } else {\n      return this.rootView.getViewCache();\n    }\n  }\n\n  isViewCachingEnabled() {\n    return this.shouldCacheViews !== false;\n  }\n\n  enableViewCaching() {\n    this.shouldCacheViews = true;\n  }\n\n  disableViewCaching() {\n    this.shouldCacheViews = false;\n  }\n\n  getCachedViewForObject(object) {\n    var _this$getViewCache;\n\n    return (_this$getViewCache = this.getViewCache()) === null || _this$getViewCache === void 0 ? void 0 : _this$getViewCache[object.getCacheKey()];\n  }\n\n  cacheViewForObject(view, object) {\n    const cache = this.getViewCache();\n\n    if (cache) {\n      cache[object.getCacheKey()] = view;\n    }\n  }\n\n  garbageCollectCachedViews() {\n    const cache = this.getViewCache();\n\n    if (cache) {\n      const views = this.getAllChildViews().concat(this);\n      const objectKeys = views.map(view => view.object.getCacheKey());\n\n      for (const key in cache) {\n        if (!objectKeys.includes(key)) {\n          delete cache[key];\n        }\n      }\n    }\n  }\n\n}\n\nclass ObjectGroupView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.objectGroup = this.object;\n    this.viewClass = this.options.viewClass;\n    delete this.options.viewClass;\n  }\n\n  getChildViews() {\n    if (!this.childViews.length) {\n      Array.from(this.objectGroup.getObjects()).forEach(object => {\n        this.findOrCreateCachedChildView(this.viewClass, object, this.options);\n      });\n    }\n\n    return this.childViews;\n  }\n\n  createNodes() {\n    const element = this.createContainerElement();\n    this.getChildViews().forEach(view => {\n      Array.from(view.getNodes()).forEach(node => {\n        element.appendChild(node);\n      });\n    });\n    return [element];\n  }\n\n  createContainerElement() {\n    let depth = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.objectGroup.getDepth();\n    return this.getChildViews()[0].createContainerElement(depth);\n  }\n\n}\n\nconst {\n  css: css$2\n} = config;\n\nclass AttachmentView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.attachment = this.object;\n    this.attachment.uploadProgressDelegate = this;\n    this.attachmentPiece = this.options.piece;\n  }\n\n  createContentNodes() {\n    return [];\n  }\n\n  createNodes() {\n    let innerElement;\n    const figure = innerElement = makeElement({\n      tagName: \"figure\",\n      className: this.getClassName(),\n      data: this.getData(),\n      editable: false\n    });\n    const href = this.getHref();\n\n    if (href) {\n      innerElement = makeElement({\n        tagName: \"a\",\n        editable: false,\n        attributes: {\n          href,\n          tabindex: -1\n        }\n      });\n      figure.appendChild(innerElement);\n    }\n\n    if (this.attachment.hasContent()) {\n      innerElement.innerHTML = this.attachment.getContent();\n    } else {\n      this.createContentNodes().forEach(node => {\n        innerElement.appendChild(node);\n      });\n    }\n\n    innerElement.appendChild(this.createCaptionElement());\n\n    if (this.attachment.isPending()) {\n      this.progressElement = makeElement({\n        tagName: \"progress\",\n        attributes: {\n          class: css$2.attachmentProgress,\n          value: this.attachment.getUploadProgress(),\n          max: 100\n        },\n        data: {\n          trixMutable: true,\n          trixStoreKey: [\"progressElement\", this.attachment.id].join(\"/\")\n        }\n      });\n      figure.appendChild(this.progressElement);\n    }\n\n    return [createCursorTarget(\"left\"), figure, createCursorTarget(\"right\")];\n  }\n\n  createCaptionElement() {\n    const figcaption = makeElement({\n      tagName: \"figcaption\",\n      className: css$2.attachmentCaption\n    });\n    const caption = this.attachmentPiece.getCaption();\n\n    if (caption) {\n      figcaption.classList.add(\"\".concat(css$2.attachmentCaption, \"--edited\"));\n      figcaption.textContent = caption;\n    } else {\n      let name, size;\n      const captionConfig = this.getCaptionConfig();\n\n      if (captionConfig.name) {\n        name = this.attachment.getFilename();\n      }\n\n      if (captionConfig.size) {\n        size = this.attachment.getFormattedFilesize();\n      }\n\n      if (name) {\n        const nameElement = makeElement({\n          tagName: \"span\",\n          className: css$2.attachmentName,\n          textContent: name\n        });\n        figcaption.appendChild(nameElement);\n      }\n\n      if (size) {\n        if (name) {\n          figcaption.appendChild(document.createTextNode(\" \"));\n        }\n\n        const sizeElement = makeElement({\n          tagName: \"span\",\n          className: css$2.attachmentSize,\n          textContent: size\n        });\n        figcaption.appendChild(sizeElement);\n      }\n    }\n\n    return figcaption;\n  }\n\n  getClassName() {\n    const names = [css$2.attachment, \"\".concat(css$2.attachment, \"--\").concat(this.attachment.getType())];\n    const extension = this.attachment.getExtension();\n\n    if (extension) {\n      names.push(\"\".concat(css$2.attachment, \"--\").concat(extension));\n    }\n\n    return names.join(\" \");\n  }\n\n  getData() {\n    const data = {\n      trixAttachment: JSON.stringify(this.attachment),\n      trixContentType: this.attachment.getContentType(),\n      trixId: this.attachment.id\n    };\n    const {\n      attributes\n    } = this.attachmentPiece;\n\n    if (!attributes.isEmpty()) {\n      data.trixAttributes = JSON.stringify(attributes);\n    }\n\n    if (this.attachment.isPending()) {\n      data.trixSerialize = false;\n    }\n\n    return data;\n  }\n\n  getHref() {\n    if (!htmlContainsTagName(this.attachment.getContent(), \"a\")) {\n      return this.attachment.getHref();\n    }\n  }\n\n  getCaptionConfig() {\n    var _config$attachments$t;\n\n    const type = this.attachment.getType();\n    const captionConfig = copyObject((_config$attachments$t = config.attachments[type]) === null || _config$attachments$t === void 0 ? void 0 : _config$attachments$t.caption);\n\n    if (type === \"file\") {\n      captionConfig.name = true;\n    }\n\n    return captionConfig;\n  }\n\n  findProgressElement() {\n    var _this$findElement;\n\n    return (_this$findElement = this.findElement()) === null || _this$findElement === void 0 ? void 0 : _this$findElement.querySelector(\"progress\");\n  } // Attachment delegate\n\n\n  attachmentDidChangeUploadProgress() {\n    const value = this.attachment.getUploadProgress();\n    const progressElement = this.findProgressElement();\n\n    if (progressElement) {\n      progressElement.value = value;\n    }\n  }\n\n}\n\nconst createCursorTarget = name => makeElement({\n  tagName: \"span\",\n  textContent: ZERO_WIDTH_SPACE,\n  data: {\n    trixCursorTarget: name,\n    trixSerialize: false\n  }\n});\n\nconst htmlContainsTagName = function (html, tagName) {\n  const div = makeElement(\"div\");\n  div.innerHTML = html || \"\";\n  return div.querySelector(tagName);\n};\n\nclass PreviewableAttachmentView extends AttachmentView {\n  constructor() {\n    super(...arguments);\n    this.attachment.previewDelegate = this;\n  }\n\n  createContentNodes() {\n    this.image = makeElement({\n      tagName: \"img\",\n      attributes: {\n        src: \"\"\n      },\n      data: {\n        trixMutable: true\n      }\n    });\n    this.refresh(this.image);\n    return [this.image];\n  }\n\n  createCaptionElement() {\n    const figcaption = super.createCaptionElement(...arguments);\n\n    if (!figcaption.textContent) {\n      figcaption.setAttribute(\"data-trix-placeholder\", config.lang.captionPlaceholder);\n    }\n\n    return figcaption;\n  }\n\n  refresh(image) {\n    if (!image) {\n      var _this$findElement;\n\n      image = (_this$findElement = this.findElement()) === null || _this$findElement === void 0 ? void 0 : _this$findElement.querySelector(\"img\");\n    }\n\n    if (image) {\n      return this.updateAttributesForImage(image);\n    }\n  }\n\n  updateAttributesForImage(image) {\n    const url = this.attachment.getURL();\n    const previewURL = this.attachment.getPreviewURL();\n    image.src = previewURL || url;\n\n    if (previewURL === url) {\n      image.removeAttribute(\"data-trix-serialized-attributes\");\n    } else {\n      const serializedAttributes = JSON.stringify({\n        src: url\n      });\n      image.setAttribute(\"data-trix-serialized-attributes\", serializedAttributes);\n    }\n\n    const width = this.attachment.getWidth();\n    const height = this.attachment.getHeight();\n\n    if (width != null) {\n      image.width = width;\n    }\n\n    if (height != null) {\n      image.height = height;\n    }\n\n    const storeKey = [\"imageElement\", this.attachment.id, image.src, image.width, image.height].join(\"/\");\n    image.dataset.trixStoreKey = storeKey;\n  } // Attachment delegate\n\n\n  attachmentDidChangeAttributes() {\n    this.refresh(this.image);\n    return this.refresh();\n  }\n\n}\n/* eslint-disable\n    no-useless-escape,\n    no-var,\n*/\n\n\nclass PieceView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.piece = this.object;\n    this.attributes = this.piece.getAttributes();\n    this.textConfig = this.options.textConfig;\n    this.context = this.options.context;\n\n    if (this.piece.attachment) {\n      this.attachment = this.piece.attachment;\n    } else {\n      this.string = this.piece.toString();\n    }\n  }\n\n  createNodes() {\n    let nodes = this.attachment ? this.createAttachmentNodes() : this.createStringNodes();\n    const element = this.createElement();\n\n    if (element) {\n      const innerElement = findInnerElement(element);\n      Array.from(nodes).forEach(node => {\n        innerElement.appendChild(node);\n      });\n      nodes = [element];\n    }\n\n    return nodes;\n  }\n\n  createAttachmentNodes() {\n    const constructor = this.attachment.isPreviewable() ? PreviewableAttachmentView : AttachmentView;\n    const view = this.createChildView(constructor, this.piece.attachment, {\n      piece: this.piece\n    });\n    return view.getNodes();\n  }\n\n  createStringNodes() {\n    var _this$textConfig;\n\n    if ((_this$textConfig = this.textConfig) !== null && _this$textConfig !== void 0 && _this$textConfig.plaintext) {\n      return [document.createTextNode(this.string)];\n    } else {\n      const nodes = [];\n      const iterable = this.string.split(\"\\n\");\n\n      for (let index = 0; index < iterable.length; index++) {\n        const substring = iterable[index];\n\n        if (index > 0) {\n          const element = makeElement(\"br\");\n          nodes.push(element);\n        }\n\n        if (substring.length) {\n          const node = document.createTextNode(this.preserveSpaces(substring));\n          nodes.push(node);\n        }\n      }\n\n      return nodes;\n    }\n  }\n\n  createElement() {\n    let element, key, value;\n    const styles = {};\n\n    for (key in this.attributes) {\n      value = this.attributes[key];\n      const config = getTextConfig(key);\n\n      if (config) {\n        if (config.tagName) {\n          var innerElement;\n          const pendingElement = makeElement(config.tagName);\n\n          if (innerElement) {\n            innerElement.appendChild(pendingElement);\n            innerElement = pendingElement;\n          } else {\n            element = innerElement = pendingElement;\n          }\n        }\n\n        if (config.styleProperty) {\n          styles[config.styleProperty] = value;\n        }\n\n        if (config.style) {\n          for (key in config.style) {\n            value = config.style[key];\n            styles[key] = value;\n          }\n        }\n      }\n    }\n\n    if (Object.keys(styles).length) {\n      if (!element) {\n        element = makeElement(\"span\");\n      }\n\n      for (key in styles) {\n        value = styles[key];\n        element.style[key] = value;\n      }\n    }\n\n    return element;\n  }\n\n  createContainerElement() {\n    for (const key in this.attributes) {\n      const value = this.attributes[key];\n      const config = getTextConfig(key);\n\n      if (config) {\n        if (config.groupTagName) {\n          const attributes = {};\n          attributes[key] = value;\n          return makeElement(config.groupTagName, attributes);\n        }\n      }\n    }\n  }\n\n  preserveSpaces(string) {\n    if (this.context.isLast) {\n      string = string.replace(/\\ $/, NON_BREAKING_SPACE);\n    }\n\n    string = string.replace(/(\\S)\\ {3}(\\S)/g, \"$1 \".concat(NON_BREAKING_SPACE, \" $2\")).replace(/\\ {2}/g, \"\".concat(NON_BREAKING_SPACE, \" \")).replace(/\\ {2}/g, \" \".concat(NON_BREAKING_SPACE));\n\n    if (this.context.isFirst || this.context.followsWhitespace) {\n      string = string.replace(/^\\ /, NON_BREAKING_SPACE);\n    }\n\n    return string;\n  }\n\n}\n/* eslint-disable\n    no-var,\n*/\n\n\nclass TextView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.text = this.object;\n    this.textConfig = this.options.textConfig;\n  }\n\n  createNodes() {\n    const nodes = [];\n    const pieces = ObjectGroup.groupObjects(this.getPieces());\n    const lastIndex = pieces.length - 1;\n\n    for (let index = 0; index < pieces.length; index++) {\n      const piece = pieces[index];\n      const context = {};\n\n      if (index === 0) {\n        context.isFirst = true;\n      }\n\n      if (index === lastIndex) {\n        context.isLast = true;\n      }\n\n      if (endsWithWhitespace(previousPiece)) {\n        context.followsWhitespace = true;\n      }\n\n      const view = this.findOrCreateCachedChildView(PieceView, piece, {\n        textConfig: this.textConfig,\n        context\n      });\n      nodes.push(...Array.from(view.getNodes() || []));\n      var previousPiece = piece;\n    }\n\n    return nodes;\n  }\n\n  getPieces() {\n    return Array.from(this.text.getPieces()).filter(piece => !piece.hasAttribute(\"blockBreak\"));\n  }\n\n}\n\nconst endsWithWhitespace = piece => /\\s$/.test(piece === null || piece === void 0 ? void 0 : piece.toString());\n\nconst {\n  css: css$1\n} = config;\n\nclass BlockView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.block = this.object;\n    this.attributes = this.block.getAttributes();\n  }\n\n  createNodes() {\n    const comment = document.createComment(\"block\");\n    const nodes = [comment];\n\n    if (this.block.isEmpty()) {\n      nodes.push(makeElement(\"br\"));\n    } else {\n      var _getBlockConfig;\n\n      const textConfig = (_getBlockConfig = getBlockConfig(this.block.getLastAttribute())) === null || _getBlockConfig === void 0 ? void 0 : _getBlockConfig.text;\n      const textView = this.findOrCreateCachedChildView(TextView, this.block.text, {\n        textConfig\n      });\n      nodes.push(...Array.from(textView.getNodes() || []));\n\n      if (this.shouldAddExtraNewlineElement()) {\n        nodes.push(makeElement(\"br\"));\n      }\n    }\n\n    if (this.attributes.length) {\n      return nodes;\n    } else {\n      let attributes;\n      const {\n        tagName\n      } = config.blockAttributes.default;\n\n      if (this.block.isRTL()) {\n        attributes = {\n          dir: \"rtl\"\n        };\n      }\n\n      const element = makeElement({\n        tagName,\n        attributes\n      });\n      nodes.forEach(node => element.appendChild(node));\n      return [element];\n    }\n  }\n\n  createContainerElement(depth) {\n    let attributes, className;\n    const attributeName = this.attributes[depth];\n    const {\n      tagName\n    } = getBlockConfig(attributeName);\n\n    if (depth === 0 && this.block.isRTL()) {\n      attributes = {\n        dir: \"rtl\"\n      };\n    }\n\n    if (attributeName === \"attachmentGallery\") {\n      const size = this.block.getBlockBreakPosition();\n      className = \"\".concat(css$1.attachmentGallery, \" \").concat(css$1.attachmentGallery, \"--\").concat(size);\n    }\n\n    return makeElement({\n      tagName,\n      className,\n      attributes\n    });\n  } // A single <br> at the end of a block element has no visual representation\n  // so add an extra one.\n\n\n  shouldAddExtraNewlineElement() {\n    return /\\n\\n$/.test(this.block.toString());\n  }\n\n}\n\nclass DocumentView extends ObjectView {\n  static render(document) {\n    const element = makeElement(\"div\");\n    const view = new this(document, {\n      element\n    });\n    view.render();\n    view.sync();\n    return element;\n  }\n\n  constructor() {\n    super(...arguments);\n    this.element = this.options.element;\n    this.elementStore = new ElementStore();\n    this.setDocument(this.object);\n  }\n\n  setDocument(document) {\n    if (!document.isEqualTo(this.document)) {\n      this.document = this.object = document;\n    }\n  }\n\n  render() {\n    this.childViews = [];\n    this.shadowElement = makeElement(\"div\");\n\n    if (!this.document.isEmpty()) {\n      const objects = ObjectGroup.groupObjects(this.document.getBlocks(), {\n        asTree: true\n      });\n      Array.from(objects).forEach(object => {\n        const view = this.findOrCreateCachedChildView(BlockView, object);\n        Array.from(view.getNodes()).map(node => this.shadowElement.appendChild(node));\n      });\n    }\n  }\n\n  isSynced() {\n    return elementsHaveEqualHTML(this.shadowElement, this.element);\n  }\n\n  sync() {\n    const fragment = this.createDocumentFragmentForSync();\n\n    while (this.element.lastChild) {\n      this.element.removeChild(this.element.lastChild);\n    }\n\n    this.element.appendChild(fragment);\n    return this.didSync();\n  } // Private\n\n\n  didSync() {\n    this.elementStore.reset(findStoredElements(this.element));\n    return defer(() => this.garbageCollectCachedViews());\n  }\n\n  createDocumentFragmentForSync() {\n    const fragment = document.createDocumentFragment();\n    Array.from(this.shadowElement.childNodes).forEach(node => {\n      fragment.appendChild(node.cloneNode(true));\n    });\n    Array.from(findStoredElements(fragment)).forEach(element => {\n      const storedElement = this.elementStore.remove(element);\n\n      if (storedElement) {\n        element.parentNode.replaceChild(storedElement, element);\n      }\n    });\n    return fragment;\n  }\n\n}\n\nconst findStoredElements = element => element.querySelectorAll(\"[data-trix-store-key]\");\n\nconst elementsHaveEqualHTML = (element, otherElement) => ignoreSpaces(element.innerHTML) === ignoreSpaces(otherElement.innerHTML);\n\nconst ignoreSpaces = html => html.replace(/&nbsp;/g, \" \");\n/* eslint-disable\n    no-empty,\n*/\n\n\nconst unserializableElementSelector = \"[data-trix-serialize=false]\";\nconst unserializableAttributeNames = [\"contenteditable\", \"data-trix-id\", \"data-trix-store-key\", \"data-trix-mutable\", \"data-trix-placeholder\", \"tabindex\"];\nconst serializedAttributesAttribute = \"data-trix-serialized-attributes\";\nconst serializedAttributesSelector = \"[\".concat(serializedAttributesAttribute, \"]\");\nconst blockCommentPattern = new RegExp(\"<!--block-->\", \"g\");\nconst serializers = {\n  \"application/json\": function (serializable) {\n    let document;\n\n    if (serializable instanceof Document) {\n      document = serializable;\n    } else if (serializable instanceof HTMLElement) {\n      document = HTMLParser.parse(serializable.innerHTML).getDocument();\n    } else {\n      throw new Error(\"unserializable object\");\n    }\n\n    return document.toSerializableDocument().toJSONString();\n  },\n  \"text/html\": function (serializable) {\n    let element;\n\n    if (serializable instanceof Document) {\n      element = DocumentView.render(serializable);\n    } else if (serializable instanceof HTMLElement) {\n      element = serializable.cloneNode(true);\n    } else {\n      throw new Error(\"unserializable object\");\n    } // Remove unserializable elements\n\n\n    Array.from(element.querySelectorAll(unserializableElementSelector)).forEach(el => {\n      removeNode(el);\n    }); // Remove unserializable attributes\n\n    unserializableAttributeNames.forEach(attribute => {\n      Array.from(element.querySelectorAll(\"[\".concat(attribute, \"]\"))).forEach(el => {\n        el.removeAttribute(attribute);\n      });\n    }); // Rewrite elements with serialized attribute overrides\n\n    Array.from(element.querySelectorAll(serializedAttributesSelector)).forEach(el => {\n      try {\n        const attributes = JSON.parse(el.getAttribute(serializedAttributesAttribute));\n        el.removeAttribute(serializedAttributesAttribute);\n\n        for (const name in attributes) {\n          const value = attributes[name];\n          el.setAttribute(name, value);\n        }\n      } catch (error) {}\n    });\n    return element.innerHTML.replace(blockCommentPattern, \"\");\n  }\n};\nconst deserializers = {\n  \"application/json\": function (string) {\n    return Document.fromJSONString(string);\n  },\n  \"text/html\": function (string) {\n    return HTMLParser.parse(string).getDocument();\n  }\n};\n\nconst serializeToContentType = function (serializable, contentType) {\n  const serializer = serializers[contentType];\n\n  if (serializer) {\n    return serializer(serializable);\n  } else {\n    throw new Error(\"unknown content type: \".concat(contentType));\n  }\n};\n\nconst deserializeFromContentType = function (string, contentType) {\n  const deserializer = deserializers[contentType];\n\n  if (deserializer) {\n    return deserializer(string);\n  } else {\n    throw new Error(\"unknown content type: \".concat(contentType));\n  }\n};\n\nconst mutableAttributeName = \"data-trix-mutable\";\nconst mutableSelector = \"[\".concat(mutableAttributeName, \"]\");\nconst options = {\n  attributes: true,\n  childList: true,\n  characterData: true,\n  characterDataOldValue: true,\n  subtree: true\n};\n\nclass MutationObserver extends BasicObject {\n  constructor(element) {\n    super(element);\n    this.didMutate = this.didMutate.bind(this);\n    this.element = element;\n    this.observer = new window.MutationObserver(this.didMutate);\n    this.start();\n  }\n\n  start() {\n    this.reset();\n    return this.observer.observe(this.element, options);\n  }\n\n  stop() {\n    return this.observer.disconnect();\n  }\n\n  didMutate(mutations) {\n    this.mutations.push(...Array.from(this.findSignificantMutations(mutations) || []));\n\n    if (this.mutations.length) {\n      var _this$delegate, _this$delegate$elemen;\n\n      (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$elemen = _this$delegate.elementDidMutate) === null || _this$delegate$elemen === void 0 ? void 0 : _this$delegate$elemen.call(_this$delegate, this.getMutationSummary());\n      return this.reset();\n    }\n  } // Private\n\n\n  reset() {\n    this.mutations = [];\n  }\n\n  findSignificantMutations(mutations) {\n    return mutations.filter(mutation => {\n      return this.mutationIsSignificant(mutation);\n    });\n  }\n\n  mutationIsSignificant(mutation) {\n    if (this.nodeIsMutable(mutation.target)) {\n      return false;\n    }\n\n    for (const node of Array.from(this.nodesModifiedByMutation(mutation))) {\n      if (this.nodeIsSignificant(node)) return true;\n    }\n\n    return false;\n  }\n\n  nodeIsSignificant(node) {\n    return node !== this.element && !this.nodeIsMutable(node) && !nodeIsEmptyTextNode(node);\n  }\n\n  nodeIsMutable(node) {\n    return findClosestElementFromNode(node, {\n      matchingSelector: mutableSelector\n    });\n  }\n\n  nodesModifiedByMutation(mutation) {\n    const nodes = [];\n\n    switch (mutation.type) {\n      case \"attributes\":\n        if (mutation.attributeName !== mutableAttributeName) {\n          nodes.push(mutation.target);\n        }\n\n        break;\n\n      case \"characterData\":\n        // Changes to text nodes should consider the parent element\n        nodes.push(mutation.target.parentNode);\n        nodes.push(mutation.target);\n        break;\n\n      case \"childList\":\n        // Consider each added or removed node\n        nodes.push(...Array.from(mutation.addedNodes || []));\n        nodes.push(...Array.from(mutation.removedNodes || []));\n        break;\n    }\n\n    return nodes;\n  }\n\n  getMutationSummary() {\n    return this.getTextMutationSummary();\n  }\n\n  getTextMutationSummary() {\n    const {\n      additions,\n      deletions\n    } = this.getTextChangesFromCharacterData();\n    const textChanges = this.getTextChangesFromChildList();\n    Array.from(textChanges.additions).forEach(addition => {\n      if (!Array.from(additions).includes(addition)) {\n        additions.push(addition);\n      }\n    });\n    deletions.push(...Array.from(textChanges.deletions || []));\n    const summary = {};\n    const added = additions.join(\"\");\n\n    if (added) {\n      summary.textAdded = added;\n    }\n\n    const deleted = deletions.join(\"\");\n\n    if (deleted) {\n      summary.textDeleted = deleted;\n    }\n\n    return summary;\n  }\n\n  getMutationsByType(type) {\n    return Array.from(this.mutations).filter(mutation => mutation.type === type);\n  }\n\n  getTextChangesFromChildList() {\n    let textAdded, textRemoved;\n    const addedNodes = [];\n    const removedNodes = [];\n    Array.from(this.getMutationsByType(\"childList\")).forEach(mutation => {\n      addedNodes.push(...Array.from(mutation.addedNodes || []));\n      removedNodes.push(...Array.from(mutation.removedNodes || []));\n    });\n    const singleBlockCommentRemoved = addedNodes.length === 0 && removedNodes.length === 1 && nodeIsBlockStartComment(removedNodes[0]);\n\n    if (singleBlockCommentRemoved) {\n      textAdded = [];\n      textRemoved = [\"\\n\"];\n    } else {\n      textAdded = getTextForNodes(addedNodes);\n      textRemoved = getTextForNodes(removedNodes);\n    }\n\n    const additions = textAdded.filter((text, index) => text !== textRemoved[index]).map(normalizeSpaces);\n    const deletions = textRemoved.filter((text, index) => text !== textAdded[index]).map(normalizeSpaces);\n    return {\n      additions,\n      deletions\n    };\n  }\n\n  getTextChangesFromCharacterData() {\n    let added, removed;\n    const characterMutations = this.getMutationsByType(\"characterData\");\n\n    if (characterMutations.length) {\n      const startMutation = characterMutations[0],\n            endMutation = characterMutations[characterMutations.length - 1];\n      const oldString = normalizeSpaces(startMutation.oldValue);\n      const newString = normalizeSpaces(endMutation.target.data);\n      const summarized = summarizeStringChange(oldString, newString);\n      added = summarized.added;\n      removed = summarized.removed;\n    }\n\n    return {\n      additions: added ? [added] : [],\n      deletions: removed ? [removed] : []\n    };\n  }\n\n}\n\nconst getTextForNodes = function () {\n  let nodes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  const text = [];\n\n  for (const node of Array.from(nodes)) {\n    switch (node.nodeType) {\n      case Node.TEXT_NODE:\n        text.push(node.data);\n        break;\n\n      case Node.ELEMENT_NODE:\n        if (tagName(node) === \"br\") {\n          text.push(\"\\n\");\n        } else {\n          text.push(...Array.from(getTextForNodes(node.childNodes) || []));\n        }\n\n        break;\n    }\n  }\n\n  return text;\n};\n\nclass Controller extends BasicObject {}\n/* eslint-disable\n    no-empty,\n*/\n\n\nclass FileVerificationOperation extends Operation {\n  constructor(file) {\n    super(...arguments);\n    this.file = file;\n  }\n\n  perform(callback) {\n    const reader = new FileReader();\n\n    reader.onerror = () => callback(false);\n\n    reader.onload = () => {\n      reader.onerror = null;\n\n      try {\n        reader.abort();\n      } catch (error) {}\n\n      return callback(true, this.file);\n    };\n\n    return reader.readAsArrayBuffer(this.file);\n  }\n\n}\n\nclass InputController extends BasicObject {\n  constructor(element) {\n    super(...arguments);\n    this.element = element;\n    this.mutationObserver = new MutationObserver(this.element);\n    this.mutationObserver.delegate = this;\n\n    for (const eventName in this.constructor.events) {\n      handleEvent(eventName, {\n        onElement: this.element,\n        withCallback: this.handlerFor(eventName)\n      });\n    }\n  }\n\n  elementDidMutate(mutationSummary) {}\n\n  editorWillSyncDocumentView() {\n    return this.mutationObserver.stop();\n  }\n\n  editorDidSyncDocumentView() {\n    return this.mutationObserver.start();\n  }\n\n  requestRender() {\n    var _this$delegate, _this$delegate$inputC;\n\n    return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$inputC = _this$delegate.inputControllerDidRequestRender) === null || _this$delegate$inputC === void 0 ? void 0 : _this$delegate$inputC.call(_this$delegate);\n  }\n\n  requestReparse() {\n    var _this$delegate2, _this$delegate2$input;\n\n    (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$input = _this$delegate2.inputControllerDidRequestReparse) === null || _this$delegate2$input === void 0 ? void 0 : _this$delegate2$input.call(_this$delegate2);\n    return this.requestRender();\n  }\n\n  attachFiles(files) {\n    const operations = Array.from(files).map(file => new FileVerificationOperation(file));\n    return Promise.all(operations).then(files => {\n      this.handleInput(function () {\n        var _this$delegate3, _this$responder;\n\n        (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : _this$delegate3.inputControllerWillAttachFiles();\n        (_this$responder = this.responder) === null || _this$responder === void 0 ? void 0 : _this$responder.insertFiles(files);\n        return this.requestRender();\n      });\n    });\n  } // Private\n\n\n  handlerFor(eventName) {\n    return event => {\n      if (!event.defaultPrevented) {\n        this.handleInput(() => {\n          if (!innerElementIsActive(this.element)) {\n            this.eventName = eventName;\n            this.constructor.events[eventName].call(this, event);\n          }\n        });\n      }\n    };\n  }\n\n  handleInput(callback) {\n    try {\n      var _this$delegate4;\n\n      (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.inputControllerWillHandleInput();\n      callback.call(this);\n    } finally {\n      var _this$delegate5;\n\n      (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.inputControllerDidHandleInput();\n    }\n  }\n\n  createLinkHTML(href, text) {\n    const link = document.createElement(\"a\");\n    link.href = href;\n    link.textContent = text ? text : href;\n    return link.outerHTML;\n  }\n\n}\n\n_defineProperty(InputController, \"events\", {});\n\nvar _$codePointAt, _;\n\nconst {\n  browser,\n  keyNames: keyNames$1\n} = config;\nlet pastedFileCount = 0;\n\nclass Level0InputController extends InputController {\n  constructor() {\n    super(...arguments);\n    this.resetInputSummary();\n  }\n\n  setInputSummary() {\n    let summary = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.inputSummary.eventName = this.eventName;\n\n    for (const key in summary) {\n      const value = summary[key];\n      this.inputSummary[key] = value;\n    }\n\n    return this.inputSummary;\n  }\n\n  resetInputSummary() {\n    this.inputSummary = {};\n  }\n\n  reset() {\n    this.resetInputSummary();\n    return selectionChangeObserver.reset();\n  } // Mutation observer delegate\n\n\n  elementDidMutate(mutationSummary) {\n    if (this.isComposing()) {\n      var _this$delegate, _this$delegate$inputC;\n\n      return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$inputC = _this$delegate.inputControllerDidAllowUnhandledInput) === null || _this$delegate$inputC === void 0 ? void 0 : _this$delegate$inputC.call(_this$delegate);\n    } else {\n      return this.handleInput(function () {\n        if (this.mutationIsSignificant(mutationSummary)) {\n          if (this.mutationIsExpected(mutationSummary)) {\n            this.requestRender();\n          } else {\n            this.requestReparse();\n          }\n        }\n\n        return this.reset();\n      });\n    }\n  }\n\n  mutationIsExpected(_ref) {\n    let {\n      textAdded,\n      textDeleted\n    } = _ref;\n\n    if (this.inputSummary.preferDocument) {\n      return true;\n    }\n\n    const mutationAdditionMatchesSummary = textAdded != null ? textAdded === this.inputSummary.textAdded : !this.inputSummary.textAdded;\n    const mutationDeletionMatchesSummary = textDeleted != null ? this.inputSummary.didDelete : !this.inputSummary.didDelete;\n    const unexpectedNewlineAddition = [\"\\n\", \" \\n\"].includes(textAdded) && !mutationAdditionMatchesSummary;\n    const unexpectedNewlineDeletion = textDeleted === \"\\n\" && !mutationDeletionMatchesSummary;\n    const singleUnexpectedNewline = unexpectedNewlineAddition && !unexpectedNewlineDeletion || unexpectedNewlineDeletion && !unexpectedNewlineAddition;\n\n    if (singleUnexpectedNewline) {\n      const range = this.getSelectedRange();\n\n      if (range) {\n        var _this$responder;\n\n        const offset = unexpectedNewlineAddition ? textAdded.replace(/\\n$/, \"\").length || -1 : (textAdded === null || textAdded === void 0 ? void 0 : textAdded.length) || 1;\n\n        if ((_this$responder = this.responder) !== null && _this$responder !== void 0 && _this$responder.positionIsBlockBreak(range[1] + offset)) {\n          return true;\n        }\n      }\n    }\n\n    return mutationAdditionMatchesSummary && mutationDeletionMatchesSummary;\n  }\n\n  mutationIsSignificant(mutationSummary) {\n    var _this$compositionInpu;\n\n    const textChanged = Object.keys(mutationSummary).length > 0;\n    const composedEmptyString = ((_this$compositionInpu = this.compositionInput) === null || _this$compositionInpu === void 0 ? void 0 : _this$compositionInpu.getEndData()) === \"\";\n    return textChanged || !composedEmptyString;\n  } // Private\n\n\n  getCompositionInput() {\n    if (this.isComposing()) {\n      return this.compositionInput;\n    } else {\n      this.compositionInput = new CompositionInput(this);\n    }\n  }\n\n  isComposing() {\n    return this.compositionInput && !this.compositionInput.isEnded();\n  }\n\n  deleteInDirection(direction, event) {\n    var _this$responder2;\n\n    if (((_this$responder2 = this.responder) === null || _this$responder2 === void 0 ? void 0 : _this$responder2.deleteInDirection(direction)) === false) {\n      if (event) {\n        event.preventDefault();\n        return this.requestRender();\n      }\n    } else {\n      return this.setInputSummary({\n        didDelete: true\n      });\n    }\n  }\n\n  serializeSelectionToDataTransfer(dataTransfer) {\n    var _this$responder3;\n\n    if (!dataTransferIsWritable(dataTransfer)) return;\n    const document = (_this$responder3 = this.responder) === null || _this$responder3 === void 0 ? void 0 : _this$responder3.getSelectedDocument().toSerializableDocument();\n    dataTransfer.setData(\"application/x-trix-document\", JSON.stringify(document));\n    dataTransfer.setData(\"text/html\", DocumentView.render(document).innerHTML);\n    dataTransfer.setData(\"text/plain\", document.toString().replace(/\\n$/, \"\"));\n    return true;\n  }\n\n  canAcceptDataTransfer(dataTransfer) {\n    const types = {};\n    Array.from((dataTransfer === null || dataTransfer === void 0 ? void 0 : dataTransfer.types) || []).forEach(type => {\n      types[type] = true;\n    });\n    return types.Files || types[\"application/x-trix-document\"] || types[\"text/html\"] || types[\"text/plain\"];\n  }\n\n  getPastedHTMLUsingHiddenElement(callback) {\n    const selectedRange = this.getSelectedRange();\n    const style = {\n      position: \"absolute\",\n      left: \"\".concat(window.pageXOffset, \"px\"),\n      top: \"\".concat(window.pageYOffset, \"px\"),\n      opacity: 0\n    };\n    const element = makeElement({\n      style,\n      tagName: \"div\",\n      editable: true\n    });\n    document.body.appendChild(element);\n    element.focus();\n    return requestAnimationFrame(() => {\n      const html = element.innerHTML;\n      removeNode(element);\n      this.setSelectedRange(selectedRange);\n      return callback(html);\n    });\n  }\n\n}\n\n_defineProperty(Level0InputController, \"events\", {\n  keydown(event) {\n    if (!this.isComposing()) {\n      this.resetInputSummary();\n    }\n\n    this.inputSummary.didInput = true;\n    const keyName = keyNames$1[event.keyCode];\n\n    if (keyName) {\n      var _context2;\n\n      let context = this.keys;\n      [\"ctrl\", \"alt\", \"shift\", \"meta\"].forEach(modifier => {\n        if (event[\"\".concat(modifier, \"Key\")]) {\n          var _context;\n\n          if (modifier === \"ctrl\") {\n            modifier = \"control\";\n          }\n\n          context = (_context = context) === null || _context === void 0 ? void 0 : _context[modifier];\n        }\n      });\n\n      if (((_context2 = context) === null || _context2 === void 0 ? void 0 : _context2[keyName]) != null) {\n        this.setInputSummary({\n          keyName\n        });\n        selectionChangeObserver.reset();\n        context[keyName].call(this, event);\n      }\n    }\n\n    if (keyEventIsKeyboardCommand(event)) {\n      const character = String.fromCharCode(event.keyCode).toLowerCase();\n\n      if (character) {\n        var _this$delegate3;\n\n        const keys = [\"alt\", \"shift\"].map(modifier => {\n          if (event[\"\".concat(modifier, \"Key\")]) {\n            return modifier;\n          }\n        }).filter(key => key);\n        keys.push(character);\n\n        if ((_this$delegate3 = this.delegate) !== null && _this$delegate3 !== void 0 && _this$delegate3.inputControllerDidReceiveKeyboardCommand(keys)) {\n          event.preventDefault();\n        }\n      }\n    }\n  },\n\n  keypress(event) {\n    if (this.inputSummary.eventName != null) return;\n    if (event.metaKey) return;\n    if (event.ctrlKey && !event.altKey) return;\n    const string = stringFromKeyEvent(event);\n\n    if (string) {\n      var _this$delegate4, _this$responder9;\n\n      (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.inputControllerWillPerformTyping();\n      (_this$responder9 = this.responder) === null || _this$responder9 === void 0 ? void 0 : _this$responder9.insertString(string);\n      return this.setInputSummary({\n        textAdded: string,\n        didDelete: this.selectionIsExpanded()\n      });\n    }\n  },\n\n  textInput(event) {\n    // Handle autocapitalization\n    const {\n      data\n    } = event;\n    const {\n      textAdded\n    } = this.inputSummary;\n\n    if (textAdded && textAdded !== data && textAdded.toUpperCase() === data) {\n      var _this$responder10;\n\n      const range = this.getSelectedRange();\n      this.setSelectedRange([range[0], range[1] + textAdded.length]);\n      (_this$responder10 = this.responder) === null || _this$responder10 === void 0 ? void 0 : _this$responder10.insertString(data);\n      this.setInputSummary({\n        textAdded: data\n      });\n      return this.setSelectedRange(range);\n    }\n  },\n\n  dragenter(event) {\n    event.preventDefault();\n  },\n\n  dragstart(event) {\n    var _this$delegate5, _this$delegate5$input;\n\n    this.serializeSelectionToDataTransfer(event.dataTransfer);\n    this.draggedRange = this.getSelectedRange();\n    return (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : (_this$delegate5$input = _this$delegate5.inputControllerDidStartDrag) === null || _this$delegate5$input === void 0 ? void 0 : _this$delegate5$input.call(_this$delegate5);\n  },\n\n  dragover(event) {\n    if (this.draggedRange || this.canAcceptDataTransfer(event.dataTransfer)) {\n      event.preventDefault();\n      const draggingPoint = {\n        x: event.clientX,\n        y: event.clientY\n      };\n\n      if (!objectsAreEqual(draggingPoint, this.draggingPoint)) {\n        var _this$delegate6, _this$delegate6$input;\n\n        this.draggingPoint = draggingPoint;\n        return (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : (_this$delegate6$input = _this$delegate6.inputControllerDidReceiveDragOverPoint) === null || _this$delegate6$input === void 0 ? void 0 : _this$delegate6$input.call(_this$delegate6, this.draggingPoint);\n      }\n    }\n  },\n\n  dragend(event) {\n    var _this$delegate7, _this$delegate7$input;\n\n    (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : (_this$delegate7$input = _this$delegate7.inputControllerDidCancelDrag) === null || _this$delegate7$input === void 0 ? void 0 : _this$delegate7$input.call(_this$delegate7);\n    this.draggedRange = null;\n    this.draggingPoint = null;\n  },\n\n  drop(event) {\n    var _event$dataTransfer, _this$responder11;\n\n    event.preventDefault();\n    const files = (_event$dataTransfer = event.dataTransfer) === null || _event$dataTransfer === void 0 ? void 0 : _event$dataTransfer.files;\n    const documentJSON = event.dataTransfer.getData(\"application/x-trix-document\");\n    const point = {\n      x: event.clientX,\n      y: event.clientY\n    };\n    (_this$responder11 = this.responder) === null || _this$responder11 === void 0 ? void 0 : _this$responder11.setLocationRangeFromPointRange(point);\n\n    if (files !== null && files !== void 0 && files.length) {\n      this.attachFiles(files);\n    } else if (this.draggedRange) {\n      var _this$delegate8, _this$responder12;\n\n      (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : _this$delegate8.inputControllerWillMoveText();\n      (_this$responder12 = this.responder) === null || _this$responder12 === void 0 ? void 0 : _this$responder12.moveTextFromRange(this.draggedRange);\n      this.draggedRange = null;\n      this.requestRender();\n    } else if (documentJSON) {\n      var _this$responder13;\n\n      const document = Document.fromJSONString(documentJSON);\n      (_this$responder13 = this.responder) === null || _this$responder13 === void 0 ? void 0 : _this$responder13.insertDocument(document);\n      this.requestRender();\n    }\n\n    this.draggedRange = null;\n    this.draggingPoint = null;\n  },\n\n  cut(event) {\n    var _this$responder14;\n\n    if ((_this$responder14 = this.responder) !== null && _this$responder14 !== void 0 && _this$responder14.selectionIsExpanded()) {\n      var _this$delegate9;\n\n      if (this.serializeSelectionToDataTransfer(event.clipboardData)) {\n        event.preventDefault();\n      }\n\n      (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : _this$delegate9.inputControllerWillCutText();\n      this.deleteInDirection(\"backward\");\n\n      if (event.defaultPrevented) {\n        return this.requestRender();\n      }\n    }\n  },\n\n  copy(event) {\n    var _this$responder15;\n\n    if ((_this$responder15 = this.responder) !== null && _this$responder15 !== void 0 && _this$responder15.selectionIsExpanded()) {\n      if (this.serializeSelectionToDataTransfer(event.clipboardData)) {\n        event.preventDefault();\n      }\n    }\n  },\n\n  paste(event) {\n    const clipboard = event.clipboardData || event.testClipboardData;\n    const paste = {\n      clipboard\n    };\n\n    if (!clipboard || pasteEventIsCrippledSafariHTMLPaste(event)) {\n      this.getPastedHTMLUsingHiddenElement(html => {\n        var _this$delegate10, _this$responder16, _this$delegate11;\n\n        paste.type = \"text/html\";\n        paste.html = html;\n        (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : _this$delegate10.inputControllerWillPaste(paste);\n        (_this$responder16 = this.responder) === null || _this$responder16 === void 0 ? void 0 : _this$responder16.insertHTML(paste.html);\n        this.requestRender();\n        return (_this$delegate11 = this.delegate) === null || _this$delegate11 === void 0 ? void 0 : _this$delegate11.inputControllerDidPaste(paste);\n      });\n      return;\n    }\n\n    const href = clipboard.getData(\"URL\");\n    const html = clipboard.getData(\"text/html\");\n    const name = clipboard.getData(\"public.url-name\");\n\n    if (href) {\n      var _this$delegate12, _this$responder17, _this$delegate13;\n\n      let string;\n      paste.type = \"text/html\";\n\n      if (name) {\n        string = squishBreakableWhitespace(name).trim();\n      } else {\n        string = href;\n      }\n\n      paste.html = this.createLinkHTML(href, string);\n      (_this$delegate12 = this.delegate) === null || _this$delegate12 === void 0 ? void 0 : _this$delegate12.inputControllerWillPaste(paste);\n      this.setInputSummary({\n        textAdded: string,\n        didDelete: this.selectionIsExpanded()\n      });\n      (_this$responder17 = this.responder) === null || _this$responder17 === void 0 ? void 0 : _this$responder17.insertHTML(paste.html);\n      this.requestRender();\n      (_this$delegate13 = this.delegate) === null || _this$delegate13 === void 0 ? void 0 : _this$delegate13.inputControllerDidPaste(paste);\n    } else if (dataTransferIsPlainText(clipboard)) {\n      var _this$delegate14, _this$responder18, _this$delegate15;\n\n      paste.type = \"text/plain\";\n      paste.string = clipboard.getData(\"text/plain\");\n      (_this$delegate14 = this.delegate) === null || _this$delegate14 === void 0 ? void 0 : _this$delegate14.inputControllerWillPaste(paste);\n      this.setInputSummary({\n        textAdded: paste.string,\n        didDelete: this.selectionIsExpanded()\n      });\n      (_this$responder18 = this.responder) === null || _this$responder18 === void 0 ? void 0 : _this$responder18.insertString(paste.string);\n      this.requestRender();\n      (_this$delegate15 = this.delegate) === null || _this$delegate15 === void 0 ? void 0 : _this$delegate15.inputControllerDidPaste(paste);\n    } else if (html) {\n      var _this$delegate16, _this$responder19, _this$delegate17;\n\n      paste.type = \"text/html\";\n      paste.html = html;\n      (_this$delegate16 = this.delegate) === null || _this$delegate16 === void 0 ? void 0 : _this$delegate16.inputControllerWillPaste(paste);\n      (_this$responder19 = this.responder) === null || _this$responder19 === void 0 ? void 0 : _this$responder19.insertHTML(paste.html);\n      this.requestRender();\n      (_this$delegate17 = this.delegate) === null || _this$delegate17 === void 0 ? void 0 : _this$delegate17.inputControllerDidPaste(paste);\n    } else if (Array.from(clipboard.types).includes(\"Files\")) {\n      var _clipboard$items, _clipboard$items$, _clipboard$items$$get;\n\n      const file = (_clipboard$items = clipboard.items) === null || _clipboard$items === void 0 ? void 0 : (_clipboard$items$ = _clipboard$items[0]) === null || _clipboard$items$ === void 0 ? void 0 : (_clipboard$items$$get = _clipboard$items$.getAsFile) === null || _clipboard$items$$get === void 0 ? void 0 : _clipboard$items$$get.call(_clipboard$items$);\n\n      if (file) {\n        var _this$delegate18, _this$responder20, _this$delegate19;\n\n        const extension = extensionForFile(file);\n\n        if (!file.name && extension) {\n          file.name = \"pasted-file-\".concat(++pastedFileCount, \".\").concat(extension);\n        }\n\n        paste.type = \"File\";\n        paste.file = file;\n        (_this$delegate18 = this.delegate) === null || _this$delegate18 === void 0 ? void 0 : _this$delegate18.inputControllerWillAttachFiles();\n        (_this$responder20 = this.responder) === null || _this$responder20 === void 0 ? void 0 : _this$responder20.insertFile(paste.file);\n        this.requestRender();\n        (_this$delegate19 = this.delegate) === null || _this$delegate19 === void 0 ? void 0 : _this$delegate19.inputControllerDidPaste(paste);\n      }\n    }\n\n    event.preventDefault();\n  },\n\n  compositionstart(event) {\n    return this.getCompositionInput().start(event.data);\n  },\n\n  compositionupdate(event) {\n    return this.getCompositionInput().update(event.data);\n  },\n\n  compositionend(event) {\n    return this.getCompositionInput().end(event.data);\n  },\n\n  beforeinput(event) {\n    this.inputSummary.didInput = true;\n  },\n\n  input(event) {\n    this.inputSummary.didInput = true;\n    return event.stopPropagation();\n  }\n\n});\n\n_defineProperty(Level0InputController, \"keys\", {\n  backspace(event) {\n    var _this$delegate20;\n\n    (_this$delegate20 = this.delegate) === null || _this$delegate20 === void 0 ? void 0 : _this$delegate20.inputControllerWillPerformTyping();\n    return this.deleteInDirection(\"backward\", event);\n  },\n\n  delete(event) {\n    var _this$delegate21;\n\n    (_this$delegate21 = this.delegate) === null || _this$delegate21 === void 0 ? void 0 : _this$delegate21.inputControllerWillPerformTyping();\n    return this.deleteInDirection(\"forward\", event);\n  },\n\n  return(event) {\n    var _this$delegate22, _this$responder21;\n\n    this.setInputSummary({\n      preferDocument: true\n    });\n    (_this$delegate22 = this.delegate) === null || _this$delegate22 === void 0 ? void 0 : _this$delegate22.inputControllerWillPerformTyping();\n    return (_this$responder21 = this.responder) === null || _this$responder21 === void 0 ? void 0 : _this$responder21.insertLineBreak();\n  },\n\n  tab(event) {\n    var _this$responder22;\n\n    if ((_this$responder22 = this.responder) !== null && _this$responder22 !== void 0 && _this$responder22.canIncreaseNestingLevel()) {\n      var _this$responder23;\n\n      (_this$responder23 = this.responder) === null || _this$responder23 === void 0 ? void 0 : _this$responder23.increaseNestingLevel();\n      this.requestRender();\n      event.preventDefault();\n    }\n  },\n\n  left(event) {\n    if (this.selectionIsInCursorTarget()) {\n      var _this$responder24;\n\n      event.preventDefault();\n      return (_this$responder24 = this.responder) === null || _this$responder24 === void 0 ? void 0 : _this$responder24.moveCursorInDirection(\"backward\");\n    }\n  },\n\n  right(event) {\n    if (this.selectionIsInCursorTarget()) {\n      var _this$responder25;\n\n      event.preventDefault();\n      return (_this$responder25 = this.responder) === null || _this$responder25 === void 0 ? void 0 : _this$responder25.moveCursorInDirection(\"forward\");\n    }\n  },\n\n  control: {\n    d(event) {\n      var _this$delegate23;\n\n      (_this$delegate23 = this.delegate) === null || _this$delegate23 === void 0 ? void 0 : _this$delegate23.inputControllerWillPerformTyping();\n      return this.deleteInDirection(\"forward\", event);\n    },\n\n    h(event) {\n      var _this$delegate24;\n\n      (_this$delegate24 = this.delegate) === null || _this$delegate24 === void 0 ? void 0 : _this$delegate24.inputControllerWillPerformTyping();\n      return this.deleteInDirection(\"backward\", event);\n    },\n\n    o(event) {\n      var _this$delegate25, _this$responder26;\n\n      event.preventDefault();\n      (_this$delegate25 = this.delegate) === null || _this$delegate25 === void 0 ? void 0 : _this$delegate25.inputControllerWillPerformTyping();\n      (_this$responder26 = this.responder) === null || _this$responder26 === void 0 ? void 0 : _this$responder26.insertString(\"\\n\", {\n        updatePosition: false\n      });\n      return this.requestRender();\n    }\n\n  },\n  shift: {\n    return(event) {\n      var _this$delegate26, _this$responder27;\n\n      (_this$delegate26 = this.delegate) === null || _this$delegate26 === void 0 ? void 0 : _this$delegate26.inputControllerWillPerformTyping();\n      (_this$responder27 = this.responder) === null || _this$responder27 === void 0 ? void 0 : _this$responder27.insertString(\"\\n\");\n      this.requestRender();\n      event.preventDefault();\n    },\n\n    tab(event) {\n      var _this$responder28;\n\n      if ((_this$responder28 = this.responder) !== null && _this$responder28 !== void 0 && _this$responder28.canDecreaseNestingLevel()) {\n        var _this$responder29;\n\n        (_this$responder29 = this.responder) === null || _this$responder29 === void 0 ? void 0 : _this$responder29.decreaseNestingLevel();\n        this.requestRender();\n        event.preventDefault();\n      }\n    },\n\n    left(event) {\n      if (this.selectionIsInCursorTarget()) {\n        event.preventDefault();\n        return this.expandSelectionInDirection(\"backward\");\n      }\n    },\n\n    right(event) {\n      if (this.selectionIsInCursorTarget()) {\n        event.preventDefault();\n        return this.expandSelectionInDirection(\"forward\");\n      }\n    }\n\n  },\n  alt: {\n    backspace(event) {\n      var _this$delegate27;\n\n      this.setInputSummary({\n        preferDocument: false\n      });\n      return (_this$delegate27 = this.delegate) === null || _this$delegate27 === void 0 ? void 0 : _this$delegate27.inputControllerWillPerformTyping();\n    }\n\n  },\n  meta: {\n    backspace(event) {\n      var _this$delegate28;\n\n      this.setInputSummary({\n        preferDocument: false\n      });\n      return (_this$delegate28 = this.delegate) === null || _this$delegate28 === void 0 ? void 0 : _this$delegate28.inputControllerWillPerformTyping();\n    }\n\n  }\n});\n\nLevel0InputController.proxyMethod(\"responder?.getSelectedRange\");\nLevel0InputController.proxyMethod(\"responder?.setSelectedRange\");\nLevel0InputController.proxyMethod(\"responder?.expandSelectionInDirection\");\nLevel0InputController.proxyMethod(\"responder?.selectionIsInCursorTarget\");\nLevel0InputController.proxyMethod(\"responder?.selectionIsExpanded\");\n\nconst extensionForFile = file => {\n  var _file$type, _file$type$match;\n\n  return (_file$type = file.type) === null || _file$type === void 0 ? void 0 : (_file$type$match = _file$type.match(/\\/(\\w+)$/)) === null || _file$type$match === void 0 ? void 0 : _file$type$match[1];\n};\n\nconst hasStringCodePointAt = !!((_$codePointAt = (_ = \" \").codePointAt) !== null && _$codePointAt !== void 0 && _$codePointAt.call(_, 0));\n\nconst stringFromKeyEvent = function (event) {\n  if (event.key && hasStringCodePointAt && event.key.codePointAt(0) === event.keyCode) {\n    return event.key;\n  } else {\n    let code;\n\n    if (event.which === null) {\n      code = event.keyCode;\n    } else if (event.which !== 0 && event.charCode !== 0) {\n      code = event.charCode;\n    }\n\n    if (code != null && keyNames$1[code] !== \"escape\") {\n      return UTF16String.fromCodepoints([code]).toString();\n    }\n  }\n};\n\nconst pasteEventIsCrippledSafariHTMLPaste = function (event) {\n  const paste = event.clipboardData;\n\n  if (paste) {\n    if (paste.types.includes(\"text/html\")) {\n      // Answer is yes if there's any possibility of Paste and Match Style in Safari,\n      // which is nearly impossible to detect confidently: https://bugs.webkit.org/show_bug.cgi?id=174165\n      for (const type of paste.types) {\n        const hasPasteboardFlavor = /^CorePasteboardFlavorType/.test(type);\n        const hasReadableDynamicData = /^dyn\\./.test(type) && paste.getData(type);\n        const mightBePasteAndMatchStyle = hasPasteboardFlavor || hasReadableDynamicData;\n\n        if (mightBePasteAndMatchStyle) {\n          return true;\n        }\n      }\n\n      return false;\n    } else {\n      const isExternalHTMLPaste = paste.types.includes(\"com.apple.webarchive\");\n      const isExternalRichTextPaste = paste.types.includes(\"com.apple.flat-rtfd\");\n      return isExternalHTMLPaste || isExternalRichTextPaste;\n    }\n  }\n};\n\nclass CompositionInput extends BasicObject {\n  constructor(inputController) {\n    super(...arguments);\n    this.inputController = inputController;\n    this.responder = this.inputController.responder;\n    this.delegate = this.inputController.delegate;\n    this.inputSummary = this.inputController.inputSummary;\n    this.data = {};\n  }\n\n  start(data) {\n    this.data.start = data;\n\n    if (this.isSignificant()) {\n      var _this$responder5;\n\n      if (this.inputSummary.eventName === \"keypress\" && this.inputSummary.textAdded) {\n        var _this$responder4;\n\n        (_this$responder4 = this.responder) === null || _this$responder4 === void 0 ? void 0 : _this$responder4.deleteInDirection(\"left\");\n      }\n\n      if (!this.selectionIsExpanded()) {\n        this.insertPlaceholder();\n        this.requestRender();\n      }\n\n      this.range = (_this$responder5 = this.responder) === null || _this$responder5 === void 0 ? void 0 : _this$responder5.getSelectedRange();\n    }\n  }\n\n  update(data) {\n    this.data.update = data;\n\n    if (this.isSignificant()) {\n      const range = this.selectPlaceholder();\n\n      if (range) {\n        this.forgetPlaceholder();\n        this.range = range;\n      }\n    }\n  }\n\n  end(data) {\n    this.data.end = data;\n\n    if (this.isSignificant()) {\n      this.forgetPlaceholder();\n\n      if (this.canApplyToDocument()) {\n        var _this$delegate2, _this$responder6, _this$responder7, _this$responder8;\n\n        this.setInputSummary({\n          preferDocument: true,\n          didInput: false\n        });\n        (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : _this$delegate2.inputControllerWillPerformTyping();\n        (_this$responder6 = this.responder) === null || _this$responder6 === void 0 ? void 0 : _this$responder6.setSelectedRange(this.range);\n        (_this$responder7 = this.responder) === null || _this$responder7 === void 0 ? void 0 : _this$responder7.insertString(this.data.end);\n        return (_this$responder8 = this.responder) === null || _this$responder8 === void 0 ? void 0 : _this$responder8.setSelectedRange(this.range[0] + this.data.end.length);\n      } else if (this.data.start != null || this.data.update != null) {\n        this.requestReparse();\n        return this.inputController.reset();\n      }\n    } else {\n      return this.inputController.reset();\n    }\n  }\n\n  getEndData() {\n    return this.data.end;\n  }\n\n  isEnded() {\n    return this.getEndData() != null;\n  }\n\n  isSignificant() {\n    if (browser.composesExistingText) {\n      return this.inputSummary.didInput;\n    } else {\n      return true;\n    }\n  } // Private\n\n\n  canApplyToDocument() {\n    var _this$data$start, _this$data$end;\n\n    return ((_this$data$start = this.data.start) === null || _this$data$start === void 0 ? void 0 : _this$data$start.length) === 0 && ((_this$data$end = this.data.end) === null || _this$data$end === void 0 ? void 0 : _this$data$end.length) > 0 && this.range;\n  }\n\n}\n\nCompositionInput.proxyMethod(\"inputController.setInputSummary\");\nCompositionInput.proxyMethod(\"inputController.requestRender\");\nCompositionInput.proxyMethod(\"inputController.requestReparse\");\nCompositionInput.proxyMethod(\"responder?.selectionIsExpanded\");\nCompositionInput.proxyMethod(\"responder?.insertPlaceholder\");\nCompositionInput.proxyMethod(\"responder?.selectPlaceholder\");\nCompositionInput.proxyMethod(\"responder?.forgetPlaceholder\");\n\nclass Level2InputController extends InputController {\n  constructor() {\n    super(...arguments);\n    this.render = this.render.bind(this);\n  }\n\n  elementDidMutate() {\n    if (this.scheduledRender) {\n      if (this.composing) {\n        var _this$delegate, _this$delegate$inputC;\n\n        return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$inputC = _this$delegate.inputControllerDidAllowUnhandledInput) === null || _this$delegate$inputC === void 0 ? void 0 : _this$delegate$inputC.call(_this$delegate);\n      }\n    } else {\n      return this.reparse();\n    }\n  }\n\n  scheduleRender() {\n    return this.scheduledRender ? this.scheduledRender : this.scheduledRender = requestAnimationFrame(this.render);\n  }\n\n  render() {\n    var _this$afterRender;\n\n    cancelAnimationFrame(this.scheduledRender);\n    this.scheduledRender = null;\n\n    if (!this.composing) {\n      var _this$delegate2;\n\n      (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : _this$delegate2.render();\n    }\n\n    (_this$afterRender = this.afterRender) === null || _this$afterRender === void 0 ? void 0 : _this$afterRender.call(this);\n    this.afterRender = null;\n  }\n\n  reparse() {\n    var _this$delegate3;\n\n    return (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : _this$delegate3.reparse();\n  } // Responder helpers\n\n\n  insertString() {\n    var _this$delegate4;\n\n    let string = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n    let options = arguments.length > 1 ? arguments[1] : undefined;\n    (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.inputControllerWillPerformTyping();\n    return this.withTargetDOMRange(function () {\n      var _this$responder;\n\n      return (_this$responder = this.responder) === null || _this$responder === void 0 ? void 0 : _this$responder.insertString(string, options);\n    });\n  }\n\n  toggleAttributeIfSupported(attributeName) {\n    if (getAllAttributeNames().includes(attributeName)) {\n      var _this$delegate5;\n\n      (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.inputControllerWillPerformFormatting(attributeName);\n      return this.withTargetDOMRange(function () {\n        var _this$responder2;\n\n        return (_this$responder2 = this.responder) === null || _this$responder2 === void 0 ? void 0 : _this$responder2.toggleCurrentAttribute(attributeName);\n      });\n    }\n  }\n\n  activateAttributeIfSupported(attributeName, value) {\n    if (getAllAttributeNames().includes(attributeName)) {\n      var _this$delegate6;\n\n      (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : _this$delegate6.inputControllerWillPerformFormatting(attributeName);\n      return this.withTargetDOMRange(function () {\n        var _this$responder3;\n\n        return (_this$responder3 = this.responder) === null || _this$responder3 === void 0 ? void 0 : _this$responder3.setCurrentAttribute(attributeName, value);\n      });\n    }\n  }\n\n  deleteInDirection(direction) {\n    let {\n      recordUndoEntry\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      recordUndoEntry: true\n    };\n\n    if (recordUndoEntry) {\n      var _this$delegate7;\n\n      (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : _this$delegate7.inputControllerWillPerformTyping();\n    }\n\n    const perform = () => {\n      var _this$responder4;\n\n      return (_this$responder4 = this.responder) === null || _this$responder4 === void 0 ? void 0 : _this$responder4.deleteInDirection(direction);\n    };\n\n    const domRange = this.getTargetDOMRange({\n      minLength: 2\n    });\n\n    if (domRange) {\n      return this.withTargetDOMRange(domRange, perform);\n    } else {\n      return perform();\n    }\n  } // Selection helpers\n\n\n  withTargetDOMRange(domRange, fn) {\n    if (typeof domRange === \"function\") {\n      fn = domRange;\n      domRange = this.getTargetDOMRange();\n    }\n\n    if (domRange) {\n      var _this$responder5;\n\n      return (_this$responder5 = this.responder) === null || _this$responder5 === void 0 ? void 0 : _this$responder5.withTargetDOMRange(domRange, fn.bind(this));\n    } else {\n      selectionChangeObserver.reset();\n      return fn.call(this);\n    }\n  }\n\n  getTargetDOMRange() {\n    var _this$event$getTarget, _this$event;\n\n    let {\n      minLength\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n      minLength: 0\n    };\n    const targetRanges = (_this$event$getTarget = (_this$event = this.event).getTargetRanges) === null || _this$event$getTarget === void 0 ? void 0 : _this$event$getTarget.call(_this$event);\n\n    if (targetRanges) {\n      if (targetRanges.length) {\n        const domRange = staticRangeToRange(targetRanges[0]);\n\n        if (minLength === 0 || domRange.toString().length >= minLength) {\n          return domRange;\n        }\n      }\n    }\n  }\n\n  withEvent(event, fn) {\n    let result;\n    this.event = event;\n\n    try {\n      result = fn.call(this);\n    } finally {\n      this.event = null;\n    }\n\n    return result;\n  }\n\n}\n\n_defineProperty(Level2InputController, \"events\", {\n  keydown(event) {\n    if (keyEventIsKeyboardCommand(event)) {\n      var _this$delegate8;\n\n      const command = keyboardCommandFromKeyEvent(event);\n\n      if ((_this$delegate8 = this.delegate) !== null && _this$delegate8 !== void 0 && _this$delegate8.inputControllerDidReceiveKeyboardCommand(command)) {\n        event.preventDefault();\n      }\n    } else {\n      let name = event.key;\n\n      if (event.altKey) {\n        name += \"+Alt\";\n      }\n\n      if (event.shiftKey) {\n        name += \"+Shift\";\n      }\n\n      const handler = this.constructor.keys[name];\n\n      if (handler) {\n        return this.withEvent(event, handler);\n      }\n    }\n  },\n\n  // Handle paste event to work around beforeinput.insertFromPaste browser bugs.\n  // Safe to remove each condition once fixed upstream.\n  paste(event) {\n    var _event$clipboardData; // https://bugs.webkit.org/show_bug.cgi?id=194921\n\n\n    let paste;\n    const href = (_event$clipboardData = event.clipboardData) === null || _event$clipboardData === void 0 ? void 0 : _event$clipboardData.getData(\"URL\");\n\n    if (pasteEventHasFilesOnly(event)) {\n      event.preventDefault();\n      return this.attachFiles(event.clipboardData.files); // https://bugs.chromium.org/p/chromium/issues/detail?id=934448\n    } else if (pasteEventHasPlainTextOnly(event)) {\n      var _this$delegate9, _this$responder6, _this$delegate10;\n\n      event.preventDefault();\n      paste = {\n        type: \"text/plain\",\n        string: event.clipboardData.getData(\"text/plain\")\n      };\n      (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : _this$delegate9.inputControllerWillPaste(paste);\n      (_this$responder6 = this.responder) === null || _this$responder6 === void 0 ? void 0 : _this$responder6.insertString(paste.string);\n      this.render();\n      return (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : _this$delegate10.inputControllerDidPaste(paste); // https://bugs.webkit.org/show_bug.cgi?id=196702\n    } else if (href) {\n      var _this$delegate11, _this$responder7, _this$delegate12;\n\n      event.preventDefault();\n      paste = {\n        type: \"text/html\",\n        html: this.createLinkHTML(href)\n      };\n      (_this$delegate11 = this.delegate) === null || _this$delegate11 === void 0 ? void 0 : _this$delegate11.inputControllerWillPaste(paste);\n      (_this$responder7 = this.responder) === null || _this$responder7 === void 0 ? void 0 : _this$responder7.insertHTML(paste.html);\n      this.render();\n      return (_this$delegate12 = this.delegate) === null || _this$delegate12 === void 0 ? void 0 : _this$delegate12.inputControllerDidPaste(paste);\n    }\n  },\n\n  beforeinput(event) {\n    const handler = this.constructor.inputTypes[event.inputType];\n\n    if (handler) {\n      this.withEvent(event, handler);\n      return this.scheduleRender();\n    }\n  },\n\n  input(event) {\n    return selectionChangeObserver.reset();\n  },\n\n  dragstart(event) {\n    var _this$responder8;\n\n    if ((_this$responder8 = this.responder) !== null && _this$responder8 !== void 0 && _this$responder8.selectionContainsAttachments()) {\n      var _this$responder9;\n\n      event.dataTransfer.setData(\"application/x-trix-dragging\", true);\n      this.dragging = {\n        range: (_this$responder9 = this.responder) === null || _this$responder9 === void 0 ? void 0 : _this$responder9.getSelectedRange(),\n        point: pointFromEvent(event)\n      };\n    }\n  },\n\n  dragenter(event) {\n    if (dragEventHasFiles(event)) {\n      event.preventDefault();\n    }\n  },\n\n  dragover(event) {\n    if (this.dragging) {\n      event.preventDefault();\n      const point = pointFromEvent(event);\n\n      if (!objectsAreEqual(point, this.dragging.point)) {\n        var _this$responder10;\n\n        this.dragging.point = point;\n        return (_this$responder10 = this.responder) === null || _this$responder10 === void 0 ? void 0 : _this$responder10.setLocationRangeFromPointRange(point);\n      }\n    } else if (dragEventHasFiles(event)) {\n      event.preventDefault();\n    }\n  },\n\n  drop(event) {\n    if (this.dragging) {\n      var _this$delegate13, _this$responder11;\n\n      event.preventDefault();\n      (_this$delegate13 = this.delegate) === null || _this$delegate13 === void 0 ? void 0 : _this$delegate13.inputControllerWillMoveText();\n      (_this$responder11 = this.responder) === null || _this$responder11 === void 0 ? void 0 : _this$responder11.moveTextFromRange(this.dragging.range);\n      this.dragging = null;\n      return this.scheduleRender();\n    } else if (dragEventHasFiles(event)) {\n      var _this$responder12;\n\n      event.preventDefault();\n      const point = pointFromEvent(event);\n      (_this$responder12 = this.responder) === null || _this$responder12 === void 0 ? void 0 : _this$responder12.setLocationRangeFromPointRange(point);\n      return this.attachFiles(event.dataTransfer.files);\n    }\n  },\n\n  dragend() {\n    if (this.dragging) {\n      var _this$responder13;\n\n      (_this$responder13 = this.responder) === null || _this$responder13 === void 0 ? void 0 : _this$responder13.setSelectedRange(this.dragging.range);\n      this.dragging = null;\n    }\n  },\n\n  compositionend(event) {\n    if (this.composing) {\n      this.composing = false;\n      return this.scheduleRender();\n    }\n  }\n\n});\n\n_defineProperty(Level2InputController, \"keys\", {\n  ArrowLeft() {\n    var _this$responder14;\n\n    if ((_this$responder14 = this.responder) !== null && _this$responder14 !== void 0 && _this$responder14.shouldManageMovingCursorInDirection(\"backward\")) {\n      var _this$responder15;\n\n      this.event.preventDefault();\n      return (_this$responder15 = this.responder) === null || _this$responder15 === void 0 ? void 0 : _this$responder15.moveCursorInDirection(\"backward\");\n    }\n  },\n\n  ArrowRight() {\n    var _this$responder16;\n\n    if ((_this$responder16 = this.responder) !== null && _this$responder16 !== void 0 && _this$responder16.shouldManageMovingCursorInDirection(\"forward\")) {\n      var _this$responder17;\n\n      this.event.preventDefault();\n      return (_this$responder17 = this.responder) === null || _this$responder17 === void 0 ? void 0 : _this$responder17.moveCursorInDirection(\"forward\");\n    }\n  },\n\n  Backspace() {\n    var _this$responder18;\n\n    if ((_this$responder18 = this.responder) !== null && _this$responder18 !== void 0 && _this$responder18.shouldManageDeletingInDirection(\"backward\")) {\n      var _this$delegate14, _this$responder19;\n\n      this.event.preventDefault();\n      (_this$delegate14 = this.delegate) === null || _this$delegate14 === void 0 ? void 0 : _this$delegate14.inputControllerWillPerformTyping();\n      (_this$responder19 = this.responder) === null || _this$responder19 === void 0 ? void 0 : _this$responder19.deleteInDirection(\"backward\");\n      return this.render();\n    }\n  },\n\n  Tab() {\n    var _this$responder20;\n\n    if ((_this$responder20 = this.responder) !== null && _this$responder20 !== void 0 && _this$responder20.canIncreaseNestingLevel()) {\n      var _this$responder21;\n\n      this.event.preventDefault();\n      (_this$responder21 = this.responder) === null || _this$responder21 === void 0 ? void 0 : _this$responder21.increaseNestingLevel();\n      return this.render();\n    }\n  },\n\n  \"Tab+Shift\"() {\n    var _this$responder22;\n\n    if ((_this$responder22 = this.responder) !== null && _this$responder22 !== void 0 && _this$responder22.canDecreaseNestingLevel()) {\n      var _this$responder23;\n\n      this.event.preventDefault();\n      (_this$responder23 = this.responder) === null || _this$responder23 === void 0 ? void 0 : _this$responder23.decreaseNestingLevel();\n      return this.render();\n    }\n  }\n\n});\n\n_defineProperty(Level2InputController, \"inputTypes\", {\n  deleteByComposition() {\n    return this.deleteInDirection(\"backward\", {\n      recordUndoEntry: false\n    });\n  },\n\n  deleteByCut() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteByDrag() {\n    this.event.preventDefault();\n    return this.withTargetDOMRange(function () {\n      var _this$responder24;\n\n      this.deleteByDragRange = (_this$responder24 = this.responder) === null || _this$responder24 === void 0 ? void 0 : _this$responder24.getSelectedRange();\n    });\n  },\n\n  deleteCompositionText() {\n    return this.deleteInDirection(\"backward\", {\n      recordUndoEntry: false\n    });\n  },\n\n  deleteContent() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteContentBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteContentForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  deleteEntireSoftLine() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  deleteHardLineBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteHardLineForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  deleteSoftLineBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteSoftLineForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  deleteWordBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteWordForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  formatBackColor() {\n    return this.activateAttributeIfSupported(\"backgroundColor\", this.event.data);\n  },\n\n  formatBold() {\n    return this.toggleAttributeIfSupported(\"bold\");\n  },\n\n  formatFontColor() {\n    return this.activateAttributeIfSupported(\"color\", this.event.data);\n  },\n\n  formatFontName() {\n    return this.activateAttributeIfSupported(\"font\", this.event.data);\n  },\n\n  formatIndent() {\n    var _this$responder25;\n\n    if ((_this$responder25 = this.responder) !== null && _this$responder25 !== void 0 && _this$responder25.canIncreaseNestingLevel()) {\n      return this.withTargetDOMRange(function () {\n        var _this$responder26;\n\n        return (_this$responder26 = this.responder) === null || _this$responder26 === void 0 ? void 0 : _this$responder26.increaseNestingLevel();\n      });\n    }\n  },\n\n  formatItalic() {\n    return this.toggleAttributeIfSupported(\"italic\");\n  },\n\n  formatJustifyCenter() {\n    return this.toggleAttributeIfSupported(\"justifyCenter\");\n  },\n\n  formatJustifyFull() {\n    return this.toggleAttributeIfSupported(\"justifyFull\");\n  },\n\n  formatJustifyLeft() {\n    return this.toggleAttributeIfSupported(\"justifyLeft\");\n  },\n\n  formatJustifyRight() {\n    return this.toggleAttributeIfSupported(\"justifyRight\");\n  },\n\n  formatOutdent() {\n    var _this$responder27;\n\n    if ((_this$responder27 = this.responder) !== null && _this$responder27 !== void 0 && _this$responder27.canDecreaseNestingLevel()) {\n      return this.withTargetDOMRange(function () {\n        var _this$responder28;\n\n        return (_this$responder28 = this.responder) === null || _this$responder28 === void 0 ? void 0 : _this$responder28.decreaseNestingLevel();\n      });\n    }\n  },\n\n  formatRemove() {\n    this.withTargetDOMRange(function () {\n      for (const attributeName in (_this$responder29 = this.responder) === null || _this$responder29 === void 0 ? void 0 : _this$responder29.getCurrentAttributes()) {\n        var _this$responder29, _this$responder30;\n\n        (_this$responder30 = this.responder) === null || _this$responder30 === void 0 ? void 0 : _this$responder30.removeCurrentAttribute(attributeName);\n      }\n    });\n  },\n\n  formatSetBlockTextDirection() {\n    return this.activateAttributeIfSupported(\"blockDir\", this.event.data);\n  },\n\n  formatSetInlineTextDirection() {\n    return this.activateAttributeIfSupported(\"textDir\", this.event.data);\n  },\n\n  formatStrikeThrough() {\n    return this.toggleAttributeIfSupported(\"strike\");\n  },\n\n  formatSubscript() {\n    return this.toggleAttributeIfSupported(\"sub\");\n  },\n\n  formatSuperscript() {\n    return this.toggleAttributeIfSupported(\"sup\");\n  },\n\n  formatUnderline() {\n    return this.toggleAttributeIfSupported(\"underline\");\n  },\n\n  historyRedo() {\n    var _this$delegate15;\n\n    return (_this$delegate15 = this.delegate) === null || _this$delegate15 === void 0 ? void 0 : _this$delegate15.inputControllerWillPerformRedo();\n  },\n\n  historyUndo() {\n    var _this$delegate16;\n\n    return (_this$delegate16 = this.delegate) === null || _this$delegate16 === void 0 ? void 0 : _this$delegate16.inputControllerWillPerformUndo();\n  },\n\n  insertCompositionText() {\n    this.composing = true;\n    return this.insertString(this.event.data);\n  },\n\n  insertFromComposition() {\n    this.composing = false;\n    return this.insertString(this.event.data);\n  },\n\n  insertFromDrop() {\n    const range = this.deleteByDragRange;\n\n    if (range) {\n      var _this$delegate17;\n\n      this.deleteByDragRange = null;\n      (_this$delegate17 = this.delegate) === null || _this$delegate17 === void 0 ? void 0 : _this$delegate17.inputControllerWillMoveText();\n      return this.withTargetDOMRange(function () {\n        var _this$responder31;\n\n        return (_this$responder31 = this.responder) === null || _this$responder31 === void 0 ? void 0 : _this$responder31.moveTextFromRange(range);\n      });\n    }\n  },\n\n  insertFromPaste() {\n    var _dataTransfer$files;\n\n    const {\n      dataTransfer\n    } = this.event;\n    const paste = {\n      dataTransfer\n    };\n    const href = dataTransfer.getData(\"URL\");\n    const html = dataTransfer.getData(\"text/html\");\n\n    if (href) {\n      var _this$delegate18;\n\n      let string;\n      this.event.preventDefault();\n      paste.type = \"text/html\";\n      const name = dataTransfer.getData(\"public.url-name\");\n\n      if (name) {\n        string = squishBreakableWhitespace(name).trim();\n      } else {\n        string = href;\n      }\n\n      paste.html = this.createLinkHTML(href, string);\n      (_this$delegate18 = this.delegate) === null || _this$delegate18 === void 0 ? void 0 : _this$delegate18.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder32;\n\n        return (_this$responder32 = this.responder) === null || _this$responder32 === void 0 ? void 0 : _this$responder32.insertHTML(paste.html);\n      });\n\n      this.afterRender = () => {\n        var _this$delegate19;\n\n        return (_this$delegate19 = this.delegate) === null || _this$delegate19 === void 0 ? void 0 : _this$delegate19.inputControllerDidPaste(paste);\n      };\n    } else if (dataTransferIsPlainText(dataTransfer)) {\n      var _this$delegate20;\n\n      paste.type = \"text/plain\";\n      paste.string = dataTransfer.getData(\"text/plain\");\n      (_this$delegate20 = this.delegate) === null || _this$delegate20 === void 0 ? void 0 : _this$delegate20.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder33;\n\n        return (_this$responder33 = this.responder) === null || _this$responder33 === void 0 ? void 0 : _this$responder33.insertString(paste.string);\n      });\n\n      this.afterRender = () => {\n        var _this$delegate21;\n\n        return (_this$delegate21 = this.delegate) === null || _this$delegate21 === void 0 ? void 0 : _this$delegate21.inputControllerDidPaste(paste);\n      };\n    } else if (html) {\n      var _this$delegate22;\n\n      this.event.preventDefault();\n      paste.type = \"text/html\";\n      paste.html = html;\n      (_this$delegate22 = this.delegate) === null || _this$delegate22 === void 0 ? void 0 : _this$delegate22.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder34;\n\n        return (_this$responder34 = this.responder) === null || _this$responder34 === void 0 ? void 0 : _this$responder34.insertHTML(paste.html);\n      });\n\n      this.afterRender = () => {\n        var _this$delegate23;\n\n        return (_this$delegate23 = this.delegate) === null || _this$delegate23 === void 0 ? void 0 : _this$delegate23.inputControllerDidPaste(paste);\n      };\n    } else if ((_dataTransfer$files = dataTransfer.files) !== null && _dataTransfer$files !== void 0 && _dataTransfer$files.length) {\n      var _this$delegate24;\n\n      paste.type = \"File\";\n      paste.file = dataTransfer.files[0];\n      (_this$delegate24 = this.delegate) === null || _this$delegate24 === void 0 ? void 0 : _this$delegate24.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder35;\n\n        return (_this$responder35 = this.responder) === null || _this$responder35 === void 0 ? void 0 : _this$responder35.insertFile(paste.file);\n      });\n\n      this.afterRender = () => {\n        var _this$delegate25;\n\n        return (_this$delegate25 = this.delegate) === null || _this$delegate25 === void 0 ? void 0 : _this$delegate25.inputControllerDidPaste(paste);\n      };\n    }\n  },\n\n  insertFromYank() {\n    return this.insertString(this.event.data);\n  },\n\n  insertLineBreak() {\n    return this.insertString(\"\\n\");\n  },\n\n  insertLink() {\n    return this.activateAttributeIfSupported(\"href\", this.event.data);\n  },\n\n  insertOrderedList() {\n    return this.toggleAttributeIfSupported(\"number\");\n  },\n\n  insertParagraph() {\n    var _this$delegate26;\n\n    (_this$delegate26 = this.delegate) === null || _this$delegate26 === void 0 ? void 0 : _this$delegate26.inputControllerWillPerformTyping();\n    return this.withTargetDOMRange(function () {\n      var _this$responder36;\n\n      return (_this$responder36 = this.responder) === null || _this$responder36 === void 0 ? void 0 : _this$responder36.insertLineBreak();\n    });\n  },\n\n  insertReplacementText() {\n    return this.insertString(this.event.dataTransfer.getData(\"text/plain\"), {\n      updatePosition: false\n    });\n  },\n\n  insertText() {\n    var _this$event$dataTrans;\n\n    return this.insertString(this.event.data || ((_this$event$dataTrans = this.event.dataTransfer) === null || _this$event$dataTrans === void 0 ? void 0 : _this$event$dataTrans.getData(\"text/plain\")));\n  },\n\n  insertTranspose() {\n    return this.insertString(this.event.data);\n  },\n\n  insertUnorderedList() {\n    return this.toggleAttributeIfSupported(\"bullet\");\n  }\n\n});\n\nconst staticRangeToRange = function (staticRange) {\n  const range = document.createRange();\n  range.setStart(staticRange.startContainer, staticRange.startOffset);\n  range.setEnd(staticRange.endContainer, staticRange.endOffset);\n  return range;\n}; // Event helpers\n\n\nconst dragEventHasFiles = event => {\n  var _event$dataTransfer;\n\n  return Array.from(((_event$dataTransfer = event.dataTransfer) === null || _event$dataTransfer === void 0 ? void 0 : _event$dataTransfer.types) || []).includes(\"Files\");\n};\n\nconst pasteEventHasFilesOnly = function (event) {\n  const clipboard = event.clipboardData;\n\n  if (clipboard) {\n    return clipboard.types.includes(\"Files\") && clipboard.types.length === 1 && clipboard.files.length >= 1;\n  }\n};\n\nconst pasteEventHasPlainTextOnly = function (event) {\n  const clipboard = event.clipboardData;\n\n  if (clipboard) {\n    return clipboard.types.includes(\"text/plain\") && clipboard.types.length === 1;\n  }\n};\n\nconst keyboardCommandFromKeyEvent = function (event) {\n  const command = [];\n\n  if (event.altKey) {\n    command.push(\"alt\");\n  }\n\n  if (event.shiftKey) {\n    command.push(\"shift\");\n  }\n\n  command.push(event.key);\n  return command;\n};\n\nconst pointFromEvent = event => ({\n  x: event.clientX,\n  y: event.clientY\n});\n\nconst {\n  lang,\n  css,\n  keyNames\n} = config;\n\nconst undoable = function (fn) {\n  return function () {\n    const commands = fn.apply(this, arguments);\n    commands.do();\n\n    if (!this.undos) {\n      this.undos = [];\n    }\n\n    this.undos.push(commands.undo);\n  };\n};\n\nclass AttachmentEditorController extends BasicObject {\n  constructor(attachmentPiece, _element, container) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    super(...arguments);\n\n    _defineProperty(this, \"makeElementMutable\", undoable(() => {\n      return {\n        do: () => {\n          this.element.dataset.trixMutable = true;\n        },\n        undo: () => delete this.element.dataset.trixMutable\n      };\n    }));\n\n    _defineProperty(this, \"addToolbar\", undoable(() => {\n      // <div class=\"#{css.attachmentMetadataContainer}\" data-trix-mutable=\"true\">\n      //   <div class=\"trix-button-row\">\n      //     <span class=\"trix-button-group trix-button-group--actions\">\n      //       <button type=\"button\" class=\"trix-button trix-button--remove\" title=\"#{lang.remove}\" data-trix-action=\"remove\">#{lang.remove}</button>\n      //     </span>\n      //   </div>\n      // </div>\n      const element = makeElement({\n        tagName: \"div\",\n        className: css.attachmentToolbar,\n        data: {\n          trixMutable: true\n        },\n        childNodes: makeElement({\n          tagName: \"div\",\n          className: \"trix-button-row\",\n          childNodes: makeElement({\n            tagName: \"span\",\n            className: \"trix-button-group trix-button-group--actions\",\n            childNodes: makeElement({\n              tagName: \"button\",\n              className: \"trix-button trix-button--remove\",\n              textContent: lang.remove,\n              attributes: {\n                title: lang.remove\n              },\n              data: {\n                trixAction: \"remove\"\n              }\n            })\n          })\n        })\n      });\n\n      if (this.attachment.isPreviewable()) {\n        // <div class=\"#{css.attachmentMetadataContainer}\">\n        //   <span class=\"#{css.attachmentMetadata}\">\n        //     <span class=\"#{css.attachmentName}\" title=\"#{name}\">#{name}</span>\n        //     <span class=\"#{css.attachmentSize}\">#{size}</span>\n        //   </span>\n        // </div>\n        element.appendChild(makeElement({\n          tagName: \"div\",\n          className: css.attachmentMetadataContainer,\n          childNodes: makeElement({\n            tagName: \"span\",\n            className: css.attachmentMetadata,\n            childNodes: [makeElement({\n              tagName: \"span\",\n              className: css.attachmentName,\n              textContent: this.attachment.getFilename(),\n              attributes: {\n                title: this.attachment.getFilename()\n              }\n            }), makeElement({\n              tagName: \"span\",\n              className: css.attachmentSize,\n              textContent: this.attachment.getFormattedFilesize()\n            })]\n          })\n        }));\n      }\n\n      handleEvent(\"click\", {\n        onElement: element,\n        withCallback: this.didClickToolbar\n      });\n      handleEvent(\"click\", {\n        onElement: element,\n        matchingSelector: \"[data-trix-action]\",\n        withCallback: this.didClickActionButton\n      });\n      return {\n        do: () => this.element.appendChild(element),\n        undo: () => removeNode(element)\n      };\n    }));\n\n    _defineProperty(this, \"installCaptionEditor\", undoable(() => {\n      const textarea = makeElement({\n        tagName: \"textarea\",\n        className: css.attachmentCaptionEditor,\n        attributes: {\n          placeholder: lang.captionPlaceholder\n        },\n        data: {\n          trixMutable: true\n        }\n      });\n      textarea.value = this.attachmentPiece.getCaption();\n      const textareaClone = textarea.cloneNode();\n      textareaClone.classList.add(\"trix-autoresize-clone\");\n      textareaClone.tabIndex = -1;\n\n      const autoresize = function () {\n        textareaClone.value = textarea.value;\n        textarea.style.height = textareaClone.scrollHeight + \"px\";\n      };\n\n      handleEvent(\"input\", {\n        onElement: textarea,\n        withCallback: autoresize\n      });\n      handleEvent(\"input\", {\n        onElement: textarea,\n        withCallback: this.didInputCaption\n      });\n      handleEvent(\"keydown\", {\n        onElement: textarea,\n        withCallback: this.didKeyDownCaption\n      });\n      handleEvent(\"change\", {\n        onElement: textarea,\n        withCallback: this.didChangeCaption\n      });\n      handleEvent(\"blur\", {\n        onElement: textarea,\n        withCallback: this.didBlurCaption\n      });\n      const figcaption = this.element.querySelector(\"figcaption\");\n      const editingFigcaption = figcaption.cloneNode();\n      return {\n        do: () => {\n          figcaption.style.display = \"none\";\n          editingFigcaption.appendChild(textarea);\n          editingFigcaption.appendChild(textareaClone);\n          editingFigcaption.classList.add(\"\".concat(css.attachmentCaption, \"--editing\"));\n          figcaption.parentElement.insertBefore(editingFigcaption, figcaption);\n          autoresize();\n\n          if (this.options.editCaption) {\n            return defer(() => textarea.focus());\n          }\n        },\n\n        undo() {\n          removeNode(editingFigcaption);\n          figcaption.style.display = null;\n        }\n\n      };\n    }));\n\n    this.didClickToolbar = this.didClickToolbar.bind(this);\n    this.didClickActionButton = this.didClickActionButton.bind(this);\n    this.didKeyDownCaption = this.didKeyDownCaption.bind(this);\n    this.didInputCaption = this.didInputCaption.bind(this);\n    this.didChangeCaption = this.didChangeCaption.bind(this);\n    this.didBlurCaption = this.didBlurCaption.bind(this);\n    this.attachmentPiece = attachmentPiece;\n    this.element = _element;\n    this.container = container;\n    this.options = options;\n    this.attachment = this.attachmentPiece.attachment;\n\n    if (tagName(this.element) === \"a\") {\n      this.element = this.element.firstChild;\n    }\n\n    this.install();\n  }\n\n  install() {\n    this.makeElementMutable();\n    this.addToolbar();\n\n    if (this.attachment.isPreviewable()) {\n      this.installCaptionEditor();\n    }\n  }\n\n  uninstall() {\n    var _this$delegate;\n\n    let undo = this.undos.pop();\n    this.savePendingCaption();\n\n    while (undo) {\n      undo();\n      undo = this.undos.pop();\n    }\n\n    (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : _this$delegate.didUninstallAttachmentEditor(this);\n  } // Private\n\n\n  savePendingCaption() {\n    if (this.pendingCaption) {\n      const caption = this.pendingCaption;\n      this.pendingCaption = null;\n\n      if (caption) {\n        var _this$delegate2, _this$delegate2$attac;\n\n        (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$attac = _this$delegate2.attachmentEditorDidRequestUpdatingAttributesForAttachment) === null || _this$delegate2$attac === void 0 ? void 0 : _this$delegate2$attac.call(_this$delegate2, {\n          caption\n        }, this.attachment);\n      } else {\n        var _this$delegate3, _this$delegate3$attac;\n\n        (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : (_this$delegate3$attac = _this$delegate3.attachmentEditorDidRequestRemovingAttributeForAttachment) === null || _this$delegate3$attac === void 0 ? void 0 : _this$delegate3$attac.call(_this$delegate3, \"caption\", this.attachment);\n      }\n    }\n  } // Installing and uninstalling\n  // Event handlers\n\n\n  didClickToolbar(event) {\n    event.preventDefault();\n    return event.stopPropagation();\n  }\n\n  didClickActionButton(event) {\n    var _this$delegate4;\n\n    const action = event.target.getAttribute(\"data-trix-action\");\n\n    switch (action) {\n      case \"remove\":\n        return (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.attachmentEditorDidRequestRemovalOfAttachment(this.attachment);\n    }\n  }\n\n  didKeyDownCaption(event) {\n    if (keyNames[event.keyCode] === \"return\") {\n      var _this$delegate5, _this$delegate5$attac;\n\n      event.preventDefault();\n      this.savePendingCaption();\n      return (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : (_this$delegate5$attac = _this$delegate5.attachmentEditorDidRequestDeselectingAttachment) === null || _this$delegate5$attac === void 0 ? void 0 : _this$delegate5$attac.call(_this$delegate5, this.attachment);\n    }\n  }\n\n  didInputCaption(event) {\n    this.pendingCaption = event.target.value.replace(/\\s/g, \" \").trim();\n  }\n\n  didChangeCaption(event) {\n    return this.savePendingCaption();\n  }\n\n  didBlurCaption(event) {\n    return this.savePendingCaption();\n  }\n\n}\n\nclass CompositionController extends BasicObject {\n  constructor(element, composition) {\n    super(...arguments);\n    this.didFocus = this.didFocus.bind(this);\n    this.didBlur = this.didBlur.bind(this);\n    this.didClickAttachment = this.didClickAttachment.bind(this);\n    this.element = element;\n    this.composition = composition;\n    this.documentView = new DocumentView(this.composition.document, {\n      element: this.element\n    });\n    handleEvent(\"focus\", {\n      onElement: this.element,\n      withCallback: this.didFocus\n    });\n    handleEvent(\"blur\", {\n      onElement: this.element,\n      withCallback: this.didBlur\n    });\n    handleEvent(\"click\", {\n      onElement: this.element,\n      matchingSelector: \"a[contenteditable=false]\",\n      preventDefault: true\n    });\n    handleEvent(\"mousedown\", {\n      onElement: this.element,\n      matchingSelector: attachmentSelector,\n      withCallback: this.didClickAttachment\n    });\n    handleEvent(\"click\", {\n      onElement: this.element,\n      matchingSelector: \"a\".concat(attachmentSelector),\n      preventDefault: true\n    });\n  }\n\n  didFocus(event) {\n    var _this$blurPromise;\n\n    const perform = () => {\n      if (!this.focused) {\n        var _this$delegate, _this$delegate$compos;\n\n        this.focused = true;\n        return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$compos = _this$delegate.compositionControllerDidFocus) === null || _this$delegate$compos === void 0 ? void 0 : _this$delegate$compos.call(_this$delegate);\n      }\n    };\n\n    return ((_this$blurPromise = this.blurPromise) === null || _this$blurPromise === void 0 ? void 0 : _this$blurPromise.then(perform)) || perform();\n  }\n\n  didBlur(event) {\n    this.blurPromise = new Promise(resolve => {\n      return defer(() => {\n        if (!innerElementIsActive(this.element)) {\n          var _this$delegate2, _this$delegate2$compo;\n\n          this.focused = null;\n          (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$compo = _this$delegate2.compositionControllerDidBlur) === null || _this$delegate2$compo === void 0 ? void 0 : _this$delegate2$compo.call(_this$delegate2);\n        }\n\n        this.blurPromise = null;\n        return resolve();\n      });\n    });\n  }\n\n  didClickAttachment(event, target) {\n    var _this$delegate3, _this$delegate3$compo;\n\n    const attachment = this.findAttachmentForElement(target);\n    const editCaption = !!findClosestElementFromNode(event.target, {\n      matchingSelector: \"figcaption\"\n    });\n    return (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : (_this$delegate3$compo = _this$delegate3.compositionControllerDidSelectAttachment) === null || _this$delegate3$compo === void 0 ? void 0 : _this$delegate3$compo.call(_this$delegate3, attachment, {\n      editCaption\n    });\n  }\n\n  getSerializableElement() {\n    if (this.isEditingAttachment()) {\n      return this.documentView.shadowElement;\n    } else {\n      return this.element;\n    }\n  }\n\n  render() {\n    var _this$delegate6, _this$delegate6$compo;\n\n    if (this.revision !== this.composition.revision) {\n      this.documentView.setDocument(this.composition.document);\n      this.documentView.render();\n      this.revision = this.composition.revision;\n    }\n\n    if (this.canSyncDocumentView() && !this.documentView.isSynced()) {\n      var _this$delegate4, _this$delegate4$compo, _this$delegate5, _this$delegate5$compo;\n\n      (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : (_this$delegate4$compo = _this$delegate4.compositionControllerWillSyncDocumentView) === null || _this$delegate4$compo === void 0 ? void 0 : _this$delegate4$compo.call(_this$delegate4);\n      this.documentView.sync();\n      (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : (_this$delegate5$compo = _this$delegate5.compositionControllerDidSyncDocumentView) === null || _this$delegate5$compo === void 0 ? void 0 : _this$delegate5$compo.call(_this$delegate5);\n    }\n\n    return (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : (_this$delegate6$compo = _this$delegate6.compositionControllerDidRender) === null || _this$delegate6$compo === void 0 ? void 0 : _this$delegate6$compo.call(_this$delegate6);\n  }\n\n  rerenderViewForObject(object) {\n    this.invalidateViewForObject(object);\n    return this.render();\n  }\n\n  invalidateViewForObject(object) {\n    return this.documentView.invalidateViewForObject(object);\n  }\n\n  isViewCachingEnabled() {\n    return this.documentView.isViewCachingEnabled();\n  }\n\n  enableViewCaching() {\n    return this.documentView.enableViewCaching();\n  }\n\n  disableViewCaching() {\n    return this.documentView.disableViewCaching();\n  }\n\n  refreshViewCache() {\n    return this.documentView.garbageCollectCachedViews();\n  } // Attachment editor management\n\n\n  isEditingAttachment() {\n    return !!this.attachmentEditor;\n  }\n\n  installAttachmentEditorForAttachment(attachment, options) {\n    var _this$attachmentEdito;\n\n    if (((_this$attachmentEdito = this.attachmentEditor) === null || _this$attachmentEdito === void 0 ? void 0 : _this$attachmentEdito.attachment) === attachment) return;\n    const element = this.documentView.findElementForObject(attachment);\n    if (!element) return;\n    this.uninstallAttachmentEditor();\n    const attachmentPiece = this.composition.document.getAttachmentPieceForAttachment(attachment);\n    this.attachmentEditor = new AttachmentEditorController(attachmentPiece, element, this.element, options);\n    this.attachmentEditor.delegate = this;\n  }\n\n  uninstallAttachmentEditor() {\n    var _this$attachmentEdito2;\n\n    return (_this$attachmentEdito2 = this.attachmentEditor) === null || _this$attachmentEdito2 === void 0 ? void 0 : _this$attachmentEdito2.uninstall();\n  } // Attachment controller delegate\n\n\n  didUninstallAttachmentEditor() {\n    this.attachmentEditor = null;\n    return this.render();\n  }\n\n  attachmentEditorDidRequestUpdatingAttributesForAttachment(attributes, attachment) {\n    var _this$delegate7, _this$delegate7$compo;\n\n    (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : (_this$delegate7$compo = _this$delegate7.compositionControllerWillUpdateAttachment) === null || _this$delegate7$compo === void 0 ? void 0 : _this$delegate7$compo.call(_this$delegate7, attachment);\n    return this.composition.updateAttributesForAttachment(attributes, attachment);\n  }\n\n  attachmentEditorDidRequestRemovingAttributeForAttachment(attribute, attachment) {\n    var _this$delegate8, _this$delegate8$compo;\n\n    (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : (_this$delegate8$compo = _this$delegate8.compositionControllerWillUpdateAttachment) === null || _this$delegate8$compo === void 0 ? void 0 : _this$delegate8$compo.call(_this$delegate8, attachment);\n    return this.composition.removeAttributeForAttachment(attribute, attachment);\n  }\n\n  attachmentEditorDidRequestRemovalOfAttachment(attachment) {\n    var _this$delegate9, _this$delegate9$compo;\n\n    return (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : (_this$delegate9$compo = _this$delegate9.compositionControllerDidRequestRemovalOfAttachment) === null || _this$delegate9$compo === void 0 ? void 0 : _this$delegate9$compo.call(_this$delegate9, attachment);\n  }\n\n  attachmentEditorDidRequestDeselectingAttachment(attachment) {\n    var _this$delegate10, _this$delegate10$comp;\n\n    return (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : (_this$delegate10$comp = _this$delegate10.compositionControllerDidRequestDeselectingAttachment) === null || _this$delegate10$comp === void 0 ? void 0 : _this$delegate10$comp.call(_this$delegate10, attachment);\n  } // Private\n\n\n  canSyncDocumentView() {\n    return !this.isEditingAttachment();\n  }\n\n  findAttachmentForElement(element) {\n    return this.composition.document.getAttachmentById(parseInt(element.dataset.trixId, 10));\n  }\n\n}\n\nconst attributeButtonSelector = \"[data-trix-attribute]\";\nconst actionButtonSelector = \"[data-trix-action]\";\nconst toolbarButtonSelector = \"\".concat(attributeButtonSelector, \", \").concat(actionButtonSelector);\nconst dialogSelector = \"[data-trix-dialog]\";\nconst activeDialogSelector = \"\".concat(dialogSelector, \"[data-trix-active]\");\nconst dialogButtonSelector = \"\".concat(dialogSelector, \" [data-trix-method]\");\nconst dialogInputSelector = \"\".concat(dialogSelector, \" [data-trix-input]\");\n\nconst getInputForDialog = (element, attributeName) => {\n  if (!attributeName) {\n    attributeName = getAttributeName(element);\n  }\n\n  return element.querySelector(\"[data-trix-input][name='\".concat(attributeName, \"']\"));\n};\n\nconst getActionName = element => element.getAttribute(\"data-trix-action\");\n\nconst getAttributeName = element => {\n  return element.getAttribute(\"data-trix-attribute\") || element.getAttribute(\"data-trix-dialog-attribute\");\n};\n\nconst getDialogName = element => element.getAttribute(\"data-trix-dialog\");\n\nclass ToolbarController extends BasicObject {\n  constructor(element) {\n    super(element);\n    this.didClickActionButton = this.didClickActionButton.bind(this);\n    this.didClickAttributeButton = this.didClickAttributeButton.bind(this);\n    this.didClickDialogButton = this.didClickDialogButton.bind(this);\n    this.didKeyDownDialogInput = this.didKeyDownDialogInput.bind(this);\n    this.element = element;\n    this.attributes = {};\n    this.actions = {};\n    this.resetDialogInputs();\n    handleEvent(\"mousedown\", {\n      onElement: this.element,\n      matchingSelector: actionButtonSelector,\n      withCallback: this.didClickActionButton\n    });\n    handleEvent(\"mousedown\", {\n      onElement: this.element,\n      matchingSelector: attributeButtonSelector,\n      withCallback: this.didClickAttributeButton\n    });\n    handleEvent(\"click\", {\n      onElement: this.element,\n      matchingSelector: toolbarButtonSelector,\n      preventDefault: true\n    });\n    handleEvent(\"click\", {\n      onElement: this.element,\n      matchingSelector: dialogButtonSelector,\n      withCallback: this.didClickDialogButton\n    });\n    handleEvent(\"keydown\", {\n      onElement: this.element,\n      matchingSelector: dialogInputSelector,\n      withCallback: this.didKeyDownDialogInput\n    });\n  } // Event handlers\n\n\n  didClickActionButton(event, element) {\n    var _this$delegate;\n\n    (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : _this$delegate.toolbarDidClickButton();\n    event.preventDefault();\n    const actionName = getActionName(element);\n\n    if (this.getDialog(actionName)) {\n      return this.toggleDialog(actionName);\n    } else {\n      var _this$delegate2;\n\n      return (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : _this$delegate2.toolbarDidInvokeAction(actionName);\n    }\n  }\n\n  didClickAttributeButton(event, element) {\n    var _this$delegate3;\n\n    (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : _this$delegate3.toolbarDidClickButton();\n    event.preventDefault();\n    const attributeName = getAttributeName(element);\n\n    if (this.getDialog(attributeName)) {\n      this.toggleDialog(attributeName);\n    } else {\n      var _this$delegate4;\n\n      (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.toolbarDidToggleAttribute(attributeName);\n    }\n\n    return this.refreshAttributeButtons();\n  }\n\n  didClickDialogButton(event, element) {\n    const dialogElement = findClosestElementFromNode(element, {\n      matchingSelector: dialogSelector\n    });\n    const method = element.getAttribute(\"data-trix-method\");\n    return this[method].call(this, dialogElement);\n  }\n\n  didKeyDownDialogInput(event, element) {\n    if (event.keyCode === 13) {\n      // Enter key\n      event.preventDefault();\n      const attribute = element.getAttribute(\"name\");\n      const dialog = this.getDialog(attribute);\n      this.setAttribute(dialog);\n    }\n\n    if (event.keyCode === 27) {\n      // Escape key\n      event.preventDefault();\n      return this.hideDialog();\n    }\n  } // Action buttons\n\n\n  updateActions(actions) {\n    this.actions = actions;\n    return this.refreshActionButtons();\n  }\n\n  refreshActionButtons() {\n    return this.eachActionButton((element, actionName) => {\n      element.disabled = this.actions[actionName] === false;\n    });\n  }\n\n  eachActionButton(callback) {\n    return Array.from(this.element.querySelectorAll(actionButtonSelector)).map(element => callback(element, getActionName(element)));\n  } // Attribute buttons\n\n\n  updateAttributes(attributes) {\n    this.attributes = attributes;\n    return this.refreshAttributeButtons();\n  }\n\n  refreshAttributeButtons() {\n    return this.eachAttributeButton((element, attributeName) => {\n      element.disabled = this.attributes[attributeName] === false;\n\n      if (this.attributes[attributeName] || this.dialogIsVisible(attributeName)) {\n        element.setAttribute(\"data-trix-active\", \"\");\n        return element.classList.add(\"trix-active\");\n      } else {\n        element.removeAttribute(\"data-trix-active\");\n        return element.classList.remove(\"trix-active\");\n      }\n    });\n  }\n\n  eachAttributeButton(callback) {\n    return Array.from(this.element.querySelectorAll(attributeButtonSelector)).map(element => callback(element, getAttributeName(element)));\n  }\n\n  applyKeyboardCommand(keys) {\n    const keyString = JSON.stringify(keys.sort());\n\n    for (const button of Array.from(this.element.querySelectorAll(\"[data-trix-key]\"))) {\n      const buttonKeys = button.getAttribute(\"data-trix-key\").split(\"+\");\n      const buttonKeyString = JSON.stringify(buttonKeys.sort());\n\n      if (buttonKeyString === keyString) {\n        triggerEvent(\"mousedown\", {\n          onElement: button\n        });\n        return true;\n      }\n    }\n\n    return false;\n  } // Dialogs\n\n\n  dialogIsVisible(dialogName) {\n    const element = this.getDialog(dialogName);\n\n    if (element) {\n      return element.hasAttribute(\"data-trix-active\");\n    }\n  }\n\n  toggleDialog(dialogName) {\n    if (this.dialogIsVisible(dialogName)) {\n      return this.hideDialog();\n    } else {\n      return this.showDialog(dialogName);\n    }\n  }\n\n  showDialog(dialogName) {\n    var _this$delegate5, _this$delegate6;\n\n    this.hideDialog();\n    (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.toolbarWillShowDialog();\n    const element = this.getDialog(dialogName);\n    element.setAttribute(\"data-trix-active\", \"\");\n    element.classList.add(\"trix-active\");\n    Array.from(element.querySelectorAll(\"input[disabled]\")).forEach(disabledInput => {\n      disabledInput.removeAttribute(\"disabled\");\n    });\n    const attributeName = getAttributeName(element);\n\n    if (attributeName) {\n      const input = getInputForDialog(element, dialogName);\n\n      if (input) {\n        input.value = this.attributes[attributeName] || \"\";\n        input.select();\n      }\n    }\n\n    return (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : _this$delegate6.toolbarDidShowDialog(dialogName);\n  }\n\n  setAttribute(dialogElement) {\n    const attributeName = getAttributeName(dialogElement);\n    const input = getInputForDialog(dialogElement, attributeName);\n\n    if (input.willValidate && !input.checkValidity()) {\n      input.setAttribute(\"data-trix-validate\", \"\");\n      input.classList.add(\"trix-validate\");\n      return input.focus();\n    } else {\n      var _this$delegate7;\n\n      (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : _this$delegate7.toolbarDidUpdateAttribute(attributeName, input.value);\n      return this.hideDialog();\n    }\n  }\n\n  removeAttribute(dialogElement) {\n    var _this$delegate8;\n\n    const attributeName = getAttributeName(dialogElement);\n    (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : _this$delegate8.toolbarDidRemoveAttribute(attributeName);\n    return this.hideDialog();\n  }\n\n  hideDialog() {\n    const element = this.element.querySelector(activeDialogSelector);\n\n    if (element) {\n      var _this$delegate9;\n\n      element.removeAttribute(\"data-trix-active\");\n      element.classList.remove(\"trix-active\");\n      this.resetDialogInputs();\n      return (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : _this$delegate9.toolbarDidHideDialog(getDialogName(element));\n    }\n  }\n\n  resetDialogInputs() {\n    Array.from(this.element.querySelectorAll(dialogInputSelector)).forEach(input => {\n      input.setAttribute(\"disabled\", \"disabled\");\n      input.removeAttribute(\"data-trix-validate\");\n      input.classList.remove(\"trix-validate\");\n    });\n  }\n\n  getDialog(dialogName) {\n    return this.element.querySelector(\"[data-trix-dialog=\".concat(dialogName, \"]\"));\n  }\n\n}\n\nconst snapshotsAreEqual = (a, b) => rangesAreEqual(a.selectedRange, b.selectedRange) && a.document.isEqualTo(b.document);\n\nclass EditorController extends Controller {\n  constructor(_ref) {\n    let {\n      editorElement,\n      document,\n      html\n    } = _ref;\n    super(...arguments);\n    this.editorElement = editorElement;\n    this.selectionManager = new SelectionManager(this.editorElement);\n    this.selectionManager.delegate = this;\n    this.composition = new Composition();\n    this.composition.delegate = this;\n    this.attachmentManager = new AttachmentManager(this.composition.getAttachments());\n    this.attachmentManager.delegate = this;\n    this.inputController = config.input.getLevel() === 2 ? new Level2InputController(this.editorElement) : new Level0InputController(this.editorElement);\n    this.inputController.delegate = this;\n    this.inputController.responder = this.composition;\n    this.compositionController = new CompositionController(this.editorElement, this.composition);\n    this.compositionController.delegate = this;\n    this.toolbarController = new ToolbarController(this.editorElement.toolbarElement);\n    this.toolbarController.delegate = this;\n    this.editor = new Editor(this.composition, this.selectionManager, this.editorElement);\n\n    if (document) {\n      this.editor.loadDocument(document);\n    } else {\n      this.editor.loadHTML(html);\n    }\n  }\n\n  registerSelectionManager() {\n    return selectionChangeObserver.registerSelectionManager(this.selectionManager);\n  }\n\n  unregisterSelectionManager() {\n    return selectionChangeObserver.unregisterSelectionManager(this.selectionManager);\n  }\n\n  render() {\n    return this.compositionController.render();\n  }\n\n  reparse() {\n    return this.composition.replaceHTML(this.editorElement.innerHTML);\n  } // Composition delegate\n\n\n  compositionDidChangeDocument(document) {\n    this.notifyEditorElement(\"document-change\");\n\n    if (!this.handlingInput) {\n      return this.render();\n    }\n  }\n\n  compositionDidChangeCurrentAttributes(currentAttributes) {\n    this.currentAttributes = currentAttributes;\n    this.toolbarController.updateAttributes(this.currentAttributes);\n    this.updateCurrentActions();\n    return this.notifyEditorElement(\"attributes-change\", {\n      attributes: this.currentAttributes\n    });\n  }\n\n  compositionDidPerformInsertionAtRange(range) {\n    if (this.pasting) {\n      this.pastedRange = range;\n    }\n  }\n\n  compositionShouldAcceptFile(file) {\n    return this.notifyEditorElement(\"file-accept\", {\n      file\n    });\n  }\n\n  compositionDidAddAttachment(attachment) {\n    const managedAttachment = this.attachmentManager.manageAttachment(attachment);\n    return this.notifyEditorElement(\"attachment-add\", {\n      attachment: managedAttachment\n    });\n  }\n\n  compositionDidEditAttachment(attachment) {\n    this.compositionController.rerenderViewForObject(attachment);\n    const managedAttachment = this.attachmentManager.manageAttachment(attachment);\n    this.notifyEditorElement(\"attachment-edit\", {\n      attachment: managedAttachment\n    });\n    return this.notifyEditorElement(\"change\");\n  }\n\n  compositionDidChangeAttachmentPreviewURL(attachment) {\n    this.compositionController.invalidateViewForObject(attachment);\n    return this.notifyEditorElement(\"change\");\n  }\n\n  compositionDidRemoveAttachment(attachment) {\n    const managedAttachment = this.attachmentManager.unmanageAttachment(attachment);\n    return this.notifyEditorElement(\"attachment-remove\", {\n      attachment: managedAttachment\n    });\n  }\n\n  compositionDidStartEditingAttachment(attachment, options) {\n    this.attachmentLocationRange = this.composition.document.getLocationRangeOfAttachment(attachment);\n    this.compositionController.installAttachmentEditorForAttachment(attachment, options);\n    return this.selectionManager.setLocationRange(this.attachmentLocationRange);\n  }\n\n  compositionDidStopEditingAttachment(attachment) {\n    this.compositionController.uninstallAttachmentEditor();\n    this.attachmentLocationRange = null;\n  }\n\n  compositionDidRequestChangingSelectionToLocationRange(locationRange) {\n    if (this.loadingSnapshot && !this.isFocused()) return;\n    this.requestedLocationRange = locationRange;\n    this.compositionRevisionWhenLocationRangeRequested = this.composition.revision;\n\n    if (!this.handlingInput) {\n      return this.render();\n    }\n  }\n\n  compositionWillLoadSnapshot() {\n    this.loadingSnapshot = true;\n  }\n\n  compositionDidLoadSnapshot() {\n    this.compositionController.refreshViewCache();\n    this.render();\n    this.loadingSnapshot = false;\n  }\n\n  getSelectionManager() {\n    return this.selectionManager;\n  } // Attachment manager delegate\n\n\n  attachmentManagerDidRequestRemovalOfAttachment(attachment) {\n    return this.removeAttachment(attachment);\n  } // Document controller delegate\n\n\n  compositionControllerWillSyncDocumentView() {\n    this.inputController.editorWillSyncDocumentView();\n    this.selectionManager.lock();\n    return this.selectionManager.clearSelection();\n  }\n\n  compositionControllerDidSyncDocumentView() {\n    this.inputController.editorDidSyncDocumentView();\n    this.selectionManager.unlock();\n    this.updateCurrentActions();\n    return this.notifyEditorElement(\"sync\");\n  }\n\n  compositionControllerDidRender() {\n    if (this.requestedLocationRange) {\n      if (this.compositionRevisionWhenLocationRangeRequested === this.composition.revision) {\n        this.selectionManager.setLocationRange(this.requestedLocationRange);\n      }\n\n      this.requestedLocationRange = null;\n      this.compositionRevisionWhenLocationRangeRequested = null;\n    }\n\n    if (this.renderedCompositionRevision !== this.composition.revision) {\n      this.runEditorFilters();\n      this.composition.updateCurrentAttributes();\n      this.notifyEditorElement(\"render\");\n    }\n\n    this.renderedCompositionRevision = this.composition.revision;\n  }\n\n  compositionControllerDidFocus() {\n    if (this.isFocusedInvisibly()) {\n      this.setLocationRange({\n        index: 0,\n        offset: 0\n      });\n    }\n\n    this.toolbarController.hideDialog();\n    return this.notifyEditorElement(\"focus\");\n  }\n\n  compositionControllerDidBlur() {\n    return this.notifyEditorElement(\"blur\");\n  }\n\n  compositionControllerDidSelectAttachment(attachment, options) {\n    this.toolbarController.hideDialog();\n    return this.composition.editAttachment(attachment, options);\n  }\n\n  compositionControllerDidRequestDeselectingAttachment(attachment) {\n    const locationRange = this.attachmentLocationRange || this.composition.document.getLocationRangeOfAttachment(attachment);\n    return this.selectionManager.setLocationRange(locationRange[1]);\n  }\n\n  compositionControllerWillUpdateAttachment(attachment) {\n    return this.editor.recordUndoEntry(\"Edit Attachment\", {\n      context: attachment.id,\n      consolidatable: true\n    });\n  }\n\n  compositionControllerDidRequestRemovalOfAttachment(attachment) {\n    return this.removeAttachment(attachment);\n  } // Input controller delegate\n\n\n  inputControllerWillHandleInput() {\n    this.handlingInput = true;\n    this.requestedRender = false;\n  }\n\n  inputControllerDidRequestRender() {\n    this.requestedRender = true;\n  }\n\n  inputControllerDidHandleInput() {\n    this.handlingInput = false;\n\n    if (this.requestedRender) {\n      this.requestedRender = false;\n      return this.render();\n    }\n  }\n\n  inputControllerDidAllowUnhandledInput() {\n    return this.notifyEditorElement(\"change\");\n  }\n\n  inputControllerDidRequestReparse() {\n    return this.reparse();\n  }\n\n  inputControllerWillPerformTyping() {\n    return this.recordTypingUndoEntry();\n  }\n\n  inputControllerWillPerformFormatting(attributeName) {\n    return this.recordFormattingUndoEntry(attributeName);\n  }\n\n  inputControllerWillCutText() {\n    return this.editor.recordUndoEntry(\"Cut\");\n  }\n\n  inputControllerWillPaste(paste) {\n    this.editor.recordUndoEntry(\"Paste\");\n    this.pasting = true;\n    return this.notifyEditorElement(\"before-paste\", {\n      paste\n    });\n  }\n\n  inputControllerDidPaste(paste) {\n    paste.range = this.pastedRange;\n    this.pastedRange = null;\n    this.pasting = null;\n    return this.notifyEditorElement(\"paste\", {\n      paste\n    });\n  }\n\n  inputControllerWillMoveText() {\n    return this.editor.recordUndoEntry(\"Move\");\n  }\n\n  inputControllerWillAttachFiles() {\n    return this.editor.recordUndoEntry(\"Drop Files\");\n  }\n\n  inputControllerWillPerformUndo() {\n    return this.editor.undo();\n  }\n\n  inputControllerWillPerformRedo() {\n    return this.editor.redo();\n  }\n\n  inputControllerDidReceiveKeyboardCommand(keys) {\n    return this.toolbarController.applyKeyboardCommand(keys);\n  }\n\n  inputControllerDidStartDrag() {\n    this.locationRangeBeforeDrag = this.selectionManager.getLocationRange();\n  }\n\n  inputControllerDidReceiveDragOverPoint(point) {\n    return this.selectionManager.setLocationRangeFromPointRange(point);\n  }\n\n  inputControllerDidCancelDrag() {\n    this.selectionManager.setLocationRange(this.locationRangeBeforeDrag);\n    this.locationRangeBeforeDrag = null;\n  } // Selection manager delegate\n\n\n  locationRangeDidChange(locationRange) {\n    this.composition.updateCurrentAttributes();\n    this.updateCurrentActions();\n\n    if (this.attachmentLocationRange && !rangesAreEqual(this.attachmentLocationRange, locationRange)) {\n      this.composition.stopEditingAttachment();\n    }\n\n    return this.notifyEditorElement(\"selection-change\");\n  } // Toolbar controller delegate\n\n\n  toolbarDidClickButton() {\n    if (!this.getLocationRange()) {\n      return this.setLocationRange({\n        index: 0,\n        offset: 0\n      });\n    }\n  }\n\n  toolbarDidInvokeAction(actionName) {\n    return this.invokeAction(actionName);\n  }\n\n  toolbarDidToggleAttribute(attributeName) {\n    this.recordFormattingUndoEntry(attributeName);\n    this.composition.toggleCurrentAttribute(attributeName);\n    this.render();\n\n    if (!this.selectionFrozen) {\n      return this.editorElement.focus();\n    }\n  }\n\n  toolbarDidUpdateAttribute(attributeName, value) {\n    this.recordFormattingUndoEntry(attributeName);\n    this.composition.setCurrentAttribute(attributeName, value);\n    this.render();\n\n    if (!this.selectionFrozen) {\n      return this.editorElement.focus();\n    }\n  }\n\n  toolbarDidRemoveAttribute(attributeName) {\n    this.recordFormattingUndoEntry(attributeName);\n    this.composition.removeCurrentAttribute(attributeName);\n    this.render();\n\n    if (!this.selectionFrozen) {\n      return this.editorElement.focus();\n    }\n  }\n\n  toolbarWillShowDialog(dialogElement) {\n    this.composition.expandSelectionForEditing();\n    return this.freezeSelection();\n  }\n\n  toolbarDidShowDialog(dialogName) {\n    return this.notifyEditorElement(\"toolbar-dialog-show\", {\n      dialogName\n    });\n  }\n\n  toolbarDidHideDialog(dialogName) {\n    this.thawSelection();\n    this.editorElement.focus();\n    return this.notifyEditorElement(\"toolbar-dialog-hide\", {\n      dialogName\n    });\n  } // Selection\n\n\n  freezeSelection() {\n    if (!this.selectionFrozen) {\n      this.selectionManager.lock();\n      this.composition.freezeSelection();\n      this.selectionFrozen = true;\n      return this.render();\n    }\n  }\n\n  thawSelection() {\n    if (this.selectionFrozen) {\n      this.composition.thawSelection();\n      this.selectionManager.unlock();\n      this.selectionFrozen = false;\n      return this.render();\n    }\n  }\n\n  canInvokeAction(actionName) {\n    if (this.actionIsExternal(actionName)) {\n      return true;\n    } else {\n      var _this$actions$actionN, _this$actions$actionN2;\n\n      return !!((_this$actions$actionN = this.actions[actionName]) !== null && _this$actions$actionN !== void 0 && (_this$actions$actionN2 = _this$actions$actionN.test) !== null && _this$actions$actionN2 !== void 0 && _this$actions$actionN2.call(this));\n    }\n  }\n\n  invokeAction(actionName) {\n    if (this.actionIsExternal(actionName)) {\n      return this.notifyEditorElement(\"action-invoke\", {\n        actionName\n      });\n    } else {\n      var _this$actions$actionN3, _this$actions$actionN4;\n\n      return (_this$actions$actionN3 = this.actions[actionName]) === null || _this$actions$actionN3 === void 0 ? void 0 : (_this$actions$actionN4 = _this$actions$actionN3.perform) === null || _this$actions$actionN4 === void 0 ? void 0 : _this$actions$actionN4.call(this);\n    }\n  }\n\n  actionIsExternal(actionName) {\n    return /^x-./.test(actionName);\n  }\n\n  getCurrentActions() {\n    const result = {};\n\n    for (const actionName in this.actions) {\n      result[actionName] = this.canInvokeAction(actionName);\n    }\n\n    return result;\n  }\n\n  updateCurrentActions() {\n    const currentActions = this.getCurrentActions();\n\n    if (!objectsAreEqual(currentActions, this.currentActions)) {\n      this.currentActions = currentActions;\n      this.toolbarController.updateActions(this.currentActions);\n      return this.notifyEditorElement(\"actions-change\", {\n        actions: this.currentActions\n      });\n    }\n  } // Editor filters\n\n\n  runEditorFilters() {\n    let snapshot = this.composition.getSnapshot();\n    Array.from(this.editor.filters).forEach(filter => {\n      const {\n        document,\n        selectedRange\n      } = snapshot;\n      snapshot = filter.call(this.editor, snapshot) || {};\n\n      if (!snapshot.document) {\n        snapshot.document = document;\n      }\n\n      if (!snapshot.selectedRange) {\n        snapshot.selectedRange = selectedRange;\n      }\n    });\n\n    if (!snapshotsAreEqual(snapshot, this.composition.getSnapshot())) {\n      return this.composition.loadSnapshot(snapshot);\n    }\n  } // Private\n\n\n  updateInputElement() {\n    const element = this.compositionController.getSerializableElement();\n    const value = serializeToContentType(element, \"text/html\");\n    return this.editorElement.setInputElementValue(value);\n  }\n\n  notifyEditorElement(message, data) {\n    switch (message) {\n      case \"document-change\":\n        this.documentChangedSinceLastRender = true;\n        break;\n\n      case \"render\":\n        if (this.documentChangedSinceLastRender) {\n          this.documentChangedSinceLastRender = false;\n          this.notifyEditorElement(\"change\");\n        }\n\n        break;\n\n      case \"change\":\n      case \"attachment-add\":\n      case \"attachment-edit\":\n      case \"attachment-remove\":\n        this.updateInputElement();\n        break;\n    }\n\n    return this.editorElement.notify(message, data);\n  }\n\n  removeAttachment(attachment) {\n    this.editor.recordUndoEntry(\"Delete Attachment\");\n    this.composition.removeAttachment(attachment);\n    return this.render();\n  }\n\n  recordFormattingUndoEntry(attributeName) {\n    const blockConfig = getBlockConfig(attributeName);\n    const locationRange = this.selectionManager.getLocationRange();\n\n    if (blockConfig || !rangeIsCollapsed(locationRange)) {\n      return this.editor.recordUndoEntry(\"Formatting\", {\n        context: this.getUndoContext(),\n        consolidatable: true\n      });\n    }\n  }\n\n  recordTypingUndoEntry() {\n    return this.editor.recordUndoEntry(\"Typing\", {\n      context: this.getUndoContext(this.currentAttributes),\n      consolidatable: true\n    });\n  }\n\n  getUndoContext() {\n    for (var _len = arguments.length, context = new Array(_len), _key = 0; _key < _len; _key++) {\n      context[_key] = arguments[_key];\n    }\n\n    return [this.getLocationContext(), this.getTimeContext(), ...Array.from(context)];\n  }\n\n  getLocationContext() {\n    const locationRange = this.selectionManager.getLocationRange();\n\n    if (rangeIsCollapsed(locationRange)) {\n      return locationRange[0].index;\n    } else {\n      return locationRange;\n    }\n  }\n\n  getTimeContext() {\n    if (config.undoInterval > 0) {\n      return Math.floor(new Date().getTime() / config.undoInterval);\n    } else {\n      return 0;\n    }\n  }\n\n  isFocused() {\n    var _this$editorElement$o;\n\n    return this.editorElement === ((_this$editorElement$o = this.editorElement.ownerDocument) === null || _this$editorElement$o === void 0 ? void 0 : _this$editorElement$o.activeElement);\n  } // Detect \"Cursor disappears sporadically\" Firefox bug.\n  // - https://bugzilla.mozilla.org/show_bug.cgi?id=226301\n\n\n  isFocusedInvisibly() {\n    return this.isFocused() && !this.getLocationRange();\n  }\n\n  get actions() {\n    return this.constructor.actions;\n  }\n\n}\n\n_defineProperty(EditorController, \"actions\", {\n  undo: {\n    test() {\n      return this.editor.canUndo();\n    },\n\n    perform() {\n      return this.editor.undo();\n    }\n\n  },\n  redo: {\n    test() {\n      return this.editor.canRedo();\n    },\n\n    perform() {\n      return this.editor.redo();\n    }\n\n  },\n  link: {\n    test() {\n      return this.editor.canActivateAttribute(\"href\");\n    }\n\n  },\n  increaseNestingLevel: {\n    test() {\n      return this.editor.canIncreaseNestingLevel();\n    },\n\n    perform() {\n      return this.editor.increaseNestingLevel() && this.render();\n    }\n\n  },\n  decreaseNestingLevel: {\n    test() {\n      return this.editor.canDecreaseNestingLevel();\n    },\n\n    perform() {\n      return this.editor.decreaseNestingLevel() && this.render();\n    }\n\n  },\n  attachFiles: {\n    test() {\n      return true;\n    },\n\n    perform() {\n      return config.input.pickFiles(this.editor.insertFiles);\n    }\n\n  }\n});\n\nEditorController.proxyMethod(\"getSelectionManager().setLocationRange\");\nEditorController.proxyMethod(\"getSelectionManager().getLocationRange\");\ninstallDefaultCSSForTagName(\"trix-toolbar\", \"%t {\\n  display: block;\\n}\\n\\n%t {\\n  white-space: nowrap;\\n}\\n\\n%t [data-trix-dialog] {\\n  display: none;\\n}\\n\\n%t [data-trix-dialog][data-trix-active] {\\n  display: block;\\n}\\n\\n%t [data-trix-dialog] [data-trix-validate]:invalid {\\n  background-color: #ffdddd;\\n}\");\n\nclass TrixToolbarElement extends HTMLElement {\n  // Element lifecycle\n  connectedCallback() {\n    if (this.innerHTML === \"\") {\n      this.innerHTML = config.toolbar.getDefaultHTML();\n    }\n  }\n\n}\n\nwindow.customElements.define(\"trix-toolbar\", TrixToolbarElement);\nlet id = 0; // Contenteditable support helpers\n\nconst autofocus = function (element) {\n  if (!document.querySelector(\":focus\")) {\n    if (element.hasAttribute(\"autofocus\") && document.querySelector(\"[autofocus]\") === element) {\n      return element.focus();\n    }\n  }\n};\n\nconst makeEditable = function (element) {\n  if (element.hasAttribute(\"contenteditable\")) {\n    return;\n  }\n\n  element.setAttribute(\"contenteditable\", \"\");\n  return handleEventOnce(\"focus\", {\n    onElement: element,\n\n    withCallback() {\n      return configureContentEditable(element);\n    }\n\n  });\n};\n\nconst configureContentEditable = function (element) {\n  disableObjectResizing(element);\n  return setDefaultParagraphSeparator(element);\n};\n\nconst disableObjectResizing = function (element) {\n  var _document$queryComman, _document;\n\n  if ((_document$queryComman = (_document = document).queryCommandSupported) !== null && _document$queryComman !== void 0 && _document$queryComman.call(_document, \"enableObjectResizing\")) {\n    document.execCommand(\"enableObjectResizing\", false, false);\n    return handleEvent(\"mscontrolselect\", {\n      onElement: element,\n      preventDefault: true\n    });\n  }\n};\n\nconst setDefaultParagraphSeparator = function (element) {\n  var _document$queryComman2, _document2;\n\n  if ((_document$queryComman2 = (_document2 = document).queryCommandSupported) !== null && _document$queryComman2 !== void 0 && _document$queryComman2.call(_document2, \"DefaultParagraphSeparator\")) {\n    const {\n      tagName\n    } = config.blockAttributes.default;\n\n    if ([\"div\", \"p\"].includes(tagName)) {\n      return document.execCommand(\"DefaultParagraphSeparator\", false, tagName);\n    }\n  }\n}; // Accessibility helpers\n\n\nconst addAccessibilityRole = function (element) {\n  if (element.hasAttribute(\"role\")) {\n    return;\n  }\n\n  return element.setAttribute(\"role\", \"textbox\");\n};\n\nconst ensureAriaLabel = function (element) {\n  if (element.hasAttribute(\"aria-label\") || element.hasAttribute(\"aria-labelledby\")) {\n    return;\n  }\n\n  const update = function () {\n    const texts = Array.from(element.labels).map(label => {\n      if (!label.contains(element)) return label.textContent;\n    }).filter(text => text);\n    const text = texts.join(\" \");\n\n    if (text) {\n      return element.setAttribute(\"aria-label\", text);\n    } else {\n      return element.removeAttribute(\"aria-label\");\n    }\n  };\n\n  update();\n  return handleEvent(\"focus\", {\n    onElement: element,\n    withCallback: update\n  });\n}; // Style\n\n\nconst cursorTargetStyles = function () {\n  if (config.browser.forcesObjectResizing) {\n    return {\n      display: \"inline\",\n      width: \"auto\"\n    };\n  } else {\n    return {\n      display: \"inline-block\",\n      width: \"1px\"\n    };\n  }\n}();\n\ninstallDefaultCSSForTagName(\"trix-editor\", \"%t {\\n    display: block;\\n}\\n\\n%t:empty:not(:focus)::before {\\n    content: attr(placeholder);\\n    color: graytext;\\n    cursor: text;\\n    pointer-events: none;\\n    white-space: pre-line;\\n}\\n\\n%t a[contenteditable=false] {\\n    cursor: text;\\n}\\n\\n%t img {\\n    max-width: 100%;\\n    height: auto;\\n}\\n\\n%t \".concat(attachmentSelector, \" figcaption textarea {\\n    resize: none;\\n}\\n\\n%t \").concat(attachmentSelector, \" figcaption textarea.trix-autoresize-clone {\\n    position: absolute;\\n    left: -9999px;\\n    max-height: 0px;\\n}\\n\\n%t \").concat(attachmentSelector, \" figcaption[data-trix-placeholder]:empty::before {\\n    content: attr(data-trix-placeholder);\\n    color: graytext;\\n}\\n\\n%t [data-trix-cursor-target] {\\n    display: \").concat(cursorTargetStyles.display, \" !important;\\n    width: \").concat(cursorTargetStyles.width, \" !important;\\n    padding: 0 !important;\\n    margin: 0 !important;\\n    border: none !important;\\n}\\n\\n%t [data-trix-cursor-target=left] {\\n    vertical-align: top !important;\\n    margin-left: -1px !important;\\n}\\n\\n%t [data-trix-cursor-target=right] {\\n    vertical-align: bottom !important;\\n    margin-right: -1px !important;\\n}\"));\n\nclass TrixEditorElement extends HTMLElement {\n  // Properties\n  get trixId() {\n    if (this.hasAttribute(\"trix-id\")) {\n      return this.getAttribute(\"trix-id\");\n    } else {\n      this.setAttribute(\"trix-id\", ++id);\n      return this.trixId;\n    }\n  }\n\n  get labels() {\n    const labels = [];\n\n    if (this.id && this.ownerDocument) {\n      labels.push(...Array.from(this.ownerDocument.querySelectorAll(\"label[for='\".concat(this.id, \"']\")) || []));\n    }\n\n    const label = findClosestElementFromNode(this, {\n      matchingSelector: \"label\"\n    });\n\n    if (label) {\n      if ([this, null].includes(label.control)) {\n        labels.push(label);\n      }\n    }\n\n    return labels;\n  }\n\n  get toolbarElement() {\n    if (this.hasAttribute(\"toolbar\")) {\n      var _this$ownerDocument;\n\n      return (_this$ownerDocument = this.ownerDocument) === null || _this$ownerDocument === void 0 ? void 0 : _this$ownerDocument.getElementById(this.getAttribute(\"toolbar\"));\n    } else if (this.parentNode) {\n      const toolbarId = \"trix-toolbar-\".concat(this.trixId);\n      this.setAttribute(\"toolbar\", toolbarId);\n      const element = makeElement(\"trix-toolbar\", {\n        id: toolbarId\n      });\n      this.parentNode.insertBefore(element, this);\n      return element;\n    } else {\n      return undefined;\n    }\n  }\n\n  get form() {\n    var _this$inputElement;\n\n    return (_this$inputElement = this.inputElement) === null || _this$inputElement === void 0 ? void 0 : _this$inputElement.form;\n  }\n\n  get inputElement() {\n    if (this.hasAttribute(\"input\")) {\n      var _this$ownerDocument2;\n\n      return (_this$ownerDocument2 = this.ownerDocument) === null || _this$ownerDocument2 === void 0 ? void 0 : _this$ownerDocument2.getElementById(this.getAttribute(\"input\"));\n    } else if (this.parentNode) {\n      const inputId = \"trix-input-\".concat(this.trixId);\n      this.setAttribute(\"input\", inputId);\n      const element = makeElement(\"input\", {\n        type: \"hidden\",\n        id: inputId\n      });\n      this.parentNode.insertBefore(element, this.nextElementSibling);\n      return element;\n    } else {\n      return undefined;\n    }\n  }\n\n  get editor() {\n    var _this$editorControlle;\n\n    return (_this$editorControlle = this.editorController) === null || _this$editorControlle === void 0 ? void 0 : _this$editorControlle.editor;\n  }\n\n  get name() {\n    var _this$inputElement2;\n\n    return (_this$inputElement2 = this.inputElement) === null || _this$inputElement2 === void 0 ? void 0 : _this$inputElement2.name;\n  }\n\n  get value() {\n    var _this$inputElement3;\n\n    return (_this$inputElement3 = this.inputElement) === null || _this$inputElement3 === void 0 ? void 0 : _this$inputElement3.value;\n  }\n\n  set value(defaultValue) {\n    var _this$editor;\n\n    this.defaultValue = defaultValue;\n    (_this$editor = this.editor) === null || _this$editor === void 0 ? void 0 : _this$editor.loadHTML(this.defaultValue);\n  } // Controller delegate methods\n\n\n  notify(message, data) {\n    if (this.editorController) {\n      return triggerEvent(\"trix-\".concat(message), {\n        onElement: this,\n        attributes: data\n      });\n    }\n  }\n\n  setInputElementValue(value) {\n    if (this.inputElement) {\n      this.inputElement.value = value;\n    }\n  } // Element lifecycle\n\n\n  connectedCallback() {\n    if (!this.hasAttribute(\"data-trix-internal\")) {\n      makeEditable(this);\n      addAccessibilityRole(this);\n      ensureAriaLabel(this);\n\n      if (!this.editorController) {\n        triggerEvent(\"trix-before-initialize\", {\n          onElement: this\n        });\n        this.editorController = new EditorController({\n          editorElement: this,\n          html: this.defaultValue = this.value\n        });\n        requestAnimationFrame(() => triggerEvent(\"trix-initialize\", {\n          onElement: this\n        }));\n      }\n\n      this.editorController.registerSelectionManager();\n      this.registerResetListener();\n      this.registerClickListener();\n      autofocus(this);\n    }\n  }\n\n  disconnectedCallback() {\n    var _this$editorControlle2;\n\n    (_this$editorControlle2 = this.editorController) === null || _this$editorControlle2 === void 0 ? void 0 : _this$editorControlle2.unregisterSelectionManager();\n    this.unregisterResetListener();\n    return this.unregisterClickListener();\n  } // Form support\n\n\n  registerResetListener() {\n    this.resetListener = this.resetBubbled.bind(this);\n    return window.addEventListener(\"reset\", this.resetListener, false);\n  }\n\n  unregisterResetListener() {\n    return window.removeEventListener(\"reset\", this.resetListener, false);\n  }\n\n  registerClickListener() {\n    this.clickListener = this.clickBubbled.bind(this);\n    return window.addEventListener(\"click\", this.clickListener, false);\n  }\n\n  unregisterClickListener() {\n    return window.removeEventListener(\"click\", this.clickListener, false);\n  }\n\n  resetBubbled(event) {\n    if (event.defaultPrevented) return;\n    if (event.target !== this.form) return;\n    return this.reset();\n  }\n\n  clickBubbled(event) {\n    if (event.defaultPrevented) return;\n    if (this.contains(event.target)) return;\n    const label = findClosestElementFromNode(event.target, {\n      matchingSelector: \"label\"\n    });\n    if (!label) return;\n    if (!Array.from(this.labels).includes(label)) return;\n    return this.focus();\n  }\n\n  reset() {\n    this.value = this.defaultValue;\n  }\n\n}\n\nwindow.customElements.define(\"trix-editor\", TrixEditorElement);\nexport { Trix as default };","map":{"version":3,"names":["name","version","description","main","module","style","files","repository","type","url","keywords","author","license","bugs","homepage","devDependencies","eslint","esm","karma","qunit","rangy","rollup","svgo","scripts","build","watch","lint","pretest","test","postversion","release","dependencies","_package","attachmentSelector","attachments","preview","presentation","caption","size","file","attributes","default","tagName","parse","quote","nestable","heading1","terminal","breakOnReturn","group","code","text","plaintext","bulletList","bullet","listAttribute","element","tagName$1","parentNode","numberList","number","attachmentGallery","exclusive","_element$tagName","toLowerCase","browser$1","composesExistingText","navigator","userAgent","forcesObjectResizing","supportsInputEvents","InputEvent","property","prototype","css$3","attachment","attachmentCaption","attachmentCaptionEditor","attachmentMetadata","attachmentMetadataContainer","attachmentName","attachmentProgress","attachmentSize","attachmentToolbar","lang$1","attachFiles","bold","bullets","byte","bytes","captionPlaceholder","indent","italic","link","numbers","outdent","redo","remove","strike","undo","unlink","urlPlaceholder","GB","KB","MB","PB","TB","sizes","fileSize","prefix","precision","formatter","concat","base","exp","Math","floor","log","humanSize","pow","string","toFixed","withoutInsignificantZeros","replace","ZERO_WIDTH_SPACE","NON_BREAKING_SPACE","OBJECT_REPLACEMENT_CHARACTER","extend","properties","key","value","html","document","documentElement","match","matches","handleEvent","eventName","onElement","matchingSelector","withCallback","inPhase","preventDefault","times","arguments","length","undefined","selector","useCapture","handler","event","destroy","target","findClosestElementFromNode","call","removeEventListener","addEventListener","handleEventOnce","options","triggerEvent","bubbles","cancelable","createEvent","initEvent","dispatchEvent","elementMatchesSelector","nodeType","node","untilNode","Node","ELEMENT_NODE","closest","findInnerElement","_element","firstElementChild","innerElementIsActive","activeElement","elementContainsNode","findNodeFromContainerAndOffset","container","offset","TEXT_NODE","firstChild","childNodes","item","findElementFromContainerAndOffset","findChildIndexOfNode","_node","childIndex","previousSibling","removeNode","_node$parentNode","removeChild","walkTree","tree","onlyNodesOfType","usingFilter","expandEntityReferences","whatToShow","NodeFilter","SHOW_ELEMENT","SHOW_TEXT","SHOW_COMMENT","SHOW_ALL","createTreeWalker","makeElement","tag","createElement","editable","contenteditable","setAttribute","data","dataset","className","split","forEach","classList","add","textContent","childNode","appendChild","blockTagNames","getBlockTagNames","attributes$1","push","nodeIsBlockContainer","nodeIsBlockStartComment","nodeProbablyIsBlockContainer","includes","nodeIsBlockStart","strict","nodeIsCommentNode","COMMENT_NODE","nodeIsCursorTarget","nodeIsTextNode","trixCursorTarget","nodeIsAttachmentElement","nodeIsEmptyTextNode","input","level2Enabled","getLevel","pickFiles","callback","multiple","hidden","id","fileInputId","getElementById","body","click","keyNames$2","textAttributes","inheritable","parser","window","getComputedStyle","fontWeight","fontStyle","href","groupTagName","getAttribute","frozen","backgroundColor","toolbar","getDefaultHTML","undoInterval","config","blockAttributes","browser","css","keyNames","lang","createMetadataMethodsForProperty","metadataMap","kind","decoratorFinishedRef","getMetadata","assertNotFinished","assertMetadataKey","metadataForKey","pub","public","priv","private","get","Object","hasOwnProperty","constructor","setMetadata","Map","set","convertMetadataMapToFinal","obj","parentMetadataMap","Symbol","metadata","for","metadataKeys","getOwnPropertySymbols","i","metaForKey","parentMetaForKey","parentPub","setPrototypeOf","privArr","Array","from","values","parentPriv","createAddInitializerMethod","initializers","initializer","assertCallable","memberDec","dec","desc","isStatic","isPrivate","kindStr","metadataKind","metadataName","ctx","v","addInitializer","access","assign","fnName","Error","TypeError","fn","hint","assertValidReturnValue","init","getInit","console","warn","applyMemberDec","ret","decInfo","newValue","decs","getOwnPropertyDescriptor","newInit","instance","ownInitializers","originalInitializer","args","defineProperty","applyMemberDecs","Class","protoMetadataMap","staticMetadataMap","decInfos","protoInitializers","staticInitializers","existingProtoNonFields","existingStaticNonFields","isArray","existingNonFields","existingKind","pushInitializers","applyClassDecs","targetClass","classDecs","newClass","nextNewClass","_applyDecs","memberDecs","_asyncIterator","iterable","method","async","sync","retry","asyncIterator","iterator","AsyncFromSyncIterator","s","AsyncFromSyncIteratorContinuation","r","Promise","reject","done","resolve","then","n","next","apply","return","throw","thr","REACT_ELEMENT_TYPE","_jsx","props","children","defaultProps","childrenLength","childArray","propName","$$typeof","ref","_owner","ownKeys","object","enumerableOnly","keys","symbols","filter","sym","enumerable","_objectSpread2","source","_defineProperty","getOwnPropertyDescriptors","defineProperties","_typeof","_wrapRegExp","re","groups","BabelRegExp","_super","RegExp","_groups","WeakMap","flags","_this","_setPrototypeOf","buildGroups","result","g","reduce","create","_inherits","exec","str","substitution","_","slice","_AwaitValue","wrapped","_AsyncGenerator","gen","front","back","send","arg","request","resume","wrappedAwait","settle","err","_invoke","_wrapAsyncGenerator","_awaitAsyncGenerator","_asyncGeneratorDelegate","inner","awaitWrap","iter","waiting","pump","asyncGeneratorStep","_next","_throw","info","error","_asyncToGenerator","self","_classCallCheck","Constructor","_defineProperties","descriptor","configurable","writable","_createClass","protoProps","staticProps","_defineEnumerableProperties","descs","objectSymbols","_defaults","defaults","getOwnPropertyNames","_extends","_objectSpread","subClass","superClass","_inheritsLoose","_getPrototypeOf","o","getPrototypeOf","__proto__","p","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Boolean","valueOf","e","_construct","Parent","a","Function","bind","_isNativeFunction","toString","indexOf","_wrapNativeSuper","_cache","has","Wrapper","_instanceof","left","right","hasInstance","_interopRequireDefault","__esModule","_getRequireWildcardCache","nodeInterop","cacheBabelInterop","cacheNodeInterop","_interopRequireWildcard","cache","newObj","hasPropertyDescriptor","_newArrowCheck","innerThis","boundThis","_objectDestructuringEmpty","_objectWithoutPropertiesLoose","excluded","sourceKeys","_objectWithoutProperties","sourceSymbolKeys","propertyIsEnumerable","_assertThisInitialized","ReferenceError","_possibleConstructorReturn","_createSuper","Derived","hasNativeReflectConstruct","_createSuperInternal","Super","NewTarget","_superPropBase","_get","receiver","_set","isStrict","_taggedTemplateLiteral","strings","raw","freeze","_taggedTemplateLiteralLoose","_readOnlyError","_writeOnlyError","_classNameTDZError","_temporalUndefined","_tdz","_temporalRef","val","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","_slicedToArrayLoose","_iterableToArrayLimitLoose","_toArray","_iterableToArray","_toConsumableArray","_arrayWithoutHoles","_nonIterableSpread","_arrayLikeToArray","_maybeArrayLike","len","_i","_arr","_n","_d","_s","_e","_step","minLen","arr2","_createForOfIteratorHelper","allowArrayLike","it","F","f","normalCompletion","didErr","step","_createForOfIteratorHelperLoose","_skipFirstGeneratorNext","_toPrimitive","prim","toPrimitive","res","String","Number","_toPropertyKey","_initializerWarningHelper","context","_initializerDefineProperty","_applyDecoratedDescriptor","decorators","reverse","decorator","id$2","_classPrivateFieldLooseKey","_classPrivateFieldLooseBase","privateKey","_classPrivateFieldGet","privateMap","_classExtractFieldDescriptor","_classApplyDescriptorGet","_classPrivateFieldSet","_classApplyDescriptorSet","_classPrivateFieldDestructureSet","_classApplyDescriptorDestructureSet","action","_classStaticPrivateFieldSpecGet","classConstructor","_classCheckPrivateStaticAccess","_classCheckPrivateStaticFieldDescriptor","_classStaticPrivateFieldSpecSet","_classStaticPrivateMethodGet","_classStaticPrivateMethodSet","__destrObj","_classStaticPrivateFieldDestructureSet","_decorate","factory","mixins","api","_getDecoratorsApi","initialize","O","initializeInstanceElements","decorated","elements","decorateClass","_coalesceClassElements","d","map","_createElementDescriptor","initializeClassElements","runClassFinishers","finishers","elementsDefinitionOrder","placement","defineClassElement","proto","newElements","placements","static","own","addElementPlacement","_hasDecorators","elementFinishersExtras","decorateElement","extras","decorateConstructor","silent","splice","elementObject","fromElementDescriptor","elementFinisherExtras","toElementFinisherExtras","finisher","newExtras","j","fromClassDescriptor","elementsAndFinisher","toClassDescriptor","k","toStringTag","toElementDescriptors","elementObjects","toElementDescriptor","disallowProperty","_optionalCallableProperty","newConstructor","objectType","def","_coalesceGetterSetter","other","isSameElement","find","_isDataDescriptor","_classPrivateMethodGet","privateSet","_checkPrivateRedeclaration","privateCollection","_classPrivateFieldInitSpec","_classPrivateMethodInitSpec","_classPrivateMethodSet","_identity","x","BasicObject","proxyMethod","expression","toMethod","toProperty","optional","parseProxyMethodExpression","subject","_this$toMethod","_object","proxyMethodExpressionPattern","_Array$from","_$codePointAt$1","_$1","_String$fromCodePoint","UTF16String","box","fromUCS2String","ucs2String","ucs2decode","fromCodepoints","codepoints","ucs2encode","ucs2Length","offsetToUCS2Offset","max","offsetFromUCS2Offset","ucs2Offset","charAt","isEqualTo","toJSON","getCacheKey","hasArrayFrom","hasStringCodePointAt$1","codePointAt","hasStringFromCodePoint","fromCodePoint","char","output","counter","charCodeAt","extra","array","characters","fromCharCode","join","id$1","TrixObject","fromJSONString","jsonString","fromJSON","JSON","hasSameConstructorAs","inspect","parts","contents","contentsForInspection","toJSONString","stringify","toUTF16String","arraysAreEqual","b","index","arrayStartsWith","spliceArray","_len","_key","summarizeArrayChange","oldArray","newArray","added","removed","existingValues","Set","currentValues","RTL_PATTERN","getDirection","dir","dirName","form","supportsDirName","FormData","supportsDirSelector","trim","allAttributeNames","blockAttributeNames","textAttributeNames","listAttributeNames","getAllAttributeNames","getTextAttributeNames","getBlockAttributeNames","getBlockConfig","attributeName","getTextConfig","getListAttributeNames","installDefaultCSSForTagName","defaultCSS","styleElement","insertStyleElementForTagName","nonce","getCSPNonce","head","insertBefore","getMetaElement","querySelector","testTransferData","dataTransferIsPlainText","dataTransfer","getData","DOMParser","parseFromString","dataTransferIsWritable","setData","keyEventIsKeyboardCommand","platform","metaKey","ctrlKey","defer","setTimeout","copyObject","objectsAreEqual","normalizeRange","range","copyValue","rangeIsCollapsed","start","end","rangeValuesAreEqual","rangesAreEqual","leftRange","rightRange","leftStart","leftEnd","rightStart","rightEnd","SelectionChangeObserver","update","run","selectionManagers","started","stop","registerSelectionManager","selectionManager","unregisterSelectionManager","notifySelectionManagersOfSelectionChange","selectionDidChange","domRange","getDOMRange","domRangesAreEqual","reset","requestAnimationFrame","startContainer","startOffset","endContainer","endOffset","selectionChangeObserver","getDOMSelection","selection","getSelection","rangeCount","_getDOMSelection","getRangeAt","domRangeIsPrivate","setDOMRange","removeAllRanges","addRange","nodeIsPrivate","normalizeSpaces","normalizeNewlines","breakableWhitespacePattern","squishBreakableWhitespace","summarizeStringChange","oldString","newString","utf16StringDifferences","diffA","utf16StringDifference","utf16String","diffB","leftIndex","rightIndexA","rightIndexB","Hash","fromCommonAttributesOfObjects","objects","hash","getKeys","getKeysCommonToHash","copy","merge","unbox","toArray","isEmpty","toObject","keyToRemove","sortedKeys","sort","Operation","isPerforming","performing","hasPerformed","performed","hasSucceeded","succeeded","hasFailed","getPromise","promise","perform","_this$promise","_this$promise$cancel","cancel","ImagePreloadOperation","image","Image","onload","width","naturalWidth","height","naturalHeight","onerror","src","Attachment","attachmentForFile","attributesForFile","setFile","filename","filesize","contentType","attachmentJSON","releaseFile","didChangeAttributes","attribute","hasAttribute","getAttributes","setAttributes","newAttributes","_this$previewDelegate","_this$previewDelegate2","_this$delegate","_this$delegate$attach","previewDelegate","attachmentDidChangeAttributes","delegate","isPreviewable","preloadURL","isPending","getURL","getHref","previewablePattern","getContentType","getType","hasContent","getFilename","getFilesize","getFormattedFilesize","getExtension","_this$getFilename$mat","getContent","getWidth","getHeight","getFile","preloadFile","releasePreloadedFile","getUploadProgress","uploadProgress","setUploadProgress","_this$uploadProgressD","_this$uploadProgressD2","uploadProgressDelegate","attachmentDidChangeUploadProgress","getPreviewURL","previewURL","preloadingURL","setPreviewURL","_this$previewDelegate3","_this$previewDelegate4","_this$delegate2","_this$delegate2$attac","attachmentDidChangePreviewURL","preload","fileObjectURL","URL","createObjectURL","revokeObjectURL","operation","_ref","catch","ManagedAttachment","attachmentManager","requestRemovalOfAttachment","AttachmentManager","managedAttachments","manageAttachment","getAttachments","attachmentIsManaged","attachmentManagerDidRequestRemovalOfAttachment","unmanageAttachment","managedAttachment","Piece","registerType","types","pieceJSON","copyWithAttributes","getValue","copyWithAdditionalAttributes","copyWithoutAttribute","getAttributesHash","hasSameStringValueAsPiece","piece","hasSameAttributesAsPiece","isBlockBreak","isSerializable","canBeGrouped","canBeGroupedWith","getLength","canBeConsolidatedWith","AttachmentPiece","ensureAttachmentExclusivelyHasAttribute","removeProhibitedAttributes","permittedAttributes","getCaption","_piece$attachment","json","toConsole","StringPiece","consolidateWith","splitAtOffset","SplittableList","eachObject","insertObjectAtIndex","insertSplittableListAtIndex","splittableList","insertSplittableListAtPosition","position","splitObjectAtPosition","editObjectAtIndex","replaceObjectAtIndex","removeObjectAtIndex","getObjectAtIndex","getSplittableListInRange","rightIndex","splitObjectsAtRange","selectSplittableList","removeObjectsInRange","transformObjectsInRange","transform","transformedObjects","rightOuterIndex","leftInnerIndex","startOfRange","endOfRange","getObjectAtPosition","findIndexAndOffsetAtPosition","splitIndex","splitOffset","leftObject","rightObject","consolidate","pendingObject","_pendingObject$canBeC","_pendingObject","consolidateFromIndexToIndex","startIndex","endIndex","objectsInRange","consolidatedInRange","currentPosition","nextPosition","findPositionAtIndexAndOffset","currentIndex","getEndPosition","endPosition","objectArraysAreEqual","Text","textForAttachmentWithAttributes","textForStringWithAttributes","textJSON","pieces","notEmpty","pieceList","copyWithPieceList","copyUsingObjectMap","objectMap","getPieces","appendText","insertTextAtPosition","removeTextAtRange","replaceTextAtRange","moveTextFromRangeToPosition","getTextAtRange","addAttributeAtRange","addAttributesAtRange","removeAttributeAtRange","setAttributesAtRange","getAttributesAtPosition","_this$pieceList$getOb","getCommonAttributes","getCommonAttributesAtRange","getExpandedRangeForAttributeAtOffset","getStringAtRange","getStringAtPosition","startsWithString","endsWithString","getAttachmentPieces","getAttachmentAndPositionById","attachmentId","getAttachmentById","getRangeOfAttachment","attachmentAndPosition","updateAttributesForAttachment","_text$pieceList","eachPiece","getPieceAtPosition","toSerializableText","isRTL","Block","blockJSON","applyBlockBreakToText","block","copyWithText","copyWithoutText","copyWithoutAttributes","mappedText","addAttribute","expandAttribute","removeAttribute","removeLastValue","removeLastAttribute","getLastAttribute","getLastElement","getAttributeLevel","getAttributeAtLevel","level","hasAttributes","getLastNestableAttribute","getNestableAttributes","getNestingLevel","decreaseNestingLevel","increaseNestingLevel","lastIndexOf","getListItemAttributes","isListItem","_getBlockConfig","isTerminalBlock","_getBlockConfig2","breaksOnReturn","_getBlockConfig3","findLineBreakInDirectionFromPosition","direction","newlineText","getTextWithoutBlockBreak","getBlockBreakPosition","textEndsInBlockBreak","depth","otherBlock","otherAttributes","otherAttribute","unmarkExistingInnerBlockBreaksInText","addBlockBreakToText","modified","innerPieces","lastPiece","unmarkBlockBreakPiece","blockBreakText","blockBreak","endText","ObjectMap","Document","documentJSON","blocks","fromString","blockList","getBlockAtIndex","consolidateBlocks","copyUsingObjectsFromDocument","sourceDocument","getObjects","getBlocks","mappedBlock","copyWithBaseBlockAttributes","replaceBlock","oldBlock","newBlock","insertDocumentAtRange","locationFromPosition","getBlockAtPosition","mergeDocumentAtRange","formattedDocument","startPosition","startLocation","baseBlockAttributes","getBaseBlockAttributes","trailingBlockAttributes","leadingBlockAttributes","blockCount","getBlockCount","firstBlock","firstText","insertTextAtRange","leftPosition","rightPosition","leftLocation","rightLocation","locationRangeFromRange","leftOffset","leftBlock","rightOffset","rightBlock","removeRightNewline","leftText","rightText","removingLeftBlock","useRightBlock","affectedBlockCount","getDocumentAtRange","movingRightward","eachBlockAtRange","textRange","eachBlock","getTextAtIndex","removeAttributeForAttachment","insertBlockBreakAtRange","applyBlockAttributeAtRange","expanded","expandRangeToLineBreaksAndSplitBlocks","blockConfig","removeLastListAttributeAtRange","exceptAttributeName","converted","convertLineBreaksToBlockBreaksInRange","removeBlockAttributesAtRange","removeLastTerminalAttributeAtRange","consolidateBlocksAtRange","lastAttributeName","endLocation","startBlock","positionFromLocation","endBlock","_this$getBlockAtIndex","getTextAtPosition","getCharacterAtPosition","getEditCount","editCount","getCommonAttributesAtPosition","attributesForBlock","commonAttributes","attributesLeft","inheritableAttributes","getRangeOfCommonAttributeAtPosition","blockIndex","lastAttributeIndex","min","attachmentPieces","getLocationRangeOfAttachment","getAttachmentPieceForAttachment","findRangesForBlockAttribute","ranges","findRangesForTextAttribute","withValue","location","locationRangeFromPosition","rangeFromLocationRange","locationRange","getTexts","toSerializableDocument","DEFAULT_ALLOWED_ATTRIBUTES","DEFAULT_FORBIDDEN_PROTOCOLS","DEFAULT_FORBIDDEN_ELEMENTS","HTMLSanitizer","sanitize","sanitizer","allowedAttributes","forbiddenProtocols","forbiddenElements","createBodyElementForHTML","sanitizeElements","normalizeListElementNesting","getHTML","innerHTML","getBody","walker","nodesToRemove","nextNode","currentNode","elementIsRemovable","sanitizeElement","protocol","querySelectorAll","listElement","previousElement","previousElementSibling","elementIsForbidden","elementIsntSerializable","doc","implementation","createHTMLDocument","pieceForString","pieceForAttachment","blockForAttributes","parseTrixDataAttribute","getImageDimensions","dimensions","parseInt","HTMLParser","referenceElement","blockElements","processedElements","getDocument","createHiddenContainer","containerElement","nodeFilter","processNode","translateBlockElementMarginsToNewlines","removeHiddenContainer","cloneNode","display","nextSibling","isInsignificantTextNode","appendBlockForTextNode","processTextNode","appendBlockForElement","processElement","currentBlockElement","isBlockElement","appendStringWithAttributes","_this$currentBlock","getBlockAttributes","currentBlock","appendBlockForAttributesWithElement","elementIsBlockElement","currentBlockContainsElement","parentBlockElement","findParentBlockElement","appendEmptyBlock","parentElement","elementCanDisplayPreformattedText","_node$previousSibling","stringEndsWithWhitespace","leftTrimBreakableWhitespace","getTextAttributes","appendAttachmentWithAttributes","isExtraBR","appendPiece","appendStringToTextAtIndex","prependStringToTextAtIndex","unshift","configAttr","attributeInheritedFromBlock","blockElement","findBlockElementAncestors","styleProperty","attrConfig","_attrConfig$test","ancestors","stringIsAllBreakableWhitespace","nodeEndsWithNonWhitespace","lastChild","defaultMargin","getMarginOfDefaultBlockElement","margin","getMarginOfBlockElementAtIndex","top","bottom","getBlockElementMargin","whiteSpace","marginTop","marginBottom","FILTER_REJECT","FILTER_ACCEPT","LineBreakInsertion","composition","selectedRange","getSelectedRange","previousCharacter","nextCharacter","shouldInsertBlockBreak","shouldBreakFormattedBlock","shouldDecreaseListLevel","shouldPrependListItem","shouldRemoveLastBlockAttribute","PLACEHOLDER","Composition","currentAttributes","revision","setDocument","_this$delegate$compos","refreshAttachments","compositionDidChangeDocument","getSnapshot","loadSnapshot","_this$delegate2$compo","_this$delegate3","_this$delegate3$compo","compositionWillLoadSnapshot","setSelection","compositionDidLoadSnapshot","insertText","updatePosition","notifyDelegateOfInsertionAtRange","insertBlock","insertDocument","insertString","getCurrentTextAttributes","insertBlockBreak","insertLineBreak","insertion","decreaseListLevel","removeLastBlockAttribute","breakFormattedBlock","insertHTML","replaceHTML","getLocationRange","insertFile","insertFiles","_this$delegate4","compositionShouldAcceptFile","insertAttachments","insertAttachment","_config$attachments$t","attachmentText","shouldManageDeletingInDirection","shouldManageMovingCursorInDirection","deleteInDirection","deletingIntoPreviousBlock","selectionSpansBlocks","selectionIsCollapsed","canDecreaseBlockAttributeLevel","getBlock","decreaseBlockAttributeLevel","getExpandedRangeInDirection","getAttachmentAtRange","editAttachment","moveTextFromRange","removeAttachment","stopEditingAttachment","removeCurrentAttribute","insertPlaceholder","placeholderPosition","getPosition","selectPlaceholder","setSelectedRange","forgetPlaceholder","hasCurrentAttribute","toggleCurrentAttribute","setCurrentAttribute","canSetCurrentAttribute","canSetCurrentBlockAttribute","canSetCurrentTextAttribute","getSelectedDocument","setBlockAttribute","setTextAttribute","notifyDelegateOfCurrentAttributesChange","removeBlockAttribute","updateCurrentAttributes","removeTextAttribute","canDecreaseNestingLevel","_this$getBlock","canIncreaseNestingLevel","previousBlock","getPreviousBlock","_this$getBlock2","_this$getBlock3","attributeLevel","ignoreLock","getCurrentAttributes","freezeSelection","thawSelection","hasFrozenSelection","_this$delegate5","compositionDidRequestChangingSelectionToLocationRange","getSelectionManager","setLocationRange","targetLocationRange","withTargetLocationRange","withTargetRange","withTargetDOMRange","createLocationRangeFromDOMRange","translateUTF16PositionFromOffset","editingAttachment","moveCursorInDirection","canEditAttachment","expandSelectionInDirection","expandSelectionForEditing","expandSelectionAroundCommonAttribute","selectionContainsAttachments","_this$getSelectedAtta","getSelectedAttachments","selectionIsInCursorTarget","positionIsCursorTarget","locationIsCursorTarget","positionIsBlockBreak","_this$document$getPie","_this$getSelectedDocu","_this$delegate6","_this$delegate6$compo","compositionDidRemoveAttachment","_this$delegate7","_this$delegate7$compo","compositionDidAddAttachment","_this$delegate8","_this$delegate8$compo","compositionDidEditAttachment","_this$delegate9","_this$delegate9$compo","compositionDidChangeAttachmentPreviewURL","_this$delegate10","_this$delegate10$comp","compositionDidStartEditingAttachment","_this$delegate11","_this$delegate11$comp","compositionDidStopEditingAttachment","newDocument","_this$delegate12","_this$delegate12$comp","compositionDidChangeCurrentAttributes","_this$delegate13","_this$delegate13$comp","compositionDidPerformInsertionAtRange","utf16string","utf16position","UndoManager","undoEntries","redoEntries","recordUndoEntry","consolidatable","previousEntry","entryHasDescriptionAndContext","undoEntry","createEntry","pop","redoEntry","snapshot","canUndo","canRedo","entry","attachmentGalleryFilter","Filter","BLOCK_ATTRIBUTE_NAME","TEXT_ATTRIBUTE_NAME","TEXT_ATTRIBUTE_VALUE","applyBlockAttribute","findRangesOfBlocks","findRangesOfPieces","moveSelectedRangeForward","DEFAULT_FILTERS","Editor","undoManager","filters","loadDocument","loadHTML","loadJSON","getClientRectAtPosition","getClientRectAtLocationRange","activateAttribute","attributeIsActive","canActivateAttribute","deactivateAttribute","LocationMapper","findLocationFromContainerAndOffset","foundBlock","attachmentElement","findAttachmentElementParentForNode","rejectAttachmentContents","nodeLength","findContainerAndOffsetFromLocation","nodeOffset","findNodeAndOffsetFromLocation","getSignificantNodesForIndex","nodes","acceptSignificantNodes","recordingNodes","rejectEmptyTextNodes","PointMapper","createDOMRangeFromPoint","y","caretPositionFromPoint","offsetNode","createRange","setStart","caretRangeFromPoint","createTextRange","originalDOMRange","moveToPoint","select","getClientRectsForDOMRange","getClientRects","SelectionManager","didMouseDown","locationMapper","pointMapper","lockCount","currentLocationRange","lockedLocationRange","createDOMRangeFromLocationRange","updateCurrentLocationRange","setLocationRangeFromPointRange","pointRange","getLocationAtPoint","lock","unlock","clearSelection","_getDOMRange","collapsed","selectionIsExpanded","domRangeWithinElement","pauseTemporarily","resumeHandlers","paused","clearTimeout","resumeTimeout","_this$delegate$locati","locationRangeDidChange","rangeStart","rangeEnd","setEnd","point","_this$createLocationR","models","Cocument","Trix","VERSION","ObjectGroup","groupObjects","ungroupedObjects","asTree","_object$canBeGrouped2","_object$canBeGrouped","_group$canBeGroupedWi","_group","getDepth","ElementStore","getKey","trixStoreKey","ObjectView","childViews","rootView","getNodes","createNodes","invalidate","_this$parentView","parentView","invalidateViewForObject","_this$findViewForObje","findViewForObject","findOrCreateCachedChildView","viewClass","view","getCachedViewForObject","recordChildView","createChildView","cacheViewForObject","ObjectGroupView","getAllChildViews","views","childView","findElement","findElementForObject","getViewCache","isViewCachingEnabled","viewCache","shouldCacheViews","enableViewCaching","disableViewCaching","_this$getViewCache","garbageCollectCachedViews","objectKeys","objectGroup","getChildViews","createContainerElement","css$2","AttachmentView","attachmentPiece","createContentNodes","innerElement","figure","getClassName","tabindex","createCaptionElement","progressElement","class","trixMutable","createCursorTarget","figcaption","captionConfig","getCaptionConfig","nameElement","createTextNode","sizeElement","names","extension","trixAttachment","trixContentType","trixId","trixAttributes","trixSerialize","htmlContainsTagName","findProgressElement","_this$findElement","div","PreviewableAttachmentView","refresh","updateAttributesForImage","serializedAttributes","storeKey","PieceView","textConfig","createAttachmentNodes","createStringNodes","_this$textConfig","substring","preserveSpaces","styles","pendingElement","isLast","isFirst","followsWhitespace","TextView","lastIndex","endsWithWhitespace","previousPiece","css$1","BlockView","comment","createComment","textView","shouldAddExtraNewlineElement","DocumentView","render","elementStore","shadowElement","isSynced","elementsHaveEqualHTML","fragment","createDocumentFragmentForSync","didSync","findStoredElements","createDocumentFragment","storedElement","replaceChild","otherElement","ignoreSpaces","unserializableElementSelector","unserializableAttributeNames","serializedAttributesAttribute","serializedAttributesSelector","blockCommentPattern","serializers","serializable","HTMLElement","el","deserializers","serializeToContentType","serializer","deserializeFromContentType","deserializer","mutableAttributeName","mutableSelector","childList","characterData","characterDataOldValue","subtree","MutationObserver","didMutate","observer","observe","disconnect","mutations","findSignificantMutations","_this$delegate$elemen","elementDidMutate","getMutationSummary","mutation","mutationIsSignificant","nodeIsMutable","nodesModifiedByMutation","nodeIsSignificant","addedNodes","removedNodes","getTextMutationSummary","additions","deletions","getTextChangesFromCharacterData","textChanges","getTextChangesFromChildList","addition","summary","textAdded","deleted","textDeleted","getMutationsByType","textRemoved","singleBlockCommentRemoved","getTextForNodes","characterMutations","startMutation","endMutation","oldValue","summarized","Controller","FileVerificationOperation","reader","FileReader","abort","readAsArrayBuffer","InputController","mutationObserver","events","handlerFor","mutationSummary","editorWillSyncDocumentView","editorDidSyncDocumentView","requestRender","_this$delegate$inputC","inputControllerDidRequestRender","requestReparse","_this$delegate2$input","inputControllerDidRequestReparse","operations","all","handleInput","_this$responder","inputControllerWillAttachFiles","responder","defaultPrevented","inputControllerWillHandleInput","inputControllerDidHandleInput","createLinkHTML","outerHTML","_$codePointAt","keyNames$1","pastedFileCount","Level0InputController","resetInputSummary","setInputSummary","inputSummary","isComposing","inputControllerDidAllowUnhandledInput","mutationIsExpected","preferDocument","mutationAdditionMatchesSummary","mutationDeletionMatchesSummary","didDelete","unexpectedNewlineAddition","unexpectedNewlineDeletion","singleUnexpectedNewline","_this$compositionInpu","textChanged","composedEmptyString","compositionInput","getEndData","getCompositionInput","CompositionInput","isEnded","_this$responder2","serializeSelectionToDataTransfer","_this$responder3","canAcceptDataTransfer","Files","getPastedHTMLUsingHiddenElement","pageXOffset","pageYOffset","opacity","focus","keydown","didInput","keyName","keyCode","_context2","modifier","_context","character","inputControllerDidReceiveKeyboardCommand","keypress","altKey","stringFromKeyEvent","_this$responder9","inputControllerWillPerformTyping","textInput","toUpperCase","_this$responder10","dragenter","dragstart","_this$delegate5$input","draggedRange","inputControllerDidStartDrag","dragover","draggingPoint","clientX","clientY","_this$delegate6$input","inputControllerDidReceiveDragOverPoint","dragend","_this$delegate7$input","inputControllerDidCancelDrag","drop","_event$dataTransfer","_this$responder11","_this$responder12","inputControllerWillMoveText","_this$responder13","cut","_this$responder14","clipboardData","inputControllerWillCutText","_this$responder15","paste","clipboard","testClipboardData","pasteEventIsCrippledSafariHTMLPaste","_this$responder16","inputControllerWillPaste","inputControllerDidPaste","_this$responder17","_this$delegate14","_this$responder18","_this$delegate15","_this$delegate16","_this$responder19","_this$delegate17","_clipboard$items","_clipboard$items$","_clipboard$items$$get","items","getAsFile","_this$delegate18","_this$responder20","_this$delegate19","extensionForFile","compositionstart","compositionupdate","compositionend","beforeinput","stopPropagation","backspace","_this$delegate20","delete","_this$delegate21","_this$delegate22","_this$responder21","tab","_this$responder22","_this$responder23","_this$responder24","_this$responder25","control","_this$delegate23","h","_this$delegate24","_this$delegate25","_this$responder26","shift","_this$delegate26","_this$responder27","_this$responder28","_this$responder29","alt","_this$delegate27","meta","_this$delegate28","_file$type","_file$type$match","hasStringCodePointAt","which","charCode","hasPasteboardFlavor","hasReadableDynamicData","mightBePasteAndMatchStyle","isExternalHTMLPaste","isExternalRichTextPaste","inputController","isSignificant","_this$responder5","_this$responder4","canApplyToDocument","_this$responder6","_this$responder7","_this$responder8","_this$data$start","_this$data$end","Level2InputController","scheduledRender","composing","reparse","scheduleRender","_this$afterRender","cancelAnimationFrame","afterRender","toggleAttributeIfSupported","inputControllerWillPerformFormatting","activateAttributeIfSupported","getTargetDOMRange","minLength","_this$event$getTarget","_this$event","targetRanges","getTargetRanges","staticRangeToRange","withEvent","command","keyboardCommandFromKeyEvent","shiftKey","_event$clipboardData","pasteEventHasFilesOnly","pasteEventHasPlainTextOnly","inputTypes","inputType","dragging","pointFromEvent","dragEventHasFiles","ArrowLeft","ArrowRight","Backspace","Tab","deleteByComposition","deleteByCut","deleteByDrag","deleteByDragRange","deleteCompositionText","deleteContent","deleteContentBackward","deleteContentForward","deleteEntireSoftLine","deleteHardLineBackward","deleteHardLineForward","deleteSoftLineBackward","deleteSoftLineForward","deleteWordBackward","deleteWordForward","formatBackColor","formatBold","formatFontColor","formatFontName","formatIndent","formatItalic","formatJustifyCenter","formatJustifyFull","formatJustifyLeft","formatJustifyRight","formatOutdent","formatRemove","_this$responder30","formatSetBlockTextDirection","formatSetInlineTextDirection","formatStrikeThrough","formatSubscript","formatSuperscript","formatUnderline","historyRedo","inputControllerWillPerformRedo","historyUndo","inputControllerWillPerformUndo","insertCompositionText","insertFromComposition","insertFromDrop","_this$responder31","insertFromPaste","_dataTransfer$files","_this$responder32","_this$responder33","_this$responder34","_this$responder35","insertFromYank","insertLink","insertOrderedList","insertParagraph","_this$responder36","insertReplacementText","_this$event$dataTrans","insertTranspose","insertUnorderedList","staticRange","undoable","commands","do","undos","AttachmentEditorController","title","trixAction","didClickToolbar","didClickActionButton","textarea","placeholder","textareaClone","tabIndex","autoresize","scrollHeight","didInputCaption","didKeyDownCaption","didChangeCaption","didBlurCaption","editingFigcaption","editCaption","install","makeElementMutable","addToolbar","installCaptionEditor","uninstall","savePendingCaption","didUninstallAttachmentEditor","pendingCaption","attachmentEditorDidRequestUpdatingAttributesForAttachment","_this$delegate3$attac","attachmentEditorDidRequestRemovingAttributeForAttachment","attachmentEditorDidRequestRemovalOfAttachment","_this$delegate5$attac","attachmentEditorDidRequestDeselectingAttachment","CompositionController","didFocus","didBlur","didClickAttachment","documentView","_this$blurPromise","focused","compositionControllerDidFocus","blurPromise","compositionControllerDidBlur","findAttachmentForElement","compositionControllerDidSelectAttachment","getSerializableElement","isEditingAttachment","canSyncDocumentView","_this$delegate4$compo","_this$delegate5$compo","compositionControllerWillSyncDocumentView","compositionControllerDidSyncDocumentView","compositionControllerDidRender","rerenderViewForObject","refreshViewCache","attachmentEditor","installAttachmentEditorForAttachment","_this$attachmentEdito","uninstallAttachmentEditor","_this$attachmentEdito2","compositionControllerWillUpdateAttachment","compositionControllerDidRequestRemovalOfAttachment","compositionControllerDidRequestDeselectingAttachment","attributeButtonSelector","actionButtonSelector","toolbarButtonSelector","dialogSelector","activeDialogSelector","dialogButtonSelector","dialogInputSelector","getInputForDialog","getAttributeName","getActionName","getDialogName","ToolbarController","didClickAttributeButton","didClickDialogButton","didKeyDownDialogInput","actions","resetDialogInputs","toolbarDidClickButton","actionName","getDialog","toggleDialog","toolbarDidInvokeAction","toolbarDidToggleAttribute","refreshAttributeButtons","dialogElement","dialog","hideDialog","updateActions","refreshActionButtons","eachActionButton","disabled","updateAttributes","eachAttributeButton","dialogIsVisible","applyKeyboardCommand","keyString","button","buttonKeys","buttonKeyString","dialogName","showDialog","toolbarWillShowDialog","disabledInput","toolbarDidShowDialog","willValidate","checkValidity","toolbarDidUpdateAttribute","toolbarDidRemoveAttribute","toolbarDidHideDialog","snapshotsAreEqual","EditorController","editorElement","compositionController","toolbarController","toolbarElement","editor","notifyEditorElement","handlingInput","updateCurrentActions","pasting","pastedRange","attachmentLocationRange","loadingSnapshot","isFocused","requestedLocationRange","compositionRevisionWhenLocationRangeRequested","renderedCompositionRevision","runEditorFilters","isFocusedInvisibly","requestedRender","recordTypingUndoEntry","recordFormattingUndoEntry","locationRangeBeforeDrag","invokeAction","selectionFrozen","canInvokeAction","actionIsExternal","_this$actions$actionN","_this$actions$actionN2","_this$actions$actionN3","_this$actions$actionN4","getCurrentActions","currentActions","updateInputElement","setInputElementValue","message","documentChangedSinceLastRender","notify","getUndoContext","getLocationContext","getTimeContext","Date","getTime","_this$editorElement$o","ownerDocument","TrixToolbarElement","connectedCallback","customElements","define","autofocus","makeEditable","configureContentEditable","disableObjectResizing","setDefaultParagraphSeparator","_document$queryComman","_document","queryCommandSupported","execCommand","_document$queryComman2","_document2","addAccessibilityRole","ensureAriaLabel","texts","labels","label","contains","cursorTargetStyles","TrixEditorElement","_this$ownerDocument","toolbarId","_this$inputElement","inputElement","_this$ownerDocument2","inputId","nextElementSibling","_this$editorControlle","editorController","_this$inputElement2","_this$inputElement3","defaultValue","_this$editor","registerResetListener","registerClickListener","disconnectedCallback","_this$editorControlle2","unregisterResetListener","unregisterClickListener","resetListener","resetBubbled","clickListener","clickBubbled"],"sources":["C:/Users/asa_h/Desktop/bth/jsramverk/frontend/texteditor/node_modules/trix/dist/trix.js"],"sourcesContent":["/*\nTrix 2.0.0-alpha.1\nCopyright © 2022 Basecamp, LLC\n */\nvar name = \"trix\";\nvar version = \"2.0.0-alpha.1\";\nvar description = \"A rich text editor for everyday writing\";\nvar main = \"dist/trix.umd.js\";\nvar module = \"dist/trix.js\";\nvar style = \"dist/trix.css\";\nvar files = [\n\t\"dist/*.css\",\n\t\"dist/*.js\"\n];\nvar repository = {\n\ttype: \"git\",\n\turl: \"git+https://github.com/basecamp/trix.git\"\n};\nvar keywords = [\n\t\"rich text\",\n\t\"wysiwyg\",\n\t\"editor\"\n];\nvar author = \"Basecamp, LLC\";\nvar license = \"MIT\";\nvar bugs = {\n\turl: \"https://github.com/basecamp/trix/issues\"\n};\nvar homepage = \"https://trix-editor.org/\";\nvar devDependencies = {\n\t\"@babel/core\": \"^7.16.0\",\n\t\"@babel/preset-env\": \"^7.16.4\",\n\t\"@rollup/plugin-babel\": \"^5.3.0\",\n\t\"@rollup/plugin-json\": \"^4.1.0\",\n\t\"babel-eslint\": \"^10.1.0\",\n\teslint: \"^7.32.0\",\n\tesm: \"^3.2.25\",\n\tkarma: \"5.0.2\",\n\t\"karma-chrome-launcher\": \"3.1.0\",\n\t\"karma-qunit\": \"^4.1.2\",\n\t\"karma-sauce-launcher\": \"^4.3.6\",\n\t\"node-sass\": \"^7.0.1\",\n\tqunit: \"2.9.3\",\n\trangy: \"^1.3.0\",\n\trollup: \"^2.56.3\",\n\t\"rollup-plugin-commonjs\": \"^10.1.0\",\n\t\"rollup-plugin-includepaths\": \"^0.2.4\",\n\t\"rollup-plugin-node-resolve\": \"^5.2.0\",\n\t\"rollup-plugin-terser\": \"^7.0.2\",\n\tsvgo: \"^2.8.0\"\n};\nvar scripts = {\n\t\"build-css\": \"node-sass --functions=./assets/trix/stylesheets/functions assets/trix.scss dist/trix.css\",\n\t\"build-js\": \"rollup -c\",\n\t\"build-assets\": \"cp -f assets/*.html dist/\",\n\tbuild: \"yarn run build-js && yarn run build-css && yarn run build-assets\",\n\twatch: \"rollup -c -w\",\n\tlint: \"eslint .\",\n\tpretest: \"yarn run lint && yarn run build\",\n\ttest: \"karma start\",\n\tpostversion: \"git push && git push --tags\",\n\trelease: \"yarn test && npm adduser && yarn version && npm publish\"\n};\nvar dependencies = {\n};\nvar _package = {\n\tname: name,\n\tversion: version,\n\tdescription: description,\n\tmain: main,\n\tmodule: module,\n\tstyle: style,\n\tfiles: files,\n\trepository: repository,\n\tkeywords: keywords,\n\tauthor: author,\n\tlicense: license,\n\tbugs: bugs,\n\thomepage: homepage,\n\tdevDependencies: devDependencies,\n\tscripts: scripts,\n\tdependencies: dependencies\n};\n\nconst attachmentSelector = \"[data-trix-attachment]\";\nconst attachments = {\n  preview: {\n    presentation: \"gallery\",\n    caption: {\n      name: true,\n      size: true\n    }\n  },\n  file: {\n    caption: {\n      size: true\n    }\n  }\n};\n\nconst attributes = {\n  default: {\n    tagName: \"div\",\n    parse: false\n  },\n  quote: {\n    tagName: \"blockquote\",\n    nestable: true\n  },\n  heading1: {\n    tagName: \"h1\",\n    terminal: true,\n    breakOnReturn: true,\n    group: false\n  },\n  code: {\n    tagName: \"pre\",\n    terminal: true,\n    text: {\n      plaintext: true\n    }\n  },\n  bulletList: {\n    tagName: \"ul\",\n    parse: false\n  },\n  bullet: {\n    tagName: \"li\",\n    listAttribute: \"bulletList\",\n    group: false,\n    nestable: true,\n\n    test(element) {\n      return tagName$1(element.parentNode) === attributes[this.listAttribute].tagName;\n    }\n\n  },\n  numberList: {\n    tagName: \"ol\",\n    parse: false\n  },\n  number: {\n    tagName: \"li\",\n    listAttribute: \"numberList\",\n    group: false,\n    nestable: true,\n\n    test(element) {\n      return tagName$1(element.parentNode) === attributes[this.listAttribute].tagName;\n    }\n\n  },\n  attachmentGallery: {\n    tagName: \"div\",\n    exclusive: true,\n    terminal: true,\n    parse: false,\n    group: false\n  }\n};\n\nconst tagName$1 = element => {\n  var _element$tagName;\n\n  return element === null || element === void 0 ? void 0 : (_element$tagName = element.tagName) === null || _element$tagName === void 0 ? void 0 : _element$tagName.toLowerCase();\n};\n\nvar browser$1 = {\n  // Android emits composition events when moving the cursor through existing text\n  // Introduced in Chrome 65: https://bugs.chromium.org/p/chromium/issues/detail?id=764439#c9\n  composesExistingText: /Android.*Chrome/.test(navigator.userAgent),\n  // IE 11 activates resizing handles on editable elements that have \"layout\"\n  forcesObjectResizing: /Trident.*rv:11/.test(navigator.userAgent),\n  // https://www.w3.org/TR/input-events-1/ + https://www.w3.org/TR/input-events-2/\n  supportsInputEvents: function () {\n    if (typeof InputEvent === \"undefined\") {\n      return false;\n    }\n\n    for (const property of [\"data\", \"getTargetRanges\", \"inputType\"]) {\n      if (!(property in InputEvent.prototype)) {\n        return false;\n      }\n    }\n\n    return true;\n  }()\n};\n\nvar css$3 = {\n  attachment: \"attachment\",\n  attachmentCaption: \"attachment__caption\",\n  attachmentCaptionEditor: \"attachment__caption-editor\",\n  attachmentMetadata: \"attachment__metadata\",\n  attachmentMetadataContainer: \"attachment__metadata-container\",\n  attachmentName: \"attachment__name\",\n  attachmentProgress: \"attachment__progress\",\n  attachmentSize: \"attachment__size\",\n  attachmentToolbar: \"attachment__toolbar\",\n  attachmentGallery: \"attachment-gallery\"\n};\n\nvar lang$1 = {\n  attachFiles: \"Attach Files\",\n  bold: \"Bold\",\n  bullets: \"Bullets\",\n  byte: \"Byte\",\n  bytes: \"Bytes\",\n  captionPlaceholder: \"Add a caption…\",\n  code: \"Code\",\n  heading1: \"Heading\",\n  indent: \"Increase Level\",\n  italic: \"Italic\",\n  link: \"Link\",\n  numbers: \"Numbers\",\n  outdent: \"Decrease Level\",\n  quote: \"Quote\",\n  redo: \"Redo\",\n  remove: \"Remove\",\n  strike: \"Strikethrough\",\n  undo: \"Undo\",\n  unlink: \"Unlink\",\n  url: \"URL\",\n  urlPlaceholder: \"Enter a URL…\",\n  GB: \"GB\",\n  KB: \"KB\",\n  MB: \"MB\",\n  PB: \"PB\",\n  TB: \"TB\"\n};\n\n/* eslint-disable\n    no-case-declarations,\n*/\nconst sizes = [lang$1.bytes, lang$1.KB, lang$1.MB, lang$1.GB, lang$1.TB, lang$1.PB];\nvar fileSize = {\n  prefix: \"IEC\",\n  precision: 2,\n\n  formatter(number) {\n    switch (number) {\n      case 0:\n        return \"0 \".concat(lang$1.bytes);\n\n      case 1:\n        return \"1 \".concat(lang$1.byte);\n\n      default:\n        let base;\n\n        if (this.prefix === \"SI\") {\n          base = 1000;\n        } else if (this.prefix === \"IEC\") {\n          base = 1024;\n        }\n\n        const exp = Math.floor(Math.log(number) / Math.log(base));\n        const humanSize = number / Math.pow(base, exp);\n        const string = humanSize.toFixed(this.precision);\n        const withoutInsignificantZeros = string.replace(/0*$/, \"\").replace(/\\.$/, \"\");\n        return \"\".concat(withoutInsignificantZeros, \" \").concat(sizes[exp]);\n    }\n  }\n\n};\n\nconst ZERO_WIDTH_SPACE = \"\\uFEFF\";\nconst NON_BREAKING_SPACE = \"\\u00A0\";\nconst OBJECT_REPLACEMENT_CHARACTER = \"\\uFFFC\";\n\nconst extend = function (properties) {\n  for (const key in properties) {\n    const value = properties[key];\n    this[key] = value;\n  }\n\n  return this;\n};\n\nconst html = document.documentElement;\nconst match = html.matches;\nconst handleEvent = function (eventName) {\n  let {\n    onElement,\n    matchingSelector,\n    withCallback,\n    inPhase,\n    preventDefault,\n    times\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const element = onElement ? onElement : html;\n  const selector = matchingSelector;\n  const useCapture = inPhase === \"capturing\";\n\n  const handler = function (event) {\n    if (times != null && --times === 0) {\n      handler.destroy();\n    }\n\n    const target = findClosestElementFromNode(event.target, {\n      matchingSelector: selector\n    });\n\n    if (target != null) {\n      withCallback === null || withCallback === void 0 ? void 0 : withCallback.call(target, event, target);\n\n      if (preventDefault) {\n        event.preventDefault();\n      }\n    }\n  };\n\n  handler.destroy = () => element.removeEventListener(eventName, handler, useCapture);\n\n  element.addEventListener(eventName, handler, useCapture);\n  return handler;\n};\nconst handleEventOnce = function (eventName) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  options.times = 1;\n  return handleEvent(eventName, options);\n};\nconst triggerEvent = function (eventName) {\n  let {\n    onElement,\n    bubbles,\n    cancelable,\n    attributes\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const element = onElement != null ? onElement : html;\n  bubbles = bubbles !== false;\n  cancelable = cancelable !== false;\n  const event = document.createEvent(\"Events\");\n  event.initEvent(eventName, bubbles, cancelable);\n\n  if (attributes != null) {\n    extend.call(event, attributes);\n  }\n\n  return element.dispatchEvent(event);\n};\nconst elementMatchesSelector = function (element, selector) {\n  if ((element === null || element === void 0 ? void 0 : element.nodeType) === 1) {\n    return match.call(element, selector);\n  }\n};\nconst findClosestElementFromNode = function (node) {\n  let {\n    matchingSelector,\n    untilNode\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  while (node && node.nodeType !== Node.ELEMENT_NODE) {\n    node = node.parentNode;\n  }\n\n  if (node == null) {\n    return;\n  }\n\n  if (matchingSelector != null) {\n    if (node.closest && untilNode == null) {\n      return node.closest(matchingSelector);\n    } else {\n      while (node && node !== untilNode) {\n        if (elementMatchesSelector(node, matchingSelector)) {\n          return node;\n        }\n\n        node = node.parentNode;\n      }\n    }\n  } else {\n    return node;\n  }\n};\nconst findInnerElement = function (element) {\n  while ((_element = element) !== null && _element !== void 0 && _element.firstElementChild) {\n    var _element;\n\n    element = element.firstElementChild;\n  }\n\n  return element;\n};\nconst innerElementIsActive = element => document.activeElement !== element && elementContainsNode(element, document.activeElement);\nconst elementContainsNode = function (element, node) {\n  if (!element || !node) {\n    return;\n  }\n\n  while (node) {\n    if (node === element) {\n      return true;\n    }\n\n    node = node.parentNode;\n  }\n};\nconst findNodeFromContainerAndOffset = function (container, offset) {\n  if (!container) {\n    return;\n  }\n\n  if (container.nodeType === Node.TEXT_NODE) {\n    return container;\n  } else if (offset === 0) {\n    return container.firstChild != null ? container.firstChild : container;\n  } else {\n    return container.childNodes.item(offset - 1);\n  }\n};\nconst findElementFromContainerAndOffset = function (container, offset) {\n  const node = findNodeFromContainerAndOffset(container, offset);\n  return findClosestElementFromNode(node);\n};\nconst findChildIndexOfNode = function (node) {\n  var _node;\n\n  if (!((_node = node) !== null && _node !== void 0 && _node.parentNode)) {\n    return;\n  }\n\n  let childIndex = 0;\n  node = node.previousSibling;\n\n  while (node) {\n    childIndex++;\n    node = node.previousSibling;\n  }\n\n  return childIndex;\n};\nconst removeNode = node => {\n  var _node$parentNode;\n\n  return node === null || node === void 0 ? void 0 : (_node$parentNode = node.parentNode) === null || _node$parentNode === void 0 ? void 0 : _node$parentNode.removeChild(node);\n};\nconst walkTree = function (tree) {\n  let {\n    onlyNodesOfType,\n    usingFilter,\n    expandEntityReferences\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  const whatToShow = (() => {\n    switch (onlyNodesOfType) {\n      case \"element\":\n        return NodeFilter.SHOW_ELEMENT;\n\n      case \"text\":\n        return NodeFilter.SHOW_TEXT;\n\n      case \"comment\":\n        return NodeFilter.SHOW_COMMENT;\n\n      default:\n        return NodeFilter.SHOW_ALL;\n    }\n  })();\n\n  return document.createTreeWalker(tree, whatToShow, usingFilter != null ? usingFilter : null, expandEntityReferences === true);\n};\nconst tagName = element => {\n  var _element$tagName;\n\n  return element === null || element === void 0 ? void 0 : (_element$tagName = element.tagName) === null || _element$tagName === void 0 ? void 0 : _element$tagName.toLowerCase();\n};\nconst makeElement = function (tag) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  let key, value;\n\n  if (typeof tag === \"object\") {\n    options = tag;\n    tag = options.tagName;\n  } else {\n    options = {\n      attributes: options\n    };\n  }\n\n  const element = document.createElement(tag);\n\n  if (options.editable != null) {\n    if (options.attributes == null) {\n      options.attributes = {};\n    }\n\n    options.attributes.contenteditable = options.editable;\n  }\n\n  if (options.attributes) {\n    for (key in options.attributes) {\n      value = options.attributes[key];\n      element.setAttribute(key, value);\n    }\n  }\n\n  if (options.style) {\n    for (key in options.style) {\n      value = options.style[key];\n      element.style[key] = value;\n    }\n  }\n\n  if (options.data) {\n    for (key in options.data) {\n      value = options.data[key];\n      element.dataset[key] = value;\n    }\n  }\n\n  if (options.className) {\n    options.className.split(\" \").forEach(className => {\n      element.classList.add(className);\n    });\n  }\n\n  if (options.textContent) {\n    element.textContent = options.textContent;\n  }\n\n  if (options.childNodes) {\n    [].concat(options.childNodes).forEach(childNode => {\n      element.appendChild(childNode);\n    });\n  }\n\n  return element;\n};\nlet blockTagNames = undefined;\nconst getBlockTagNames = function () {\n  if (blockTagNames != null) {\n    return blockTagNames;\n  }\n\n  blockTagNames = [];\n\n  for (const key in attributes) {\n    const attributes$1 = attributes[key];\n\n    if (attributes$1.tagName) {\n      blockTagNames.push(attributes$1.tagName);\n    }\n  }\n\n  return blockTagNames;\n};\nconst nodeIsBlockContainer = node => nodeIsBlockStartComment(node === null || node === void 0 ? void 0 : node.firstChild);\nconst nodeProbablyIsBlockContainer = function (node) {\n  return getBlockTagNames().includes(tagName(node)) && !getBlockTagNames().includes(tagName(node.firstChild));\n};\nconst nodeIsBlockStart = function (node) {\n  let {\n    strict\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n    strict: true\n  };\n\n  if (strict) {\n    return nodeIsBlockStartComment(node);\n  } else {\n    return nodeIsBlockStartComment(node) || !nodeIsBlockStartComment(node.firstChild) && nodeProbablyIsBlockContainer(node);\n  }\n};\nconst nodeIsBlockStartComment = node => nodeIsCommentNode(node) && (node === null || node === void 0 ? void 0 : node.data) === \"block\";\nconst nodeIsCommentNode = node => (node === null || node === void 0 ? void 0 : node.nodeType) === Node.COMMENT_NODE;\nconst nodeIsCursorTarget = function (node) {\n  let {\n    name\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  if (!node) {\n    return;\n  }\n\n  if (nodeIsTextNode(node)) {\n    if (node.data === ZERO_WIDTH_SPACE) {\n      if (name) {\n        return node.parentNode.dataset.trixCursorTarget === name;\n      } else {\n        return true;\n      }\n    }\n  } else {\n    return nodeIsCursorTarget(node.firstChild);\n  }\n};\nconst nodeIsAttachmentElement = node => elementMatchesSelector(node, attachmentSelector);\nconst nodeIsEmptyTextNode = node => nodeIsTextNode(node) && (node === null || node === void 0 ? void 0 : node.data) === \"\";\nconst nodeIsTextNode = node => (node === null || node === void 0 ? void 0 : node.nodeType) === Node.TEXT_NODE;\n\nconst input = {\n  level2Enabled: true,\n\n  getLevel() {\n    if (this.level2Enabled && browser$1.supportsInputEvents) {\n      return 2;\n    } else {\n      return 0;\n    }\n  },\n\n  pickFiles(callback) {\n    const input = makeElement(\"input\", {\n      type: \"file\",\n      multiple: true,\n      hidden: true,\n      id: this.fileInputId\n    });\n    input.addEventListener(\"change\", () => {\n      callback(input.files);\n      removeNode(input);\n    });\n    removeNode(document.getElementById(this.fileInputId));\n    document.body.appendChild(input);\n    input.click();\n  }\n\n};\n\nvar keyNames$2 = {\n  8: \"backspace\",\n  9: \"tab\",\n  13: \"return\",\n  27: \"escape\",\n  37: \"left\",\n  39: \"right\",\n  46: \"delete\",\n  68: \"d\",\n  72: \"h\",\n  79: \"o\"\n};\n\nvar textAttributes = {\n  bold: {\n    tagName: \"strong\",\n    inheritable: true,\n\n    parser(element) {\n      const style = window.getComputedStyle(element);\n      return style.fontWeight === \"bold\" || style.fontWeight >= 600;\n    }\n\n  },\n  italic: {\n    tagName: \"em\",\n    inheritable: true,\n\n    parser(element) {\n      const style = window.getComputedStyle(element);\n      return style.fontStyle === \"italic\";\n    }\n\n  },\n  href: {\n    groupTagName: \"a\",\n\n    parser(element) {\n      const matchingSelector = \"a:not(\".concat(attachmentSelector, \")\");\n      const link = element.closest(matchingSelector);\n\n      if (link) {\n        return link.getAttribute(\"href\");\n      }\n    }\n\n  },\n  strike: {\n    tagName: \"del\",\n    inheritable: true\n  },\n  frozen: {\n    style: {\n      backgroundColor: \"highlight\"\n    }\n  }\n};\n\nvar toolbar = {\n  getDefaultHTML() {\n    return \"<div class=\\\"trix-button-row\\\">\\n      <span class=\\\"trix-button-group trix-button-group--text-tools\\\" data-trix-button-group=\\\"text-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-bold\\\" data-trix-attribute=\\\"bold\\\" data-trix-key=\\\"b\\\" title=\\\"\".concat(lang$1.bold, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.bold, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-italic\\\" data-trix-attribute=\\\"italic\\\" data-trix-key=\\\"i\\\" title=\\\"\").concat(lang$1.italic, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.italic, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-strike\\\" data-trix-attribute=\\\"strike\\\" title=\\\"\").concat(lang$1.strike, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.strike, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-link\\\" data-trix-attribute=\\\"href\\\" data-trix-action=\\\"link\\\" data-trix-key=\\\"k\\\" title=\\\"\").concat(lang$1.link, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.link, \"</button>\\n      </span>\\n\\n      <span class=\\\"trix-button-group trix-button-group--block-tools\\\" data-trix-button-group=\\\"block-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-heading-1\\\" data-trix-attribute=\\\"heading1\\\" title=\\\"\").concat(lang$1.heading1, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.heading1, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-quote\\\" data-trix-attribute=\\\"quote\\\" title=\\\"\").concat(lang$1.quote, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.quote, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-code\\\" data-trix-attribute=\\\"code\\\" title=\\\"\").concat(lang$1.code, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.code, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-bullet-list\\\" data-trix-attribute=\\\"bullet\\\" title=\\\"\").concat(lang$1.bullets, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.bullets, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-number-list\\\" data-trix-attribute=\\\"number\\\" title=\\\"\").concat(lang$1.numbers, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.numbers, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-decrease-nesting-level\\\" data-trix-action=\\\"decreaseNestingLevel\\\" title=\\\"\").concat(lang$1.outdent, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.outdent, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-increase-nesting-level\\\" data-trix-action=\\\"increaseNestingLevel\\\" title=\\\"\").concat(lang$1.indent, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.indent, \"</button>\\n      </span>\\n\\n      <span class=\\\"trix-button-group trix-button-group--file-tools\\\" data-trix-button-group=\\\"file-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-attach\\\" data-trix-action=\\\"attachFiles\\\" title=\\\"\").concat(lang$1.attachFiles, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.attachFiles, \"</button>\\n      </span>\\n\\n      <span class=\\\"trix-button-group-spacer\\\"></span>\\n\\n      <span class=\\\"trix-button-group trix-button-group--history-tools\\\" data-trix-button-group=\\\"history-tools\\\">\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-undo\\\" data-trix-action=\\\"undo\\\" data-trix-key=\\\"z\\\" title=\\\"\").concat(lang$1.undo, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.undo, \"</button>\\n        <button type=\\\"button\\\" class=\\\"trix-button trix-button--icon trix-button--icon-redo\\\" data-trix-action=\\\"redo\\\" data-trix-key=\\\"shift+z\\\" title=\\\"\").concat(lang$1.redo, \"\\\" tabindex=\\\"-1\\\">\").concat(lang$1.redo, \"</button>\\n      </span>\\n    </div>\\n\\n    <div class=\\\"trix-dialogs\\\" data-trix-dialogs>\\n      <div class=\\\"trix-dialog trix-dialog--link\\\" data-trix-dialog=\\\"href\\\" data-trix-dialog-attribute=\\\"href\\\">\\n        <div class=\\\"trix-dialog__link-fields\\\">\\n          <input type=\\\"url\\\" name=\\\"href\\\" class=\\\"trix-input trix-input--dialog\\\" placeholder=\\\"\").concat(lang$1.urlPlaceholder, \"\\\" aria-label=\\\"\").concat(lang$1.url, \"\\\" required data-trix-input>\\n          <div class=\\\"trix-button-group\\\">\\n            <input type=\\\"button\\\" class=\\\"trix-button trix-button--dialog\\\" value=\\\"\").concat(lang$1.link, \"\\\" data-trix-method=\\\"setAttribute\\\">\\n            <input type=\\\"button\\\" class=\\\"trix-button trix-button--dialog\\\" value=\\\"\").concat(lang$1.unlink, \"\\\" data-trix-method=\\\"removeAttribute\\\">\\n          </div>\\n        </div>\\n      </div>\\n    </div>\");\n  }\n\n};\n\nconst undoInterval = 5000;\n\nconst config = {\n  attachments,\n  blockAttributes: attributes,\n  browser: browser$1,\n  css: css$3,\n  fileSize,\n  input,\n  keyNames: keyNames$2,\n  lang: lang$1,\n  textAttributes,\n  toolbar,\n  undoInterval\n};\n\nfunction createMetadataMethodsForProperty(metadataMap, kind, property, decoratorFinishedRef) {\n  return {\n    getMetadata: function (key) {\n      assertNotFinished(decoratorFinishedRef, \"getMetadata\"), assertMetadataKey(key);\n      var metadataForKey = metadataMap[key];\n      if (void 0 !== metadataForKey) if (1 === kind) {\n        var pub = metadataForKey.public;\n        if (void 0 !== pub) return pub[property];\n      } else if (2 === kind) {\n        var priv = metadataForKey.private;\n        if (void 0 !== priv) return priv.get(property);\n      } else if (Object.hasOwnProperty.call(metadataForKey, \"constructor\")) return metadataForKey.constructor;\n    },\n    setMetadata: function (key, value) {\n      assertNotFinished(decoratorFinishedRef, \"setMetadata\"), assertMetadataKey(key);\n      var metadataForKey = metadataMap[key];\n\n      if (void 0 === metadataForKey && (metadataForKey = metadataMap[key] = {}), 1 === kind) {\n        var pub = metadataForKey.public;\n        void 0 === pub && (pub = metadataForKey.public = {}), pub[property] = value;\n      } else if (2 === kind) {\n        var priv = metadataForKey.priv;\n        void 0 === priv && (priv = metadataForKey.private = new Map()), priv.set(property, value);\n      } else metadataForKey.constructor = value;\n    }\n  };\n}\n\nfunction convertMetadataMapToFinal(obj, metadataMap) {\n  var parentMetadataMap = obj[Symbol.metadata || Symbol.for(\"Symbol.metadata\")],\n      metadataKeys = Object.getOwnPropertySymbols(metadataMap);\n\n  if (0 !== metadataKeys.length) {\n    for (var i = 0; i < metadataKeys.length; i++) {\n      var key = metadataKeys[i],\n          metaForKey = metadataMap[key],\n          parentMetaForKey = parentMetadataMap ? parentMetadataMap[key] : null,\n          pub = metaForKey.public,\n          parentPub = parentMetaForKey ? parentMetaForKey.public : null;\n      pub && parentPub && Object.setPrototypeOf(pub, parentPub);\n      var priv = metaForKey.private;\n\n      if (priv) {\n        var privArr = Array.from(priv.values()),\n            parentPriv = parentMetaForKey ? parentMetaForKey.private : null;\n        parentPriv && (privArr = privArr.concat(parentPriv)), metaForKey.private = privArr;\n      }\n\n      parentMetaForKey && Object.setPrototypeOf(metaForKey, parentMetaForKey);\n    }\n\n    parentMetadataMap && Object.setPrototypeOf(metadataMap, parentMetadataMap), obj[Symbol.metadata || Symbol.for(\"Symbol.metadata\")] = metadataMap;\n  }\n}\n\nfunction createAddInitializerMethod(initializers, decoratorFinishedRef) {\n  return function (initializer) {\n    assertNotFinished(decoratorFinishedRef, \"addInitializer\"), assertCallable(initializer, \"An initializer\"), initializers.push(initializer);\n  };\n}\n\nfunction memberDec(dec, name, desc, metadataMap, initializers, kind, isStatic, isPrivate, value) {\n  var kindStr;\n\n  switch (kind) {\n    case 1:\n      kindStr = \"accessor\";\n      break;\n\n    case 2:\n      kindStr = \"method\";\n      break;\n\n    case 3:\n      kindStr = \"getter\";\n      break;\n\n    case 4:\n      kindStr = \"setter\";\n      break;\n\n    default:\n      kindStr = \"field\";\n  }\n\n  var metadataKind,\n      metadataName,\n      ctx = {\n    kind: kindStr,\n    name: isPrivate ? \"#\" + name : name,\n    isStatic: isStatic,\n    isPrivate: isPrivate\n  },\n      decoratorFinishedRef = {\n    v: !1\n  };\n\n  if (0 !== kind && (ctx.addInitializer = createAddInitializerMethod(initializers, decoratorFinishedRef)), isPrivate) {\n    metadataKind = 2, metadataName = Symbol(name);\n    var access = {};\n    0 === kind ? (access.get = desc.get, access.set = desc.set) : 2 === kind ? access.get = function () {\n      return desc.value;\n    } : (1 !== kind && 3 !== kind || (access.get = function () {\n      return desc.get.call(this);\n    }), 1 !== kind && 4 !== kind || (access.set = function (v) {\n      desc.set.call(this, v);\n    })), ctx.access = access;\n  } else metadataKind = 1, metadataName = name;\n\n  try {\n    return dec(value, Object.assign(ctx, createMetadataMethodsForProperty(metadataMap, metadataKind, metadataName, decoratorFinishedRef)));\n  } finally {\n    decoratorFinishedRef.v = !0;\n  }\n}\n\nfunction assertNotFinished(decoratorFinishedRef, fnName) {\n  if (decoratorFinishedRef.v) throw new Error(\"attempted to call \" + fnName + \" after decoration was finished\");\n}\n\nfunction assertMetadataKey(key) {\n  if (\"symbol\" != typeof key) throw new TypeError(\"Metadata keys must be symbols, received: \" + key);\n}\n\nfunction assertCallable(fn, hint) {\n  if (\"function\" != typeof fn) throw new TypeError(hint + \" must be a function\");\n}\n\nfunction assertValidReturnValue(kind, value) {\n  var type = typeof value;\n\n  if (1 === kind) {\n    if (\"object\" !== type || null === value) throw new TypeError(\"accessor decorators must return an object with get, set, or init properties or void 0\");\n    void 0 !== value.get && assertCallable(value.get, \"accessor.get\"), void 0 !== value.set && assertCallable(value.set, \"accessor.set\"), void 0 !== value.init && assertCallable(value.init, \"accessor.init\"), void 0 !== value.initializer && assertCallable(value.initializer, \"accessor.initializer\");\n  } else if (\"function\" !== type) {\n    var hint;\n    throw hint = 0 === kind ? \"field\" : 10 === kind ? \"class\" : \"method\", new TypeError(hint + \" decorators must return a function or void 0\");\n  }\n}\n\nfunction getInit(desc) {\n  var initializer;\n  return null == (initializer = desc.init) && (initializer = desc.initializer) && \"undefined\" != typeof console && console.warn(\".initializer has been renamed to .init as of March 2022\"), initializer;\n}\n\nfunction applyMemberDec(ret, base, decInfo, name, kind, isStatic, isPrivate, metadataMap, initializers) {\n  var desc,\n      initializer,\n      value,\n      newValue,\n      get,\n      set,\n      decs = decInfo[0];\n  if (isPrivate ? desc = 0 === kind || 1 === kind ? {\n    get: decInfo[3],\n    set: decInfo[4]\n  } : 3 === kind ? {\n    get: decInfo[3]\n  } : 4 === kind ? {\n    set: decInfo[3]\n  } : {\n    value: decInfo[3]\n  } : 0 !== kind && (desc = Object.getOwnPropertyDescriptor(base, name)), 1 === kind ? value = {\n    get: desc.get,\n    set: desc.set\n  } : 2 === kind ? value = desc.value : 3 === kind ? value = desc.get : 4 === kind && (value = desc.set), \"function\" == typeof decs) void 0 !== (newValue = memberDec(decs, name, desc, metadataMap, initializers, kind, isStatic, isPrivate, value)) && (assertValidReturnValue(kind, newValue), 0 === kind ? initializer = newValue : 1 === kind ? (initializer = getInit(newValue), get = newValue.get || value.get, set = newValue.set || value.set, value = {\n    get: get,\n    set: set\n  }) : value = newValue);else for (var i = decs.length - 1; i >= 0; i--) {\n    var newInit;\n    if (void 0 !== (newValue = memberDec(decs[i], name, desc, metadataMap, initializers, kind, isStatic, isPrivate, value))) assertValidReturnValue(kind, newValue), 0 === kind ? newInit = newValue : 1 === kind ? (newInit = getInit(newValue), get = newValue.get || value.get, set = newValue.set || value.set, value = {\n      get: get,\n      set: set\n    }) : value = newValue, void 0 !== newInit && (void 0 === initializer ? initializer = newInit : \"function\" == typeof initializer ? initializer = [initializer, newInit] : initializer.push(newInit));\n  }\n\n  if (0 === kind || 1 === kind) {\n    if (void 0 === initializer) initializer = function (instance, init) {\n      return init;\n    };else if (\"function\" != typeof initializer) {\n      var ownInitializers = initializer;\n\n      initializer = function (instance, init) {\n        for (var value = init, i = 0; i < ownInitializers.length; i++) value = ownInitializers[i].call(instance, value);\n\n        return value;\n      };\n    } else {\n      var originalInitializer = initializer;\n\n      initializer = function (instance, init) {\n        return originalInitializer.call(instance, init);\n      };\n    }\n    ret.push(initializer);\n  }\n\n  0 !== kind && (1 === kind ? (desc.get = value.get, desc.set = value.set) : 2 === kind ? desc.value = value : 3 === kind ? desc.get = value : 4 === kind && (desc.set = value), isPrivate ? 1 === kind ? (ret.push(function (instance, args) {\n    return value.get.call(instance, args);\n  }), ret.push(function (instance, args) {\n    return value.set.call(instance, args);\n  })) : 2 === kind ? ret.push(value) : ret.push(function (instance, args) {\n    return value.call(instance, args);\n  }) : Object.defineProperty(base, name, desc));\n}\n\nfunction applyMemberDecs(ret, Class, protoMetadataMap, staticMetadataMap, decInfos) {\n  for (var protoInitializers, staticInitializers, existingProtoNonFields = new Map(), existingStaticNonFields = new Map(), i = 0; i < decInfos.length; i++) {\n    var decInfo = decInfos[i];\n\n    if (Array.isArray(decInfo)) {\n      var base,\n          metadataMap,\n          initializers,\n          kind = decInfo[1],\n          name = decInfo[2],\n          isPrivate = decInfo.length > 3,\n          isStatic = kind >= 5;\n\n      if (isStatic ? (base = Class, metadataMap = staticMetadataMap, 0 !== (kind -= 5) && (initializers = staticInitializers = staticInitializers || [])) : (base = Class.prototype, metadataMap = protoMetadataMap, 0 !== kind && (initializers = protoInitializers = protoInitializers || [])), 0 !== kind && !isPrivate) {\n        var existingNonFields = isStatic ? existingStaticNonFields : existingProtoNonFields,\n            existingKind = existingNonFields.get(name) || 0;\n        if (!0 === existingKind || 3 === existingKind && 4 !== kind || 4 === existingKind && 3 !== kind) throw new Error(\"Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: \" + name);\n        !existingKind && kind > 2 ? existingNonFields.set(name, kind) : existingNonFields.set(name, !0);\n      }\n\n      applyMemberDec(ret, base, decInfo, name, kind, isStatic, isPrivate, metadataMap, initializers);\n    }\n  }\n\n  pushInitializers(ret, protoInitializers), pushInitializers(ret, staticInitializers);\n}\n\nfunction pushInitializers(ret, initializers) {\n  initializers && ret.push(function (instance) {\n    for (var i = 0; i < initializers.length; i++) initializers[i].call(instance);\n\n    return instance;\n  });\n}\n\nfunction applyClassDecs(ret, targetClass, metadataMap, classDecs) {\n  if (classDecs.length > 0) {\n    for (var initializers = [], newClass = targetClass, name = targetClass.name, i = classDecs.length - 1; i >= 0; i--) {\n      var decoratorFinishedRef = {\n        v: !1\n      };\n\n      try {\n        var ctx = Object.assign({\n          kind: \"class\",\n          name: name,\n          addInitializer: createAddInitializerMethod(initializers, decoratorFinishedRef)\n        }, createMetadataMethodsForProperty(metadataMap, 0, name, decoratorFinishedRef)),\n            nextNewClass = classDecs[i](newClass, ctx);\n      } finally {\n        decoratorFinishedRef.v = !0;\n      }\n\n      void 0 !== nextNewClass && (assertValidReturnValue(10, nextNewClass), newClass = nextNewClass);\n    }\n\n    ret.push(newClass, function () {\n      for (var i = 0; i < initializers.length; i++) initializers[i].call(newClass);\n    });\n  }\n}\n\nfunction _applyDecs(targetClass, memberDecs, classDecs) {\n  var ret = [],\n      staticMetadataMap = {},\n      protoMetadataMap = {};\n  return applyMemberDecs(ret, targetClass, protoMetadataMap, staticMetadataMap, memberDecs), convertMetadataMapToFinal(targetClass.prototype, protoMetadataMap), applyClassDecs(ret, targetClass, staticMetadataMap, classDecs), convertMetadataMapToFinal(targetClass, staticMetadataMap), ret;\n}\n\nfunction _asyncIterator(iterable) {\n  var method,\n      async,\n      sync,\n      retry = 2;\n\n  for (\"undefined\" != typeof Symbol && (async = Symbol.asyncIterator, sync = Symbol.iterator); retry--;) {\n    if (async && null != (method = iterable[async])) return method.call(iterable);\n    if (sync && null != (method = iterable[sync])) return new AsyncFromSyncIterator(method.call(iterable));\n    async = \"@@asyncIterator\", sync = \"@@iterator\";\n  }\n\n  throw new TypeError(\"Object is not async iterable\");\n}\n\nfunction AsyncFromSyncIterator(s) {\n  function AsyncFromSyncIteratorContinuation(r) {\n    if (Object(r) !== r) return Promise.reject(new TypeError(r + \" is not an object.\"));\n    var done = r.done;\n    return Promise.resolve(r.value).then(function (value) {\n      return {\n        value: value,\n        done: done\n      };\n    });\n  }\n\n  return AsyncFromSyncIterator = function (s) {\n    this.s = s, this.n = s.next;\n  }, AsyncFromSyncIterator.prototype = {\n    s: null,\n    n: null,\n    next: function () {\n      return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments));\n    },\n    return: function (value) {\n      var ret = this.s.return;\n      return void 0 === ret ? Promise.resolve({\n        value: value,\n        done: !0\n      }) : AsyncFromSyncIteratorContinuation(ret.apply(this.s, arguments));\n    },\n    throw: function (value) {\n      var thr = this.s.return;\n      return void 0 === thr ? Promise.reject(value) : AsyncFromSyncIteratorContinuation(thr.apply(this.s, arguments));\n    }\n  }, new AsyncFromSyncIterator(s);\n}\n\nvar REACT_ELEMENT_TYPE;\n\nfunction _jsx(type, props, key, children) {\n  REACT_ELEMENT_TYPE || (REACT_ELEMENT_TYPE = \"function\" == typeof Symbol && Symbol.for && Symbol.for(\"react.element\") || 60103);\n  var defaultProps = type && type.defaultProps,\n      childrenLength = arguments.length - 3;\n  if (props || 0 === childrenLength || (props = {\n    children: void 0\n  }), 1 === childrenLength) props.children = children;else if (childrenLength > 1) {\n    for (var childArray = new Array(childrenLength), i = 0; i < childrenLength; i++) childArray[i] = arguments[i + 3];\n\n    props.children = childArray;\n  }\n  if (props && defaultProps) for (var propName in defaultProps) void 0 === props[propName] && (props[propName] = defaultProps[propName]);else props || (props = defaultProps || {});\n  return {\n    $$typeof: REACT_ELEMENT_TYPE,\n    type: type,\n    key: void 0 === key ? null : \"\" + key,\n    ref: null,\n    props: props,\n    _owner: null\n  };\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n\nfunction _wrapRegExp() {\n  _wrapRegExp = function (re, groups) {\n    return new BabelRegExp(re, void 0, groups);\n  };\n\n  var _super = RegExp.prototype,\n      _groups = new WeakMap();\n\n  function BabelRegExp(re, flags, groups) {\n    var _this = new RegExp(re, flags);\n\n    return _groups.set(_this, groups || _groups.get(re)), _setPrototypeOf(_this, BabelRegExp.prototype);\n  }\n\n  function buildGroups(result, re) {\n    var g = _groups.get(re);\n\n    return Object.keys(g).reduce(function (groups, name) {\n      return groups[name] = result[g[name]], groups;\n    }, Object.create(null));\n  }\n\n  return _inherits(BabelRegExp, RegExp), BabelRegExp.prototype.exec = function (str) {\n    var result = _super.exec.call(this, str);\n\n    return result && (result.groups = buildGroups(result, this)), result;\n  }, BabelRegExp.prototype[Symbol.replace] = function (str, substitution) {\n    if (\"string\" == typeof substitution) {\n      var groups = _groups.get(this);\n\n      return _super[Symbol.replace].call(this, str, substitution.replace(/\\$<([^>]+)>/g, function (_, name) {\n        return \"$\" + groups[name];\n      }));\n    }\n\n    if (\"function\" == typeof substitution) {\n      var _this = this;\n\n      return _super[Symbol.replace].call(this, str, function () {\n        var args = arguments;\n        return \"object\" != typeof args[args.length - 1] && (args = [].slice.call(args)).push(buildGroups(args, _this)), substitution.apply(this, args);\n      });\n    }\n\n    return _super[Symbol.replace].call(this, str, substitution);\n  }, _wrapRegExp.apply(this, arguments);\n}\n\nfunction _AwaitValue(value) {\n  this.wrapped = value;\n}\n\nfunction _AsyncGenerator(gen) {\n  var front, back;\n\n  function send(key, arg) {\n    return new Promise(function (resolve, reject) {\n      var request = {\n        key: key,\n        arg: arg,\n        resolve: resolve,\n        reject: reject,\n        next: null\n      };\n\n      if (back) {\n        back = back.next = request;\n      } else {\n        front = back = request;\n        resume(key, arg);\n      }\n    });\n  }\n\n  function resume(key, arg) {\n    try {\n      var result = gen[key](arg);\n      var value = result.value;\n      var wrappedAwait = value instanceof _AwaitValue;\n      Promise.resolve(wrappedAwait ? value.wrapped : value).then(function (arg) {\n        if (wrappedAwait) {\n          resume(key === \"return\" ? \"return\" : \"next\", arg);\n          return;\n        }\n\n        settle(result.done ? \"return\" : \"normal\", arg);\n      }, function (err) {\n        resume(\"throw\", err);\n      });\n    } catch (err) {\n      settle(\"throw\", err);\n    }\n  }\n\n  function settle(type, value) {\n    switch (type) {\n      case \"return\":\n        front.resolve({\n          value: value,\n          done: true\n        });\n        break;\n\n      case \"throw\":\n        front.reject(value);\n        break;\n\n      default:\n        front.resolve({\n          value: value,\n          done: false\n        });\n        break;\n    }\n\n    front = front.next;\n\n    if (front) {\n      resume(front.key, front.arg);\n    } else {\n      back = null;\n    }\n  }\n\n  this._invoke = send;\n\n  if (typeof gen.return !== \"function\") {\n    this.return = undefined;\n  }\n}\n\n_AsyncGenerator.prototype[typeof Symbol === \"function\" && Symbol.asyncIterator || \"@@asyncIterator\"] = function () {\n  return this;\n};\n\n_AsyncGenerator.prototype.next = function (arg) {\n  return this._invoke(\"next\", arg);\n};\n\n_AsyncGenerator.prototype.throw = function (arg) {\n  return this._invoke(\"throw\", arg);\n};\n\n_AsyncGenerator.prototype.return = function (arg) {\n  return this._invoke(\"return\", arg);\n};\n\nfunction _wrapAsyncGenerator(fn) {\n  return function () {\n    return new _AsyncGenerator(fn.apply(this, arguments));\n  };\n}\n\nfunction _awaitAsyncGenerator(value) {\n  return new _AwaitValue(value);\n}\n\nfunction _asyncGeneratorDelegate(inner, awaitWrap) {\n  var iter = {},\n      waiting = false;\n\n  function pump(key, value) {\n    waiting = true;\n    value = new Promise(function (resolve) {\n      resolve(inner[key](value));\n    });\n    return {\n      done: false,\n      value: awaitWrap(value)\n    };\n  }\n\n  ;\n\n  iter[typeof Symbol !== \"undefined\" && Symbol.iterator || \"@@iterator\"] = function () {\n    return this;\n  };\n\n  iter.next = function (value) {\n    if (waiting) {\n      waiting = false;\n      return value;\n    }\n\n    return pump(\"next\", value);\n  };\n\n  if (typeof inner.throw === \"function\") {\n    iter.throw = function (value) {\n      if (waiting) {\n        waiting = false;\n        throw value;\n      }\n\n      return pump(\"throw\", value);\n    };\n  }\n\n  if (typeof inner.return === \"function\") {\n    iter.return = function (value) {\n      if (waiting) {\n        waiting = false;\n        return value;\n      }\n\n      return pump(\"return\", value);\n    };\n  }\n\n  return iter;\n}\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nfunction _defineEnumerableProperties(obj, descs) {\n  for (var key in descs) {\n    var desc = descs[key];\n    desc.configurable = desc.enumerable = true;\n    if (\"value\" in desc) desc.writable = true;\n    Object.defineProperty(obj, key, desc);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    var objectSymbols = Object.getOwnPropertySymbols(descs);\n\n    for (var i = 0; i < objectSymbols.length; i++) {\n      var sym = objectSymbols[i];\n      var desc = descs[sym];\n      desc.configurable = desc.enumerable = true;\n      if (\"value\" in desc) desc.writable = true;\n      Object.defineProperty(obj, sym, desc);\n    }\n  }\n\n  return obj;\n}\n\nfunction _defaults(obj, defaults) {\n  var keys = Object.getOwnPropertyNames(defaults);\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n    if (value && value.configurable && obj[key] === undefined) {\n      Object.defineProperty(obj, key, value);\n    }\n  }\n\n  return obj;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? Object(arguments[i]) : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys.push.apply(ownKeys, Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n\n  _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _isNativeFunction(fn) {\n  return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n}\n\nfunction _wrapNativeSuper(Class) {\n  var _cache = typeof Map === \"function\" ? new Map() : undefined;\n\n  _wrapNativeSuper = function _wrapNativeSuper(Class) {\n    if (Class === null || !_isNativeFunction(Class)) return Class;\n\n    if (typeof Class !== \"function\") {\n      throw new TypeError(\"Super expression must either be null or a function\");\n    }\n\n    if (typeof _cache !== \"undefined\") {\n      if (_cache.has(Class)) return _cache.get(Class);\n\n      _cache.set(Class, Wrapper);\n    }\n\n    function Wrapper() {\n      return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n    }\n\n    Wrapper.prototype = Object.create(Class.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    return _setPrototypeOf(Wrapper, Class);\n  };\n\n  return _wrapNativeSuper(Class);\n}\n\nfunction _instanceof(left, right) {\n  if (right != null && typeof Symbol !== \"undefined\" && right[Symbol.hasInstance]) {\n    return !!right[Symbol.hasInstance](left);\n  } else {\n    return left instanceof right;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function (nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\n\nfunction _interopRequireWildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache(nodeInterop);\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj.default = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction _newArrowCheck(innerThis, boundThis) {\n  if (innerThis !== boundThis) {\n    throw new TypeError(\"Cannot instantiate an arrow function\");\n  }\n}\n\nfunction _objectDestructuringEmpty(obj) {\n  if (obj == null) throw new TypeError(\"Cannot destructure undefined\");\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nfunction _get() {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(arguments.length < 3 ? target : receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get.apply(this, arguments);\n}\n\nfunction set(target, property, value, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.set) {\n    set = Reflect.set;\n  } else {\n    set = function set(target, property, value, receiver) {\n      var base = _superPropBase(target, property);\n\n      var desc;\n\n      if (base) {\n        desc = Object.getOwnPropertyDescriptor(base, property);\n\n        if (desc.set) {\n          desc.set.call(receiver, value);\n          return true;\n        } else if (!desc.writable) {\n          return false;\n        }\n      }\n\n      desc = Object.getOwnPropertyDescriptor(receiver, property);\n\n      if (desc) {\n        if (!desc.writable) {\n          return false;\n        }\n\n        desc.value = value;\n        Object.defineProperty(receiver, property, desc);\n      } else {\n        _defineProperty(receiver, property, value);\n      }\n\n      return true;\n    };\n  }\n\n  return set(target, property, value, receiver);\n}\n\nfunction _set(target, property, value, receiver, isStrict) {\n  var s = set(target, property, value, receiver || target);\n\n  if (!s && isStrict) {\n    throw new Error('failed to set property');\n  }\n\n  return value;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  return Object.freeze(Object.defineProperties(strings, {\n    raw: {\n      value: Object.freeze(raw)\n    }\n  }));\n}\n\nfunction _taggedTemplateLiteralLoose(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  strings.raw = raw;\n  return strings;\n}\n\nfunction _readOnlyError(name) {\n  throw new TypeError(\"\\\"\" + name + \"\\\" is read-only\");\n}\n\nfunction _writeOnlyError(name) {\n  throw new TypeError(\"\\\"\" + name + \"\\\" is write-only\");\n}\n\nfunction _classNameTDZError(name) {\n  throw new Error(\"Class \\\"\" + name + \"\\\" cannot be referenced in computed property keys.\");\n}\n\nfunction _temporalUndefined() {}\n\nfunction _tdz(name) {\n  throw new ReferenceError(name + \" is not defined - temporal dead zone\");\n}\n\nfunction _temporalRef(val, name) {\n  return val === _temporalUndefined ? _tdz(name) : val;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _slicedToArrayLoose(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimitLoose(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toArray(arr) {\n  return _arrayWithHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _maybeArrayLike(next, arr, i) {\n  if (arr && !Array.isArray(arr) && typeof arr.length === \"number\") {\n    var len = arr.length;\n    return _arrayLikeToArray(arr, i !== void 0 && i < len ? i : len);\n  }\n\n  return next(arr, i);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _iterableToArrayLimitLoose(arr, i) {\n  var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]);\n\n  if (_i == null) return;\n  var _arr = [];\n\n  for (_i = _i.call(arr), _step; !(_step = _i.next()).done;) {\n    _arr.push(_step.value);\n\n    if (i && _arr.length === i) break;\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function () {};\n\n      return {\n        s: F,\n        n: function () {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function (e) {\n          throw e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function () {\n      it = it.call(o);\n    },\n    n: function () {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function (e) {\n      didErr = true;\n      err = e;\n    },\n    f: function () {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (it) return (it = it.call(o)).next.bind(it);\n\n  if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n    if (it) o = it;\n    var i = 0;\n    return function () {\n      if (i >= o.length) return {\n        done: true\n      };\n      return {\n        done: false,\n        value: o[i++]\n      };\n    };\n  }\n\n  throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _skipFirstGeneratorNext(fn) {\n  return function () {\n    var it = fn.apply(this, arguments);\n    it.next();\n    return it;\n  };\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nfunction _initializerWarningHelper(descriptor, context) {\n  throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and runs after the decorators transform.');\n}\n\nfunction _initializerDefineProperty(target, property, descriptor, context) {\n  if (!descriptor) return;\n  Object.defineProperty(target, property, {\n    enumerable: descriptor.enumerable,\n    configurable: descriptor.configurable,\n    writable: descriptor.writable,\n    value: descriptor.initializer ? descriptor.initializer.call(context) : void 0\n  });\n}\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n  var desc = {};\n  Object.keys(descriptor).forEach(function (key) {\n    desc[key] = descriptor[key];\n  });\n  desc.enumerable = !!desc.enumerable;\n  desc.configurable = !!desc.configurable;\n\n  if ('value' in desc || desc.initializer) {\n    desc.writable = true;\n  }\n\n  desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n    return decorator(target, property, desc) || desc;\n  }, desc);\n\n  if (context && desc.initializer !== void 0) {\n    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n    desc.initializer = undefined;\n  }\n\n  if (desc.initializer === void 0) {\n    Object.defineProperty(target, property, desc);\n    desc = null;\n  }\n\n  return desc;\n}\n\nvar id$2 = 0;\n\nfunction _classPrivateFieldLooseKey(name) {\n  return \"__private_\" + id$2++ + \"_\" + name;\n}\n\nfunction _classPrivateFieldLooseBase(receiver, privateKey) {\n  if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n    throw new TypeError(\"attempted to use private field on non-instance\");\n  }\n\n  return receiver;\n}\n\nfunction _classPrivateFieldGet(receiver, privateMap) {\n  var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"get\");\n\n  return _classApplyDescriptorGet(receiver, descriptor);\n}\n\nfunction _classPrivateFieldSet(receiver, privateMap, value) {\n  var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"set\");\n\n  _classApplyDescriptorSet(receiver, descriptor, value);\n\n  return value;\n}\n\nfunction _classPrivateFieldDestructureSet(receiver, privateMap) {\n  var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"set\");\n\n  return _classApplyDescriptorDestructureSet(receiver, descriptor);\n}\n\nfunction _classExtractFieldDescriptor(receiver, privateMap, action) {\n  if (!privateMap.has(receiver)) {\n    throw new TypeError(\"attempted to \" + action + \" private field on non-instance\");\n  }\n\n  return privateMap.get(receiver);\n}\n\nfunction _classStaticPrivateFieldSpecGet(receiver, classConstructor, descriptor) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  _classCheckPrivateStaticFieldDescriptor(descriptor, \"get\");\n\n  return _classApplyDescriptorGet(receiver, descriptor);\n}\n\nfunction _classStaticPrivateFieldSpecSet(receiver, classConstructor, descriptor, value) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  _classCheckPrivateStaticFieldDescriptor(descriptor, \"set\");\n\n  _classApplyDescriptorSet(receiver, descriptor, value);\n\n  return value;\n}\n\nfunction _classStaticPrivateMethodGet(receiver, classConstructor, method) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  return method;\n}\n\nfunction _classStaticPrivateMethodSet() {\n  throw new TypeError(\"attempted to set read only static private field\");\n}\n\nfunction _classApplyDescriptorGet(receiver, descriptor) {\n  if (descriptor.get) {\n    return descriptor.get.call(receiver);\n  }\n\n  return descriptor.value;\n}\n\nfunction _classApplyDescriptorSet(receiver, descriptor, value) {\n  if (descriptor.set) {\n    descriptor.set.call(receiver, value);\n  } else {\n    if (!descriptor.writable) {\n      throw new TypeError(\"attempted to set read only private field\");\n    }\n\n    descriptor.value = value;\n  }\n}\n\nfunction _classApplyDescriptorDestructureSet(receiver, descriptor) {\n  if (descriptor.set) {\n    if (!(\"__destrObj\" in descriptor)) {\n      descriptor.__destrObj = {\n        set value(v) {\n          descriptor.set.call(receiver, v);\n        }\n\n      };\n    }\n\n    return descriptor.__destrObj;\n  } else {\n    if (!descriptor.writable) {\n      throw new TypeError(\"attempted to set read only private field\");\n    }\n\n    return descriptor;\n  }\n}\n\nfunction _classStaticPrivateFieldDestructureSet(receiver, classConstructor, descriptor) {\n  _classCheckPrivateStaticAccess(receiver, classConstructor);\n\n  _classCheckPrivateStaticFieldDescriptor(descriptor, \"set\");\n\n  return _classApplyDescriptorDestructureSet(receiver, descriptor);\n}\n\nfunction _classCheckPrivateStaticAccess(receiver, classConstructor) {\n  if (receiver !== classConstructor) {\n    throw new TypeError(\"Private static access of wrong provenance\");\n  }\n}\n\nfunction _classCheckPrivateStaticFieldDescriptor(descriptor, action) {\n  if (descriptor === undefined) {\n    throw new TypeError(\"attempted to \" + action + \" private static field before its declaration\");\n  }\n}\n\nfunction _decorate(decorators, factory, superClass, mixins) {\n  var api = _getDecoratorsApi();\n\n  if (mixins) {\n    for (var i = 0; i < mixins.length; i++) {\n      api = mixins[i](api);\n    }\n  }\n\n  var r = factory(function initialize(O) {\n    api.initializeInstanceElements(O, decorated.elements);\n  }, superClass);\n  var decorated = api.decorateClass(_coalesceClassElements(r.d.map(_createElementDescriptor)), decorators);\n  api.initializeClassElements(r.F, decorated.elements);\n  return api.runClassFinishers(r.F, decorated.finishers);\n}\n\nfunction _getDecoratorsApi() {\n  _getDecoratorsApi = function () {\n    return api;\n  };\n\n  var api = {\n    elementsDefinitionOrder: [[\"method\"], [\"field\"]],\n    initializeInstanceElements: function (O, elements) {\n      [\"method\", \"field\"].forEach(function (kind) {\n        elements.forEach(function (element) {\n          if (element.kind === kind && element.placement === \"own\") {\n            this.defineClassElement(O, element);\n          }\n        }, this);\n      }, this);\n    },\n    initializeClassElements: function (F, elements) {\n      var proto = F.prototype;\n      [\"method\", \"field\"].forEach(function (kind) {\n        elements.forEach(function (element) {\n          var placement = element.placement;\n\n          if (element.kind === kind && (placement === \"static\" || placement === \"prototype\")) {\n            var receiver = placement === \"static\" ? F : proto;\n            this.defineClassElement(receiver, element);\n          }\n        }, this);\n      }, this);\n    },\n    defineClassElement: function (receiver, element) {\n      var descriptor = element.descriptor;\n\n      if (element.kind === \"field\") {\n        var initializer = element.initializer;\n        descriptor = {\n          enumerable: descriptor.enumerable,\n          writable: descriptor.writable,\n          configurable: descriptor.configurable,\n          value: initializer === void 0 ? void 0 : initializer.call(receiver)\n        };\n      }\n\n      Object.defineProperty(receiver, element.key, descriptor);\n    },\n    decorateClass: function (elements, decorators) {\n      var newElements = [];\n      var finishers = [];\n      var placements = {\n        static: [],\n        prototype: [],\n        own: []\n      };\n      elements.forEach(function (element) {\n        this.addElementPlacement(element, placements);\n      }, this);\n      elements.forEach(function (element) {\n        if (!_hasDecorators(element)) return newElements.push(element);\n        var elementFinishersExtras = this.decorateElement(element, placements);\n        newElements.push(elementFinishersExtras.element);\n        newElements.push.apply(newElements, elementFinishersExtras.extras);\n        finishers.push.apply(finishers, elementFinishersExtras.finishers);\n      }, this);\n\n      if (!decorators) {\n        return {\n          elements: newElements,\n          finishers: finishers\n        };\n      }\n\n      var result = this.decorateConstructor(newElements, decorators);\n      finishers.push.apply(finishers, result.finishers);\n      result.finishers = finishers;\n      return result;\n    },\n    addElementPlacement: function (element, placements, silent) {\n      var keys = placements[element.placement];\n\n      if (!silent && keys.indexOf(element.key) !== -1) {\n        throw new TypeError(\"Duplicated element (\" + element.key + \")\");\n      }\n\n      keys.push(element.key);\n    },\n    decorateElement: function (element, placements) {\n      var extras = [];\n      var finishers = [];\n\n      for (var decorators = element.decorators, i = decorators.length - 1; i >= 0; i--) {\n        var keys = placements[element.placement];\n        keys.splice(keys.indexOf(element.key), 1);\n        var elementObject = this.fromElementDescriptor(element);\n        var elementFinisherExtras = this.toElementFinisherExtras((0, decorators[i])(elementObject) || elementObject);\n        element = elementFinisherExtras.element;\n        this.addElementPlacement(element, placements);\n\n        if (elementFinisherExtras.finisher) {\n          finishers.push(elementFinisherExtras.finisher);\n        }\n\n        var newExtras = elementFinisherExtras.extras;\n\n        if (newExtras) {\n          for (var j = 0; j < newExtras.length; j++) {\n            this.addElementPlacement(newExtras[j], placements);\n          }\n\n          extras.push.apply(extras, newExtras);\n        }\n      }\n\n      return {\n        element: element,\n        finishers: finishers,\n        extras: extras\n      };\n    },\n    decorateConstructor: function (elements, decorators) {\n      var finishers = [];\n\n      for (var i = decorators.length - 1; i >= 0; i--) {\n        var obj = this.fromClassDescriptor(elements);\n        var elementsAndFinisher = this.toClassDescriptor((0, decorators[i])(obj) || obj);\n\n        if (elementsAndFinisher.finisher !== undefined) {\n          finishers.push(elementsAndFinisher.finisher);\n        }\n\n        if (elementsAndFinisher.elements !== undefined) {\n          elements = elementsAndFinisher.elements;\n\n          for (var j = 0; j < elements.length - 1; j++) {\n            for (var k = j + 1; k < elements.length; k++) {\n              if (elements[j].key === elements[k].key && elements[j].placement === elements[k].placement) {\n                throw new TypeError(\"Duplicated element (\" + elements[j].key + \")\");\n              }\n            }\n          }\n        }\n      }\n\n      return {\n        elements: elements,\n        finishers: finishers\n      };\n    },\n    fromElementDescriptor: function (element) {\n      var obj = {\n        kind: element.kind,\n        key: element.key,\n        placement: element.placement,\n        descriptor: element.descriptor\n      };\n      var desc = {\n        value: \"Descriptor\",\n        configurable: true\n      };\n      Object.defineProperty(obj, Symbol.toStringTag, desc);\n      if (element.kind === \"field\") obj.initializer = element.initializer;\n      return obj;\n    },\n    toElementDescriptors: function (elementObjects) {\n      if (elementObjects === undefined) return;\n      return _toArray(elementObjects).map(function (elementObject) {\n        var element = this.toElementDescriptor(elementObject);\n        this.disallowProperty(elementObject, \"finisher\", \"An element descriptor\");\n        this.disallowProperty(elementObject, \"extras\", \"An element descriptor\");\n        return element;\n      }, this);\n    },\n    toElementDescriptor: function (elementObject) {\n      var kind = String(elementObject.kind);\n\n      if (kind !== \"method\" && kind !== \"field\") {\n        throw new TypeError('An element descriptor\\'s .kind property must be either \"method\" or' + ' \"field\", but a decorator created an element descriptor with' + ' .kind \"' + kind + '\"');\n      }\n\n      var key = _toPropertyKey(elementObject.key);\n\n      var placement = String(elementObject.placement);\n\n      if (placement !== \"static\" && placement !== \"prototype\" && placement !== \"own\") {\n        throw new TypeError('An element descriptor\\'s .placement property must be one of \"static\",' + ' \"prototype\" or \"own\", but a decorator created an element descriptor' + ' with .placement \"' + placement + '\"');\n      }\n\n      var descriptor = elementObject.descriptor;\n      this.disallowProperty(elementObject, \"elements\", \"An element descriptor\");\n      var element = {\n        kind: kind,\n        key: key,\n        placement: placement,\n        descriptor: Object.assign({}, descriptor)\n      };\n\n      if (kind !== \"field\") {\n        this.disallowProperty(elementObject, \"initializer\", \"A method descriptor\");\n      } else {\n        this.disallowProperty(descriptor, \"get\", \"The property descriptor of a field descriptor\");\n        this.disallowProperty(descriptor, \"set\", \"The property descriptor of a field descriptor\");\n        this.disallowProperty(descriptor, \"value\", \"The property descriptor of a field descriptor\");\n        element.initializer = elementObject.initializer;\n      }\n\n      return element;\n    },\n    toElementFinisherExtras: function (elementObject) {\n      var element = this.toElementDescriptor(elementObject);\n\n      var finisher = _optionalCallableProperty(elementObject, \"finisher\");\n\n      var extras = this.toElementDescriptors(elementObject.extras);\n      return {\n        element: element,\n        finisher: finisher,\n        extras: extras\n      };\n    },\n    fromClassDescriptor: function (elements) {\n      var obj = {\n        kind: \"class\",\n        elements: elements.map(this.fromElementDescriptor, this)\n      };\n      var desc = {\n        value: \"Descriptor\",\n        configurable: true\n      };\n      Object.defineProperty(obj, Symbol.toStringTag, desc);\n      return obj;\n    },\n    toClassDescriptor: function (obj) {\n      var kind = String(obj.kind);\n\n      if (kind !== \"class\") {\n        throw new TypeError('A class descriptor\\'s .kind property must be \"class\", but a decorator' + ' created a class descriptor with .kind \"' + kind + '\"');\n      }\n\n      this.disallowProperty(obj, \"key\", \"A class descriptor\");\n      this.disallowProperty(obj, \"placement\", \"A class descriptor\");\n      this.disallowProperty(obj, \"descriptor\", \"A class descriptor\");\n      this.disallowProperty(obj, \"initializer\", \"A class descriptor\");\n      this.disallowProperty(obj, \"extras\", \"A class descriptor\");\n\n      var finisher = _optionalCallableProperty(obj, \"finisher\");\n\n      var elements = this.toElementDescriptors(obj.elements);\n      return {\n        elements: elements,\n        finisher: finisher\n      };\n    },\n    runClassFinishers: function (constructor, finishers) {\n      for (var i = 0; i < finishers.length; i++) {\n        var newConstructor = (0, finishers[i])(constructor);\n\n        if (newConstructor !== undefined) {\n          if (typeof newConstructor !== \"function\") {\n            throw new TypeError(\"Finishers must return a constructor.\");\n          }\n\n          constructor = newConstructor;\n        }\n      }\n\n      return constructor;\n    },\n    disallowProperty: function (obj, name, objectType) {\n      if (obj[name] !== undefined) {\n        throw new TypeError(objectType + \" can't have a .\" + name + \" property.\");\n      }\n    }\n  };\n  return api;\n}\n\nfunction _createElementDescriptor(def) {\n  var key = _toPropertyKey(def.key);\n\n  var descriptor;\n\n  if (def.kind === \"method\") {\n    descriptor = {\n      value: def.value,\n      writable: true,\n      configurable: true,\n      enumerable: false\n    };\n  } else if (def.kind === \"get\") {\n    descriptor = {\n      get: def.value,\n      configurable: true,\n      enumerable: false\n    };\n  } else if (def.kind === \"set\") {\n    descriptor = {\n      set: def.value,\n      configurable: true,\n      enumerable: false\n    };\n  } else if (def.kind === \"field\") {\n    descriptor = {\n      configurable: true,\n      writable: true,\n      enumerable: true\n    };\n  }\n\n  var element = {\n    kind: def.kind === \"field\" ? \"field\" : \"method\",\n    key: key,\n    placement: def.static ? \"static\" : def.kind === \"field\" ? \"own\" : \"prototype\",\n    descriptor: descriptor\n  };\n  if (def.decorators) element.decorators = def.decorators;\n  if (def.kind === \"field\") element.initializer = def.value;\n  return element;\n}\n\nfunction _coalesceGetterSetter(element, other) {\n  if (element.descriptor.get !== undefined) {\n    other.descriptor.get = element.descriptor.get;\n  } else {\n    other.descriptor.set = element.descriptor.set;\n  }\n}\n\nfunction _coalesceClassElements(elements) {\n  var newElements = [];\n\n  var isSameElement = function (other) {\n    return other.kind === \"method\" && other.key === element.key && other.placement === element.placement;\n  };\n\n  for (var i = 0; i < elements.length; i++) {\n    var element = elements[i];\n    var other;\n\n    if (element.kind === \"method\" && (other = newElements.find(isSameElement))) {\n      if (_isDataDescriptor(element.descriptor) || _isDataDescriptor(other.descriptor)) {\n        if (_hasDecorators(element) || _hasDecorators(other)) {\n          throw new ReferenceError(\"Duplicated methods (\" + element.key + \") can't be decorated.\");\n        }\n\n        other.descriptor = element.descriptor;\n      } else {\n        if (_hasDecorators(element)) {\n          if (_hasDecorators(other)) {\n            throw new ReferenceError(\"Decorators can't be placed on different accessors with for \" + \"the same property (\" + element.key + \").\");\n          }\n\n          other.decorators = element.decorators;\n        }\n\n        _coalesceGetterSetter(element, other);\n      }\n    } else {\n      newElements.push(element);\n    }\n  }\n\n  return newElements;\n}\n\nfunction _hasDecorators(element) {\n  return element.decorators && element.decorators.length;\n}\n\nfunction _isDataDescriptor(desc) {\n  return desc !== undefined && !(desc.value === undefined && desc.writable === undefined);\n}\n\nfunction _optionalCallableProperty(obj, name) {\n  var value = obj[name];\n\n  if (value !== undefined && typeof value !== \"function\") {\n    throw new TypeError(\"Expected '\" + name + \"' to be a function\");\n  }\n\n  return value;\n}\n\nfunction _classPrivateMethodGet(receiver, privateSet, fn) {\n  if (!privateSet.has(receiver)) {\n    throw new TypeError(\"attempted to get private field on non-instance\");\n  }\n\n  return fn;\n}\n\nfunction _checkPrivateRedeclaration(obj, privateCollection) {\n  if (privateCollection.has(obj)) {\n    throw new TypeError(\"Cannot initialize the same private elements twice on an object\");\n  }\n}\n\nfunction _classPrivateFieldInitSpec(obj, privateMap, value) {\n  _checkPrivateRedeclaration(obj, privateMap);\n\n  privateMap.set(obj, value);\n}\n\nfunction _classPrivateMethodInitSpec(obj, privateSet) {\n  _checkPrivateRedeclaration(obj, privateSet);\n\n  privateSet.add(obj);\n}\n\nfunction _classPrivateMethodSet() {\n  throw new TypeError(\"attempted to reassign private method\");\n}\n\nfunction _identity(x) {\n  return x;\n}\n\nclass BasicObject {\n  static proxyMethod(expression) {\n    const {\n      name,\n      toMethod,\n      toProperty,\n      optional\n    } = parseProxyMethodExpression(expression);\n\n    this.prototype[name] = function () {\n      let subject;\n      let object;\n\n      if (toMethod) {\n        if (optional) {\n          var _this$toMethod;\n\n          object = (_this$toMethod = this[toMethod]) === null || _this$toMethod === void 0 ? void 0 : _this$toMethod.call(this);\n        } else {\n          object = this[toMethod]();\n        }\n      } else if (toProperty) {\n        object = this[toProperty];\n      }\n\n      if (optional) {\n        var _object;\n\n        subject = (_object = object) === null || _object === void 0 ? void 0 : _object[name];\n\n        if (subject) {\n          return apply.call(subject, object, arguments);\n        }\n      } else {\n        subject = object[name];\n        return apply.call(subject, object, arguments);\n      }\n    };\n  }\n\n}\n\nconst parseProxyMethodExpression = function (expression) {\n  const match = expression.match(proxyMethodExpressionPattern);\n\n  if (!match) {\n    throw new Error(\"can't parse @proxyMethod expression: \".concat(expression));\n  }\n\n  const args = {\n    name: match[4]\n  };\n\n  if (match[2] != null) {\n    args.toMethod = match[1];\n  } else {\n    args.toProperty = match[1];\n  }\n\n  if (match[3] != null) {\n    args.optional = true;\n  }\n\n  return args;\n};\n\nconst {\n  apply\n} = Function.prototype;\nconst proxyMethodExpressionPattern = new RegExp(\"\\\n^\\\n(.+?)\\\n(\\\\(\\\\))?\\\n(\\\\?)?\\\n\\\\.\\\n(.+?)\\\n$\\\n\");\n\nvar _Array$from, _$codePointAt$1, _$1, _String$fromCodePoint;\nclass UTF16String extends BasicObject {\n  static box() {\n    let value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n\n    if (value instanceof this) {\n      return value;\n    } else {\n      return this.fromUCS2String(value === null || value === void 0 ? void 0 : value.toString());\n    }\n  }\n\n  static fromUCS2String(ucs2String) {\n    return new this(ucs2String, ucs2decode(ucs2String));\n  }\n\n  static fromCodepoints(codepoints) {\n    return new this(ucs2encode(codepoints), codepoints);\n  }\n\n  constructor(ucs2String, codepoints) {\n    super(...arguments);\n    this.ucs2String = ucs2String;\n    this.codepoints = codepoints;\n    this.length = this.codepoints.length;\n    this.ucs2Length = this.ucs2String.length;\n  }\n\n  offsetToUCS2Offset(offset) {\n    return ucs2encode(this.codepoints.slice(0, Math.max(0, offset))).length;\n  }\n\n  offsetFromUCS2Offset(ucs2Offset) {\n    return ucs2decode(this.ucs2String.slice(0, Math.max(0, ucs2Offset))).length;\n  }\n\n  slice() {\n    return this.constructor.fromCodepoints(this.codepoints.slice(...arguments));\n  }\n\n  charAt(offset) {\n    return this.slice(offset, offset + 1);\n  }\n\n  isEqualTo(value) {\n    return this.constructor.box(value).ucs2String === this.ucs2String;\n  }\n\n  toJSON() {\n    return this.ucs2String;\n  }\n\n  getCacheKey() {\n    return this.ucs2String;\n  }\n\n  toString() {\n    return this.ucs2String;\n  }\n\n}\nconst hasArrayFrom = ((_Array$from = Array.from) === null || _Array$from === void 0 ? void 0 : _Array$from.call(Array, \"\\ud83d\\udc7c\").length) === 1;\nconst hasStringCodePointAt$1 = ((_$codePointAt$1 = (_$1 = \" \").codePointAt) === null || _$codePointAt$1 === void 0 ? void 0 : _$codePointAt$1.call(_$1, 0)) != null;\nconst hasStringFromCodePoint = ((_String$fromCodePoint = String.fromCodePoint) === null || _String$fromCodePoint === void 0 ? void 0 : _String$fromCodePoint.call(String, 32, 128124)) === \" \\ud83d\\udc7c\"; // UCS-2 conversion helpers ported from Mathias Bynens' Punycode.js:\n// https://github.com/bestiejs/punycode.js#punycodeucs2\n\nlet ucs2decode, ucs2encode; // Creates an array containing the numeric code points of each Unicode\n// character in the string. While JavaScript uses UCS-2 internally,\n// this function will convert a pair of surrogate halves (each of which\n// UCS-2 exposes as separate characters) into a single code point,\n// matching UTF-16.\n\nif (hasArrayFrom && hasStringCodePointAt$1) {\n  ucs2decode = string => Array.from(string).map(char => char.codePointAt(0));\n} else {\n  ucs2decode = function (string) {\n    const output = [];\n    let counter = 0;\n    const {\n      length\n    } = string;\n\n    while (counter < length) {\n      let value = string.charCodeAt(counter++);\n\n      if (0xd800 <= value && value <= 0xdbff && counter < length) {\n        // high surrogate, and there is a next character\n        const extra = string.charCodeAt(counter++);\n\n        if ((extra & 0xfc00) === 0xdc00) {\n          // low surrogate\n          value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n        } else {\n          // unmatched surrogate; only append this code unit, in case the\n          // next code unit is the high surrogate of a surrogate pair\n          counter--;\n        }\n      }\n\n      output.push(value);\n    }\n\n    return output;\n  };\n} // Creates a string based on an array of numeric code points.\n\n\nif (hasStringFromCodePoint) {\n  ucs2encode = array => String.fromCodePoint(...Array.from(array || []));\n} else {\n  ucs2encode = function (array) {\n    const characters = (() => {\n      const result = [];\n      Array.from(array).forEach(value => {\n        let output = \"\";\n\n        if (value > 0xffff) {\n          value -= 0x10000;\n          output += String.fromCharCode(value >>> 10 & 0x3ff | 0xd800);\n          value = 0xdc00 | value & 0x3ff;\n        }\n\n        result.push(output + String.fromCharCode(value));\n      });\n      return result;\n    })();\n\n    return characters.join(\"\");\n  };\n}\n\nlet id$1 = 0;\nclass TrixObject extends BasicObject {\n  static fromJSONString(jsonString) {\n    return this.fromJSON(JSON.parse(jsonString));\n  }\n\n  constructor() {\n    super(...arguments);\n    this.id = ++id$1;\n  }\n\n  hasSameConstructorAs(object) {\n    return this.constructor === (object === null || object === void 0 ? void 0 : object.constructor);\n  }\n\n  isEqualTo(object) {\n    return this === object;\n  }\n\n  inspect() {\n    const parts = [];\n    const contents = this.contentsForInspection() || {};\n\n    for (const key in contents) {\n      const value = contents[key];\n      parts.push(\"\".concat(key, \"=\").concat(value));\n    }\n\n    return \"#<\".concat(this.constructor.name, \":\").concat(this.id).concat(parts.length ? \" \".concat(parts.join(\", \")) : \"\", \">\");\n  }\n\n  contentsForInspection() {}\n\n  toJSONString() {\n    return JSON.stringify(this);\n  }\n\n  toUTF16String() {\n    return UTF16String.box(this);\n  }\n\n  getCacheKey() {\n    return this.id.toString();\n  }\n\n}\n\n/* eslint-disable\n    id-length,\n*/\nconst arraysAreEqual = function () {\n  let a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  let b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  if (a.length !== b.length) {\n    return false;\n  }\n\n  for (let index = 0; index < a.length; index++) {\n    const value = a[index];\n\n    if (value !== b[index]) {\n      return false;\n    }\n  }\n\n  return true;\n};\nconst arrayStartsWith = function () {\n  let a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  let b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return arraysAreEqual(a.slice(0, b.length), b);\n};\nconst spliceArray = function (array) {\n  const result = array.slice(0);\n\n  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    args[_key - 1] = arguments[_key];\n  }\n\n  result.splice(...args);\n  return result;\n};\nconst summarizeArrayChange = function () {\n  let oldArray = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  let newArray = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  const added = [];\n  const removed = [];\n  const existingValues = new Set();\n  oldArray.forEach(value => {\n    existingValues.add(value);\n  });\n  const currentValues = new Set();\n  newArray.forEach(value => {\n    currentValues.add(value);\n\n    if (!existingValues.has(value)) {\n      added.push(value);\n    }\n  });\n  oldArray.forEach(value => {\n    if (!currentValues.has(value)) {\n      removed.push(value);\n    }\n  });\n  return {\n    added,\n    removed\n  };\n};\n\nconst RTL_PATTERN = /[\\u05BE\\u05C0\\u05C3\\u05D0-\\u05EA\\u05F0-\\u05F4\\u061B\\u061F\\u0621-\\u063A\\u0640-\\u064A\\u066D\\u0671-\\u06B7\\u06BA-\\u06BE\\u06C0-\\u06CE\\u06D0-\\u06D5\\u06E5\\u06E6\\u200F\\u202B\\u202E\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE72\\uFE74\\uFE76-\\uFEFC]/;\nconst getDirection = function () {\n  const input = makeElement(\"input\", {\n    dir: \"auto\",\n    name: \"x\",\n    dirName: \"x.dir\"\n  });\n  const form = makeElement(\"form\");\n  form.appendChild(input);\n\n  const supportsDirName = function () {\n    try {\n      return new FormData(form).has(input.dirName);\n    } catch (error) {\n      return false;\n    }\n  }();\n\n  const supportsDirSelector = function () {\n    try {\n      return input.matches(\":dir(ltr),:dir(rtl)\");\n    } catch (error) {\n      return false;\n    }\n  }();\n\n  if (supportsDirName) {\n    return function (string) {\n      input.value = string;\n      return new FormData(form).get(input.dirName);\n    };\n  } else if (supportsDirSelector) {\n    return function (string) {\n      input.value = string;\n\n      if (input.matches(\":dir(rtl)\")) {\n        return \"rtl\";\n      } else {\n        return \"ltr\";\n      }\n    };\n  } else {\n    return function (string) {\n      const char = string.trim().charAt(0);\n\n      if (RTL_PATTERN.test(char)) {\n        return \"rtl\";\n      } else {\n        return \"ltr\";\n      }\n    };\n  }\n}();\n\nlet allAttributeNames = null;\nlet blockAttributeNames = null;\nlet textAttributeNames = null;\nlet listAttributeNames = null;\nconst getAllAttributeNames = () => {\n  if (!allAttributeNames) {\n    allAttributeNames = getTextAttributeNames().concat(getBlockAttributeNames());\n  }\n\n  return allAttributeNames;\n};\nconst getBlockConfig = attributeName => config.blockAttributes[attributeName];\nconst getBlockAttributeNames = () => {\n  if (!blockAttributeNames) {\n    blockAttributeNames = Object.keys(config.blockAttributes);\n  }\n\n  return blockAttributeNames;\n};\nconst getTextConfig = attributeName => config.textAttributes[attributeName];\nconst getTextAttributeNames = () => {\n  if (!textAttributeNames) {\n    textAttributeNames = Object.keys(config.textAttributes);\n  }\n\n  return textAttributeNames;\n};\nconst getListAttributeNames = () => {\n  if (!listAttributeNames) {\n    listAttributeNames = [];\n\n    for (const key in config.blockAttributes) {\n      const {\n        listAttribute\n      } = config.blockAttributes[key];\n\n      if (listAttribute != null) {\n        listAttributeNames.push(listAttribute);\n      }\n    }\n  }\n\n  return listAttributeNames;\n};\n\n/* eslint-disable\n*/\nconst installDefaultCSSForTagName = function (tagName, defaultCSS) {\n  const styleElement = insertStyleElementForTagName(tagName);\n  styleElement.textContent = defaultCSS.replace(/%t/g, tagName);\n};\n\nconst insertStyleElementForTagName = function (tagName) {\n  const element = document.createElement(\"style\");\n  element.setAttribute(\"type\", \"text/css\");\n  element.setAttribute(\"data-tag-name\", tagName.toLowerCase());\n  const nonce = getCSPNonce();\n\n  if (nonce) {\n    element.setAttribute(\"nonce\", nonce);\n  }\n\n  document.head.insertBefore(element, document.head.firstChild);\n  return element;\n};\n\nconst getCSPNonce = function () {\n  const element = getMetaElement(\"trix-csp-nonce\") || getMetaElement(\"csp-nonce\");\n\n  if (element) {\n    return element.getAttribute(\"content\");\n  }\n};\n\nconst getMetaElement = name => document.head.querySelector(\"meta[name=\".concat(name, \"]\"));\n\nconst testTransferData = {\n  \"application/x-trix-feature-detection\": \"test\"\n};\nconst dataTransferIsPlainText = function (dataTransfer) {\n  const text = dataTransfer.getData(\"text/plain\");\n  const html = dataTransfer.getData(\"text/html\");\n\n  if (text && html) {\n    const {\n      body\n    } = new DOMParser().parseFromString(html, \"text/html\");\n\n    if (body.textContent === text) {\n      return !body.querySelector(\"*\");\n    }\n  } else {\n    return text === null || text === void 0 ? void 0 : text.length;\n  }\n};\nconst dataTransferIsWritable = function (dataTransfer) {\n  if (!(dataTransfer !== null && dataTransfer !== void 0 && dataTransfer.setData)) return false;\n\n  for (const key in testTransferData) {\n    const value = testTransferData[key];\n\n    try {\n      dataTransfer.setData(key, value);\n      if (!dataTransfer.getData(key) === value) return false;\n    } catch (error) {\n      return false;\n    }\n  }\n\n  return true;\n};\nconst keyEventIsKeyboardCommand = function () {\n  if (/Mac|^iP/.test(navigator.platform)) {\n    return event => event.metaKey;\n  } else {\n    return event => event.ctrlKey;\n  }\n}();\n\nconst defer = fn => setTimeout(fn, 1);\n\n/* eslint-disable\n    id-length,\n*/\nconst copyObject = function () {\n  let object = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  const result = {};\n\n  for (const key in object) {\n    const value = object[key];\n    result[key] = value;\n  }\n\n  return result;\n};\nconst objectsAreEqual = function () {\n  let a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  let b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  if (Object.keys(a).length !== Object.keys(b).length) {\n    return false;\n  }\n\n  for (const key in a) {\n    const value = a[key];\n\n    if (value !== b[key]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nconst normalizeRange = function (range) {\n  if (range == null) return;\n\n  if (!Array.isArray(range)) {\n    range = [range, range];\n  }\n\n  return [copyValue(range[0]), copyValue(range[1] != null ? range[1] : range[0])];\n};\nconst rangeIsCollapsed = function (range) {\n  if (range == null) return;\n  const [start, end] = normalizeRange(range);\n  return rangeValuesAreEqual(start, end);\n};\nconst rangesAreEqual = function (leftRange, rightRange) {\n  if (leftRange == null || rightRange == null) return;\n  const [leftStart, leftEnd] = normalizeRange(leftRange);\n  const [rightStart, rightEnd] = normalizeRange(rightRange);\n  return rangeValuesAreEqual(leftStart, rightStart) && rangeValuesAreEqual(leftEnd, rightEnd);\n};\n\nconst copyValue = function (value) {\n  if (typeof value === \"number\") {\n    return value;\n  } else {\n    return copyObject(value);\n  }\n};\n\nconst rangeValuesAreEqual = function (left, right) {\n  if (typeof left === \"number\") {\n    return left === right;\n  } else {\n    return objectsAreEqual(left, right);\n  }\n};\n\n/* eslint-disable\n    id-length,\n*/\nclass SelectionChangeObserver extends BasicObject {\n  constructor() {\n    super(...arguments);\n    this.update = this.update.bind(this);\n    this.run = this.run.bind(this);\n    this.selectionManagers = [];\n  }\n\n  start() {\n    if (!this.started) {\n      this.started = true;\n\n      if (\"onselectionchange\" in document) {\n        return document.addEventListener(\"selectionchange\", this.update, true);\n      } else {\n        return this.run();\n      }\n    }\n  }\n\n  stop() {\n    if (this.started) {\n      this.started = false;\n      return document.removeEventListener(\"selectionchange\", this.update, true);\n    }\n  }\n\n  registerSelectionManager(selectionManager) {\n    if (!this.selectionManagers.includes(selectionManager)) {\n      this.selectionManagers.push(selectionManager);\n      return this.start();\n    }\n  }\n\n  unregisterSelectionManager(selectionManager) {\n    this.selectionManagers = this.selectionManagers.filter(s => s !== selectionManager);\n\n    if (this.selectionManagers.length === 0) {\n      return this.stop();\n    }\n  }\n\n  notifySelectionManagersOfSelectionChange() {\n    return this.selectionManagers.map(selectionManager => selectionManager.selectionDidChange());\n  }\n\n  update() {\n    const domRange = getDOMRange();\n\n    if (!domRangesAreEqual(domRange, this.domRange)) {\n      this.domRange = domRange;\n      return this.notifySelectionManagersOfSelectionChange();\n    }\n  }\n\n  reset() {\n    this.domRange = null;\n    return this.update();\n  } // Private\n\n\n  run() {\n    if (this.started) {\n      this.update();\n      return requestAnimationFrame(this.run);\n    }\n  }\n\n}\n\nconst domRangesAreEqual = (left, right) => (left === null || left === void 0 ? void 0 : left.startContainer) === (right === null || right === void 0 ? void 0 : right.startContainer) && (left === null || left === void 0 ? void 0 : left.startOffset) === (right === null || right === void 0 ? void 0 : right.startOffset) && (left === null || left === void 0 ? void 0 : left.endContainer) === (right === null || right === void 0 ? void 0 : right.endContainer) && (left === null || left === void 0 ? void 0 : left.endOffset) === (right === null || right === void 0 ? void 0 : right.endOffset);\n\nconst selectionChangeObserver = new SelectionChangeObserver();\nconst getDOMSelection = function () {\n  const selection = window.getSelection();\n\n  if (selection.rangeCount > 0) {\n    return selection;\n  }\n};\nconst getDOMRange = function () {\n  var _getDOMSelection;\n\n  const domRange = (_getDOMSelection = getDOMSelection()) === null || _getDOMSelection === void 0 ? void 0 : _getDOMSelection.getRangeAt(0);\n\n  if (domRange) {\n    if (!domRangeIsPrivate(domRange)) {\n      return domRange;\n    }\n  }\n};\nconst setDOMRange = function (domRange) {\n  const selection = window.getSelection();\n  selection.removeAllRanges();\n  selection.addRange(domRange);\n  return selectionChangeObserver.update();\n}; // In Firefox, clicking certain <input> elements changes the selection to a\n// private element used to draw its UI. Attempting to access properties of those\n// elements throws an error.\n// https://bugzilla.mozilla.org/show_bug.cgi?id=208427\n\nconst domRangeIsPrivate = domRange => nodeIsPrivate(domRange.startContainer) || nodeIsPrivate(domRange.endContainer);\n\nconst nodeIsPrivate = node => !Object.getPrototypeOf(node);\n\n/* eslint-disable\n    id-length,\n    no-useless-escape,\n*/\nconst normalizeSpaces = string => string.replace(new RegExp(\"\".concat(ZERO_WIDTH_SPACE), \"g\"), \"\").replace(new RegExp(\"\".concat(NON_BREAKING_SPACE), \"g\"), \" \");\nconst normalizeNewlines = string => string.replace(/\\r\\n/g, \"\\n\");\nconst breakableWhitespacePattern = new RegExp(\"[^\\\\S\".concat(NON_BREAKING_SPACE, \"]\"));\nconst squishBreakableWhitespace = string => string // Replace all breakable whitespace characters with a space\n.replace(new RegExp(\"\".concat(breakableWhitespacePattern.source), \"g\"), \" \") // Replace two or more spaces with a single space\n.replace(/\\ {2,}/g, \" \");\nconst summarizeStringChange = function (oldString, newString) {\n  let added, removed;\n  oldString = UTF16String.box(oldString);\n  newString = UTF16String.box(newString);\n\n  if (newString.length < oldString.length) {\n    [removed, added] = utf16StringDifferences(oldString, newString);\n  } else {\n    [added, removed] = utf16StringDifferences(newString, oldString);\n  }\n\n  return {\n    added,\n    removed\n  };\n};\n\nconst utf16StringDifferences = function (a, b) {\n  if (a.isEqualTo(b)) {\n    return [\"\", \"\"];\n  }\n\n  const diffA = utf16StringDifference(a, b);\n  const {\n    length\n  } = diffA.utf16String;\n  let diffB;\n\n  if (length) {\n    const {\n      offset\n    } = diffA;\n    const codepoints = a.codepoints.slice(0, offset).concat(a.codepoints.slice(offset + length));\n    diffB = utf16StringDifference(b, UTF16String.fromCodepoints(codepoints));\n  } else {\n    diffB = utf16StringDifference(b, a);\n  }\n\n  return [diffA.utf16String.toString(), diffB.utf16String.toString()];\n};\n\nconst utf16StringDifference = function (a, b) {\n  let leftIndex = 0;\n  let rightIndexA = a.length;\n  let rightIndexB = b.length;\n\n  while (leftIndex < rightIndexA && a.charAt(leftIndex).isEqualTo(b.charAt(leftIndex))) {\n    leftIndex++;\n  }\n\n  while (rightIndexA > leftIndex + 1 && a.charAt(rightIndexA - 1).isEqualTo(b.charAt(rightIndexB - 1))) {\n    rightIndexA--;\n    rightIndexB--;\n  }\n\n  return {\n    utf16String: a.slice(leftIndex, rightIndexA),\n    offset: leftIndex\n  };\n};\n\nclass Hash extends TrixObject {\n  static fromCommonAttributesOfObjects() {\n    let objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n    if (!objects.length) {\n      return new this();\n    }\n\n    let hash = box(objects[0]);\n    let keys = hash.getKeys();\n    objects.slice(1).forEach(object => {\n      keys = hash.getKeysCommonToHash(box(object));\n      hash = hash.slice(keys);\n    });\n    return hash;\n  }\n\n  static box(values) {\n    return box(values);\n  }\n\n  constructor() {\n    let values = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super(...arguments);\n    this.values = copy(values);\n  }\n\n  add(key, value) {\n    return this.merge(object(key, value));\n  }\n\n  remove(key) {\n    return new Hash(copy(this.values, key));\n  }\n\n  get(key) {\n    return this.values[key];\n  }\n\n  has(key) {\n    return key in this.values;\n  }\n\n  merge(values) {\n    return new Hash(merge(this.values, unbox(values)));\n  }\n\n  slice(keys) {\n    const values = {};\n    keys.forEach(key => {\n      if (this.has(key)) {\n        values[key] = this.values[key];\n      }\n    });\n    return new Hash(values);\n  }\n\n  getKeys() {\n    return Object.keys(this.values);\n  }\n\n  getKeysCommonToHash(hash) {\n    hash = box(hash);\n    return this.getKeys().filter(key => this.values[key] === hash.values[key]);\n  }\n\n  isEqualTo(values) {\n    return arraysAreEqual(this.toArray(), box(values).toArray());\n  }\n\n  isEmpty() {\n    return this.getKeys().length === 0;\n  }\n\n  toArray() {\n    if (!this.array) {\n      const result = [];\n\n      for (const key in this.values) {\n        const value = this.values[key];\n        result.push(result.push(key, value));\n      }\n\n      this.array = result.slice(0);\n    }\n\n    return this.array;\n  }\n\n  toObject() {\n    return copy(this.values);\n  }\n\n  toJSON() {\n    return this.toObject();\n  }\n\n  contentsForInspection() {\n    return {\n      values: JSON.stringify(this.values)\n    };\n  }\n\n}\n\nconst object = function (key, value) {\n  const result = {};\n  result[key] = value;\n  return result;\n};\n\nconst merge = function (object, values) {\n  const result = copy(object);\n\n  for (const key in values) {\n    const value = values[key];\n    result[key] = value;\n  }\n\n  return result;\n};\n\nconst copy = function (object, keyToRemove) {\n  const result = {};\n  const sortedKeys = Object.keys(object).sort();\n  sortedKeys.forEach(key => {\n    if (key !== keyToRemove) {\n      result[key] = object[key];\n    }\n  });\n  return result;\n};\n\nconst box = function (object) {\n  if (object instanceof Hash) {\n    return object;\n  } else {\n    return new Hash(object);\n  }\n};\n\nconst unbox = function (object) {\n  if (object instanceof Hash) {\n    return object.values;\n  } else {\n    return object;\n  }\n};\n\nclass Operation extends BasicObject {\n  isPerforming() {\n    return this.performing === true;\n  }\n\n  hasPerformed() {\n    return this.performed === true;\n  }\n\n  hasSucceeded() {\n    return this.performed && this.succeeded;\n  }\n\n  hasFailed() {\n    return this.performed && !this.succeeded;\n  }\n\n  getPromise() {\n    if (!this.promise) {\n      this.promise = new Promise((resolve, reject) => {\n        this.performing = true;\n        return this.perform((succeeded, result) => {\n          this.succeeded = succeeded;\n          this.performing = false;\n          this.performed = true;\n\n          if (this.succeeded) {\n            resolve(result);\n          } else {\n            reject(result);\n          }\n        });\n      });\n    }\n\n    return this.promise;\n  }\n\n  perform(callback) {\n    return callback(false);\n  }\n\n  release() {\n    var _this$promise, _this$promise$cancel;\n\n    (_this$promise = this.promise) === null || _this$promise === void 0 ? void 0 : (_this$promise$cancel = _this$promise.cancel) === null || _this$promise$cancel === void 0 ? void 0 : _this$promise$cancel.call(_this$promise);\n    this.promise = null;\n    this.performing = null;\n    this.performed = null;\n    this.succeeded = null;\n  }\n\n}\nOperation.proxyMethod(\"getPromise().then\");\nOperation.proxyMethod(\"getPromise().catch\");\n\nclass ImagePreloadOperation extends Operation {\n  constructor(url) {\n    super(...arguments);\n    this.url = url;\n  }\n\n  perform(callback) {\n    const image = new Image();\n\n    image.onload = () => {\n      image.width = this.width = image.naturalWidth;\n      image.height = this.height = image.naturalHeight;\n      return callback(true, image);\n    };\n\n    image.onerror = () => callback(false);\n\n    image.src = this.url;\n  }\n\n}\n\nclass Attachment extends TrixObject {\n  static attachmentForFile(file) {\n    const attributes = this.attributesForFile(file);\n    const attachment = new this(attributes);\n    attachment.setFile(file);\n    return attachment;\n  }\n\n  static attributesForFile(file) {\n    return new Hash({\n      filename: file.name,\n      filesize: file.size,\n      contentType: file.type\n    });\n  }\n\n  static fromJSON(attachmentJSON) {\n    return new this(attachmentJSON);\n  }\n\n  constructor() {\n    let attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super(attributes);\n    this.releaseFile = this.releaseFile.bind(this);\n    this.attributes = Hash.box(attributes);\n    this.didChangeAttributes();\n  }\n\n  getAttribute(attribute) {\n    return this.attributes.get(attribute);\n  }\n\n  hasAttribute(attribute) {\n    return this.attributes.has(attribute);\n  }\n\n  getAttributes() {\n    return this.attributes.toObject();\n  }\n\n  setAttributes() {\n    let attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const newAttributes = this.attributes.merge(attributes);\n\n    if (!this.attributes.isEqualTo(newAttributes)) {\n      var _this$previewDelegate, _this$previewDelegate2, _this$delegate, _this$delegate$attach;\n\n      this.attributes = newAttributes;\n      this.didChangeAttributes();\n      (_this$previewDelegate = this.previewDelegate) === null || _this$previewDelegate === void 0 ? void 0 : (_this$previewDelegate2 = _this$previewDelegate.attachmentDidChangeAttributes) === null || _this$previewDelegate2 === void 0 ? void 0 : _this$previewDelegate2.call(_this$previewDelegate, this);\n      return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$attach = _this$delegate.attachmentDidChangeAttributes) === null || _this$delegate$attach === void 0 ? void 0 : _this$delegate$attach.call(_this$delegate, this);\n    }\n  }\n\n  didChangeAttributes() {\n    if (this.isPreviewable()) {\n      return this.preloadURL();\n    }\n  }\n\n  isPending() {\n    return this.file != null && !(this.getURL() || this.getHref());\n  }\n\n  isPreviewable() {\n    if (this.attributes.has(\"previewable\")) {\n      return this.attributes.get(\"previewable\");\n    } else {\n      return Attachment.previewablePattern.test(this.getContentType());\n    }\n  }\n\n  getType() {\n    if (this.hasContent()) {\n      return \"content\";\n    } else if (this.isPreviewable()) {\n      return \"preview\";\n    } else {\n      return \"file\";\n    }\n  }\n\n  getURL() {\n    return this.attributes.get(\"url\");\n  }\n\n  getHref() {\n    return this.attributes.get(\"href\");\n  }\n\n  getFilename() {\n    return this.attributes.get(\"filename\") || \"\";\n  }\n\n  getFilesize() {\n    return this.attributes.get(\"filesize\");\n  }\n\n  getFormattedFilesize() {\n    const filesize = this.attributes.get(\"filesize\");\n\n    if (typeof filesize === \"number\") {\n      return config.fileSize.formatter(filesize);\n    } else {\n      return \"\";\n    }\n  }\n\n  getExtension() {\n    var _this$getFilename$mat;\n\n    return (_this$getFilename$mat = this.getFilename().match(/\\.(\\w+)$/)) === null || _this$getFilename$mat === void 0 ? void 0 : _this$getFilename$mat[1].toLowerCase();\n  }\n\n  getContentType() {\n    return this.attributes.get(\"contentType\");\n  }\n\n  hasContent() {\n    return this.attributes.has(\"content\");\n  }\n\n  getContent() {\n    return this.attributes.get(\"content\");\n  }\n\n  getWidth() {\n    return this.attributes.get(\"width\");\n  }\n\n  getHeight() {\n    return this.attributes.get(\"height\");\n  }\n\n  getFile() {\n    return this.file;\n  }\n\n  setFile(file) {\n    this.file = file;\n\n    if (this.isPreviewable()) {\n      return this.preloadFile();\n    }\n  }\n\n  releaseFile() {\n    this.releasePreloadedFile();\n    this.file = null;\n  }\n\n  getUploadProgress() {\n    return this.uploadProgress != null ? this.uploadProgress : 0;\n  }\n\n  setUploadProgress(value) {\n    if (this.uploadProgress !== value) {\n      var _this$uploadProgressD, _this$uploadProgressD2;\n\n      this.uploadProgress = value;\n      return (_this$uploadProgressD = this.uploadProgressDelegate) === null || _this$uploadProgressD === void 0 ? void 0 : (_this$uploadProgressD2 = _this$uploadProgressD.attachmentDidChangeUploadProgress) === null || _this$uploadProgressD2 === void 0 ? void 0 : _this$uploadProgressD2.call(_this$uploadProgressD, this);\n    }\n  }\n\n  toJSON() {\n    return this.getAttributes();\n  }\n\n  getCacheKey() {\n    return [super.getCacheKey(...arguments), this.attributes.getCacheKey(), this.getPreviewURL()].join(\"/\");\n  } // Previewable\n\n\n  getPreviewURL() {\n    return this.previewURL || this.preloadingURL;\n  }\n\n  setPreviewURL(url) {\n    if (url !== this.getPreviewURL()) {\n      var _this$previewDelegate3, _this$previewDelegate4, _this$delegate2, _this$delegate2$attac;\n\n      this.previewURL = url;\n      (_this$previewDelegate3 = this.previewDelegate) === null || _this$previewDelegate3 === void 0 ? void 0 : (_this$previewDelegate4 = _this$previewDelegate3.attachmentDidChangeAttributes) === null || _this$previewDelegate4 === void 0 ? void 0 : _this$previewDelegate4.call(_this$previewDelegate3, this);\n      return (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$attac = _this$delegate2.attachmentDidChangePreviewURL) === null || _this$delegate2$attac === void 0 ? void 0 : _this$delegate2$attac.call(_this$delegate2, this);\n    }\n  }\n\n  preloadURL() {\n    return this.preload(this.getURL(), this.releaseFile);\n  }\n\n  preloadFile() {\n    if (this.file) {\n      this.fileObjectURL = URL.createObjectURL(this.file);\n      return this.preload(this.fileObjectURL);\n    }\n  }\n\n  releasePreloadedFile() {\n    if (this.fileObjectURL) {\n      URL.revokeObjectURL(this.fileObjectURL);\n      this.fileObjectURL = null;\n    }\n  }\n\n  preload(url, callback) {\n    if (url && url !== this.getPreviewURL()) {\n      this.preloadingURL = url;\n      const operation = new ImagePreloadOperation(url);\n      return operation.then(_ref => {\n        let {\n          width,\n          height\n        } = _ref;\n\n        if (!this.getWidth() || !this.getHeight()) {\n          this.setAttributes({\n            width,\n            height\n          });\n        }\n\n        this.preloadingURL = null;\n        this.setPreviewURL(url);\n        return callback === null || callback === void 0 ? void 0 : callback();\n      }).catch(() => {\n        this.preloadingURL = null;\n        return callback === null || callback === void 0 ? void 0 : callback();\n      });\n    }\n  }\n\n}\n\n_defineProperty(Attachment, \"previewablePattern\", /^image(\\/(gif|png|jpe?g)|$)/);\n\nclass ManagedAttachment extends BasicObject {\n  constructor(attachmentManager, attachment) {\n    super(...arguments);\n    this.attachmentManager = attachmentManager;\n    this.attachment = attachment;\n    this.id = this.attachment.id;\n    this.file = this.attachment.file;\n  }\n\n  remove() {\n    return this.attachmentManager.requestRemovalOfAttachment(this.attachment);\n  }\n\n}\nManagedAttachment.proxyMethod(\"attachment.getAttribute\");\nManagedAttachment.proxyMethod(\"attachment.hasAttribute\");\nManagedAttachment.proxyMethod(\"attachment.setAttribute\");\nManagedAttachment.proxyMethod(\"attachment.getAttributes\");\nManagedAttachment.proxyMethod(\"attachment.setAttributes\");\nManagedAttachment.proxyMethod(\"attachment.isPending\");\nManagedAttachment.proxyMethod(\"attachment.isPreviewable\");\nManagedAttachment.proxyMethod(\"attachment.getURL\");\nManagedAttachment.proxyMethod(\"attachment.getHref\");\nManagedAttachment.proxyMethod(\"attachment.getFilename\");\nManagedAttachment.proxyMethod(\"attachment.getFilesize\");\nManagedAttachment.proxyMethod(\"attachment.getFormattedFilesize\");\nManagedAttachment.proxyMethod(\"attachment.getExtension\");\nManagedAttachment.proxyMethod(\"attachment.getContentType\");\nManagedAttachment.proxyMethod(\"attachment.getFile\");\nManagedAttachment.proxyMethod(\"attachment.setFile\");\nManagedAttachment.proxyMethod(\"attachment.releaseFile\");\nManagedAttachment.proxyMethod(\"attachment.getUploadProgress\");\nManagedAttachment.proxyMethod(\"attachment.setUploadProgress\");\n\nclass AttachmentManager extends BasicObject {\n  constructor() {\n    let attachments = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n    this.managedAttachments = {};\n    Array.from(attachments).forEach(attachment => {\n      this.manageAttachment(attachment);\n    });\n  }\n\n  getAttachments() {\n    const result = [];\n\n    for (const id in this.managedAttachments) {\n      const attachment = this.managedAttachments[id];\n      result.push(attachment);\n    }\n\n    return result;\n  }\n\n  manageAttachment(attachment) {\n    if (!this.managedAttachments[attachment.id]) {\n      this.managedAttachments[attachment.id] = new ManagedAttachment(this, attachment);\n    }\n\n    return this.managedAttachments[attachment.id];\n  }\n\n  attachmentIsManaged(attachment) {\n    return attachment.id in this.managedAttachments;\n  }\n\n  requestRemovalOfAttachment(attachment) {\n    if (this.attachmentIsManaged(attachment)) {\n      var _this$delegate, _this$delegate$attach;\n\n      return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$attach = _this$delegate.attachmentManagerDidRequestRemovalOfAttachment) === null || _this$delegate$attach === void 0 ? void 0 : _this$delegate$attach.call(_this$delegate, attachment);\n    }\n  }\n\n  unmanageAttachment(attachment) {\n    const managedAttachment = this.managedAttachments[attachment.id];\n    delete this.managedAttachments[attachment.id];\n    return managedAttachment;\n  }\n\n}\n\nclass Piece extends TrixObject {\n  static registerType(type, constructor) {\n    constructor.type = type;\n    this.types[type] = constructor;\n  }\n\n  static fromJSON(pieceJSON) {\n    const constructor = this.types[pieceJSON.type];\n\n    if (constructor) {\n      return constructor.fromJSON(pieceJSON);\n    }\n  }\n\n  constructor(value) {\n    let attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super(...arguments);\n    this.attributes = Hash.box(attributes);\n  }\n\n  copyWithAttributes(attributes) {\n    return new this.constructor(this.getValue(), attributes);\n  }\n\n  copyWithAdditionalAttributes(attributes) {\n    return this.copyWithAttributes(this.attributes.merge(attributes));\n  }\n\n  copyWithoutAttribute(attribute) {\n    return this.copyWithAttributes(this.attributes.remove(attribute));\n  }\n\n  copy() {\n    return this.copyWithAttributes(this.attributes);\n  }\n\n  getAttribute(attribute) {\n    return this.attributes.get(attribute);\n  }\n\n  getAttributesHash() {\n    return this.attributes;\n  }\n\n  getAttributes() {\n    return this.attributes.toObject();\n  }\n\n  hasAttribute(attribute) {\n    return this.attributes.has(attribute);\n  }\n\n  hasSameStringValueAsPiece(piece) {\n    return piece && this.toString() === piece.toString();\n  }\n\n  hasSameAttributesAsPiece(piece) {\n    return piece && (this.attributes === piece.attributes || this.attributes.isEqualTo(piece.attributes));\n  }\n\n  isBlockBreak() {\n    return false;\n  }\n\n  isEqualTo(piece) {\n    return super.isEqualTo(...arguments) || this.hasSameConstructorAs(piece) && this.hasSameStringValueAsPiece(piece) && this.hasSameAttributesAsPiece(piece);\n  }\n\n  isEmpty() {\n    return this.length === 0;\n  }\n\n  isSerializable() {\n    return true;\n  }\n\n  toJSON() {\n    return {\n      type: this.constructor.type,\n      attributes: this.getAttributes()\n    };\n  }\n\n  contentsForInspection() {\n    return {\n      type: this.constructor.type,\n      attributes: this.attributes.inspect()\n    };\n  } // Grouping\n\n\n  canBeGrouped() {\n    return this.hasAttribute(\"href\");\n  }\n\n  canBeGroupedWith(piece) {\n    return this.getAttribute(\"href\") === piece.getAttribute(\"href\");\n  } // Splittable\n\n\n  getLength() {\n    return this.length;\n  }\n\n  canBeConsolidatedWith(piece) {\n    return false;\n  }\n\n}\n\n_defineProperty(Piece, \"types\", {});\n\nclass AttachmentPiece extends Piece {\n  static fromJSON(pieceJSON) {\n    return new this(Attachment.fromJSON(pieceJSON.attachment), pieceJSON.attributes);\n  }\n\n  constructor(attachment) {\n    super(...arguments);\n    this.attachment = attachment;\n    this.length = 1;\n    this.ensureAttachmentExclusivelyHasAttribute(\"href\");\n\n    if (!this.attachment.hasContent()) {\n      this.removeProhibitedAttributes();\n    }\n  }\n\n  ensureAttachmentExclusivelyHasAttribute(attribute) {\n    if (this.hasAttribute(attribute)) {\n      if (!this.attachment.hasAttribute(attribute)) {\n        this.attachment.setAttributes(this.attributes.slice(attribute));\n      }\n\n      this.attributes = this.attributes.remove(attribute);\n    }\n  }\n\n  removeProhibitedAttributes() {\n    const attributes = this.attributes.slice(AttachmentPiece.permittedAttributes);\n\n    if (!attributes.isEqualTo(this.attributes)) {\n      this.attributes = attributes;\n    }\n  }\n\n  getValue() {\n    return this.attachment;\n  }\n\n  isSerializable() {\n    return !this.attachment.isPending();\n  }\n\n  getCaption() {\n    return this.attributes.get(\"caption\") || \"\";\n  }\n\n  isEqualTo(piece) {\n    var _piece$attachment;\n\n    return super.isEqualTo(piece) && this.attachment.id === (piece === null || piece === void 0 ? void 0 : (_piece$attachment = piece.attachment) === null || _piece$attachment === void 0 ? void 0 : _piece$attachment.id);\n  }\n\n  toString() {\n    return OBJECT_REPLACEMENT_CHARACTER;\n  }\n\n  toJSON() {\n    const json = super.toJSON(...arguments);\n    json.attachment = this.attachment;\n    return json;\n  }\n\n  getCacheKey() {\n    return [super.getCacheKey(...arguments), this.attachment.getCacheKey()].join(\"/\");\n  }\n\n  toConsole() {\n    return JSON.stringify(this.toString());\n  }\n\n}\n\n_defineProperty(AttachmentPiece, \"permittedAttributes\", [\"caption\", \"presentation\"]);\n\nPiece.registerType(\"attachment\", AttachmentPiece);\n\nclass StringPiece extends Piece {\n  static fromJSON(pieceJSON) {\n    return new this(pieceJSON.string, pieceJSON.attributes);\n  }\n\n  constructor(string) {\n    super(...arguments);\n    this.string = normalizeNewlines(string);\n    this.length = this.string.length;\n  }\n\n  getValue() {\n    return this.string;\n  }\n\n  toString() {\n    return this.string.toString();\n  }\n\n  isBlockBreak() {\n    return this.toString() === \"\\n\" && this.getAttribute(\"blockBreak\") === true;\n  }\n\n  toJSON() {\n    const result = super.toJSON(...arguments);\n    result.string = this.string;\n    return result;\n  } // Splittable\n\n\n  canBeConsolidatedWith(piece) {\n    return piece && this.hasSameConstructorAs(piece) && this.hasSameAttributesAsPiece(piece);\n  }\n\n  consolidateWith(piece) {\n    return new this.constructor(this.toString() + piece.toString(), this.attributes);\n  }\n\n  splitAtOffset(offset) {\n    let left, right;\n\n    if (offset === 0) {\n      left = null;\n      right = this;\n    } else if (offset === this.length) {\n      left = this;\n      right = null;\n    } else {\n      left = new this.constructor(this.string.slice(0, offset), this.attributes);\n      right = new this.constructor(this.string.slice(offset), this.attributes);\n    }\n\n    return [left, right];\n  }\n\n  toConsole() {\n    let {\n      string\n    } = this;\n\n    if (string.length > 15) {\n      string = string.slice(0, 14) + \"…\";\n    }\n\n    return JSON.stringify(string.toString());\n  }\n\n}\nPiece.registerType(\"string\", StringPiece);\n\n/* eslint-disable\n    prefer-const,\n*/\nclass SplittableList extends TrixObject {\n  static box(objects) {\n    if (objects instanceof this) {\n      return objects;\n    } else {\n      return new this(objects);\n    }\n  }\n\n  constructor() {\n    let objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n    this.objects = objects.slice(0);\n    this.length = this.objects.length;\n  }\n\n  indexOf(object) {\n    return this.objects.indexOf(object);\n  }\n\n  splice() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return new this.constructor(spliceArray(this.objects, ...args));\n  }\n\n  eachObject(callback) {\n    return this.objects.map((object, index) => callback(object, index));\n  }\n\n  insertObjectAtIndex(object, index) {\n    return this.splice(index, 0, object);\n  }\n\n  insertSplittableListAtIndex(splittableList, index) {\n    return this.splice(index, 0, ...splittableList.objects);\n  }\n\n  insertSplittableListAtPosition(splittableList, position) {\n    const [objects, index] = this.splitObjectAtPosition(position);\n    return new this.constructor(objects).insertSplittableListAtIndex(splittableList, index);\n  }\n\n  editObjectAtIndex(index, callback) {\n    return this.replaceObjectAtIndex(callback(this.objects[index]), index);\n  }\n\n  replaceObjectAtIndex(object, index) {\n    return this.splice(index, 1, object);\n  }\n\n  removeObjectAtIndex(index) {\n    return this.splice(index, 1);\n  }\n\n  getObjectAtIndex(index) {\n    return this.objects[index];\n  }\n\n  getSplittableListInRange(range) {\n    const [objects, leftIndex, rightIndex] = this.splitObjectsAtRange(range);\n    return new this.constructor(objects.slice(leftIndex, rightIndex + 1));\n  }\n\n  selectSplittableList(test) {\n    const objects = this.objects.filter(object => test(object));\n    return new this.constructor(objects);\n  }\n\n  removeObjectsInRange(range) {\n    const [objects, leftIndex, rightIndex] = this.splitObjectsAtRange(range);\n    return new this.constructor(objects).splice(leftIndex, rightIndex - leftIndex + 1);\n  }\n\n  transformObjectsInRange(range, transform) {\n    const [objects, leftIndex, rightIndex] = this.splitObjectsAtRange(range);\n    const transformedObjects = objects.map((object, index) => leftIndex <= index && index <= rightIndex ? transform(object) : object);\n    return new this.constructor(transformedObjects);\n  }\n\n  splitObjectsAtRange(range) {\n    let rightOuterIndex;\n    let [objects, leftInnerIndex, offset] = this.splitObjectAtPosition(startOfRange(range));\n    [objects, rightOuterIndex] = new this.constructor(objects).splitObjectAtPosition(endOfRange(range) + offset);\n    return [objects, leftInnerIndex, rightOuterIndex - 1];\n  }\n\n  getObjectAtPosition(position) {\n    const {\n      index\n    } = this.findIndexAndOffsetAtPosition(position);\n    return this.objects[index];\n  }\n\n  splitObjectAtPosition(position) {\n    let splitIndex, splitOffset;\n    const {\n      index,\n      offset\n    } = this.findIndexAndOffsetAtPosition(position);\n    const objects = this.objects.slice(0);\n\n    if (index != null) {\n      if (offset === 0) {\n        splitIndex = index;\n        splitOffset = 0;\n      } else {\n        const object = this.getObjectAtIndex(index);\n        const [leftObject, rightObject] = object.splitAtOffset(offset);\n        objects.splice(index, 1, leftObject, rightObject);\n        splitIndex = index + 1;\n        splitOffset = leftObject.getLength() - offset;\n      }\n    } else {\n      splitIndex = objects.length;\n      splitOffset = 0;\n    }\n\n    return [objects, splitIndex, splitOffset];\n  }\n\n  consolidate() {\n    const objects = [];\n    let pendingObject = this.objects[0];\n    this.objects.slice(1).forEach(object => {\n      var _pendingObject$canBeC, _pendingObject;\n\n      if ((_pendingObject$canBeC = (_pendingObject = pendingObject).canBeConsolidatedWith) !== null && _pendingObject$canBeC !== void 0 && _pendingObject$canBeC.call(_pendingObject, object)) {\n        pendingObject = pendingObject.consolidateWith(object);\n      } else {\n        objects.push(pendingObject);\n        pendingObject = object;\n      }\n    });\n\n    if (pendingObject) {\n      objects.push(pendingObject);\n    }\n\n    return new this.constructor(objects);\n  }\n\n  consolidateFromIndexToIndex(startIndex, endIndex) {\n    const objects = this.objects.slice(0);\n    const objectsInRange = objects.slice(startIndex, endIndex + 1);\n    const consolidatedInRange = new this.constructor(objectsInRange).consolidate().toArray();\n    return this.splice(startIndex, objectsInRange.length, ...consolidatedInRange);\n  }\n\n  findIndexAndOffsetAtPosition(position) {\n    let index;\n    let currentPosition = 0;\n\n    for (index = 0; index < this.objects.length; index++) {\n      const object = this.objects[index];\n      const nextPosition = currentPosition + object.getLength();\n\n      if (currentPosition <= position && position < nextPosition) {\n        return {\n          index,\n          offset: position - currentPosition\n        };\n      }\n\n      currentPosition = nextPosition;\n    }\n\n    return {\n      index: null,\n      offset: null\n    };\n  }\n\n  findPositionAtIndexAndOffset(index, offset) {\n    let position = 0;\n\n    for (let currentIndex = 0; currentIndex < this.objects.length; currentIndex++) {\n      const object = this.objects[currentIndex];\n\n      if (currentIndex < index) {\n        position += object.getLength();\n      } else if (currentIndex === index) {\n        position += offset;\n        break;\n      }\n    }\n\n    return position;\n  }\n\n  getEndPosition() {\n    if (this.endPosition == null) {\n      this.endPosition = 0;\n      this.objects.forEach(object => this.endPosition += object.getLength());\n    }\n\n    return this.endPosition;\n  }\n\n  toString() {\n    return this.objects.join(\"\");\n  }\n\n  toArray() {\n    return this.objects.slice(0);\n  }\n\n  toJSON() {\n    return this.toArray();\n  }\n\n  isEqualTo(splittableList) {\n    return super.isEqualTo(...arguments) || objectArraysAreEqual(this.objects, splittableList === null || splittableList === void 0 ? void 0 : splittableList.objects);\n  }\n\n  contentsForInspection() {\n    return {\n      objects: \"[\".concat(this.objects.map(object => object.inspect()).join(\", \"), \"]\")\n    };\n  }\n\n}\n\nconst objectArraysAreEqual = function (left) {\n  let right = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n\n  if (left.length !== right.length) {\n    return false;\n  }\n\n  let result = true;\n\n  for (let index = 0; index < left.length; index++) {\n    const object = left[index];\n\n    if (result && !object.isEqualTo(right[index])) {\n      result = false;\n    }\n  }\n\n  return result;\n};\n\nconst startOfRange = range => range[0];\n\nconst endOfRange = range => range[1];\n\nclass Text extends TrixObject {\n  static textForAttachmentWithAttributes(attachment, attributes) {\n    const piece = new AttachmentPiece(attachment, attributes);\n    return new this([piece]);\n  }\n\n  static textForStringWithAttributes(string, attributes) {\n    const piece = new StringPiece(string, attributes);\n    return new this([piece]);\n  }\n\n  static fromJSON(textJSON) {\n    const pieces = Array.from(textJSON).map(pieceJSON => Piece.fromJSON(pieceJSON));\n    return new this(pieces);\n  }\n\n  constructor() {\n    let pieces = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n    const notEmpty = pieces.filter(piece => !piece.isEmpty());\n    this.pieceList = new SplittableList(notEmpty);\n  }\n\n  copy() {\n    return this.copyWithPieceList(this.pieceList);\n  }\n\n  copyWithPieceList(pieceList) {\n    return new this.constructor(pieceList.consolidate().toArray());\n  }\n\n  copyUsingObjectMap(objectMap) {\n    const pieces = this.getPieces().map(piece => objectMap.find(piece) || piece);\n    return new this.constructor(pieces);\n  }\n\n  appendText(text) {\n    return this.insertTextAtPosition(text, this.getLength());\n  }\n\n  insertTextAtPosition(text, position) {\n    return this.copyWithPieceList(this.pieceList.insertSplittableListAtPosition(text.pieceList, position));\n  }\n\n  removeTextAtRange(range) {\n    return this.copyWithPieceList(this.pieceList.removeObjectsInRange(range));\n  }\n\n  replaceTextAtRange(text, range) {\n    return this.removeTextAtRange(range).insertTextAtPosition(text, range[0]);\n  }\n\n  moveTextFromRangeToPosition(range, position) {\n    if (range[0] <= position && position <= range[1]) return;\n    const text = this.getTextAtRange(range);\n    const length = text.getLength();\n\n    if (range[0] < position) {\n      position -= length;\n    }\n\n    return this.removeTextAtRange(range).insertTextAtPosition(text, position);\n  }\n\n  addAttributeAtRange(attribute, value, range) {\n    const attributes = {};\n    attributes[attribute] = value;\n    return this.addAttributesAtRange(attributes, range);\n  }\n\n  addAttributesAtRange(attributes, range) {\n    return this.copyWithPieceList(this.pieceList.transformObjectsInRange(range, piece => piece.copyWithAdditionalAttributes(attributes)));\n  }\n\n  removeAttributeAtRange(attribute, range) {\n    return this.copyWithPieceList(this.pieceList.transformObjectsInRange(range, piece => piece.copyWithoutAttribute(attribute)));\n  }\n\n  setAttributesAtRange(attributes, range) {\n    return this.copyWithPieceList(this.pieceList.transformObjectsInRange(range, piece => piece.copyWithAttributes(attributes)));\n  }\n\n  getAttributesAtPosition(position) {\n    var _this$pieceList$getOb;\n\n    return ((_this$pieceList$getOb = this.pieceList.getObjectAtPosition(position)) === null || _this$pieceList$getOb === void 0 ? void 0 : _this$pieceList$getOb.getAttributes()) || {};\n  }\n\n  getCommonAttributes() {\n    const objects = Array.from(this.pieceList.toArray()).map(piece => piece.getAttributes());\n    return Hash.fromCommonAttributesOfObjects(objects).toObject();\n  }\n\n  getCommonAttributesAtRange(range) {\n    return this.getTextAtRange(range).getCommonAttributes() || {};\n  }\n\n  getExpandedRangeForAttributeAtOffset(attributeName, offset) {\n    let right;\n    let left = right = offset;\n    const length = this.getLength();\n\n    while (left > 0 && this.getCommonAttributesAtRange([left - 1, right])[attributeName]) {\n      left--;\n    }\n\n    while (right < length && this.getCommonAttributesAtRange([offset, right + 1])[attributeName]) {\n      right++;\n    }\n\n    return [left, right];\n  }\n\n  getTextAtRange(range) {\n    return this.copyWithPieceList(this.pieceList.getSplittableListInRange(range));\n  }\n\n  getStringAtRange(range) {\n    return this.pieceList.getSplittableListInRange(range).toString();\n  }\n\n  getStringAtPosition(position) {\n    return this.getStringAtRange([position, position + 1]);\n  }\n\n  startsWithString(string) {\n    return this.getStringAtRange([0, string.length]) === string;\n  }\n\n  endsWithString(string) {\n    const length = this.getLength();\n    return this.getStringAtRange([length - string.length, length]) === string;\n  }\n\n  getAttachmentPieces() {\n    return this.pieceList.toArray().filter(piece => !!piece.attachment);\n  }\n\n  getAttachments() {\n    return this.getAttachmentPieces().map(piece => piece.attachment);\n  }\n\n  getAttachmentAndPositionById(attachmentId) {\n    let position = 0;\n\n    for (const piece of this.pieceList.toArray()) {\n      var _piece$attachment;\n\n      if (((_piece$attachment = piece.attachment) === null || _piece$attachment === void 0 ? void 0 : _piece$attachment.id) === attachmentId) {\n        return {\n          attachment: piece.attachment,\n          position\n        };\n      }\n\n      position += piece.length;\n    }\n\n    return {\n      attachment: null,\n      position: null\n    };\n  }\n\n  getAttachmentById(attachmentId) {\n    const {\n      attachment\n    } = this.getAttachmentAndPositionById(attachmentId);\n    return attachment;\n  }\n\n  getRangeOfAttachment(attachment) {\n    const attachmentAndPosition = this.getAttachmentAndPositionById(attachment.id);\n    const position = attachmentAndPosition.position;\n    attachment = attachmentAndPosition.attachment;\n\n    if (attachment) {\n      return [position, position + 1];\n    }\n  }\n\n  updateAttributesForAttachment(attributes, attachment) {\n    const range = this.getRangeOfAttachment(attachment);\n\n    if (range) {\n      return this.addAttributesAtRange(attributes, range);\n    } else {\n      return this;\n    }\n  }\n\n  getLength() {\n    return this.pieceList.getEndPosition();\n  }\n\n  isEmpty() {\n    return this.getLength() === 0;\n  }\n\n  isEqualTo(text) {\n    var _text$pieceList;\n\n    return super.isEqualTo(text) || (text === null || text === void 0 ? void 0 : (_text$pieceList = text.pieceList) === null || _text$pieceList === void 0 ? void 0 : _text$pieceList.isEqualTo(this.pieceList));\n  }\n\n  isBlockBreak() {\n    return this.getLength() === 1 && this.pieceList.getObjectAtIndex(0).isBlockBreak();\n  }\n\n  eachPiece(callback) {\n    return this.pieceList.eachObject(callback);\n  }\n\n  getPieces() {\n    return this.pieceList.toArray();\n  }\n\n  getPieceAtPosition(position) {\n    return this.pieceList.getObjectAtPosition(position);\n  }\n\n  contentsForInspection() {\n    return {\n      pieceList: this.pieceList.inspect()\n    };\n  }\n\n  toSerializableText() {\n    const pieceList = this.pieceList.selectSplittableList(piece => piece.isSerializable());\n    return this.copyWithPieceList(pieceList);\n  }\n\n  toString() {\n    return this.pieceList.toString();\n  }\n\n  toJSON() {\n    return this.pieceList.toJSON();\n  }\n\n  toConsole() {\n    return JSON.stringify(this.pieceList.toArray().map(piece => JSON.parse(piece.toConsole())));\n  } // BIDI\n\n\n  getDirection() {\n    return getDirection(this.toString());\n  }\n\n  isRTL() {\n    return this.getDirection() === \"rtl\";\n  }\n\n}\n\nclass Block extends TrixObject {\n  static fromJSON(blockJSON) {\n    const text = Text.fromJSON(blockJSON.text);\n    return new this(text, blockJSON.attributes);\n  }\n\n  constructor(text, attributes) {\n    super(...arguments);\n    this.text = applyBlockBreakToText(text || new Text());\n    this.attributes = attributes || [];\n  }\n\n  isEmpty() {\n    return this.text.isBlockBreak();\n  }\n\n  isEqualTo(block) {\n    if (super.isEqualTo(block)) return true;\n    return this.text.isEqualTo(block === null || block === void 0 ? void 0 : block.text) && arraysAreEqual(this.attributes, block === null || block === void 0 ? void 0 : block.attributes);\n  }\n\n  copyWithText(text) {\n    return new Block(text, this.attributes);\n  }\n\n  copyWithoutText() {\n    return this.copyWithText(null);\n  }\n\n  copyWithAttributes(attributes) {\n    return new Block(this.text, attributes);\n  }\n\n  copyWithoutAttributes() {\n    return this.copyWithAttributes(null);\n  }\n\n  copyUsingObjectMap(objectMap) {\n    const mappedText = objectMap.find(this.text);\n\n    if (mappedText) {\n      return this.copyWithText(mappedText);\n    } else {\n      return this.copyWithText(this.text.copyUsingObjectMap(objectMap));\n    }\n  }\n\n  addAttribute(attribute) {\n    const attributes = this.attributes.concat(expandAttribute(attribute));\n    return this.copyWithAttributes(attributes);\n  }\n\n  removeAttribute(attribute) {\n    const {\n      listAttribute\n    } = getBlockConfig(attribute);\n    const attributes = removeLastValue(removeLastValue(this.attributes, attribute), listAttribute);\n    return this.copyWithAttributes(attributes);\n  }\n\n  removeLastAttribute() {\n    return this.removeAttribute(this.getLastAttribute());\n  }\n\n  getLastAttribute() {\n    return getLastElement(this.attributes);\n  }\n\n  getAttributes() {\n    return this.attributes.slice(0);\n  }\n\n  getAttributeLevel() {\n    return this.attributes.length;\n  }\n\n  getAttributeAtLevel(level) {\n    return this.attributes[level - 1];\n  }\n\n  hasAttribute(attributeName) {\n    return this.attributes.includes(attributeName);\n  }\n\n  hasAttributes() {\n    return this.getAttributeLevel() > 0;\n  }\n\n  getLastNestableAttribute() {\n    return getLastElement(this.getNestableAttributes());\n  }\n\n  getNestableAttributes() {\n    return this.attributes.filter(attribute => getBlockConfig(attribute).nestable);\n  }\n\n  getNestingLevel() {\n    return this.getNestableAttributes().length;\n  }\n\n  decreaseNestingLevel() {\n    const attribute = this.getLastNestableAttribute();\n\n    if (attribute) {\n      return this.removeAttribute(attribute);\n    } else {\n      return this;\n    }\n  }\n\n  increaseNestingLevel() {\n    const attribute = this.getLastNestableAttribute();\n\n    if (attribute) {\n      const index = this.attributes.lastIndexOf(attribute);\n      const attributes = spliceArray(this.attributes, index + 1, 0, ...expandAttribute(attribute));\n      return this.copyWithAttributes(attributes);\n    } else {\n      return this;\n    }\n  }\n\n  getListItemAttributes() {\n    return this.attributes.filter(attribute => getBlockConfig(attribute).listAttribute);\n  }\n\n  isListItem() {\n    var _getBlockConfig;\n\n    return (_getBlockConfig = getBlockConfig(this.getLastAttribute())) === null || _getBlockConfig === void 0 ? void 0 : _getBlockConfig.listAttribute;\n  }\n\n  isTerminalBlock() {\n    var _getBlockConfig2;\n\n    return (_getBlockConfig2 = getBlockConfig(this.getLastAttribute())) === null || _getBlockConfig2 === void 0 ? void 0 : _getBlockConfig2.terminal;\n  }\n\n  breaksOnReturn() {\n    var _getBlockConfig3;\n\n    return (_getBlockConfig3 = getBlockConfig(this.getLastAttribute())) === null || _getBlockConfig3 === void 0 ? void 0 : _getBlockConfig3.breakOnReturn;\n  }\n\n  findLineBreakInDirectionFromPosition(direction, position) {\n    const string = this.toString();\n    let result;\n\n    switch (direction) {\n      case \"forward\":\n        result = string.indexOf(\"\\n\", position);\n        break;\n\n      case \"backward\":\n        result = string.slice(0, position).lastIndexOf(\"\\n\");\n    }\n\n    if (result !== -1) {\n      return result;\n    }\n  }\n\n  contentsForInspection() {\n    return {\n      text: this.text.inspect(),\n      attributes: this.attributes\n    };\n  }\n\n  toString() {\n    return this.text.toString();\n  }\n\n  toJSON() {\n    return {\n      text: this.text,\n      attributes: this.attributes\n    };\n  } // BIDI\n\n\n  getDirection() {\n    return this.text.getDirection();\n  }\n\n  isRTL() {\n    return this.text.isRTL();\n  } // Splittable\n\n\n  getLength() {\n    return this.text.getLength();\n  }\n\n  canBeConsolidatedWith(block) {\n    return !this.hasAttributes() && !block.hasAttributes() && this.getDirection() === block.getDirection();\n  }\n\n  consolidateWith(block) {\n    const newlineText = Text.textForStringWithAttributes(\"\\n\");\n    const text = this.getTextWithoutBlockBreak().appendText(newlineText);\n    return this.copyWithText(text.appendText(block.text));\n  }\n\n  splitAtOffset(offset) {\n    let left, right;\n\n    if (offset === 0) {\n      left = null;\n      right = this;\n    } else if (offset === this.getLength()) {\n      left = this;\n      right = null;\n    } else {\n      left = this.copyWithText(this.text.getTextAtRange([0, offset]));\n      right = this.copyWithText(this.text.getTextAtRange([offset, this.getLength()]));\n    }\n\n    return [left, right];\n  }\n\n  getBlockBreakPosition() {\n    return this.text.getLength() - 1;\n  }\n\n  getTextWithoutBlockBreak() {\n    if (textEndsInBlockBreak(this.text)) {\n      return this.text.getTextAtRange([0, this.getBlockBreakPosition()]);\n    } else {\n      return this.text.copy();\n    }\n  } // Grouping\n\n\n  canBeGrouped(depth) {\n    return this.attributes[depth];\n  }\n\n  canBeGroupedWith(otherBlock, depth) {\n    const otherAttributes = otherBlock.getAttributes();\n    const otherAttribute = otherAttributes[depth];\n    const attribute = this.attributes[depth];\n    return attribute === otherAttribute && !(getBlockConfig(attribute).group === false && !getListAttributeNames().includes(otherAttributes[depth + 1])) && (this.getDirection() === otherBlock.getDirection() || otherBlock.isEmpty());\n  }\n\n} // Block breaks\n\nconst applyBlockBreakToText = function (text) {\n  text = unmarkExistingInnerBlockBreaksInText(text);\n  text = addBlockBreakToText(text);\n  return text;\n};\n\nconst unmarkExistingInnerBlockBreaksInText = function (text) {\n  let modified = false;\n  const pieces = text.getPieces();\n  let innerPieces = pieces.slice(0, pieces.length - 1);\n  const lastPiece = pieces[pieces.length - 1];\n  if (!lastPiece) return text;\n  innerPieces = innerPieces.map(piece => {\n    if (piece.isBlockBreak()) {\n      modified = true;\n      return unmarkBlockBreakPiece(piece);\n    } else {\n      return piece;\n    }\n  });\n\n  if (modified) {\n    return new Text([...innerPieces, lastPiece]);\n  } else {\n    return text;\n  }\n};\n\nconst blockBreakText = Text.textForStringWithAttributes(\"\\n\", {\n  blockBreak: true\n});\n\nconst addBlockBreakToText = function (text) {\n  if (textEndsInBlockBreak(text)) {\n    return text;\n  } else {\n    return text.appendText(blockBreakText);\n  }\n};\n\nconst textEndsInBlockBreak = function (text) {\n  const length = text.getLength();\n\n  if (length === 0) {\n    return false;\n  }\n\n  const endText = text.getTextAtRange([length - 1, length]);\n  return endText.isBlockBreak();\n};\n\nconst unmarkBlockBreakPiece = piece => piece.copyWithoutAttribute(\"blockBreak\"); // Attributes\n\n\nconst expandAttribute = function (attribute) {\n  const {\n    listAttribute\n  } = getBlockConfig(attribute);\n\n  if (listAttribute) {\n    return [listAttribute, attribute];\n  } else {\n    return [attribute];\n  }\n}; // Array helpers\n\n\nconst getLastElement = array => array.slice(-1)[0];\n\nconst removeLastValue = function (array, value) {\n  const index = array.lastIndexOf(value);\n\n  if (index === -1) {\n    return array;\n  } else {\n    return spliceArray(array, index, 1);\n  }\n};\n\nclass ObjectMap extends BasicObject {\n  constructor() {\n    let objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n    this.objects = {};\n    Array.from(objects).forEach(object => {\n      const hash = JSON.stringify(object);\n\n      if (this.objects[hash] == null) {\n        this.objects[hash] = object;\n      }\n    });\n  }\n\n  find(object) {\n    const hash = JSON.stringify(object);\n    return this.objects[hash];\n  }\n\n}\n\nclass Document extends TrixObject {\n  static fromJSON(documentJSON) {\n    const blocks = Array.from(documentJSON).map(blockJSON => Block.fromJSON(blockJSON));\n    return new this(blocks);\n  }\n\n  static fromString(string, textAttributes) {\n    const text = Text.textForStringWithAttributes(string, textAttributes);\n    return new this([new Block(text)]);\n  }\n\n  constructor() {\n    let blocks = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    super(...arguments);\n\n    if (blocks.length === 0) {\n      blocks = [new Block()];\n    }\n\n    this.blockList = SplittableList.box(blocks);\n  }\n\n  isEmpty() {\n    const block = this.getBlockAtIndex(0);\n    return this.blockList.length === 1 && block.isEmpty() && !block.hasAttributes();\n  }\n\n  copy() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const blocks = options.consolidateBlocks ? this.blockList.consolidate().toArray() : this.blockList.toArray();\n    return new this.constructor(blocks);\n  }\n\n  copyUsingObjectsFromDocument(sourceDocument) {\n    const objectMap = new ObjectMap(sourceDocument.getObjects());\n    return this.copyUsingObjectMap(objectMap);\n  }\n\n  copyUsingObjectMap(objectMap) {\n    const blocks = this.getBlocks().map(block => {\n      const mappedBlock = objectMap.find(block);\n      return mappedBlock || block.copyUsingObjectMap(objectMap);\n    });\n    return new this.constructor(blocks);\n  }\n\n  copyWithBaseBlockAttributes() {\n    let blockAttributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    const blocks = this.getBlocks().map(block => {\n      const attributes = blockAttributes.concat(block.getAttributes());\n      return block.copyWithAttributes(attributes);\n    });\n    return new this.constructor(blocks);\n  }\n\n  replaceBlock(oldBlock, newBlock) {\n    const index = this.blockList.indexOf(oldBlock);\n\n    if (index === -1) {\n      return this;\n    }\n\n    return new this.constructor(this.blockList.replaceObjectAtIndex(newBlock, index));\n  }\n\n  insertDocumentAtRange(document, range) {\n    const {\n      blockList\n    } = document;\n    range = normalizeRange(range);\n    let [position] = range;\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    let result = this;\n    const block = this.getBlockAtPosition(position);\n\n    if (rangeIsCollapsed(range) && block.isEmpty() && !block.hasAttributes()) {\n      result = new this.constructor(result.blockList.removeObjectAtIndex(index));\n    } else if (block.getBlockBreakPosition() === offset) {\n      position++;\n    }\n\n    result = result.removeTextAtRange(range);\n    return new this.constructor(result.blockList.insertSplittableListAtPosition(blockList, position));\n  }\n\n  mergeDocumentAtRange(document, range) {\n    let formattedDocument, result;\n    range = normalizeRange(range);\n    const [startPosition] = range;\n    const startLocation = this.locationFromPosition(startPosition);\n    const blockAttributes = this.getBlockAtIndex(startLocation.index).getAttributes();\n    const baseBlockAttributes = document.getBaseBlockAttributes();\n    const trailingBlockAttributes = blockAttributes.slice(-baseBlockAttributes.length);\n\n    if (arraysAreEqual(baseBlockAttributes, trailingBlockAttributes)) {\n      const leadingBlockAttributes = blockAttributes.slice(0, -baseBlockAttributes.length);\n      formattedDocument = document.copyWithBaseBlockAttributes(leadingBlockAttributes);\n    } else {\n      formattedDocument = document.copy({\n        consolidateBlocks: true\n      }).copyWithBaseBlockAttributes(blockAttributes);\n    }\n\n    const blockCount = formattedDocument.getBlockCount();\n    const firstBlock = formattedDocument.getBlockAtIndex(0);\n\n    if (arraysAreEqual(blockAttributes, firstBlock.getAttributes())) {\n      const firstText = firstBlock.getTextWithoutBlockBreak();\n      result = this.insertTextAtRange(firstText, range);\n\n      if (blockCount > 1) {\n        formattedDocument = new this.constructor(formattedDocument.getBlocks().slice(1));\n        const position = startPosition + firstText.getLength();\n        result = result.insertDocumentAtRange(formattedDocument, position);\n      }\n    } else {\n      result = this.insertDocumentAtRange(formattedDocument, range);\n    }\n\n    return result;\n  }\n\n  insertTextAtRange(text, range) {\n    range = normalizeRange(range);\n    const [startPosition] = range;\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(startPosition);\n    const document = this.removeTextAtRange(range);\n    return new this.constructor(document.blockList.editObjectAtIndex(index, block => block.copyWithText(block.text.insertTextAtPosition(text, offset))));\n  }\n\n  removeTextAtRange(range) {\n    let blocks;\n    range = normalizeRange(range);\n    const [leftPosition, rightPosition] = range;\n\n    if (rangeIsCollapsed(range)) {\n      return this;\n    }\n\n    const [leftLocation, rightLocation] = Array.from(this.locationRangeFromRange(range));\n    const leftIndex = leftLocation.index;\n    const leftOffset = leftLocation.offset;\n    const leftBlock = this.getBlockAtIndex(leftIndex);\n    const rightIndex = rightLocation.index;\n    const rightOffset = rightLocation.offset;\n    const rightBlock = this.getBlockAtIndex(rightIndex);\n    const removeRightNewline = rightPosition - leftPosition === 1 && leftBlock.getBlockBreakPosition() === leftOffset && rightBlock.getBlockBreakPosition() !== rightOffset && rightBlock.text.getStringAtPosition(rightOffset) === \"\\n\";\n\n    if (removeRightNewline) {\n      blocks = this.blockList.editObjectAtIndex(rightIndex, block => block.copyWithText(block.text.removeTextAtRange([rightOffset, rightOffset + 1])));\n    } else {\n      let block;\n      const leftText = leftBlock.text.getTextAtRange([0, leftOffset]);\n      const rightText = rightBlock.text.getTextAtRange([rightOffset, rightBlock.getLength()]);\n      const text = leftText.appendText(rightText);\n      const removingLeftBlock = leftIndex !== rightIndex && leftOffset === 0;\n      const useRightBlock = removingLeftBlock && leftBlock.getAttributeLevel() >= rightBlock.getAttributeLevel();\n\n      if (useRightBlock) {\n        block = rightBlock.copyWithText(text);\n      } else {\n        block = leftBlock.copyWithText(text);\n      }\n\n      const affectedBlockCount = rightIndex + 1 - leftIndex;\n      blocks = this.blockList.splice(leftIndex, affectedBlockCount, block);\n    }\n\n    return new this.constructor(blocks);\n  }\n\n  moveTextFromRangeToPosition(range, position) {\n    let text;\n    range = normalizeRange(range);\n    const [startPosition, endPosition] = range;\n\n    if (startPosition <= position && position <= endPosition) {\n      return this;\n    }\n\n    let document = this.getDocumentAtRange(range);\n    let result = this.removeTextAtRange(range);\n    const movingRightward = startPosition < position;\n\n    if (movingRightward) {\n      position -= document.getLength();\n    }\n\n    const [firstBlock, ...blocks] = document.getBlocks();\n\n    if (blocks.length === 0) {\n      text = firstBlock.getTextWithoutBlockBreak();\n\n      if (movingRightward) {\n        position += 1;\n      }\n    } else {\n      text = firstBlock.text;\n    }\n\n    result = result.insertTextAtRange(text, position);\n\n    if (blocks.length === 0) {\n      return result;\n    }\n\n    document = new this.constructor(blocks);\n    position += text.getLength();\n    return result.insertDocumentAtRange(document, position);\n  }\n\n  addAttributeAtRange(attribute, value, range) {\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, (block, textRange, index) => blockList = blockList.editObjectAtIndex(index, function () {\n      if (getBlockConfig(attribute)) {\n        return block.addAttribute(attribute, value);\n      } else {\n        if (textRange[0] === textRange[1]) {\n          return block;\n        } else {\n          return block.copyWithText(block.text.addAttributeAtRange(attribute, value, textRange));\n        }\n      }\n    }));\n    return new this.constructor(blockList);\n  }\n\n  addAttribute(attribute, value) {\n    let {\n      blockList\n    } = this;\n    this.eachBlock((block, index) => blockList = blockList.editObjectAtIndex(index, () => block.addAttribute(attribute, value)));\n    return new this.constructor(blockList);\n  }\n\n  removeAttributeAtRange(attribute, range) {\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, function (block, textRange, index) {\n      if (getBlockConfig(attribute)) {\n        blockList = blockList.editObjectAtIndex(index, () => block.removeAttribute(attribute));\n      } else if (textRange[0] !== textRange[1]) {\n        blockList = blockList.editObjectAtIndex(index, () => block.copyWithText(block.text.removeAttributeAtRange(attribute, textRange)));\n      }\n    });\n    return new this.constructor(blockList);\n  }\n\n  updateAttributesForAttachment(attributes, attachment) {\n    const range = this.getRangeOfAttachment(attachment);\n    const [startPosition] = Array.from(range);\n    const {\n      index\n    } = this.locationFromPosition(startPosition);\n    const text = this.getTextAtIndex(index);\n    return new this.constructor(this.blockList.editObjectAtIndex(index, block => block.copyWithText(text.updateAttributesForAttachment(attributes, attachment))));\n  }\n\n  removeAttributeForAttachment(attribute, attachment) {\n    const range = this.getRangeOfAttachment(attachment);\n    return this.removeAttributeAtRange(attribute, range);\n  }\n\n  insertBlockBreakAtRange(range) {\n    let blocks;\n    range = normalizeRange(range);\n    const [startPosition] = range;\n    const {\n      offset\n    } = this.locationFromPosition(startPosition);\n    const document = this.removeTextAtRange(range);\n\n    if (offset === 0) {\n      blocks = [new Block()];\n    }\n\n    return new this.constructor(document.blockList.insertSplittableListAtPosition(new SplittableList(blocks), startPosition));\n  }\n\n  applyBlockAttributeAtRange(attributeName, value, range) {\n    const expanded = this.expandRangeToLineBreaksAndSplitBlocks(range);\n    let document = expanded.document;\n    range = expanded.range;\n    const blockConfig = getBlockConfig(attributeName);\n\n    if (blockConfig.listAttribute) {\n      document = document.removeLastListAttributeAtRange(range, {\n        exceptAttributeName: attributeName\n      });\n      const converted = document.convertLineBreaksToBlockBreaksInRange(range);\n      document = converted.document;\n      range = converted.range;\n    } else if (blockConfig.exclusive) {\n      document = document.removeBlockAttributesAtRange(range);\n    } else if (blockConfig.terminal) {\n      document = document.removeLastTerminalAttributeAtRange(range);\n    } else {\n      document = document.consolidateBlocksAtRange(range);\n    }\n\n    return document.addAttributeAtRange(attributeName, value, range);\n  }\n\n  removeLastListAttributeAtRange(range) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, function (block, textRange, index) {\n      const lastAttributeName = block.getLastAttribute();\n\n      if (!lastAttributeName) {\n        return;\n      }\n\n      if (!getBlockConfig(lastAttributeName).listAttribute) {\n        return;\n      }\n\n      if (lastAttributeName === options.exceptAttributeName) {\n        return;\n      }\n\n      blockList = blockList.editObjectAtIndex(index, () => block.removeAttribute(lastAttributeName));\n    });\n    return new this.constructor(blockList);\n  }\n\n  removeLastTerminalAttributeAtRange(range) {\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, function (block, textRange, index) {\n      const lastAttributeName = block.getLastAttribute();\n\n      if (!lastAttributeName) {\n        return;\n      }\n\n      if (!getBlockConfig(lastAttributeName).terminal) {\n        return;\n      }\n\n      blockList = blockList.editObjectAtIndex(index, () => block.removeAttribute(lastAttributeName));\n    });\n    return new this.constructor(blockList);\n  }\n\n  removeBlockAttributesAtRange(range) {\n    let {\n      blockList\n    } = this;\n    this.eachBlockAtRange(range, function (block, textRange, index) {\n      if (block.hasAttributes()) {\n        blockList = blockList.editObjectAtIndex(index, () => block.copyWithoutAttributes());\n      }\n    });\n    return new this.constructor(blockList);\n  }\n\n  expandRangeToLineBreaksAndSplitBlocks(range) {\n    let position;\n    range = normalizeRange(range);\n    let [startPosition, endPosition] = range;\n    const startLocation = this.locationFromPosition(startPosition);\n    const endLocation = this.locationFromPosition(endPosition);\n    let document = this;\n    const startBlock = document.getBlockAtIndex(startLocation.index);\n    startLocation.offset = startBlock.findLineBreakInDirectionFromPosition(\"backward\", startLocation.offset);\n\n    if (startLocation.offset != null) {\n      position = document.positionFromLocation(startLocation);\n      document = document.insertBlockBreakAtRange([position, position + 1]);\n      endLocation.index += 1;\n      endLocation.offset -= document.getBlockAtIndex(startLocation.index).getLength();\n      startLocation.index += 1;\n    }\n\n    startLocation.offset = 0;\n\n    if (endLocation.offset === 0 && endLocation.index > startLocation.index) {\n      endLocation.index -= 1;\n      endLocation.offset = document.getBlockAtIndex(endLocation.index).getBlockBreakPosition();\n    } else {\n      const endBlock = document.getBlockAtIndex(endLocation.index);\n\n      if (endBlock.text.getStringAtRange([endLocation.offset - 1, endLocation.offset]) === \"\\n\") {\n        endLocation.offset -= 1;\n      } else {\n        endLocation.offset = endBlock.findLineBreakInDirectionFromPosition(\"forward\", endLocation.offset);\n      }\n\n      if (endLocation.offset !== endBlock.getBlockBreakPosition()) {\n        position = document.positionFromLocation(endLocation);\n        document = document.insertBlockBreakAtRange([position, position + 1]);\n      }\n    }\n\n    startPosition = document.positionFromLocation(startLocation);\n    endPosition = document.positionFromLocation(endLocation);\n    range = normalizeRange([startPosition, endPosition]);\n    return {\n      document,\n      range\n    };\n  }\n\n  convertLineBreaksToBlockBreaksInRange(range) {\n    range = normalizeRange(range);\n    let [position] = range;\n    const string = this.getStringAtRange(range).slice(0, -1);\n    let document = this;\n    string.replace(/.*?\\n/g, function (match) {\n      position += match.length;\n      document = document.insertBlockBreakAtRange([position - 1, position]);\n    });\n    return {\n      document,\n      range\n    };\n  }\n\n  consolidateBlocksAtRange(range) {\n    range = normalizeRange(range);\n    const [startPosition, endPosition] = range;\n    const startIndex = this.locationFromPosition(startPosition).index;\n    const endIndex = this.locationFromPosition(endPosition).index;\n    return new this.constructor(this.blockList.consolidateFromIndexToIndex(startIndex, endIndex));\n  }\n\n  getDocumentAtRange(range) {\n    range = normalizeRange(range);\n    const blocks = this.blockList.getSplittableListInRange(range).toArray();\n    return new this.constructor(blocks);\n  }\n\n  getStringAtRange(range) {\n    let endIndex;\n    const array = range = normalizeRange(range),\n          endPosition = array[array.length - 1];\n\n    if (endPosition !== this.getLength()) {\n      endIndex = -1;\n    }\n\n    return this.getDocumentAtRange(range).toString().slice(0, endIndex);\n  }\n\n  getBlockAtIndex(index) {\n    return this.blockList.getObjectAtIndex(index);\n  }\n\n  getBlockAtPosition(position) {\n    const {\n      index\n    } = this.locationFromPosition(position);\n    return this.getBlockAtIndex(index);\n  }\n\n  getTextAtIndex(index) {\n    var _this$getBlockAtIndex;\n\n    return (_this$getBlockAtIndex = this.getBlockAtIndex(index)) === null || _this$getBlockAtIndex === void 0 ? void 0 : _this$getBlockAtIndex.text;\n  }\n\n  getTextAtPosition(position) {\n    const {\n      index\n    } = this.locationFromPosition(position);\n    return this.getTextAtIndex(index);\n  }\n\n  getPieceAtPosition(position) {\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    return this.getTextAtIndex(index).getPieceAtPosition(offset);\n  }\n\n  getCharacterAtPosition(position) {\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    return this.getTextAtIndex(index).getStringAtRange([offset, offset + 1]);\n  }\n\n  getLength() {\n    return this.blockList.getEndPosition();\n  }\n\n  getBlocks() {\n    return this.blockList.toArray();\n  }\n\n  getBlockCount() {\n    return this.blockList.length;\n  }\n\n  getEditCount() {\n    return this.editCount;\n  }\n\n  eachBlock(callback) {\n    return this.blockList.eachObject(callback);\n  }\n\n  eachBlockAtRange(range, callback) {\n    let block, textRange;\n    range = normalizeRange(range);\n    const [startPosition, endPosition] = range;\n    const startLocation = this.locationFromPosition(startPosition);\n    const endLocation = this.locationFromPosition(endPosition);\n\n    if (startLocation.index === endLocation.index) {\n      block = this.getBlockAtIndex(startLocation.index);\n      textRange = [startLocation.offset, endLocation.offset];\n      return callback(block, textRange, startLocation.index);\n    } else {\n      for (let index = startLocation.index; index <= endLocation.index; index++) {\n        block = this.getBlockAtIndex(index);\n\n        if (block) {\n          switch (index) {\n            case startLocation.index:\n              textRange = [startLocation.offset, block.text.getLength()];\n              break;\n\n            case endLocation.index:\n              textRange = [0, endLocation.offset];\n              break;\n\n            default:\n              textRange = [0, block.text.getLength()];\n          }\n\n          callback(block, textRange, index);\n        }\n      }\n    }\n  }\n\n  getCommonAttributesAtRange(range) {\n    range = normalizeRange(range);\n    const [startPosition] = range;\n\n    if (rangeIsCollapsed(range)) {\n      return this.getCommonAttributesAtPosition(startPosition);\n    } else {\n      const textAttributes = [];\n      const blockAttributes = [];\n      this.eachBlockAtRange(range, function (block, textRange) {\n        if (textRange[0] !== textRange[1]) {\n          textAttributes.push(block.text.getCommonAttributesAtRange(textRange));\n          return blockAttributes.push(attributesForBlock(block));\n        }\n      });\n      return Hash.fromCommonAttributesOfObjects(textAttributes).merge(Hash.fromCommonAttributesOfObjects(blockAttributes)).toObject();\n    }\n  }\n\n  getCommonAttributesAtPosition(position) {\n    let key, value;\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    const block = this.getBlockAtIndex(index);\n\n    if (!block) {\n      return {};\n    }\n\n    const commonAttributes = attributesForBlock(block);\n    const attributes = block.text.getAttributesAtPosition(offset);\n    const attributesLeft = block.text.getAttributesAtPosition(offset - 1);\n    const inheritableAttributes = Object.keys(config.textAttributes).filter(key => {\n      return config.textAttributes[key].inheritable;\n    });\n\n    for (key in attributesLeft) {\n      value = attributesLeft[key];\n\n      if (value === attributes[key] || inheritableAttributes.includes(key)) {\n        commonAttributes[key] = value;\n      }\n    }\n\n    return commonAttributes;\n  }\n\n  getRangeOfCommonAttributeAtPosition(attributeName, position) {\n    const {\n      index,\n      offset\n    } = this.locationFromPosition(position);\n    const text = this.getTextAtIndex(index);\n    const [startOffset, endOffset] = Array.from(text.getExpandedRangeForAttributeAtOffset(attributeName, offset));\n    const start = this.positionFromLocation({\n      index,\n      offset: startOffset\n    });\n    const end = this.positionFromLocation({\n      index,\n      offset: endOffset\n    });\n    return normalizeRange([start, end]);\n  }\n\n  getBaseBlockAttributes() {\n    let baseBlockAttributes = this.getBlockAtIndex(0).getAttributes();\n\n    for (let blockIndex = 1; blockIndex < this.getBlockCount(); blockIndex++) {\n      const blockAttributes = this.getBlockAtIndex(blockIndex).getAttributes();\n      const lastAttributeIndex = Math.min(baseBlockAttributes.length, blockAttributes.length);\n\n      baseBlockAttributes = (() => {\n        const result = [];\n\n        for (let index = 0; index < lastAttributeIndex; index++) {\n          if (blockAttributes[index] !== baseBlockAttributes[index]) {\n            break;\n          }\n\n          result.push(blockAttributes[index]);\n        }\n\n        return result;\n      })();\n    }\n\n    return baseBlockAttributes;\n  }\n\n  getAttachmentById(attachmentId) {\n    for (const attachment of this.getAttachments()) {\n      if (attachment.id === attachmentId) {\n        return attachment;\n      }\n    }\n  }\n\n  getAttachmentPieces() {\n    let attachmentPieces = [];\n    this.blockList.eachObject(_ref => {\n      let {\n        text\n      } = _ref;\n      return attachmentPieces = attachmentPieces.concat(text.getAttachmentPieces());\n    });\n    return attachmentPieces;\n  }\n\n  getAttachments() {\n    return this.getAttachmentPieces().map(piece => piece.attachment);\n  }\n\n  getRangeOfAttachment(attachment) {\n    let position = 0;\n    const iterable = this.blockList.toArray();\n\n    for (let index = 0; index < iterable.length; index++) {\n      const {\n        text\n      } = iterable[index];\n      const textRange = text.getRangeOfAttachment(attachment);\n\n      if (textRange) {\n        return normalizeRange([position + textRange[0], position + textRange[1]]);\n      }\n\n      position += text.getLength();\n    }\n  }\n\n  getLocationRangeOfAttachment(attachment) {\n    const range = this.getRangeOfAttachment(attachment);\n    return this.locationRangeFromRange(range);\n  }\n\n  getAttachmentPieceForAttachment(attachment) {\n    for (const piece of this.getAttachmentPieces()) {\n      if (piece.attachment === attachment) {\n        return piece;\n      }\n    }\n  }\n\n  findRangesForBlockAttribute(attributeName) {\n    let position = 0;\n    const ranges = [];\n    this.getBlocks().forEach(block => {\n      const length = block.getLength();\n\n      if (block.hasAttribute(attributeName)) {\n        ranges.push([position, position + length]);\n      }\n\n      position += length;\n    });\n    return ranges;\n  }\n\n  findRangesForTextAttribute(attributeName) {\n    let {\n      withValue\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let position = 0;\n    let range = [];\n    const ranges = [];\n\n    const match = function (piece) {\n      if (withValue) {\n        return piece.getAttribute(attributeName) === withValue;\n      } else {\n        return piece.hasAttribute(attributeName);\n      }\n    };\n\n    this.getPieces().forEach(piece => {\n      const length = piece.getLength();\n\n      if (match(piece)) {\n        if (range[1] === position) {\n          range[1] = position + length;\n        } else {\n          ranges.push(range = [position, position + length]);\n        }\n      }\n\n      position += length;\n    });\n    return ranges;\n  }\n\n  locationFromPosition(position) {\n    const location = this.blockList.findIndexAndOffsetAtPosition(Math.max(0, position));\n\n    if (location.index != null) {\n      return location;\n    } else {\n      const blocks = this.getBlocks();\n      return {\n        index: blocks.length - 1,\n        offset: blocks[blocks.length - 1].getLength()\n      };\n    }\n  }\n\n  positionFromLocation(location) {\n    return this.blockList.findPositionAtIndexAndOffset(location.index, location.offset);\n  }\n\n  locationRangeFromPosition(position) {\n    return normalizeRange(this.locationFromPosition(position));\n  }\n\n  locationRangeFromRange(range) {\n    range = normalizeRange(range);\n    if (!range) return;\n    const [startPosition, endPosition] = Array.from(range);\n    const startLocation = this.locationFromPosition(startPosition);\n    const endLocation = this.locationFromPosition(endPosition);\n    return normalizeRange([startLocation, endLocation]);\n  }\n\n  rangeFromLocationRange(locationRange) {\n    let rightPosition;\n    locationRange = normalizeRange(locationRange);\n    const leftPosition = this.positionFromLocation(locationRange[0]);\n\n    if (!rangeIsCollapsed(locationRange)) {\n      rightPosition = this.positionFromLocation(locationRange[1]);\n    }\n\n    return normalizeRange([leftPosition, rightPosition]);\n  }\n\n  isEqualTo(document) {\n    return this.blockList.isEqualTo(document === null || document === void 0 ? void 0 : document.blockList);\n  }\n\n  getTexts() {\n    return this.getBlocks().map(block => block.text);\n  }\n\n  getPieces() {\n    const pieces = [];\n    Array.from(this.getTexts()).forEach(text => {\n      pieces.push(...Array.from(text.getPieces() || []));\n    });\n    return pieces;\n  }\n\n  getObjects() {\n    return this.getBlocks().concat(this.getTexts()).concat(this.getPieces());\n  }\n\n  toSerializableDocument() {\n    const blocks = [];\n    this.blockList.eachObject(block => blocks.push(block.copyWithText(block.text.toSerializableText())));\n    return new this.constructor(blocks);\n  }\n\n  toString() {\n    return this.blockList.toString();\n  }\n\n  toJSON() {\n    return this.blockList.toJSON();\n  }\n\n  toConsole() {\n    return JSON.stringify(this.blockList.toArray()).map(block => JSON.parse(block.text.toConsole()));\n  }\n\n}\n\nconst attributesForBlock = function (block) {\n  const attributes = {};\n  const attributeName = block.getLastAttribute();\n\n  if (attributeName) {\n    attributes[attributeName] = true;\n  }\n\n  return attributes;\n};\n\nconst DEFAULT_ALLOWED_ATTRIBUTES = \"style href src width height class\".split(\" \");\nconst DEFAULT_FORBIDDEN_PROTOCOLS = \"javascript:\".split(\" \");\nconst DEFAULT_FORBIDDEN_ELEMENTS = \"script iframe\".split(\" \");\nclass HTMLSanitizer extends BasicObject {\n  static sanitize(html, options) {\n    const sanitizer = new this(html, options);\n    sanitizer.sanitize();\n    return sanitizer;\n  }\n\n  constructor(html) {\n    let {\n      allowedAttributes,\n      forbiddenProtocols,\n      forbiddenElements\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super(...arguments);\n    this.allowedAttributes = allowedAttributes || DEFAULT_ALLOWED_ATTRIBUTES;\n    this.forbiddenProtocols = forbiddenProtocols || DEFAULT_FORBIDDEN_PROTOCOLS;\n    this.forbiddenElements = forbiddenElements || DEFAULT_FORBIDDEN_ELEMENTS;\n    this.body = createBodyElementForHTML(html);\n  }\n\n  sanitize() {\n    this.sanitizeElements();\n    return this.normalizeListElementNesting();\n  }\n\n  getHTML() {\n    return this.body.innerHTML;\n  }\n\n  getBody() {\n    return this.body;\n  } // Private\n\n\n  sanitizeElements() {\n    const walker = walkTree(this.body);\n    const nodesToRemove = [];\n\n    while (walker.nextNode()) {\n      const node = walker.currentNode;\n\n      switch (node.nodeType) {\n        case Node.ELEMENT_NODE:\n          if (this.elementIsRemovable(node)) {\n            nodesToRemove.push(node);\n          } else {\n            this.sanitizeElement(node);\n          }\n\n          break;\n\n        case Node.COMMENT_NODE:\n          nodesToRemove.push(node);\n          break;\n      }\n    }\n\n    nodesToRemove.forEach(node => removeNode(node));\n    return this.body;\n  }\n\n  sanitizeElement(element) {\n    if (element.hasAttribute(\"href\")) {\n      if (this.forbiddenProtocols.includes(element.protocol)) {\n        element.removeAttribute(\"href\");\n      }\n    }\n\n    Array.from(element.attributes).forEach(_ref => {\n      let {\n        name\n      } = _ref;\n\n      if (!this.allowedAttributes.includes(name) && name.indexOf(\"data-trix\") !== 0) {\n        element.removeAttribute(name);\n      }\n    });\n    return element;\n  }\n\n  normalizeListElementNesting() {\n    Array.from(this.body.querySelectorAll(\"ul,ol\")).forEach(listElement => {\n      const previousElement = listElement.previousElementSibling;\n\n      if (previousElement) {\n        if (tagName(previousElement) === \"li\") {\n          previousElement.appendChild(listElement);\n        }\n      }\n    });\n    return this.body;\n  }\n\n  elementIsRemovable(element) {\n    if ((element === null || element === void 0 ? void 0 : element.nodeType) !== Node.ELEMENT_NODE) return;\n    return this.elementIsForbidden(element) || this.elementIsntSerializable(element);\n  }\n\n  elementIsForbidden(element) {\n    return this.forbiddenElements.includes(tagName(element));\n  }\n\n  elementIsntSerializable(element) {\n    return element.getAttribute(\"data-trix-serialize\") === \"false\" && !nodeIsAttachmentElement(element);\n  }\n\n}\n\nconst createBodyElementForHTML = function () {\n  let html = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n  // Remove everything after </html>\n  html = html.replace(/<\\/html[^>]*>[^]*$/i, \"</html>\");\n  const doc = document.implementation.createHTMLDocument(\"\");\n  doc.documentElement.innerHTML = html;\n  Array.from(doc.head.querySelectorAll(\"style\")).forEach(element => {\n    doc.body.appendChild(element);\n  });\n  return doc.body;\n};\n\n/* eslint-disable\n    no-case-declarations,\n    no-irregular-whitespace,\n*/\n\nconst pieceForString = function (string) {\n  let attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const type = \"string\";\n  string = normalizeSpaces(string);\n  return {\n    string,\n    attributes,\n    type\n  };\n};\n\nconst pieceForAttachment = function (attachment) {\n  let attributes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const type = \"attachment\";\n  return {\n    attachment,\n    attributes,\n    type\n  };\n};\n\nconst blockForAttributes = function () {\n  let attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  const text = [];\n  return {\n    text,\n    attributes\n  };\n};\n\nconst parseTrixDataAttribute = (element, name) => {\n  try {\n    return JSON.parse(element.getAttribute(\"data-trix-\".concat(name)));\n  } catch (error) {\n    return {};\n  }\n};\n\nconst getImageDimensions = element => {\n  const width = element.getAttribute(\"width\");\n  const height = element.getAttribute(\"height\");\n  const dimensions = {};\n\n  if (width) {\n    dimensions.width = parseInt(width, 10);\n  }\n\n  if (height) {\n    dimensions.height = parseInt(height, 10);\n  }\n\n  return dimensions;\n};\n\nclass HTMLParser extends BasicObject {\n  static parse(html, options) {\n    const parser = new this(html, options);\n    parser.parse();\n    return parser;\n  }\n\n  constructor(html) {\n    let {\n      referenceElement\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super(...arguments);\n    this.html = html;\n    this.referenceElement = referenceElement;\n    this.blocks = [];\n    this.blockElements = [];\n    this.processedElements = [];\n  }\n\n  getDocument() {\n    return Document.fromJSON(this.blocks);\n  } // HTML parsing\n\n\n  parse() {\n    try {\n      this.createHiddenContainer();\n      const html = HTMLSanitizer.sanitize(this.html).getHTML();\n      this.containerElement.innerHTML = html;\n      const walker = walkTree(this.containerElement, {\n        usingFilter: nodeFilter\n      });\n\n      while (walker.nextNode()) {\n        this.processNode(walker.currentNode);\n      }\n\n      return this.translateBlockElementMarginsToNewlines();\n    } finally {\n      this.removeHiddenContainer();\n    }\n  }\n\n  createHiddenContainer() {\n    if (this.referenceElement) {\n      this.containerElement = this.referenceElement.cloneNode(false);\n      this.containerElement.removeAttribute(\"id\");\n      this.containerElement.setAttribute(\"data-trix-internal\", \"\");\n      this.containerElement.style.display = \"none\";\n      return this.referenceElement.parentNode.insertBefore(this.containerElement, this.referenceElement.nextSibling);\n    } else {\n      this.containerElement = makeElement({\n        tagName: \"div\",\n        style: {\n          display: \"none\"\n        }\n      });\n      return document.body.appendChild(this.containerElement);\n    }\n  }\n\n  removeHiddenContainer() {\n    return removeNode(this.containerElement);\n  }\n\n  processNode(node) {\n    switch (node.nodeType) {\n      case Node.TEXT_NODE:\n        if (!this.isInsignificantTextNode(node)) {\n          this.appendBlockForTextNode(node);\n          return this.processTextNode(node);\n        }\n\n        break;\n\n      case Node.ELEMENT_NODE:\n        this.appendBlockForElement(node);\n        return this.processElement(node);\n    }\n  }\n\n  appendBlockForTextNode(node) {\n    const element = node.parentNode;\n\n    if (element === this.currentBlockElement && this.isBlockElement(node.previousSibling)) {\n      return this.appendStringWithAttributes(\"\\n\");\n    } else if (element === this.containerElement || this.isBlockElement(element)) {\n      var _this$currentBlock;\n\n      const attributes = this.getBlockAttributes(element);\n\n      if (!arraysAreEqual(attributes, (_this$currentBlock = this.currentBlock) === null || _this$currentBlock === void 0 ? void 0 : _this$currentBlock.attributes)) {\n        this.currentBlock = this.appendBlockForAttributesWithElement(attributes, element);\n        this.currentBlockElement = element;\n      }\n    }\n  }\n\n  appendBlockForElement(element) {\n    const elementIsBlockElement = this.isBlockElement(element);\n    const currentBlockContainsElement = elementContainsNode(this.currentBlockElement, element);\n\n    if (elementIsBlockElement && !this.isBlockElement(element.firstChild)) {\n      if (!this.isInsignificantTextNode(element.firstChild) || !this.isBlockElement(element.firstElementChild)) {\n        const attributes = this.getBlockAttributes(element);\n\n        if (element.firstChild) {\n          if (!(currentBlockContainsElement && arraysAreEqual(attributes, this.currentBlock.attributes))) {\n            this.currentBlock = this.appendBlockForAttributesWithElement(attributes, element);\n            this.currentBlockElement = element;\n          } else {\n            return this.appendStringWithAttributes(\"\\n\");\n          }\n        }\n      }\n    } else if (this.currentBlockElement && !currentBlockContainsElement && !elementIsBlockElement) {\n      const parentBlockElement = this.findParentBlockElement(element);\n\n      if (parentBlockElement) {\n        return this.appendBlockForElement(parentBlockElement);\n      } else {\n        this.currentBlock = this.appendEmptyBlock();\n        this.currentBlockElement = null;\n      }\n    }\n  }\n\n  findParentBlockElement(element) {\n    let {\n      parentElement\n    } = element;\n\n    while (parentElement && parentElement !== this.containerElement) {\n      if (this.isBlockElement(parentElement) && this.blockElements.includes(parentElement)) {\n        return parentElement;\n      } else {\n        parentElement = parentElement.parentElement;\n      }\n    }\n\n    return null;\n  }\n\n  processTextNode(node) {\n    let string = node.data;\n\n    if (!elementCanDisplayPreformattedText(node.parentNode)) {\n      var _node$previousSibling;\n\n      string = squishBreakableWhitespace(string);\n\n      if (stringEndsWithWhitespace((_node$previousSibling = node.previousSibling) === null || _node$previousSibling === void 0 ? void 0 : _node$previousSibling.textContent)) {\n        string = leftTrimBreakableWhitespace(string);\n      }\n    }\n\n    return this.appendStringWithAttributes(string, this.getTextAttributes(node.parentNode));\n  }\n\n  processElement(element) {\n    let attributes;\n\n    if (nodeIsAttachmentElement(element)) {\n      attributes = parseTrixDataAttribute(element, \"attachment\");\n\n      if (Object.keys(attributes).length) {\n        const textAttributes = this.getTextAttributes(element);\n        this.appendAttachmentWithAttributes(attributes, textAttributes); // We have everything we need so avoid processing inner nodes\n\n        element.innerHTML = \"\";\n      }\n\n      return this.processedElements.push(element);\n    } else {\n      switch (tagName(element)) {\n        case \"br\":\n          if (!this.isExtraBR(element) && !this.isBlockElement(element.nextSibling)) {\n            this.appendStringWithAttributes(\"\\n\", this.getTextAttributes(element));\n          }\n\n          return this.processedElements.push(element);\n\n        case \"img\":\n          attributes = {\n            url: element.getAttribute(\"src\"),\n            contentType: \"image\"\n          };\n          const object = getImageDimensions(element);\n\n          for (const key in object) {\n            const value = object[key];\n            attributes[key] = value;\n          }\n\n          this.appendAttachmentWithAttributes(attributes, this.getTextAttributes(element));\n          return this.processedElements.push(element);\n\n        case \"tr\":\n          if (element.parentNode.firstChild !== element) {\n            return this.appendStringWithAttributes(\"\\n\");\n          }\n\n          break;\n\n        case \"td\":\n          if (element.parentNode.firstChild !== element) {\n            return this.appendStringWithAttributes(\" | \");\n          }\n\n          break;\n      }\n    }\n  } // Document construction\n\n\n  appendBlockForAttributesWithElement(attributes, element) {\n    this.blockElements.push(element);\n    const block = blockForAttributes(attributes);\n    this.blocks.push(block);\n    return block;\n  }\n\n  appendEmptyBlock() {\n    return this.appendBlockForAttributesWithElement([], null);\n  }\n\n  appendStringWithAttributes(string, attributes) {\n    return this.appendPiece(pieceForString(string, attributes));\n  }\n\n  appendAttachmentWithAttributes(attachment, attributes) {\n    return this.appendPiece(pieceForAttachment(attachment, attributes));\n  }\n\n  appendPiece(piece) {\n    if (this.blocks.length === 0) {\n      this.appendEmptyBlock();\n    }\n\n    return this.blocks[this.blocks.length - 1].text.push(piece);\n  }\n\n  appendStringToTextAtIndex(string, index) {\n    const {\n      text\n    } = this.blocks[index];\n    const piece = text[text.length - 1];\n\n    if ((piece === null || piece === void 0 ? void 0 : piece.type) === \"string\") {\n      piece.string += string;\n    } else {\n      return text.push(pieceForString(string));\n    }\n  }\n\n  prependStringToTextAtIndex(string, index) {\n    const {\n      text\n    } = this.blocks[index];\n    const piece = text[0];\n\n    if ((piece === null || piece === void 0 ? void 0 : piece.type) === \"string\") {\n      piece.string = string + piece.string;\n    } else {\n      return text.unshift(pieceForString(string));\n    }\n  } // Attribute parsing\n\n\n  getTextAttributes(element) {\n    let value;\n    const attributes = {};\n\n    for (const attribute in config.textAttributes) {\n      const configAttr = config.textAttributes[attribute];\n\n      if (configAttr.tagName && findClosestElementFromNode(element, {\n        matchingSelector: configAttr.tagName,\n        untilNode: this.containerElement\n      })) {\n        attributes[attribute] = true;\n      } else if (configAttr.parser) {\n        value = configAttr.parser(element);\n\n        if (value) {\n          let attributeInheritedFromBlock = false;\n\n          for (const blockElement of this.findBlockElementAncestors(element)) {\n            if (configAttr.parser(blockElement) === value) {\n              attributeInheritedFromBlock = true;\n              break;\n            }\n          }\n\n          if (!attributeInheritedFromBlock) {\n            attributes[attribute] = value;\n          }\n        }\n      } else if (configAttr.styleProperty) {\n        value = element.style[configAttr.styleProperty];\n\n        if (value) {\n          attributes[attribute] = value;\n        }\n      }\n    }\n\n    if (nodeIsAttachmentElement(element)) {\n      const object = parseTrixDataAttribute(element, \"attributes\");\n\n      for (const key in object) {\n        value = object[key];\n        attributes[key] = value;\n      }\n    }\n\n    return attributes;\n  }\n\n  getBlockAttributes(element) {\n    const attributes = [];\n\n    while (element && element !== this.containerElement) {\n      for (const attribute in config.blockAttributes) {\n        const attrConfig = config.blockAttributes[attribute];\n\n        if (attrConfig.parse !== false) {\n          if (tagName(element) === attrConfig.tagName) {\n            var _attrConfig$test;\n\n            if ((_attrConfig$test = attrConfig.test) !== null && _attrConfig$test !== void 0 && _attrConfig$test.call(attrConfig, element) || !attrConfig.test) {\n              attributes.push(attribute);\n\n              if (attrConfig.listAttribute) {\n                attributes.push(attrConfig.listAttribute);\n              }\n            }\n          }\n        }\n      }\n\n      element = element.parentNode;\n    }\n\n    return attributes.reverse();\n  }\n\n  findBlockElementAncestors(element) {\n    const ancestors = [];\n\n    while (element && element !== this.containerElement) {\n      const tag = tagName(element);\n\n      if (getBlockTagNames().includes(tag)) {\n        ancestors.push(element);\n      }\n\n      element = element.parentNode;\n    }\n\n    return ancestors;\n  } // Element inspection\n\n\n  isBlockElement(element) {\n    if ((element === null || element === void 0 ? void 0 : element.nodeType) !== Node.ELEMENT_NODE) return;\n    if (nodeIsAttachmentElement(element)) return;\n    if (findClosestElementFromNode(element, {\n      matchingSelector: \"td\",\n      untilNode: this.containerElement\n    })) return;\n    return getBlockTagNames().includes(tagName(element)) || window.getComputedStyle(element).display === \"block\";\n  }\n\n  isInsignificantTextNode(node) {\n    if ((node === null || node === void 0 ? void 0 : node.nodeType) !== Node.TEXT_NODE) return;\n    if (!stringIsAllBreakableWhitespace(node.data)) return;\n    const {\n      parentNode,\n      previousSibling,\n      nextSibling\n    } = node;\n    if (nodeEndsWithNonWhitespace(parentNode.previousSibling) && !this.isBlockElement(parentNode.previousSibling)) return;\n    if (elementCanDisplayPreformattedText(parentNode)) return;\n    return !previousSibling || this.isBlockElement(previousSibling) || !nextSibling || this.isBlockElement(nextSibling);\n  }\n\n  isExtraBR(element) {\n    return tagName(element) === \"br\" && this.isBlockElement(element.parentNode) && element.parentNode.lastChild === element;\n  } // Margin translation\n\n\n  translateBlockElementMarginsToNewlines() {\n    const defaultMargin = this.getMarginOfDefaultBlockElement();\n\n    for (let index = 0; index < this.blocks.length; index++) {\n      const margin = this.getMarginOfBlockElementAtIndex(index);\n\n      if (margin) {\n        if (margin.top > defaultMargin.top * 2) {\n          this.prependStringToTextAtIndex(\"\\n\", index);\n        }\n\n        if (margin.bottom > defaultMargin.bottom * 2) {\n          this.appendStringToTextAtIndex(\"\\n\", index);\n        }\n      }\n    }\n  }\n\n  getMarginOfBlockElementAtIndex(index) {\n    const element = this.blockElements[index];\n\n    if (element) {\n      if (element.textContent) {\n        if (!getBlockTagNames().includes(tagName(element)) && !this.processedElements.includes(element)) {\n          return getBlockElementMargin(element);\n        }\n      }\n    }\n  }\n\n  getMarginOfDefaultBlockElement() {\n    const element = makeElement(config.blockAttributes.default.tagName);\n    this.containerElement.appendChild(element);\n    return getBlockElementMargin(element);\n  }\n\n} // Helpers\n\nconst elementCanDisplayPreformattedText = function (element) {\n  const {\n    whiteSpace\n  } = window.getComputedStyle(element);\n  return [\"pre\", \"pre-wrap\", \"pre-line\"].includes(whiteSpace);\n};\n\nconst nodeEndsWithNonWhitespace = node => node && !stringEndsWithWhitespace(node.textContent);\n\nconst getBlockElementMargin = function (element) {\n  const style = window.getComputedStyle(element);\n\n  if (style.display === \"block\") {\n    return {\n      top: parseInt(style.marginTop),\n      bottom: parseInt(style.marginBottom)\n    };\n  }\n};\n\nconst nodeFilter = function (node) {\n  if (tagName(node) === \"style\") {\n    return NodeFilter.FILTER_REJECT;\n  } else {\n    return NodeFilter.FILTER_ACCEPT;\n  }\n}; // Whitespace\n\n\nconst leftTrimBreakableWhitespace = string => string.replace(new RegExp(\"^\".concat(breakableWhitespacePattern.source, \"+\")), \"\");\n\nconst stringIsAllBreakableWhitespace = string => new RegExp(\"^\".concat(breakableWhitespacePattern.source, \"*$\")).test(string);\n\nconst stringEndsWithWhitespace = string => /\\s$/.test(string);\n\nclass LineBreakInsertion {\n  constructor(composition) {\n    this.composition = composition;\n    this.document = this.composition.document;\n    const selectedRange = this.composition.getSelectedRange();\n    this.startPosition = selectedRange[0];\n    this.endPosition = selectedRange[1];\n    this.startLocation = this.document.locationFromPosition(this.startPosition);\n    this.endLocation = this.document.locationFromPosition(this.endPosition);\n    this.block = this.document.getBlockAtIndex(this.endLocation.index);\n    this.breaksOnReturn = this.block.breaksOnReturn();\n    this.previousCharacter = this.block.text.getStringAtPosition(this.endLocation.offset - 1);\n    this.nextCharacter = this.block.text.getStringAtPosition(this.endLocation.offset);\n  }\n\n  shouldInsertBlockBreak() {\n    if (this.block.hasAttributes() && this.block.isListItem() && !this.block.isEmpty()) {\n      return this.startLocation.offset !== 0;\n    } else {\n      return this.breaksOnReturn && this.nextCharacter !== \"\\n\";\n    }\n  }\n\n  shouldBreakFormattedBlock() {\n    return this.block.hasAttributes() && !this.block.isListItem() && (this.breaksOnReturn && this.nextCharacter === \"\\n\" || this.previousCharacter === \"\\n\");\n  }\n\n  shouldDecreaseListLevel() {\n    return this.block.hasAttributes() && this.block.isListItem() && this.block.isEmpty();\n  }\n\n  shouldPrependListItem() {\n    return this.block.isListItem() && this.startLocation.offset === 0 && !this.block.isEmpty();\n  }\n\n  shouldRemoveLastBlockAttribute() {\n    return this.block.hasAttributes() && !this.block.isListItem() && this.block.isEmpty();\n  }\n\n}\n\nconst PLACEHOLDER = \" \";\nclass Composition extends BasicObject {\n  constructor() {\n    super(...arguments);\n    this.document = new Document();\n    this.attachments = [];\n    this.currentAttributes = {};\n    this.revision = 0;\n  }\n\n  setDocument(document) {\n    if (!document.isEqualTo(this.document)) {\n      var _this$delegate, _this$delegate$compos;\n\n      this.document = document;\n      this.refreshAttachments();\n      this.revision++;\n      return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$compos = _this$delegate.compositionDidChangeDocument) === null || _this$delegate$compos === void 0 ? void 0 : _this$delegate$compos.call(_this$delegate, document);\n    }\n  } // Snapshots\n\n\n  getSnapshot() {\n    return {\n      document: this.document,\n      selectedRange: this.getSelectedRange()\n    };\n  }\n\n  loadSnapshot(_ref) {\n    var _this$delegate2, _this$delegate2$compo, _this$delegate3, _this$delegate3$compo;\n\n    let {\n      document,\n      selectedRange\n    } = _ref;\n    (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$compo = _this$delegate2.compositionWillLoadSnapshot) === null || _this$delegate2$compo === void 0 ? void 0 : _this$delegate2$compo.call(_this$delegate2);\n    this.setDocument(document != null ? document : new Document());\n    this.setSelection(selectedRange != null ? selectedRange : [0, 0]);\n    return (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : (_this$delegate3$compo = _this$delegate3.compositionDidLoadSnapshot) === null || _this$delegate3$compo === void 0 ? void 0 : _this$delegate3$compo.call(_this$delegate3);\n  } // Responder protocol\n\n\n  insertText(text) {\n    let {\n      updatePosition\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      updatePosition: true\n    };\n    const selectedRange = this.getSelectedRange();\n    this.setDocument(this.document.insertTextAtRange(text, selectedRange));\n    const startPosition = selectedRange[0];\n    const endPosition = startPosition + text.getLength();\n\n    if (updatePosition) {\n      this.setSelection(endPosition);\n    }\n\n    return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n  }\n\n  insertBlock() {\n    let block = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Block();\n    const document = new Document([block]);\n    return this.insertDocument(document);\n  }\n\n  insertDocument() {\n    let document = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Document();\n    const selectedRange = this.getSelectedRange();\n    this.setDocument(this.document.insertDocumentAtRange(document, selectedRange));\n    const startPosition = selectedRange[0];\n    const endPosition = startPosition + document.getLength();\n    this.setSelection(endPosition);\n    return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n  }\n\n  insertString(string, options) {\n    const attributes = this.getCurrentTextAttributes();\n    const text = Text.textForStringWithAttributes(string, attributes);\n    return this.insertText(text, options);\n  }\n\n  insertBlockBreak() {\n    const selectedRange = this.getSelectedRange();\n    this.setDocument(this.document.insertBlockBreakAtRange(selectedRange));\n    const startPosition = selectedRange[0];\n    const endPosition = startPosition + 1;\n    this.setSelection(endPosition);\n    return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n  }\n\n  insertLineBreak() {\n    const insertion = new LineBreakInsertion(this);\n\n    if (insertion.shouldDecreaseListLevel()) {\n      this.decreaseListLevel();\n      return this.setSelection(insertion.startPosition);\n    } else if (insertion.shouldPrependListItem()) {\n      const document = new Document([insertion.block.copyWithoutText()]);\n      return this.insertDocument(document);\n    } else if (insertion.shouldInsertBlockBreak()) {\n      return this.insertBlockBreak();\n    } else if (insertion.shouldRemoveLastBlockAttribute()) {\n      return this.removeLastBlockAttribute();\n    } else if (insertion.shouldBreakFormattedBlock()) {\n      return this.breakFormattedBlock(insertion);\n    } else {\n      return this.insertString(\"\\n\");\n    }\n  }\n\n  insertHTML(html) {\n    const document = HTMLParser.parse(html).getDocument();\n    const selectedRange = this.getSelectedRange();\n    this.setDocument(this.document.mergeDocumentAtRange(document, selectedRange));\n    const startPosition = selectedRange[0];\n    const endPosition = startPosition + document.getLength() - 1;\n    this.setSelection(endPosition);\n    return this.notifyDelegateOfInsertionAtRange([startPosition, endPosition]);\n  }\n\n  replaceHTML(html) {\n    const document = HTMLParser.parse(html).getDocument().copyUsingObjectsFromDocument(this.document);\n    const locationRange = this.getLocationRange({\n      strict: false\n    });\n    const selectedRange = this.document.rangeFromLocationRange(locationRange);\n    this.setDocument(document);\n    return this.setSelection(selectedRange);\n  }\n\n  insertFile(file) {\n    return this.insertFiles([file]);\n  }\n\n  insertFiles(files) {\n    const attachments = [];\n    Array.from(files).forEach(file => {\n      var _this$delegate4;\n\n      if ((_this$delegate4 = this.delegate) !== null && _this$delegate4 !== void 0 && _this$delegate4.compositionShouldAcceptFile(file)) {\n        const attachment = Attachment.attachmentForFile(file);\n        attachments.push(attachment);\n      }\n    });\n    return this.insertAttachments(attachments);\n  }\n\n  insertAttachment(attachment) {\n    return this.insertAttachments([attachment]);\n  }\n\n  insertAttachments(attachments) {\n    let text = new Text();\n    Array.from(attachments).forEach(attachment => {\n      var _config$attachments$t;\n\n      const type = attachment.getType();\n      const presentation = (_config$attachments$t = config.attachments[type]) === null || _config$attachments$t === void 0 ? void 0 : _config$attachments$t.presentation;\n      const attributes = this.getCurrentTextAttributes();\n\n      if (presentation) {\n        attributes.presentation = presentation;\n      }\n\n      const attachmentText = Text.textForAttachmentWithAttributes(attachment, attributes);\n      text = text.appendText(attachmentText);\n    });\n    return this.insertText(text);\n  }\n\n  shouldManageDeletingInDirection(direction) {\n    const locationRange = this.getLocationRange();\n\n    if (rangeIsCollapsed(locationRange)) {\n      if (direction === \"backward\" && locationRange[0].offset === 0) {\n        return true;\n      }\n\n      if (this.shouldManageMovingCursorInDirection(direction)) {\n        return true;\n      }\n    } else {\n      if (locationRange[0].index !== locationRange[1].index) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  deleteInDirection(direction) {\n    let {\n      length\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let attachment, deletingIntoPreviousBlock, selectionSpansBlocks;\n    const locationRange = this.getLocationRange();\n    let range = this.getSelectedRange();\n    const selectionIsCollapsed = rangeIsCollapsed(range);\n\n    if (selectionIsCollapsed) {\n      deletingIntoPreviousBlock = direction === \"backward\" && locationRange[0].offset === 0;\n    } else {\n      selectionSpansBlocks = locationRange[0].index !== locationRange[1].index;\n    }\n\n    if (deletingIntoPreviousBlock) {\n      if (this.canDecreaseBlockAttributeLevel()) {\n        const block = this.getBlock();\n\n        if (block.isListItem()) {\n          this.decreaseListLevel();\n        } else {\n          this.decreaseBlockAttributeLevel();\n        }\n\n        this.setSelection(range[0]);\n\n        if (block.isEmpty()) {\n          return false;\n        }\n      }\n    }\n\n    if (selectionIsCollapsed) {\n      range = this.getExpandedRangeInDirection(direction, {\n        length\n      });\n\n      if (direction === \"backward\") {\n        attachment = this.getAttachmentAtRange(range);\n      }\n    }\n\n    if (attachment) {\n      this.editAttachment(attachment);\n      return false;\n    } else {\n      this.setDocument(this.document.removeTextAtRange(range));\n      this.setSelection(range[0]);\n\n      if (deletingIntoPreviousBlock || selectionSpansBlocks) {\n        return false;\n      }\n    }\n  }\n\n  moveTextFromRange(range) {\n    const [position] = Array.from(this.getSelectedRange());\n    this.setDocument(this.document.moveTextFromRangeToPosition(range, position));\n    return this.setSelection(position);\n  }\n\n  removeAttachment(attachment) {\n    const range = this.document.getRangeOfAttachment(attachment);\n\n    if (range) {\n      this.stopEditingAttachment();\n      this.setDocument(this.document.removeTextAtRange(range));\n      return this.setSelection(range[0]);\n    }\n  }\n\n  removeLastBlockAttribute() {\n    const [startPosition, endPosition] = Array.from(this.getSelectedRange());\n    const block = this.document.getBlockAtPosition(endPosition);\n    this.removeCurrentAttribute(block.getLastAttribute());\n    return this.setSelection(startPosition);\n  }\n\n  insertPlaceholder() {\n    this.placeholderPosition = this.getPosition();\n    return this.insertString(PLACEHOLDER);\n  }\n\n  selectPlaceholder() {\n    if (this.placeholderPosition != null) {\n      this.setSelectedRange([this.placeholderPosition, this.placeholderPosition + PLACEHOLDER.length]);\n      return this.getSelectedRange();\n    }\n  }\n\n  forgetPlaceholder() {\n    this.placeholderPosition = null;\n  } // Current attributes\n\n\n  hasCurrentAttribute(attributeName) {\n    const value = this.currentAttributes[attributeName];\n    return value != null && value !== false;\n  }\n\n  toggleCurrentAttribute(attributeName) {\n    const value = !this.currentAttributes[attributeName];\n\n    if (value) {\n      return this.setCurrentAttribute(attributeName, value);\n    } else {\n      return this.removeCurrentAttribute(attributeName);\n    }\n  }\n\n  canSetCurrentAttribute(attributeName) {\n    if (getBlockConfig(attributeName)) {\n      return this.canSetCurrentBlockAttribute(attributeName);\n    } else {\n      return this.canSetCurrentTextAttribute(attributeName);\n    }\n  }\n\n  canSetCurrentTextAttribute(attributeName) {\n    const document = this.getSelectedDocument();\n    if (!document) return;\n\n    for (const attachment of Array.from(document.getAttachments())) {\n      if (!attachment.hasContent()) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  canSetCurrentBlockAttribute(attributeName) {\n    const block = this.getBlock();\n    if (!block) return;\n    return !block.isTerminalBlock();\n  }\n\n  setCurrentAttribute(attributeName, value) {\n    if (getBlockConfig(attributeName)) {\n      return this.setBlockAttribute(attributeName, value);\n    } else {\n      this.setTextAttribute(attributeName, value);\n      this.currentAttributes[attributeName] = value;\n      return this.notifyDelegateOfCurrentAttributesChange();\n    }\n  }\n\n  setTextAttribute(attributeName, value) {\n    const selectedRange = this.getSelectedRange();\n    if (!selectedRange) return;\n    const [startPosition, endPosition] = Array.from(selectedRange);\n\n    if (startPosition === endPosition) {\n      if (attributeName === \"href\") {\n        const text = Text.textForStringWithAttributes(value, {\n          href: value\n        });\n        return this.insertText(text);\n      }\n    } else {\n      return this.setDocument(this.document.addAttributeAtRange(attributeName, value, selectedRange));\n    }\n  }\n\n  setBlockAttribute(attributeName, value) {\n    const selectedRange = this.getSelectedRange();\n\n    if (this.canSetCurrentAttribute(attributeName)) {\n      this.setDocument(this.document.applyBlockAttributeAtRange(attributeName, value, selectedRange));\n      return this.setSelection(selectedRange);\n    }\n  }\n\n  removeCurrentAttribute(attributeName) {\n    if (getBlockConfig(attributeName)) {\n      this.removeBlockAttribute(attributeName);\n      return this.updateCurrentAttributes();\n    } else {\n      this.removeTextAttribute(attributeName);\n      delete this.currentAttributes[attributeName];\n      return this.notifyDelegateOfCurrentAttributesChange();\n    }\n  }\n\n  removeTextAttribute(attributeName) {\n    const selectedRange = this.getSelectedRange();\n    if (!selectedRange) return;\n    return this.setDocument(this.document.removeAttributeAtRange(attributeName, selectedRange));\n  }\n\n  removeBlockAttribute(attributeName) {\n    const selectedRange = this.getSelectedRange();\n    if (!selectedRange) return;\n    return this.setDocument(this.document.removeAttributeAtRange(attributeName, selectedRange));\n  }\n\n  canDecreaseNestingLevel() {\n    var _this$getBlock;\n\n    return ((_this$getBlock = this.getBlock()) === null || _this$getBlock === void 0 ? void 0 : _this$getBlock.getNestingLevel()) > 0;\n  }\n\n  canIncreaseNestingLevel() {\n    var _getBlockConfig;\n\n    const block = this.getBlock();\n    if (!block) return;\n\n    if ((_getBlockConfig = getBlockConfig(block.getLastNestableAttribute())) !== null && _getBlockConfig !== void 0 && _getBlockConfig.listAttribute) {\n      const previousBlock = this.getPreviousBlock();\n\n      if (previousBlock) {\n        return arrayStartsWith(previousBlock.getListItemAttributes(), block.getListItemAttributes());\n      }\n    } else {\n      return block.getNestingLevel() > 0;\n    }\n  }\n\n  decreaseNestingLevel() {\n    const block = this.getBlock();\n    if (!block) return;\n    return this.setDocument(this.document.replaceBlock(block, block.decreaseNestingLevel()));\n  }\n\n  increaseNestingLevel() {\n    const block = this.getBlock();\n    if (!block) return;\n    return this.setDocument(this.document.replaceBlock(block, block.increaseNestingLevel()));\n  }\n\n  canDecreaseBlockAttributeLevel() {\n    var _this$getBlock2;\n\n    return ((_this$getBlock2 = this.getBlock()) === null || _this$getBlock2 === void 0 ? void 0 : _this$getBlock2.getAttributeLevel()) > 0;\n  }\n\n  decreaseBlockAttributeLevel() {\n    var _this$getBlock3;\n\n    const attribute = (_this$getBlock3 = this.getBlock()) === null || _this$getBlock3 === void 0 ? void 0 : _this$getBlock3.getLastAttribute();\n\n    if (attribute) {\n      return this.removeCurrentAttribute(attribute);\n    }\n  }\n\n  decreaseListLevel() {\n    let [startPosition] = Array.from(this.getSelectedRange());\n    const {\n      index\n    } = this.document.locationFromPosition(startPosition);\n    let endIndex = index;\n    const attributeLevel = this.getBlock().getAttributeLevel();\n    let block = this.document.getBlockAtIndex(endIndex + 1);\n\n    while (block) {\n      if (!block.isListItem() || block.getAttributeLevel() <= attributeLevel) {\n        break;\n      }\n\n      endIndex++;\n      block = this.document.getBlockAtIndex(endIndex + 1);\n    }\n\n    startPosition = this.document.positionFromLocation({\n      index,\n      offset: 0\n    });\n    const endPosition = this.document.positionFromLocation({\n      index: endIndex,\n      offset: 0\n    });\n    return this.setDocument(this.document.removeLastListAttributeAtRange([startPosition, endPosition]));\n  }\n\n  updateCurrentAttributes() {\n    const selectedRange = this.getSelectedRange({\n      ignoreLock: true\n    });\n\n    if (selectedRange) {\n      const currentAttributes = this.document.getCommonAttributesAtRange(selectedRange);\n      Array.from(getAllAttributeNames()).forEach(attributeName => {\n        if (!currentAttributes[attributeName]) {\n          if (!this.canSetCurrentAttribute(attributeName)) {\n            currentAttributes[attributeName] = false;\n          }\n        }\n      });\n\n      if (!objectsAreEqual(currentAttributes, this.currentAttributes)) {\n        this.currentAttributes = currentAttributes;\n        return this.notifyDelegateOfCurrentAttributesChange();\n      }\n    }\n  }\n\n  getCurrentAttributes() {\n    return extend.call({}, this.currentAttributes);\n  }\n\n  getCurrentTextAttributes() {\n    const attributes = {};\n\n    for (const key in this.currentAttributes) {\n      const value = this.currentAttributes[key];\n\n      if (value !== false) {\n        if (getTextConfig(key)) {\n          attributes[key] = value;\n        }\n      }\n    }\n\n    return attributes;\n  } // Selection freezing\n\n\n  freezeSelection() {\n    return this.setCurrentAttribute(\"frozen\", true);\n  }\n\n  thawSelection() {\n    return this.removeCurrentAttribute(\"frozen\");\n  }\n\n  hasFrozenSelection() {\n    return this.hasCurrentAttribute(\"frozen\");\n  }\n\n  setSelection(selectedRange) {\n    var _this$delegate5;\n\n    const locationRange = this.document.locationRangeFromRange(selectedRange);\n    return (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.compositionDidRequestChangingSelectionToLocationRange(locationRange);\n  }\n\n  getSelectedRange() {\n    const locationRange = this.getLocationRange();\n\n    if (locationRange) {\n      return this.document.rangeFromLocationRange(locationRange);\n    }\n  }\n\n  setSelectedRange(selectedRange) {\n    const locationRange = this.document.locationRangeFromRange(selectedRange);\n    return this.getSelectionManager().setLocationRange(locationRange);\n  }\n\n  getPosition() {\n    const locationRange = this.getLocationRange();\n\n    if (locationRange) {\n      return this.document.positionFromLocation(locationRange[0]);\n    }\n  }\n\n  getLocationRange(options) {\n    if (this.targetLocationRange) {\n      return this.targetLocationRange;\n    } else {\n      return this.getSelectionManager().getLocationRange(options) || normalizeRange({\n        index: 0,\n        offset: 0\n      });\n    }\n  }\n\n  withTargetLocationRange(locationRange, fn) {\n    let result;\n    this.targetLocationRange = locationRange;\n\n    try {\n      result = fn();\n    } finally {\n      this.targetLocationRange = null;\n    }\n\n    return result;\n  }\n\n  withTargetRange(range, fn) {\n    const locationRange = this.document.locationRangeFromRange(range);\n    return this.withTargetLocationRange(locationRange, fn);\n  }\n\n  withTargetDOMRange(domRange, fn) {\n    const locationRange = this.createLocationRangeFromDOMRange(domRange, {\n      strict: false\n    });\n    return this.withTargetLocationRange(locationRange, fn);\n  }\n\n  getExpandedRangeInDirection(direction) {\n    let {\n      length\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let [startPosition, endPosition] = Array.from(this.getSelectedRange());\n\n    if (direction === \"backward\") {\n      if (length) {\n        startPosition -= length;\n      } else {\n        startPosition = this.translateUTF16PositionFromOffset(startPosition, -1);\n      }\n    } else {\n      if (length) {\n        endPosition += length;\n      } else {\n        endPosition = this.translateUTF16PositionFromOffset(endPosition, 1);\n      }\n    }\n\n    return normalizeRange([startPosition, endPosition]);\n  }\n\n  shouldManageMovingCursorInDirection(direction) {\n    if (this.editingAttachment) {\n      return true;\n    }\n\n    const range = this.getExpandedRangeInDirection(direction);\n    return this.getAttachmentAtRange(range) != null;\n  }\n\n  moveCursorInDirection(direction) {\n    let canEditAttachment, range;\n\n    if (this.editingAttachment) {\n      range = this.document.getRangeOfAttachment(this.editingAttachment);\n    } else {\n      const selectedRange = this.getSelectedRange();\n      range = this.getExpandedRangeInDirection(direction);\n      canEditAttachment = !rangesAreEqual(selectedRange, range);\n    }\n\n    if (direction === \"backward\") {\n      this.setSelectedRange(range[0]);\n    } else {\n      this.setSelectedRange(range[1]);\n    }\n\n    if (canEditAttachment) {\n      const attachment = this.getAttachmentAtRange(range);\n\n      if (attachment) {\n        return this.editAttachment(attachment);\n      }\n    }\n  }\n\n  expandSelectionInDirection(direction) {\n    let {\n      length\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const range = this.getExpandedRangeInDirection(direction, {\n      length\n    });\n    return this.setSelectedRange(range);\n  }\n\n  expandSelectionForEditing() {\n    if (this.hasCurrentAttribute(\"href\")) {\n      return this.expandSelectionAroundCommonAttribute(\"href\");\n    }\n  }\n\n  expandSelectionAroundCommonAttribute(attributeName) {\n    const position = this.getPosition();\n    const range = this.document.getRangeOfCommonAttributeAtPosition(attributeName, position);\n    return this.setSelectedRange(range);\n  }\n\n  selectionContainsAttachments() {\n    var _this$getSelectedAtta;\n\n    return ((_this$getSelectedAtta = this.getSelectedAttachments()) === null || _this$getSelectedAtta === void 0 ? void 0 : _this$getSelectedAtta.length) > 0;\n  }\n\n  selectionIsInCursorTarget() {\n    return this.editingAttachment || this.positionIsCursorTarget(this.getPosition());\n  }\n\n  positionIsCursorTarget(position) {\n    const location = this.document.locationFromPosition(position);\n\n    if (location) {\n      return this.locationIsCursorTarget(location);\n    }\n  }\n\n  positionIsBlockBreak(position) {\n    var _this$document$getPie;\n\n    return (_this$document$getPie = this.document.getPieceAtPosition(position)) === null || _this$document$getPie === void 0 ? void 0 : _this$document$getPie.isBlockBreak();\n  }\n\n  getSelectedDocument() {\n    const selectedRange = this.getSelectedRange();\n\n    if (selectedRange) {\n      return this.document.getDocumentAtRange(selectedRange);\n    }\n  }\n\n  getSelectedAttachments() {\n    var _this$getSelectedDocu;\n\n    return (_this$getSelectedDocu = this.getSelectedDocument()) === null || _this$getSelectedDocu === void 0 ? void 0 : _this$getSelectedDocu.getAttachments();\n  } // Attachments\n\n\n  getAttachments() {\n    return this.attachments.slice(0);\n  }\n\n  refreshAttachments() {\n    const attachments = this.document.getAttachments();\n    const {\n      added,\n      removed\n    } = summarizeArrayChange(this.attachments, attachments);\n    this.attachments = attachments;\n    Array.from(removed).forEach(attachment => {\n      var _this$delegate6, _this$delegate6$compo;\n\n      attachment.delegate = null;\n      (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : (_this$delegate6$compo = _this$delegate6.compositionDidRemoveAttachment) === null || _this$delegate6$compo === void 0 ? void 0 : _this$delegate6$compo.call(_this$delegate6, attachment);\n    });\n    return (() => {\n      const result = [];\n      Array.from(added).forEach(attachment => {\n        var _this$delegate7, _this$delegate7$compo;\n\n        attachment.delegate = this;\n        result.push((_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : (_this$delegate7$compo = _this$delegate7.compositionDidAddAttachment) === null || _this$delegate7$compo === void 0 ? void 0 : _this$delegate7$compo.call(_this$delegate7, attachment));\n      });\n      return result;\n    })();\n  } // Attachment delegate\n\n\n  attachmentDidChangeAttributes(attachment) {\n    var _this$delegate8, _this$delegate8$compo;\n\n    this.revision++;\n    return (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : (_this$delegate8$compo = _this$delegate8.compositionDidEditAttachment) === null || _this$delegate8$compo === void 0 ? void 0 : _this$delegate8$compo.call(_this$delegate8, attachment);\n  }\n\n  attachmentDidChangePreviewURL(attachment) {\n    var _this$delegate9, _this$delegate9$compo;\n\n    this.revision++;\n    return (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : (_this$delegate9$compo = _this$delegate9.compositionDidChangeAttachmentPreviewURL) === null || _this$delegate9$compo === void 0 ? void 0 : _this$delegate9$compo.call(_this$delegate9, attachment);\n  } // Attachment editing\n\n\n  editAttachment(attachment, options) {\n    var _this$delegate10, _this$delegate10$comp;\n\n    if (attachment === this.editingAttachment) return;\n    this.stopEditingAttachment();\n    this.editingAttachment = attachment;\n    return (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : (_this$delegate10$comp = _this$delegate10.compositionDidStartEditingAttachment) === null || _this$delegate10$comp === void 0 ? void 0 : _this$delegate10$comp.call(_this$delegate10, this.editingAttachment, options);\n  }\n\n  stopEditingAttachment() {\n    var _this$delegate11, _this$delegate11$comp;\n\n    if (!this.editingAttachment) return;\n    (_this$delegate11 = this.delegate) === null || _this$delegate11 === void 0 ? void 0 : (_this$delegate11$comp = _this$delegate11.compositionDidStopEditingAttachment) === null || _this$delegate11$comp === void 0 ? void 0 : _this$delegate11$comp.call(_this$delegate11, this.editingAttachment);\n    this.editingAttachment = null;\n  }\n\n  updateAttributesForAttachment(attributes, attachment) {\n    return this.setDocument(this.document.updateAttributesForAttachment(attributes, attachment));\n  }\n\n  removeAttributeForAttachment(attribute, attachment) {\n    return this.setDocument(this.document.removeAttributeForAttachment(attribute, attachment));\n  } // Private\n\n\n  breakFormattedBlock(insertion) {\n    let {\n      document\n    } = insertion;\n    const {\n      block\n    } = insertion;\n    let position = insertion.startPosition;\n    let range = [position - 1, position];\n\n    if (block.getBlockBreakPosition() === insertion.startLocation.offset) {\n      if (block.breaksOnReturn() && insertion.nextCharacter === \"\\n\") {\n        position += 1;\n      } else {\n        document = document.removeTextAtRange(range);\n      }\n\n      range = [position, position];\n    } else if (insertion.nextCharacter === \"\\n\") {\n      if (insertion.previousCharacter === \"\\n\") {\n        range = [position - 1, position + 1];\n      } else {\n        range = [position, position + 1];\n        position += 1;\n      }\n    } else if (insertion.startLocation.offset - 1 !== 0) {\n      position += 1;\n    }\n\n    const newDocument = new Document([block.removeLastAttribute().copyWithoutText()]);\n    this.setDocument(document.insertDocumentAtRange(newDocument, range));\n    return this.setSelection(position);\n  }\n\n  getPreviousBlock() {\n    const locationRange = this.getLocationRange();\n\n    if (locationRange) {\n      const {\n        index\n      } = locationRange[0];\n\n      if (index > 0) {\n        return this.document.getBlockAtIndex(index - 1);\n      }\n    }\n  }\n\n  getBlock() {\n    const locationRange = this.getLocationRange();\n\n    if (locationRange) {\n      return this.document.getBlockAtIndex(locationRange[0].index);\n    }\n  }\n\n  getAttachmentAtRange(range) {\n    const document = this.document.getDocumentAtRange(range);\n\n    if (document.toString() === \"\".concat(OBJECT_REPLACEMENT_CHARACTER, \"\\n\")) {\n      return document.getAttachments()[0];\n    }\n  }\n\n  notifyDelegateOfCurrentAttributesChange() {\n    var _this$delegate12, _this$delegate12$comp;\n\n    return (_this$delegate12 = this.delegate) === null || _this$delegate12 === void 0 ? void 0 : (_this$delegate12$comp = _this$delegate12.compositionDidChangeCurrentAttributes) === null || _this$delegate12$comp === void 0 ? void 0 : _this$delegate12$comp.call(_this$delegate12, this.currentAttributes);\n  }\n\n  notifyDelegateOfInsertionAtRange(range) {\n    var _this$delegate13, _this$delegate13$comp;\n\n    return (_this$delegate13 = this.delegate) === null || _this$delegate13 === void 0 ? void 0 : (_this$delegate13$comp = _this$delegate13.compositionDidPerformInsertionAtRange) === null || _this$delegate13$comp === void 0 ? void 0 : _this$delegate13$comp.call(_this$delegate13, range);\n  }\n\n  translateUTF16PositionFromOffset(position, offset) {\n    const utf16string = this.document.toUTF16String();\n    const utf16position = utf16string.offsetFromUCS2Offset(position);\n    return utf16string.offsetToUCS2Offset(utf16position + offset);\n  }\n\n}\nComposition.proxyMethod(\"getSelectionManager().getPointRange\");\nComposition.proxyMethod(\"getSelectionManager().setLocationRangeFromPointRange\");\nComposition.proxyMethod(\"getSelectionManager().createLocationRangeFromDOMRange\");\nComposition.proxyMethod(\"getSelectionManager().locationIsCursorTarget\");\nComposition.proxyMethod(\"getSelectionManager().selectionIsExpanded\");\nComposition.proxyMethod(\"delegate?.getSelectionManager\");\n\nclass UndoManager extends BasicObject {\n  constructor(composition) {\n    super(...arguments);\n    this.composition = composition;\n    this.undoEntries = [];\n    this.redoEntries = [];\n  }\n\n  recordUndoEntry(description) {\n    let {\n      context,\n      consolidatable\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const previousEntry = this.undoEntries.slice(-1)[0];\n\n    if (!consolidatable || !entryHasDescriptionAndContext(previousEntry, description, context)) {\n      const undoEntry = this.createEntry({\n        description,\n        context\n      });\n      this.undoEntries.push(undoEntry);\n      this.redoEntries = [];\n    }\n  }\n\n  undo() {\n    const undoEntry = this.undoEntries.pop();\n\n    if (undoEntry) {\n      const redoEntry = this.createEntry(undoEntry);\n      this.redoEntries.push(redoEntry);\n      return this.composition.loadSnapshot(undoEntry.snapshot);\n    }\n  }\n\n  redo() {\n    const redoEntry = this.redoEntries.pop();\n\n    if (redoEntry) {\n      const undoEntry = this.createEntry(redoEntry);\n      this.undoEntries.push(undoEntry);\n      return this.composition.loadSnapshot(redoEntry.snapshot);\n    }\n  }\n\n  canUndo() {\n    return this.undoEntries.length > 0;\n  }\n\n  canRedo() {\n    return this.redoEntries.length > 0;\n  } // Private\n\n\n  createEntry() {\n    let {\n      description,\n      context\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    return {\n      description: description === null || description === void 0 ? void 0 : description.toString(),\n      context: JSON.stringify(context),\n      snapshot: this.composition.getSnapshot()\n    };\n  }\n\n}\n\nconst entryHasDescriptionAndContext = (entry, description, context) => (entry === null || entry === void 0 ? void 0 : entry.description) === (description === null || description === void 0 ? void 0 : description.toString()) && (entry === null || entry === void 0 ? void 0 : entry.context) === JSON.stringify(context);\n\nconst attachmentGalleryFilter = function (snapshot) {\n  const filter = new Filter(snapshot);\n  filter.perform();\n  return filter.getSnapshot();\n};\nconst BLOCK_ATTRIBUTE_NAME = \"attachmentGallery\";\nconst TEXT_ATTRIBUTE_NAME = \"presentation\";\nconst TEXT_ATTRIBUTE_VALUE = \"gallery\";\n\nclass Filter {\n  constructor(snapshot) {\n    this.document = snapshot.document;\n    this.selectedRange = snapshot.selectedRange;\n  }\n\n  perform() {\n    this.removeBlockAttribute();\n    return this.applyBlockAttribute();\n  }\n\n  getSnapshot() {\n    return {\n      document: this.document,\n      selectedRange: this.selectedRange\n    };\n  } // Private\n\n\n  removeBlockAttribute() {\n    return this.findRangesOfBlocks().map(range => this.document = this.document.removeAttributeAtRange(BLOCK_ATTRIBUTE_NAME, range));\n  }\n\n  applyBlockAttribute() {\n    let offset = 0;\n    this.findRangesOfPieces().forEach(range => {\n      if (range[1] - range[0] > 1) {\n        range[0] += offset;\n        range[1] += offset;\n\n        if (this.document.getCharacterAtPosition(range[1]) !== \"\\n\") {\n          this.document = this.document.insertBlockBreakAtRange(range[1]);\n\n          if (range[1] < this.selectedRange[1]) {\n            this.moveSelectedRangeForward();\n          }\n\n          range[1]++;\n          offset++;\n        }\n\n        if (range[0] !== 0) {\n          if (this.document.getCharacterAtPosition(range[0] - 1) !== \"\\n\") {\n            this.document = this.document.insertBlockBreakAtRange(range[0]);\n\n            if (range[0] < this.selectedRange[0]) {\n              this.moveSelectedRangeForward();\n            }\n\n            range[0]++;\n            offset++;\n          }\n        }\n\n        this.document = this.document.applyBlockAttributeAtRange(BLOCK_ATTRIBUTE_NAME, true, range);\n      }\n    });\n  }\n\n  findRangesOfBlocks() {\n    return this.document.findRangesForBlockAttribute(BLOCK_ATTRIBUTE_NAME);\n  }\n\n  findRangesOfPieces() {\n    return this.document.findRangesForTextAttribute(TEXT_ATTRIBUTE_NAME, {\n      withValue: TEXT_ATTRIBUTE_VALUE\n    });\n  }\n\n  moveSelectedRangeForward() {\n    this.selectedRange[0] += 1;\n    this.selectedRange[1] += 1;\n  }\n\n}\n\nconst DEFAULT_FILTERS = [attachmentGalleryFilter];\nclass Editor {\n  constructor(composition, selectionManager, element) {\n    this.insertFiles = this.insertFiles.bind(this);\n    this.composition = composition;\n    this.selectionManager = selectionManager;\n    this.element = element;\n    this.undoManager = new UndoManager(this.composition);\n    this.filters = DEFAULT_FILTERS.slice(0);\n  }\n\n  loadDocument(document) {\n    return this.loadSnapshot({\n      document,\n      selectedRange: [0, 0]\n    });\n  }\n\n  loadHTML() {\n    let html = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n    const document = HTMLParser.parse(html, {\n      referenceElement: this.element\n    }).getDocument();\n    return this.loadDocument(document);\n  }\n\n  loadJSON(_ref) {\n    let {\n      document,\n      selectedRange\n    } = _ref;\n    document = Document.fromJSON(document);\n    return this.loadSnapshot({\n      document,\n      selectedRange\n    });\n  }\n\n  loadSnapshot(snapshot) {\n    this.undoManager = new UndoManager(this.composition);\n    return this.composition.loadSnapshot(snapshot);\n  }\n\n  getDocument() {\n    return this.composition.document;\n  }\n\n  getSelectedDocument() {\n    return this.composition.getSelectedDocument();\n  }\n\n  getSnapshot() {\n    return this.composition.getSnapshot();\n  }\n\n  toJSON() {\n    return this.getSnapshot();\n  } // Document manipulation\n\n\n  deleteInDirection(direction) {\n    return this.composition.deleteInDirection(direction);\n  }\n\n  insertAttachment(attachment) {\n    return this.composition.insertAttachment(attachment);\n  }\n\n  insertAttachments(attachments) {\n    return this.composition.insertAttachments(attachments);\n  }\n\n  insertDocument(document) {\n    return this.composition.insertDocument(document);\n  }\n\n  insertFile(file) {\n    return this.composition.insertFile(file);\n  }\n\n  insertFiles(files) {\n    return this.composition.insertFiles(files);\n  }\n\n  insertHTML(html) {\n    return this.composition.insertHTML(html);\n  }\n\n  insertString(string) {\n    return this.composition.insertString(string);\n  }\n\n  insertText(text) {\n    return this.composition.insertText(text);\n  }\n\n  insertLineBreak() {\n    return this.composition.insertLineBreak();\n  } // Selection\n\n\n  getSelectedRange() {\n    return this.composition.getSelectedRange();\n  }\n\n  getPosition() {\n    return this.composition.getPosition();\n  }\n\n  getClientRectAtPosition(position) {\n    const locationRange = this.getDocument().locationRangeFromRange([position, position + 1]);\n    return this.selectionManager.getClientRectAtLocationRange(locationRange);\n  }\n\n  expandSelectionInDirection(direction) {\n    return this.composition.expandSelectionInDirection(direction);\n  }\n\n  moveCursorInDirection(direction) {\n    return this.composition.moveCursorInDirection(direction);\n  }\n\n  setSelectedRange(selectedRange) {\n    return this.composition.setSelectedRange(selectedRange);\n  } // Attributes\n\n\n  activateAttribute(name) {\n    let value = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    return this.composition.setCurrentAttribute(name, value);\n  }\n\n  attributeIsActive(name) {\n    return this.composition.hasCurrentAttribute(name);\n  }\n\n  canActivateAttribute(name) {\n    return this.composition.canSetCurrentAttribute(name);\n  }\n\n  deactivateAttribute(name) {\n    return this.composition.removeCurrentAttribute(name);\n  } // Nesting level\n\n\n  canDecreaseNestingLevel() {\n    return this.composition.canDecreaseNestingLevel();\n  }\n\n  canIncreaseNestingLevel() {\n    return this.composition.canIncreaseNestingLevel();\n  }\n\n  decreaseNestingLevel() {\n    if (this.canDecreaseNestingLevel()) {\n      return this.composition.decreaseNestingLevel();\n    }\n  }\n\n  increaseNestingLevel() {\n    if (this.canIncreaseNestingLevel()) {\n      return this.composition.increaseNestingLevel();\n    }\n  } // Undo/redo\n\n\n  canRedo() {\n    return this.undoManager.canRedo();\n  }\n\n  canUndo() {\n    return this.undoManager.canUndo();\n  }\n\n  recordUndoEntry(description) {\n    let {\n      context,\n      consolidatable\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.undoManager.recordUndoEntry(description, {\n      context,\n      consolidatable\n    });\n  }\n\n  redo() {\n    if (this.canRedo()) {\n      return this.undoManager.redo();\n    }\n  }\n\n  undo() {\n    if (this.canUndo()) {\n      return this.undoManager.undo();\n    }\n  }\n\n}\n\n/* eslint-disable\n    no-var,\n    prefer-const,\n*/\nclass LocationMapper {\n  constructor(element) {\n    this.element = element;\n  }\n\n  findLocationFromContainerAndOffset(container, offset) {\n    let {\n      strict\n    } = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {\n      strict: true\n    };\n    let childIndex = 0;\n    let foundBlock = false;\n    const location = {\n      index: 0,\n      offset: 0\n    };\n    const attachmentElement = this.findAttachmentElementParentForNode(container);\n\n    if (attachmentElement) {\n      container = attachmentElement.parentNode;\n      offset = findChildIndexOfNode(attachmentElement);\n    }\n\n    const walker = walkTree(this.element, {\n      usingFilter: rejectAttachmentContents\n    });\n\n    while (walker.nextNode()) {\n      const node = walker.currentNode;\n\n      if (node === container && nodeIsTextNode(container)) {\n        if (!nodeIsCursorTarget(node)) {\n          location.offset += offset;\n        }\n\n        break;\n      } else {\n        if (node.parentNode === container) {\n          if (childIndex++ === offset) {\n            break;\n          }\n        } else if (!elementContainsNode(container, node)) {\n          if (childIndex > 0) {\n            break;\n          }\n        }\n\n        if (nodeIsBlockStart(node, {\n          strict\n        })) {\n          if (foundBlock) {\n            location.index++;\n          }\n\n          location.offset = 0;\n          foundBlock = true;\n        } else {\n          location.offset += nodeLength(node);\n        }\n      }\n    }\n\n    return location;\n  }\n\n  findContainerAndOffsetFromLocation(location) {\n    let container, offset;\n\n    if (location.index === 0 && location.offset === 0) {\n      container = this.element;\n      offset = 0;\n\n      while (container.firstChild) {\n        container = container.firstChild;\n\n        if (nodeIsBlockContainer(container)) {\n          offset = 1;\n          break;\n        }\n      }\n\n      return [container, offset];\n    }\n\n    let [node, nodeOffset] = this.findNodeAndOffsetFromLocation(location);\n    if (!node) return;\n\n    if (nodeIsTextNode(node)) {\n      if (nodeLength(node) === 0) {\n        container = node.parentNode.parentNode;\n        offset = findChildIndexOfNode(node.parentNode);\n\n        if (nodeIsCursorTarget(node, {\n          name: \"right\"\n        })) {\n          offset++;\n        }\n      } else {\n        container = node;\n        offset = location.offset - nodeOffset;\n      }\n    } else {\n      container = node.parentNode;\n\n      if (!nodeIsBlockStart(node.previousSibling)) {\n        if (!nodeIsBlockContainer(container)) {\n          while (node === container.lastChild) {\n            node = container;\n            container = container.parentNode;\n\n            if (nodeIsBlockContainer(container)) {\n              break;\n            }\n          }\n        }\n      }\n\n      offset = findChildIndexOfNode(node);\n\n      if (location.offset !== 0) {\n        offset++;\n      }\n    }\n\n    return [container, offset];\n  }\n\n  findNodeAndOffsetFromLocation(location) {\n    let node, nodeOffset;\n    let offset = 0;\n\n    for (const currentNode of this.getSignificantNodesForIndex(location.index)) {\n      const length = nodeLength(currentNode);\n\n      if (location.offset <= offset + length) {\n        if (nodeIsTextNode(currentNode)) {\n          node = currentNode;\n          nodeOffset = offset;\n\n          if (location.offset === nodeOffset && nodeIsCursorTarget(node)) {\n            break;\n          }\n        } else if (!node) {\n          node = currentNode;\n          nodeOffset = offset;\n        }\n      }\n\n      offset += length;\n\n      if (offset > location.offset) {\n        break;\n      }\n    }\n\n    return [node, nodeOffset];\n  } // Private\n\n\n  findAttachmentElementParentForNode(node) {\n    while (node && node !== this.element) {\n      if (nodeIsAttachmentElement(node)) {\n        return node;\n      }\n\n      node = node.parentNode;\n    }\n  }\n\n  getSignificantNodesForIndex(index) {\n    const nodes = [];\n    const walker = walkTree(this.element, {\n      usingFilter: acceptSignificantNodes\n    });\n    let recordingNodes = false;\n\n    while (walker.nextNode()) {\n      const node = walker.currentNode;\n\n      if (nodeIsBlockStartComment(node)) {\n        var blockIndex;\n\n        if (blockIndex != null) {\n          blockIndex++;\n        } else {\n          blockIndex = 0;\n        }\n\n        if (blockIndex === index) {\n          recordingNodes = true;\n        } else if (recordingNodes) {\n          break;\n        }\n      } else if (recordingNodes) {\n        nodes.push(node);\n      }\n    }\n\n    return nodes;\n  }\n\n}\n\nconst nodeLength = function (node) {\n  if (node.nodeType === Node.TEXT_NODE) {\n    if (nodeIsCursorTarget(node)) {\n      return 0;\n    } else {\n      const string = node.textContent;\n      return string.length;\n    }\n  } else if (tagName(node) === \"br\" || nodeIsAttachmentElement(node)) {\n    return 1;\n  } else {\n    return 0;\n  }\n};\n\nconst acceptSignificantNodes = function (node) {\n  if (rejectEmptyTextNodes(node) === NodeFilter.FILTER_ACCEPT) {\n    return rejectAttachmentContents(node);\n  } else {\n    return NodeFilter.FILTER_REJECT;\n  }\n};\n\nconst rejectEmptyTextNodes = function (node) {\n  if (nodeIsEmptyTextNode(node)) {\n    return NodeFilter.FILTER_REJECT;\n  } else {\n    return NodeFilter.FILTER_ACCEPT;\n  }\n};\n\nconst rejectAttachmentContents = function (node) {\n  if (nodeIsAttachmentElement(node.parentNode)) {\n    return NodeFilter.FILTER_REJECT;\n  } else {\n    return NodeFilter.FILTER_ACCEPT;\n  }\n};\n\n/* eslint-disable\n    id-length,\n    no-empty,\n*/\nclass PointMapper {\n  createDOMRangeFromPoint(_ref) {\n    let {\n      x,\n      y\n    } = _ref;\n    let domRange;\n\n    if (document.caretPositionFromPoint) {\n      const {\n        offsetNode,\n        offset\n      } = document.caretPositionFromPoint(x, y);\n      domRange = document.createRange();\n      domRange.setStart(offsetNode, offset);\n      return domRange;\n    } else if (document.caretRangeFromPoint) {\n      return document.caretRangeFromPoint(x, y);\n    } else if (document.body.createTextRange) {\n      const originalDOMRange = getDOMRange();\n\n      try {\n        // IE 11 throws \"Unspecified error\" when using moveToPoint\n        // during a drag-and-drop operation.\n        const textRange = document.body.createTextRange();\n        textRange.moveToPoint(x, y);\n        textRange.select();\n      } catch (error) {}\n\n      domRange = getDOMRange();\n      setDOMRange(originalDOMRange);\n      return domRange;\n    }\n  }\n\n  getClientRectsForDOMRange(domRange) {\n    const array = Array.from(domRange.getClientRects());\n    const start = array[0];\n    const end = array[array.length - 1];\n    return [start, end];\n  }\n\n}\n\n/* eslint-disable\n*/\nclass SelectionManager extends BasicObject {\n  constructor(element) {\n    super(...arguments);\n    this.didMouseDown = this.didMouseDown.bind(this);\n    this.selectionDidChange = this.selectionDidChange.bind(this);\n    this.element = element;\n    this.locationMapper = new LocationMapper(this.element);\n    this.pointMapper = new PointMapper();\n    this.lockCount = 0;\n    handleEvent(\"mousedown\", {\n      onElement: this.element,\n      withCallback: this.didMouseDown\n    });\n  }\n\n  getLocationRange() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    if (options.strict === false) {\n      return this.createLocationRangeFromDOMRange(getDOMRange());\n    } else if (options.ignoreLock) {\n      return this.currentLocationRange;\n    } else if (this.lockedLocationRange) {\n      return this.lockedLocationRange;\n    } else {\n      return this.currentLocationRange;\n    }\n  }\n\n  setLocationRange(locationRange) {\n    if (this.lockedLocationRange) return;\n    locationRange = normalizeRange(locationRange);\n    const domRange = this.createDOMRangeFromLocationRange(locationRange);\n\n    if (domRange) {\n      setDOMRange(domRange);\n      this.updateCurrentLocationRange(locationRange);\n    }\n  }\n\n  setLocationRangeFromPointRange(pointRange) {\n    pointRange = normalizeRange(pointRange);\n    const startLocation = this.getLocationAtPoint(pointRange[0]);\n    const endLocation = this.getLocationAtPoint(pointRange[1]);\n    this.setLocationRange([startLocation, endLocation]);\n  }\n\n  getClientRectAtLocationRange(locationRange) {\n    const domRange = this.createDOMRangeFromLocationRange(locationRange);\n\n    if (domRange) {\n      return this.getClientRectsForDOMRange(domRange)[1];\n    }\n  }\n\n  locationIsCursorTarget(location) {\n    const node = Array.from(this.findNodeAndOffsetFromLocation(location))[0];\n    return nodeIsCursorTarget(node);\n  }\n\n  lock() {\n    if (this.lockCount++ === 0) {\n      this.updateCurrentLocationRange();\n      this.lockedLocationRange = this.getLocationRange();\n    }\n  }\n\n  unlock() {\n    if (--this.lockCount === 0) {\n      const {\n        lockedLocationRange\n      } = this;\n      this.lockedLocationRange = null;\n\n      if (lockedLocationRange != null) {\n        return this.setLocationRange(lockedLocationRange);\n      }\n    }\n  }\n\n  clearSelection() {\n    var _getDOMSelection;\n\n    return (_getDOMSelection = getDOMSelection()) === null || _getDOMSelection === void 0 ? void 0 : _getDOMSelection.removeAllRanges();\n  }\n\n  selectionIsCollapsed() {\n    var _getDOMRange;\n\n    return ((_getDOMRange = getDOMRange()) === null || _getDOMRange === void 0 ? void 0 : _getDOMRange.collapsed) === true;\n  }\n\n  selectionIsExpanded() {\n    return !this.selectionIsCollapsed();\n  }\n\n  createLocationRangeFromDOMRange(domRange, options) {\n    if (domRange == null || !this.domRangeWithinElement(domRange)) return;\n    const start = this.findLocationFromContainerAndOffset(domRange.startContainer, domRange.startOffset, options);\n    if (!start) return;\n    const end = domRange.collapsed ? undefined : this.findLocationFromContainerAndOffset(domRange.endContainer, domRange.endOffset, options);\n    return normalizeRange([start, end]);\n  }\n\n  didMouseDown() {\n    return this.pauseTemporarily();\n  }\n\n  pauseTemporarily() {\n    let resumeHandlers;\n    this.paused = true;\n\n    const resume = () => {\n      this.paused = false;\n      clearTimeout(resumeTimeout);\n      Array.from(resumeHandlers).forEach(handler => {\n        handler.destroy();\n      });\n\n      if (elementContainsNode(document, this.element)) {\n        return this.selectionDidChange();\n      }\n    };\n\n    const resumeTimeout = setTimeout(resume, 200);\n    resumeHandlers = [\"mousemove\", \"keydown\"].map(eventName => handleEvent(eventName, {\n      onElement: document,\n      withCallback: resume\n    }));\n  }\n\n  selectionDidChange() {\n    if (!this.paused && !innerElementIsActive(this.element)) {\n      return this.updateCurrentLocationRange();\n    }\n  }\n\n  updateCurrentLocationRange(locationRange) {\n    if (locationRange != null ? locationRange : locationRange = this.createLocationRangeFromDOMRange(getDOMRange())) {\n      if (!rangesAreEqual(locationRange, this.currentLocationRange)) {\n        var _this$delegate, _this$delegate$locati;\n\n        this.currentLocationRange = locationRange;\n        return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$locati = _this$delegate.locationRangeDidChange) === null || _this$delegate$locati === void 0 ? void 0 : _this$delegate$locati.call(_this$delegate, this.currentLocationRange.slice(0));\n      }\n    }\n  }\n\n  createDOMRangeFromLocationRange(locationRange) {\n    const rangeStart = this.findContainerAndOffsetFromLocation(locationRange[0]);\n    const rangeEnd = rangeIsCollapsed(locationRange) ? rangeStart : this.findContainerAndOffsetFromLocation(locationRange[1]) || rangeStart;\n\n    if (rangeStart != null && rangeEnd != null) {\n      const domRange = document.createRange();\n      domRange.setStart(...Array.from(rangeStart || []));\n      domRange.setEnd(...Array.from(rangeEnd || []));\n      return domRange;\n    }\n  }\n\n  getLocationAtPoint(point) {\n    const domRange = this.createDOMRangeFromPoint(point);\n\n    if (domRange) {\n      var _this$createLocationR;\n\n      return (_this$createLocationR = this.createLocationRangeFromDOMRange(domRange)) === null || _this$createLocationR === void 0 ? void 0 : _this$createLocationR[0];\n    }\n  }\n\n  domRangeWithinElement(domRange) {\n    if (domRange.collapsed) {\n      return elementContainsNode(this.element, domRange.startContainer);\n    } else {\n      return elementContainsNode(this.element, domRange.startContainer) && elementContainsNode(this.element, domRange.endContainer);\n    }\n  }\n\n}\nSelectionManager.proxyMethod(\"locationMapper.findLocationFromContainerAndOffset\");\nSelectionManager.proxyMethod(\"locationMapper.findContainerAndOffsetFromLocation\");\nSelectionManager.proxyMethod(\"locationMapper.findNodeAndOffsetFromLocation\");\nSelectionManager.proxyMethod(\"pointMapper.createDOMRangeFromPoint\");\nSelectionManager.proxyMethod(\"pointMapper.getClientRectsForDOMRange\");\n\nvar models = {\n  Attachment,\n  AttachmentManager,\n  AttachmentPiece,\n  Block,\n  Composition,\n  Cocument: Document,\n  Editor,\n  HTMLParser,\n  HTMLSanitizer,\n  LineBreakInsertion,\n  LocationMapper,\n  ManagedAttachment,\n  Piece,\n  PointMapper,\n  SelectionManager,\n  SplittableList,\n  StringPiece,\n  Text,\n  UndoManager\n};\n\nconst Trix = {\n  VERSION: version,\n  config\n};\nObject.assign(Trix, models);\nwindow.Trix = Trix;\n\nclass ObjectGroup {\n  static groupObjects() {\n    let ungroupedObjects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    let {\n      depth,\n      asTree\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let group;\n\n    if (asTree) {\n      if (depth == null) {\n        depth = 0;\n      }\n    }\n\n    const objects = [];\n    Array.from(ungroupedObjects).forEach(object => {\n      var _object$canBeGrouped2;\n\n      if (group) {\n        var _object$canBeGrouped, _group$canBeGroupedWi, _group;\n\n        if ((_object$canBeGrouped = object.canBeGrouped) !== null && _object$canBeGrouped !== void 0 && _object$canBeGrouped.call(object, depth) && (_group$canBeGroupedWi = (_group = group[group.length - 1]).canBeGroupedWith) !== null && _group$canBeGroupedWi !== void 0 && _group$canBeGroupedWi.call(_group, object, depth)) {\n          group.push(object);\n          return;\n        } else {\n          objects.push(new this(group, {\n            depth,\n            asTree\n          }));\n          group = null;\n        }\n      }\n\n      if ((_object$canBeGrouped2 = object.canBeGrouped) !== null && _object$canBeGrouped2 !== void 0 && _object$canBeGrouped2.call(object, depth)) {\n        group = [object];\n      } else {\n        objects.push(object);\n      }\n    });\n\n    if (group) {\n      objects.push(new this(group, {\n        depth,\n        asTree\n      }));\n    }\n\n    return objects;\n  }\n\n  constructor() {\n    let objects = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    let {\n      depth,\n      asTree\n    } = arguments.length > 1 ? arguments[1] : undefined;\n    this.objects = objects;\n\n    if (asTree) {\n      this.depth = depth;\n      this.objects = this.constructor.groupObjects(this.objects, {\n        asTree,\n        depth: this.depth + 1\n      });\n    }\n  }\n\n  getObjects() {\n    return this.objects;\n  }\n\n  getDepth() {\n    return this.depth;\n  }\n\n  getCacheKey() {\n    const keys = [\"objectGroup\"];\n    Array.from(this.getObjects()).forEach(object => {\n      keys.push(object.getCacheKey());\n    });\n    return keys.join(\"/\");\n  }\n\n}\n\nclass ElementStore {\n  constructor(elements) {\n    this.reset(elements);\n  }\n\n  add(element) {\n    const key = getKey(element);\n    this.elements[key] = element;\n  }\n\n  remove(element) {\n    const key = getKey(element);\n    const value = this.elements[key];\n\n    if (value) {\n      delete this.elements[key];\n      return value;\n    }\n  }\n\n  reset() {\n    let elements = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    this.elements = {};\n    Array.from(elements).forEach(element => {\n      this.add(element);\n    });\n    return elements;\n  }\n\n}\n\nconst getKey = element => element.dataset.trixStoreKey;\n\nclass ObjectView extends BasicObject {\n  constructor(object) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super(...arguments);\n    this.object = object;\n    this.options = options;\n    this.childViews = [];\n    this.rootView = this;\n  }\n\n  getNodes() {\n    if (!this.nodes) {\n      this.nodes = this.createNodes();\n    }\n\n    return this.nodes.map(node => node.cloneNode(true));\n  }\n\n  invalidate() {\n    var _this$parentView;\n\n    this.nodes = null;\n    this.childViews = [];\n    return (_this$parentView = this.parentView) === null || _this$parentView === void 0 ? void 0 : _this$parentView.invalidate();\n  }\n\n  invalidateViewForObject(object) {\n    var _this$findViewForObje;\n\n    return (_this$findViewForObje = this.findViewForObject(object)) === null || _this$findViewForObje === void 0 ? void 0 : _this$findViewForObje.invalidate();\n  }\n\n  findOrCreateCachedChildView(viewClass, object, options) {\n    let view = this.getCachedViewForObject(object);\n\n    if (view) {\n      this.recordChildView(view);\n    } else {\n      view = this.createChildView(...arguments);\n      this.cacheViewForObject(view, object);\n    }\n\n    return view;\n  }\n\n  createChildView(viewClass, object) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    if (object instanceof ObjectGroup) {\n      options.viewClass = viewClass;\n      viewClass = ObjectGroupView;\n    }\n\n    const view = new viewClass(object, options);\n    return this.recordChildView(view);\n  }\n\n  recordChildView(view) {\n    view.parentView = this;\n    view.rootView = this.rootView;\n    this.childViews.push(view);\n    return view;\n  }\n\n  getAllChildViews() {\n    let views = [];\n    this.childViews.forEach(childView => {\n      views.push(childView);\n      views = views.concat(childView.getAllChildViews());\n    });\n    return views;\n  }\n\n  findElement() {\n    return this.findElementForObject(this.object);\n  }\n\n  findElementForObject(object) {\n    const id = object === null || object === void 0 ? void 0 : object.id;\n\n    if (id) {\n      return this.rootView.element.querySelector(\"[data-trix-id='\".concat(id, \"']\"));\n    }\n  }\n\n  findViewForObject(object) {\n    for (const view of this.getAllChildViews()) {\n      if (view.object === object) {\n        return view;\n      }\n    }\n  }\n\n  getViewCache() {\n    if (this.rootView === this) {\n      if (this.isViewCachingEnabled()) {\n        if (!this.viewCache) {\n          this.viewCache = {};\n        }\n\n        return this.viewCache;\n      }\n    } else {\n      return this.rootView.getViewCache();\n    }\n  }\n\n  isViewCachingEnabled() {\n    return this.shouldCacheViews !== false;\n  }\n\n  enableViewCaching() {\n    this.shouldCacheViews = true;\n  }\n\n  disableViewCaching() {\n    this.shouldCacheViews = false;\n  }\n\n  getCachedViewForObject(object) {\n    var _this$getViewCache;\n\n    return (_this$getViewCache = this.getViewCache()) === null || _this$getViewCache === void 0 ? void 0 : _this$getViewCache[object.getCacheKey()];\n  }\n\n  cacheViewForObject(view, object) {\n    const cache = this.getViewCache();\n\n    if (cache) {\n      cache[object.getCacheKey()] = view;\n    }\n  }\n\n  garbageCollectCachedViews() {\n    const cache = this.getViewCache();\n\n    if (cache) {\n      const views = this.getAllChildViews().concat(this);\n      const objectKeys = views.map(view => view.object.getCacheKey());\n\n      for (const key in cache) {\n        if (!objectKeys.includes(key)) {\n          delete cache[key];\n        }\n      }\n    }\n  }\n\n}\nclass ObjectGroupView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.objectGroup = this.object;\n    this.viewClass = this.options.viewClass;\n    delete this.options.viewClass;\n  }\n\n  getChildViews() {\n    if (!this.childViews.length) {\n      Array.from(this.objectGroup.getObjects()).forEach(object => {\n        this.findOrCreateCachedChildView(this.viewClass, object, this.options);\n      });\n    }\n\n    return this.childViews;\n  }\n\n  createNodes() {\n    const element = this.createContainerElement();\n    this.getChildViews().forEach(view => {\n      Array.from(view.getNodes()).forEach(node => {\n        element.appendChild(node);\n      });\n    });\n    return [element];\n  }\n\n  createContainerElement() {\n    let depth = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.objectGroup.getDepth();\n    return this.getChildViews()[0].createContainerElement(depth);\n  }\n\n}\n\nconst {\n  css: css$2\n} = config;\nclass AttachmentView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.attachment = this.object;\n    this.attachment.uploadProgressDelegate = this;\n    this.attachmentPiece = this.options.piece;\n  }\n\n  createContentNodes() {\n    return [];\n  }\n\n  createNodes() {\n    let innerElement;\n    const figure = innerElement = makeElement({\n      tagName: \"figure\",\n      className: this.getClassName(),\n      data: this.getData(),\n      editable: false\n    });\n    const href = this.getHref();\n\n    if (href) {\n      innerElement = makeElement({\n        tagName: \"a\",\n        editable: false,\n        attributes: {\n          href,\n          tabindex: -1\n        }\n      });\n      figure.appendChild(innerElement);\n    }\n\n    if (this.attachment.hasContent()) {\n      innerElement.innerHTML = this.attachment.getContent();\n    } else {\n      this.createContentNodes().forEach(node => {\n        innerElement.appendChild(node);\n      });\n    }\n\n    innerElement.appendChild(this.createCaptionElement());\n\n    if (this.attachment.isPending()) {\n      this.progressElement = makeElement({\n        tagName: \"progress\",\n        attributes: {\n          class: css$2.attachmentProgress,\n          value: this.attachment.getUploadProgress(),\n          max: 100\n        },\n        data: {\n          trixMutable: true,\n          trixStoreKey: [\"progressElement\", this.attachment.id].join(\"/\")\n        }\n      });\n      figure.appendChild(this.progressElement);\n    }\n\n    return [createCursorTarget(\"left\"), figure, createCursorTarget(\"right\")];\n  }\n\n  createCaptionElement() {\n    const figcaption = makeElement({\n      tagName: \"figcaption\",\n      className: css$2.attachmentCaption\n    });\n    const caption = this.attachmentPiece.getCaption();\n\n    if (caption) {\n      figcaption.classList.add(\"\".concat(css$2.attachmentCaption, \"--edited\"));\n      figcaption.textContent = caption;\n    } else {\n      let name, size;\n      const captionConfig = this.getCaptionConfig();\n\n      if (captionConfig.name) {\n        name = this.attachment.getFilename();\n      }\n\n      if (captionConfig.size) {\n        size = this.attachment.getFormattedFilesize();\n      }\n\n      if (name) {\n        const nameElement = makeElement({\n          tagName: \"span\",\n          className: css$2.attachmentName,\n          textContent: name\n        });\n        figcaption.appendChild(nameElement);\n      }\n\n      if (size) {\n        if (name) {\n          figcaption.appendChild(document.createTextNode(\" \"));\n        }\n\n        const sizeElement = makeElement({\n          tagName: \"span\",\n          className: css$2.attachmentSize,\n          textContent: size\n        });\n        figcaption.appendChild(sizeElement);\n      }\n    }\n\n    return figcaption;\n  }\n\n  getClassName() {\n    const names = [css$2.attachment, \"\".concat(css$2.attachment, \"--\").concat(this.attachment.getType())];\n    const extension = this.attachment.getExtension();\n\n    if (extension) {\n      names.push(\"\".concat(css$2.attachment, \"--\").concat(extension));\n    }\n\n    return names.join(\" \");\n  }\n\n  getData() {\n    const data = {\n      trixAttachment: JSON.stringify(this.attachment),\n      trixContentType: this.attachment.getContentType(),\n      trixId: this.attachment.id\n    };\n    const {\n      attributes\n    } = this.attachmentPiece;\n\n    if (!attributes.isEmpty()) {\n      data.trixAttributes = JSON.stringify(attributes);\n    }\n\n    if (this.attachment.isPending()) {\n      data.trixSerialize = false;\n    }\n\n    return data;\n  }\n\n  getHref() {\n    if (!htmlContainsTagName(this.attachment.getContent(), \"a\")) {\n      return this.attachment.getHref();\n    }\n  }\n\n  getCaptionConfig() {\n    var _config$attachments$t;\n\n    const type = this.attachment.getType();\n    const captionConfig = copyObject((_config$attachments$t = config.attachments[type]) === null || _config$attachments$t === void 0 ? void 0 : _config$attachments$t.caption);\n\n    if (type === \"file\") {\n      captionConfig.name = true;\n    }\n\n    return captionConfig;\n  }\n\n  findProgressElement() {\n    var _this$findElement;\n\n    return (_this$findElement = this.findElement()) === null || _this$findElement === void 0 ? void 0 : _this$findElement.querySelector(\"progress\");\n  } // Attachment delegate\n\n\n  attachmentDidChangeUploadProgress() {\n    const value = this.attachment.getUploadProgress();\n    const progressElement = this.findProgressElement();\n\n    if (progressElement) {\n      progressElement.value = value;\n    }\n  }\n\n}\n\nconst createCursorTarget = name => makeElement({\n  tagName: \"span\",\n  textContent: ZERO_WIDTH_SPACE,\n  data: {\n    trixCursorTarget: name,\n    trixSerialize: false\n  }\n});\n\nconst htmlContainsTagName = function (html, tagName) {\n  const div = makeElement(\"div\");\n  div.innerHTML = html || \"\";\n  return div.querySelector(tagName);\n};\n\nclass PreviewableAttachmentView extends AttachmentView {\n  constructor() {\n    super(...arguments);\n    this.attachment.previewDelegate = this;\n  }\n\n  createContentNodes() {\n    this.image = makeElement({\n      tagName: \"img\",\n      attributes: {\n        src: \"\"\n      },\n      data: {\n        trixMutable: true\n      }\n    });\n    this.refresh(this.image);\n    return [this.image];\n  }\n\n  createCaptionElement() {\n    const figcaption = super.createCaptionElement(...arguments);\n\n    if (!figcaption.textContent) {\n      figcaption.setAttribute(\"data-trix-placeholder\", config.lang.captionPlaceholder);\n    }\n\n    return figcaption;\n  }\n\n  refresh(image) {\n    if (!image) {\n      var _this$findElement;\n\n      image = (_this$findElement = this.findElement()) === null || _this$findElement === void 0 ? void 0 : _this$findElement.querySelector(\"img\");\n    }\n\n    if (image) {\n      return this.updateAttributesForImage(image);\n    }\n  }\n\n  updateAttributesForImage(image) {\n    const url = this.attachment.getURL();\n    const previewURL = this.attachment.getPreviewURL();\n    image.src = previewURL || url;\n\n    if (previewURL === url) {\n      image.removeAttribute(\"data-trix-serialized-attributes\");\n    } else {\n      const serializedAttributes = JSON.stringify({\n        src: url\n      });\n      image.setAttribute(\"data-trix-serialized-attributes\", serializedAttributes);\n    }\n\n    const width = this.attachment.getWidth();\n    const height = this.attachment.getHeight();\n\n    if (width != null) {\n      image.width = width;\n    }\n\n    if (height != null) {\n      image.height = height;\n    }\n\n    const storeKey = [\"imageElement\", this.attachment.id, image.src, image.width, image.height].join(\"/\");\n    image.dataset.trixStoreKey = storeKey;\n  } // Attachment delegate\n\n\n  attachmentDidChangeAttributes() {\n    this.refresh(this.image);\n    return this.refresh();\n  }\n\n}\n\n/* eslint-disable\n    no-useless-escape,\n    no-var,\n*/\nclass PieceView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.piece = this.object;\n    this.attributes = this.piece.getAttributes();\n    this.textConfig = this.options.textConfig;\n    this.context = this.options.context;\n\n    if (this.piece.attachment) {\n      this.attachment = this.piece.attachment;\n    } else {\n      this.string = this.piece.toString();\n    }\n  }\n\n  createNodes() {\n    let nodes = this.attachment ? this.createAttachmentNodes() : this.createStringNodes();\n    const element = this.createElement();\n\n    if (element) {\n      const innerElement = findInnerElement(element);\n      Array.from(nodes).forEach(node => {\n        innerElement.appendChild(node);\n      });\n      nodes = [element];\n    }\n\n    return nodes;\n  }\n\n  createAttachmentNodes() {\n    const constructor = this.attachment.isPreviewable() ? PreviewableAttachmentView : AttachmentView;\n    const view = this.createChildView(constructor, this.piece.attachment, {\n      piece: this.piece\n    });\n    return view.getNodes();\n  }\n\n  createStringNodes() {\n    var _this$textConfig;\n\n    if ((_this$textConfig = this.textConfig) !== null && _this$textConfig !== void 0 && _this$textConfig.plaintext) {\n      return [document.createTextNode(this.string)];\n    } else {\n      const nodes = [];\n      const iterable = this.string.split(\"\\n\");\n\n      for (let index = 0; index < iterable.length; index++) {\n        const substring = iterable[index];\n\n        if (index > 0) {\n          const element = makeElement(\"br\");\n          nodes.push(element);\n        }\n\n        if (substring.length) {\n          const node = document.createTextNode(this.preserveSpaces(substring));\n          nodes.push(node);\n        }\n      }\n\n      return nodes;\n    }\n  }\n\n  createElement() {\n    let element, key, value;\n    const styles = {};\n\n    for (key in this.attributes) {\n      value = this.attributes[key];\n      const config = getTextConfig(key);\n\n      if (config) {\n        if (config.tagName) {\n          var innerElement;\n          const pendingElement = makeElement(config.tagName);\n\n          if (innerElement) {\n            innerElement.appendChild(pendingElement);\n            innerElement = pendingElement;\n          } else {\n            element = innerElement = pendingElement;\n          }\n        }\n\n        if (config.styleProperty) {\n          styles[config.styleProperty] = value;\n        }\n\n        if (config.style) {\n          for (key in config.style) {\n            value = config.style[key];\n            styles[key] = value;\n          }\n        }\n      }\n    }\n\n    if (Object.keys(styles).length) {\n      if (!element) {\n        element = makeElement(\"span\");\n      }\n\n      for (key in styles) {\n        value = styles[key];\n        element.style[key] = value;\n      }\n    }\n\n    return element;\n  }\n\n  createContainerElement() {\n    for (const key in this.attributes) {\n      const value = this.attributes[key];\n      const config = getTextConfig(key);\n\n      if (config) {\n        if (config.groupTagName) {\n          const attributes = {};\n          attributes[key] = value;\n          return makeElement(config.groupTagName, attributes);\n        }\n      }\n    }\n  }\n\n  preserveSpaces(string) {\n    if (this.context.isLast) {\n      string = string.replace(/\\ $/, NON_BREAKING_SPACE);\n    }\n\n    string = string.replace(/(\\S)\\ {3}(\\S)/g, \"$1 \".concat(NON_BREAKING_SPACE, \" $2\")).replace(/\\ {2}/g, \"\".concat(NON_BREAKING_SPACE, \" \")).replace(/\\ {2}/g, \" \".concat(NON_BREAKING_SPACE));\n\n    if (this.context.isFirst || this.context.followsWhitespace) {\n      string = string.replace(/^\\ /, NON_BREAKING_SPACE);\n    }\n\n    return string;\n  }\n\n}\n\n/* eslint-disable\n    no-var,\n*/\nclass TextView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.text = this.object;\n    this.textConfig = this.options.textConfig;\n  }\n\n  createNodes() {\n    const nodes = [];\n    const pieces = ObjectGroup.groupObjects(this.getPieces());\n    const lastIndex = pieces.length - 1;\n\n    for (let index = 0; index < pieces.length; index++) {\n      const piece = pieces[index];\n      const context = {};\n\n      if (index === 0) {\n        context.isFirst = true;\n      }\n\n      if (index === lastIndex) {\n        context.isLast = true;\n      }\n\n      if (endsWithWhitespace(previousPiece)) {\n        context.followsWhitespace = true;\n      }\n\n      const view = this.findOrCreateCachedChildView(PieceView, piece, {\n        textConfig: this.textConfig,\n        context\n      });\n      nodes.push(...Array.from(view.getNodes() || []));\n      var previousPiece = piece;\n    }\n\n    return nodes;\n  }\n\n  getPieces() {\n    return Array.from(this.text.getPieces()).filter(piece => !piece.hasAttribute(\"blockBreak\"));\n  }\n\n}\n\nconst endsWithWhitespace = piece => /\\s$/.test(piece === null || piece === void 0 ? void 0 : piece.toString());\n\nconst {\n  css: css$1\n} = config;\nclass BlockView extends ObjectView {\n  constructor() {\n    super(...arguments);\n    this.block = this.object;\n    this.attributes = this.block.getAttributes();\n  }\n\n  createNodes() {\n    const comment = document.createComment(\"block\");\n    const nodes = [comment];\n\n    if (this.block.isEmpty()) {\n      nodes.push(makeElement(\"br\"));\n    } else {\n      var _getBlockConfig;\n\n      const textConfig = (_getBlockConfig = getBlockConfig(this.block.getLastAttribute())) === null || _getBlockConfig === void 0 ? void 0 : _getBlockConfig.text;\n      const textView = this.findOrCreateCachedChildView(TextView, this.block.text, {\n        textConfig\n      });\n      nodes.push(...Array.from(textView.getNodes() || []));\n\n      if (this.shouldAddExtraNewlineElement()) {\n        nodes.push(makeElement(\"br\"));\n      }\n    }\n\n    if (this.attributes.length) {\n      return nodes;\n    } else {\n      let attributes;\n      const {\n        tagName\n      } = config.blockAttributes.default;\n\n      if (this.block.isRTL()) {\n        attributes = {\n          dir: \"rtl\"\n        };\n      }\n\n      const element = makeElement({\n        tagName,\n        attributes\n      });\n      nodes.forEach(node => element.appendChild(node));\n      return [element];\n    }\n  }\n\n  createContainerElement(depth) {\n    let attributes, className;\n    const attributeName = this.attributes[depth];\n    const {\n      tagName\n    } = getBlockConfig(attributeName);\n\n    if (depth === 0 && this.block.isRTL()) {\n      attributes = {\n        dir: \"rtl\"\n      };\n    }\n\n    if (attributeName === \"attachmentGallery\") {\n      const size = this.block.getBlockBreakPosition();\n      className = \"\".concat(css$1.attachmentGallery, \" \").concat(css$1.attachmentGallery, \"--\").concat(size);\n    }\n\n    return makeElement({\n      tagName,\n      className,\n      attributes\n    });\n  } // A single <br> at the end of a block element has no visual representation\n  // so add an extra one.\n\n\n  shouldAddExtraNewlineElement() {\n    return /\\n\\n$/.test(this.block.toString());\n  }\n\n}\n\nclass DocumentView extends ObjectView {\n  static render(document) {\n    const element = makeElement(\"div\");\n    const view = new this(document, {\n      element\n    });\n    view.render();\n    view.sync();\n    return element;\n  }\n\n  constructor() {\n    super(...arguments);\n    this.element = this.options.element;\n    this.elementStore = new ElementStore();\n    this.setDocument(this.object);\n  }\n\n  setDocument(document) {\n    if (!document.isEqualTo(this.document)) {\n      this.document = this.object = document;\n    }\n  }\n\n  render() {\n    this.childViews = [];\n    this.shadowElement = makeElement(\"div\");\n\n    if (!this.document.isEmpty()) {\n      const objects = ObjectGroup.groupObjects(this.document.getBlocks(), {\n        asTree: true\n      });\n      Array.from(objects).forEach(object => {\n        const view = this.findOrCreateCachedChildView(BlockView, object);\n        Array.from(view.getNodes()).map(node => this.shadowElement.appendChild(node));\n      });\n    }\n  }\n\n  isSynced() {\n    return elementsHaveEqualHTML(this.shadowElement, this.element);\n  }\n\n  sync() {\n    const fragment = this.createDocumentFragmentForSync();\n\n    while (this.element.lastChild) {\n      this.element.removeChild(this.element.lastChild);\n    }\n\n    this.element.appendChild(fragment);\n    return this.didSync();\n  } // Private\n\n\n  didSync() {\n    this.elementStore.reset(findStoredElements(this.element));\n    return defer(() => this.garbageCollectCachedViews());\n  }\n\n  createDocumentFragmentForSync() {\n    const fragment = document.createDocumentFragment();\n    Array.from(this.shadowElement.childNodes).forEach(node => {\n      fragment.appendChild(node.cloneNode(true));\n    });\n    Array.from(findStoredElements(fragment)).forEach(element => {\n      const storedElement = this.elementStore.remove(element);\n\n      if (storedElement) {\n        element.parentNode.replaceChild(storedElement, element);\n      }\n    });\n    return fragment;\n  }\n\n}\n\nconst findStoredElements = element => element.querySelectorAll(\"[data-trix-store-key]\");\n\nconst elementsHaveEqualHTML = (element, otherElement) => ignoreSpaces(element.innerHTML) === ignoreSpaces(otherElement.innerHTML);\n\nconst ignoreSpaces = html => html.replace(/&nbsp;/g, \" \");\n\n/* eslint-disable\n    no-empty,\n*/\nconst unserializableElementSelector = \"[data-trix-serialize=false]\";\nconst unserializableAttributeNames = [\"contenteditable\", \"data-trix-id\", \"data-trix-store-key\", \"data-trix-mutable\", \"data-trix-placeholder\", \"tabindex\"];\nconst serializedAttributesAttribute = \"data-trix-serialized-attributes\";\nconst serializedAttributesSelector = \"[\".concat(serializedAttributesAttribute, \"]\");\nconst blockCommentPattern = new RegExp(\"<!--block-->\", \"g\");\nconst serializers = {\n  \"application/json\": function (serializable) {\n    let document;\n\n    if (serializable instanceof Document) {\n      document = serializable;\n    } else if (serializable instanceof HTMLElement) {\n      document = HTMLParser.parse(serializable.innerHTML).getDocument();\n    } else {\n      throw new Error(\"unserializable object\");\n    }\n\n    return document.toSerializableDocument().toJSONString();\n  },\n  \"text/html\": function (serializable) {\n    let element;\n\n    if (serializable instanceof Document) {\n      element = DocumentView.render(serializable);\n    } else if (serializable instanceof HTMLElement) {\n      element = serializable.cloneNode(true);\n    } else {\n      throw new Error(\"unserializable object\");\n    } // Remove unserializable elements\n\n\n    Array.from(element.querySelectorAll(unserializableElementSelector)).forEach(el => {\n      removeNode(el);\n    }); // Remove unserializable attributes\n\n    unserializableAttributeNames.forEach(attribute => {\n      Array.from(element.querySelectorAll(\"[\".concat(attribute, \"]\"))).forEach(el => {\n        el.removeAttribute(attribute);\n      });\n    }); // Rewrite elements with serialized attribute overrides\n\n    Array.from(element.querySelectorAll(serializedAttributesSelector)).forEach(el => {\n      try {\n        const attributes = JSON.parse(el.getAttribute(serializedAttributesAttribute));\n        el.removeAttribute(serializedAttributesAttribute);\n\n        for (const name in attributes) {\n          const value = attributes[name];\n          el.setAttribute(name, value);\n        }\n      } catch (error) {}\n    });\n    return element.innerHTML.replace(blockCommentPattern, \"\");\n  }\n};\nconst deserializers = {\n  \"application/json\": function (string) {\n    return Document.fromJSONString(string);\n  },\n  \"text/html\": function (string) {\n    return HTMLParser.parse(string).getDocument();\n  }\n};\nconst serializeToContentType = function (serializable, contentType) {\n  const serializer = serializers[contentType];\n\n  if (serializer) {\n    return serializer(serializable);\n  } else {\n    throw new Error(\"unknown content type: \".concat(contentType));\n  }\n};\nconst deserializeFromContentType = function (string, contentType) {\n  const deserializer = deserializers[contentType];\n\n  if (deserializer) {\n    return deserializer(string);\n  } else {\n    throw new Error(\"unknown content type: \".concat(contentType));\n  }\n};\n\nconst mutableAttributeName = \"data-trix-mutable\";\nconst mutableSelector = \"[\".concat(mutableAttributeName, \"]\");\nconst options = {\n  attributes: true,\n  childList: true,\n  characterData: true,\n  characterDataOldValue: true,\n  subtree: true\n};\nclass MutationObserver extends BasicObject {\n  constructor(element) {\n    super(element);\n    this.didMutate = this.didMutate.bind(this);\n    this.element = element;\n    this.observer = new window.MutationObserver(this.didMutate);\n    this.start();\n  }\n\n  start() {\n    this.reset();\n    return this.observer.observe(this.element, options);\n  }\n\n  stop() {\n    return this.observer.disconnect();\n  }\n\n  didMutate(mutations) {\n    this.mutations.push(...Array.from(this.findSignificantMutations(mutations) || []));\n\n    if (this.mutations.length) {\n      var _this$delegate, _this$delegate$elemen;\n\n      (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$elemen = _this$delegate.elementDidMutate) === null || _this$delegate$elemen === void 0 ? void 0 : _this$delegate$elemen.call(_this$delegate, this.getMutationSummary());\n      return this.reset();\n    }\n  } // Private\n\n\n  reset() {\n    this.mutations = [];\n  }\n\n  findSignificantMutations(mutations) {\n    return mutations.filter(mutation => {\n      return this.mutationIsSignificant(mutation);\n    });\n  }\n\n  mutationIsSignificant(mutation) {\n    if (this.nodeIsMutable(mutation.target)) {\n      return false;\n    }\n\n    for (const node of Array.from(this.nodesModifiedByMutation(mutation))) {\n      if (this.nodeIsSignificant(node)) return true;\n    }\n\n    return false;\n  }\n\n  nodeIsSignificant(node) {\n    return node !== this.element && !this.nodeIsMutable(node) && !nodeIsEmptyTextNode(node);\n  }\n\n  nodeIsMutable(node) {\n    return findClosestElementFromNode(node, {\n      matchingSelector: mutableSelector\n    });\n  }\n\n  nodesModifiedByMutation(mutation) {\n    const nodes = [];\n\n    switch (mutation.type) {\n      case \"attributes\":\n        if (mutation.attributeName !== mutableAttributeName) {\n          nodes.push(mutation.target);\n        }\n\n        break;\n\n      case \"characterData\":\n        // Changes to text nodes should consider the parent element\n        nodes.push(mutation.target.parentNode);\n        nodes.push(mutation.target);\n        break;\n\n      case \"childList\":\n        // Consider each added or removed node\n        nodes.push(...Array.from(mutation.addedNodes || []));\n        nodes.push(...Array.from(mutation.removedNodes || []));\n        break;\n    }\n\n    return nodes;\n  }\n\n  getMutationSummary() {\n    return this.getTextMutationSummary();\n  }\n\n  getTextMutationSummary() {\n    const {\n      additions,\n      deletions\n    } = this.getTextChangesFromCharacterData();\n    const textChanges = this.getTextChangesFromChildList();\n    Array.from(textChanges.additions).forEach(addition => {\n      if (!Array.from(additions).includes(addition)) {\n        additions.push(addition);\n      }\n    });\n    deletions.push(...Array.from(textChanges.deletions || []));\n    const summary = {};\n    const added = additions.join(\"\");\n\n    if (added) {\n      summary.textAdded = added;\n    }\n\n    const deleted = deletions.join(\"\");\n\n    if (deleted) {\n      summary.textDeleted = deleted;\n    }\n\n    return summary;\n  }\n\n  getMutationsByType(type) {\n    return Array.from(this.mutations).filter(mutation => mutation.type === type);\n  }\n\n  getTextChangesFromChildList() {\n    let textAdded, textRemoved;\n    const addedNodes = [];\n    const removedNodes = [];\n    Array.from(this.getMutationsByType(\"childList\")).forEach(mutation => {\n      addedNodes.push(...Array.from(mutation.addedNodes || []));\n      removedNodes.push(...Array.from(mutation.removedNodes || []));\n    });\n    const singleBlockCommentRemoved = addedNodes.length === 0 && removedNodes.length === 1 && nodeIsBlockStartComment(removedNodes[0]);\n\n    if (singleBlockCommentRemoved) {\n      textAdded = [];\n      textRemoved = [\"\\n\"];\n    } else {\n      textAdded = getTextForNodes(addedNodes);\n      textRemoved = getTextForNodes(removedNodes);\n    }\n\n    const additions = textAdded.filter((text, index) => text !== textRemoved[index]).map(normalizeSpaces);\n    const deletions = textRemoved.filter((text, index) => text !== textAdded[index]).map(normalizeSpaces);\n    return {\n      additions,\n      deletions\n    };\n  }\n\n  getTextChangesFromCharacterData() {\n    let added, removed;\n    const characterMutations = this.getMutationsByType(\"characterData\");\n\n    if (characterMutations.length) {\n      const startMutation = characterMutations[0],\n            endMutation = characterMutations[characterMutations.length - 1];\n      const oldString = normalizeSpaces(startMutation.oldValue);\n      const newString = normalizeSpaces(endMutation.target.data);\n      const summarized = summarizeStringChange(oldString, newString);\n      added = summarized.added;\n      removed = summarized.removed;\n    }\n\n    return {\n      additions: added ? [added] : [],\n      deletions: removed ? [removed] : []\n    };\n  }\n\n}\n\nconst getTextForNodes = function () {\n  let nodes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  const text = [];\n\n  for (const node of Array.from(nodes)) {\n    switch (node.nodeType) {\n      case Node.TEXT_NODE:\n        text.push(node.data);\n        break;\n\n      case Node.ELEMENT_NODE:\n        if (tagName(node) === \"br\") {\n          text.push(\"\\n\");\n        } else {\n          text.push(...Array.from(getTextForNodes(node.childNodes) || []));\n        }\n\n        break;\n    }\n  }\n\n  return text;\n};\n\nclass Controller extends BasicObject {}\n\n/* eslint-disable\n    no-empty,\n*/\nclass FileVerificationOperation extends Operation {\n  constructor(file) {\n    super(...arguments);\n    this.file = file;\n  }\n\n  perform(callback) {\n    const reader = new FileReader();\n\n    reader.onerror = () => callback(false);\n\n    reader.onload = () => {\n      reader.onerror = null;\n\n      try {\n        reader.abort();\n      } catch (error) {}\n\n      return callback(true, this.file);\n    };\n\n    return reader.readAsArrayBuffer(this.file);\n  }\n\n}\n\nclass InputController extends BasicObject {\n  constructor(element) {\n    super(...arguments);\n    this.element = element;\n    this.mutationObserver = new MutationObserver(this.element);\n    this.mutationObserver.delegate = this;\n\n    for (const eventName in this.constructor.events) {\n      handleEvent(eventName, {\n        onElement: this.element,\n        withCallback: this.handlerFor(eventName)\n      });\n    }\n  }\n\n  elementDidMutate(mutationSummary) {}\n\n  editorWillSyncDocumentView() {\n    return this.mutationObserver.stop();\n  }\n\n  editorDidSyncDocumentView() {\n    return this.mutationObserver.start();\n  }\n\n  requestRender() {\n    var _this$delegate, _this$delegate$inputC;\n\n    return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$inputC = _this$delegate.inputControllerDidRequestRender) === null || _this$delegate$inputC === void 0 ? void 0 : _this$delegate$inputC.call(_this$delegate);\n  }\n\n  requestReparse() {\n    var _this$delegate2, _this$delegate2$input;\n\n    (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$input = _this$delegate2.inputControllerDidRequestReparse) === null || _this$delegate2$input === void 0 ? void 0 : _this$delegate2$input.call(_this$delegate2);\n    return this.requestRender();\n  }\n\n  attachFiles(files) {\n    const operations = Array.from(files).map(file => new FileVerificationOperation(file));\n    return Promise.all(operations).then(files => {\n      this.handleInput(function () {\n        var _this$delegate3, _this$responder;\n\n        (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : _this$delegate3.inputControllerWillAttachFiles();\n        (_this$responder = this.responder) === null || _this$responder === void 0 ? void 0 : _this$responder.insertFiles(files);\n        return this.requestRender();\n      });\n    });\n  } // Private\n\n\n  handlerFor(eventName) {\n    return event => {\n      if (!event.defaultPrevented) {\n        this.handleInput(() => {\n          if (!innerElementIsActive(this.element)) {\n            this.eventName = eventName;\n            this.constructor.events[eventName].call(this, event);\n          }\n        });\n      }\n    };\n  }\n\n  handleInput(callback) {\n    try {\n      var _this$delegate4;\n\n      (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.inputControllerWillHandleInput();\n      callback.call(this);\n    } finally {\n      var _this$delegate5;\n\n      (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.inputControllerDidHandleInput();\n    }\n  }\n\n  createLinkHTML(href, text) {\n    const link = document.createElement(\"a\");\n    link.href = href;\n    link.textContent = text ? text : href;\n    return link.outerHTML;\n  }\n\n}\n\n_defineProperty(InputController, \"events\", {});\n\nvar _$codePointAt, _;\nconst {\n  browser,\n  keyNames: keyNames$1\n} = config;\nlet pastedFileCount = 0;\nclass Level0InputController extends InputController {\n  constructor() {\n    super(...arguments);\n    this.resetInputSummary();\n  }\n\n  setInputSummary() {\n    let summary = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.inputSummary.eventName = this.eventName;\n\n    for (const key in summary) {\n      const value = summary[key];\n      this.inputSummary[key] = value;\n    }\n\n    return this.inputSummary;\n  }\n\n  resetInputSummary() {\n    this.inputSummary = {};\n  }\n\n  reset() {\n    this.resetInputSummary();\n    return selectionChangeObserver.reset();\n  } // Mutation observer delegate\n\n\n  elementDidMutate(mutationSummary) {\n    if (this.isComposing()) {\n      var _this$delegate, _this$delegate$inputC;\n\n      return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$inputC = _this$delegate.inputControllerDidAllowUnhandledInput) === null || _this$delegate$inputC === void 0 ? void 0 : _this$delegate$inputC.call(_this$delegate);\n    } else {\n      return this.handleInput(function () {\n        if (this.mutationIsSignificant(mutationSummary)) {\n          if (this.mutationIsExpected(mutationSummary)) {\n            this.requestRender();\n          } else {\n            this.requestReparse();\n          }\n        }\n\n        return this.reset();\n      });\n    }\n  }\n\n  mutationIsExpected(_ref) {\n    let {\n      textAdded,\n      textDeleted\n    } = _ref;\n\n    if (this.inputSummary.preferDocument) {\n      return true;\n    }\n\n    const mutationAdditionMatchesSummary = textAdded != null ? textAdded === this.inputSummary.textAdded : !this.inputSummary.textAdded;\n    const mutationDeletionMatchesSummary = textDeleted != null ? this.inputSummary.didDelete : !this.inputSummary.didDelete;\n    const unexpectedNewlineAddition = [\"\\n\", \" \\n\"].includes(textAdded) && !mutationAdditionMatchesSummary;\n    const unexpectedNewlineDeletion = textDeleted === \"\\n\" && !mutationDeletionMatchesSummary;\n    const singleUnexpectedNewline = unexpectedNewlineAddition && !unexpectedNewlineDeletion || unexpectedNewlineDeletion && !unexpectedNewlineAddition;\n\n    if (singleUnexpectedNewline) {\n      const range = this.getSelectedRange();\n\n      if (range) {\n        var _this$responder;\n\n        const offset = unexpectedNewlineAddition ? textAdded.replace(/\\n$/, \"\").length || -1 : (textAdded === null || textAdded === void 0 ? void 0 : textAdded.length) || 1;\n\n        if ((_this$responder = this.responder) !== null && _this$responder !== void 0 && _this$responder.positionIsBlockBreak(range[1] + offset)) {\n          return true;\n        }\n      }\n    }\n\n    return mutationAdditionMatchesSummary && mutationDeletionMatchesSummary;\n  }\n\n  mutationIsSignificant(mutationSummary) {\n    var _this$compositionInpu;\n\n    const textChanged = Object.keys(mutationSummary).length > 0;\n    const composedEmptyString = ((_this$compositionInpu = this.compositionInput) === null || _this$compositionInpu === void 0 ? void 0 : _this$compositionInpu.getEndData()) === \"\";\n    return textChanged || !composedEmptyString;\n  } // Private\n\n\n  getCompositionInput() {\n    if (this.isComposing()) {\n      return this.compositionInput;\n    } else {\n      this.compositionInput = new CompositionInput(this);\n    }\n  }\n\n  isComposing() {\n    return this.compositionInput && !this.compositionInput.isEnded();\n  }\n\n  deleteInDirection(direction, event) {\n    var _this$responder2;\n\n    if (((_this$responder2 = this.responder) === null || _this$responder2 === void 0 ? void 0 : _this$responder2.deleteInDirection(direction)) === false) {\n      if (event) {\n        event.preventDefault();\n        return this.requestRender();\n      }\n    } else {\n      return this.setInputSummary({\n        didDelete: true\n      });\n    }\n  }\n\n  serializeSelectionToDataTransfer(dataTransfer) {\n    var _this$responder3;\n\n    if (!dataTransferIsWritable(dataTransfer)) return;\n    const document = (_this$responder3 = this.responder) === null || _this$responder3 === void 0 ? void 0 : _this$responder3.getSelectedDocument().toSerializableDocument();\n    dataTransfer.setData(\"application/x-trix-document\", JSON.stringify(document));\n    dataTransfer.setData(\"text/html\", DocumentView.render(document).innerHTML);\n    dataTransfer.setData(\"text/plain\", document.toString().replace(/\\n$/, \"\"));\n    return true;\n  }\n\n  canAcceptDataTransfer(dataTransfer) {\n    const types = {};\n    Array.from((dataTransfer === null || dataTransfer === void 0 ? void 0 : dataTransfer.types) || []).forEach(type => {\n      types[type] = true;\n    });\n    return types.Files || types[\"application/x-trix-document\"] || types[\"text/html\"] || types[\"text/plain\"];\n  }\n\n  getPastedHTMLUsingHiddenElement(callback) {\n    const selectedRange = this.getSelectedRange();\n    const style = {\n      position: \"absolute\",\n      left: \"\".concat(window.pageXOffset, \"px\"),\n      top: \"\".concat(window.pageYOffset, \"px\"),\n      opacity: 0\n    };\n    const element = makeElement({\n      style,\n      tagName: \"div\",\n      editable: true\n    });\n    document.body.appendChild(element);\n    element.focus();\n    return requestAnimationFrame(() => {\n      const html = element.innerHTML;\n      removeNode(element);\n      this.setSelectedRange(selectedRange);\n      return callback(html);\n    });\n  }\n\n}\n\n_defineProperty(Level0InputController, \"events\", {\n  keydown(event) {\n    if (!this.isComposing()) {\n      this.resetInputSummary();\n    }\n\n    this.inputSummary.didInput = true;\n    const keyName = keyNames$1[event.keyCode];\n\n    if (keyName) {\n      var _context2;\n\n      let context = this.keys;\n      [\"ctrl\", \"alt\", \"shift\", \"meta\"].forEach(modifier => {\n        if (event[\"\".concat(modifier, \"Key\")]) {\n          var _context;\n\n          if (modifier === \"ctrl\") {\n            modifier = \"control\";\n          }\n\n          context = (_context = context) === null || _context === void 0 ? void 0 : _context[modifier];\n        }\n      });\n\n      if (((_context2 = context) === null || _context2 === void 0 ? void 0 : _context2[keyName]) != null) {\n        this.setInputSummary({\n          keyName\n        });\n        selectionChangeObserver.reset();\n        context[keyName].call(this, event);\n      }\n    }\n\n    if (keyEventIsKeyboardCommand(event)) {\n      const character = String.fromCharCode(event.keyCode).toLowerCase();\n\n      if (character) {\n        var _this$delegate3;\n\n        const keys = [\"alt\", \"shift\"].map(modifier => {\n          if (event[\"\".concat(modifier, \"Key\")]) {\n            return modifier;\n          }\n        }).filter(key => key);\n        keys.push(character);\n\n        if ((_this$delegate3 = this.delegate) !== null && _this$delegate3 !== void 0 && _this$delegate3.inputControllerDidReceiveKeyboardCommand(keys)) {\n          event.preventDefault();\n        }\n      }\n    }\n  },\n\n  keypress(event) {\n    if (this.inputSummary.eventName != null) return;\n    if (event.metaKey) return;\n    if (event.ctrlKey && !event.altKey) return;\n    const string = stringFromKeyEvent(event);\n\n    if (string) {\n      var _this$delegate4, _this$responder9;\n\n      (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.inputControllerWillPerformTyping();\n      (_this$responder9 = this.responder) === null || _this$responder9 === void 0 ? void 0 : _this$responder9.insertString(string);\n      return this.setInputSummary({\n        textAdded: string,\n        didDelete: this.selectionIsExpanded()\n      });\n    }\n  },\n\n  textInput(event) {\n    // Handle autocapitalization\n    const {\n      data\n    } = event;\n    const {\n      textAdded\n    } = this.inputSummary;\n\n    if (textAdded && textAdded !== data && textAdded.toUpperCase() === data) {\n      var _this$responder10;\n\n      const range = this.getSelectedRange();\n      this.setSelectedRange([range[0], range[1] + textAdded.length]);\n      (_this$responder10 = this.responder) === null || _this$responder10 === void 0 ? void 0 : _this$responder10.insertString(data);\n      this.setInputSummary({\n        textAdded: data\n      });\n      return this.setSelectedRange(range);\n    }\n  },\n\n  dragenter(event) {\n    event.preventDefault();\n  },\n\n  dragstart(event) {\n    var _this$delegate5, _this$delegate5$input;\n\n    this.serializeSelectionToDataTransfer(event.dataTransfer);\n    this.draggedRange = this.getSelectedRange();\n    return (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : (_this$delegate5$input = _this$delegate5.inputControllerDidStartDrag) === null || _this$delegate5$input === void 0 ? void 0 : _this$delegate5$input.call(_this$delegate5);\n  },\n\n  dragover(event) {\n    if (this.draggedRange || this.canAcceptDataTransfer(event.dataTransfer)) {\n      event.preventDefault();\n      const draggingPoint = {\n        x: event.clientX,\n        y: event.clientY\n      };\n\n      if (!objectsAreEqual(draggingPoint, this.draggingPoint)) {\n        var _this$delegate6, _this$delegate6$input;\n\n        this.draggingPoint = draggingPoint;\n        return (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : (_this$delegate6$input = _this$delegate6.inputControllerDidReceiveDragOverPoint) === null || _this$delegate6$input === void 0 ? void 0 : _this$delegate6$input.call(_this$delegate6, this.draggingPoint);\n      }\n    }\n  },\n\n  dragend(event) {\n    var _this$delegate7, _this$delegate7$input;\n\n    (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : (_this$delegate7$input = _this$delegate7.inputControllerDidCancelDrag) === null || _this$delegate7$input === void 0 ? void 0 : _this$delegate7$input.call(_this$delegate7);\n    this.draggedRange = null;\n    this.draggingPoint = null;\n  },\n\n  drop(event) {\n    var _event$dataTransfer, _this$responder11;\n\n    event.preventDefault();\n    const files = (_event$dataTransfer = event.dataTransfer) === null || _event$dataTransfer === void 0 ? void 0 : _event$dataTransfer.files;\n    const documentJSON = event.dataTransfer.getData(\"application/x-trix-document\");\n    const point = {\n      x: event.clientX,\n      y: event.clientY\n    };\n    (_this$responder11 = this.responder) === null || _this$responder11 === void 0 ? void 0 : _this$responder11.setLocationRangeFromPointRange(point);\n\n    if (files !== null && files !== void 0 && files.length) {\n      this.attachFiles(files);\n    } else if (this.draggedRange) {\n      var _this$delegate8, _this$responder12;\n\n      (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : _this$delegate8.inputControllerWillMoveText();\n      (_this$responder12 = this.responder) === null || _this$responder12 === void 0 ? void 0 : _this$responder12.moveTextFromRange(this.draggedRange);\n      this.draggedRange = null;\n      this.requestRender();\n    } else if (documentJSON) {\n      var _this$responder13;\n\n      const document = Document.fromJSONString(documentJSON);\n      (_this$responder13 = this.responder) === null || _this$responder13 === void 0 ? void 0 : _this$responder13.insertDocument(document);\n      this.requestRender();\n    }\n\n    this.draggedRange = null;\n    this.draggingPoint = null;\n  },\n\n  cut(event) {\n    var _this$responder14;\n\n    if ((_this$responder14 = this.responder) !== null && _this$responder14 !== void 0 && _this$responder14.selectionIsExpanded()) {\n      var _this$delegate9;\n\n      if (this.serializeSelectionToDataTransfer(event.clipboardData)) {\n        event.preventDefault();\n      }\n\n      (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : _this$delegate9.inputControllerWillCutText();\n      this.deleteInDirection(\"backward\");\n\n      if (event.defaultPrevented) {\n        return this.requestRender();\n      }\n    }\n  },\n\n  copy(event) {\n    var _this$responder15;\n\n    if ((_this$responder15 = this.responder) !== null && _this$responder15 !== void 0 && _this$responder15.selectionIsExpanded()) {\n      if (this.serializeSelectionToDataTransfer(event.clipboardData)) {\n        event.preventDefault();\n      }\n    }\n  },\n\n  paste(event) {\n    const clipboard = event.clipboardData || event.testClipboardData;\n    const paste = {\n      clipboard\n    };\n\n    if (!clipboard || pasteEventIsCrippledSafariHTMLPaste(event)) {\n      this.getPastedHTMLUsingHiddenElement(html => {\n        var _this$delegate10, _this$responder16, _this$delegate11;\n\n        paste.type = \"text/html\";\n        paste.html = html;\n        (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : _this$delegate10.inputControllerWillPaste(paste);\n        (_this$responder16 = this.responder) === null || _this$responder16 === void 0 ? void 0 : _this$responder16.insertHTML(paste.html);\n        this.requestRender();\n        return (_this$delegate11 = this.delegate) === null || _this$delegate11 === void 0 ? void 0 : _this$delegate11.inputControllerDidPaste(paste);\n      });\n      return;\n    }\n\n    const href = clipboard.getData(\"URL\");\n    const html = clipboard.getData(\"text/html\");\n    const name = clipboard.getData(\"public.url-name\");\n\n    if (href) {\n      var _this$delegate12, _this$responder17, _this$delegate13;\n\n      let string;\n      paste.type = \"text/html\";\n\n      if (name) {\n        string = squishBreakableWhitespace(name).trim();\n      } else {\n        string = href;\n      }\n\n      paste.html = this.createLinkHTML(href, string);\n      (_this$delegate12 = this.delegate) === null || _this$delegate12 === void 0 ? void 0 : _this$delegate12.inputControllerWillPaste(paste);\n      this.setInputSummary({\n        textAdded: string,\n        didDelete: this.selectionIsExpanded()\n      });\n      (_this$responder17 = this.responder) === null || _this$responder17 === void 0 ? void 0 : _this$responder17.insertHTML(paste.html);\n      this.requestRender();\n      (_this$delegate13 = this.delegate) === null || _this$delegate13 === void 0 ? void 0 : _this$delegate13.inputControllerDidPaste(paste);\n    } else if (dataTransferIsPlainText(clipboard)) {\n      var _this$delegate14, _this$responder18, _this$delegate15;\n\n      paste.type = \"text/plain\";\n      paste.string = clipboard.getData(\"text/plain\");\n      (_this$delegate14 = this.delegate) === null || _this$delegate14 === void 0 ? void 0 : _this$delegate14.inputControllerWillPaste(paste);\n      this.setInputSummary({\n        textAdded: paste.string,\n        didDelete: this.selectionIsExpanded()\n      });\n      (_this$responder18 = this.responder) === null || _this$responder18 === void 0 ? void 0 : _this$responder18.insertString(paste.string);\n      this.requestRender();\n      (_this$delegate15 = this.delegate) === null || _this$delegate15 === void 0 ? void 0 : _this$delegate15.inputControllerDidPaste(paste);\n    } else if (html) {\n      var _this$delegate16, _this$responder19, _this$delegate17;\n\n      paste.type = \"text/html\";\n      paste.html = html;\n      (_this$delegate16 = this.delegate) === null || _this$delegate16 === void 0 ? void 0 : _this$delegate16.inputControllerWillPaste(paste);\n      (_this$responder19 = this.responder) === null || _this$responder19 === void 0 ? void 0 : _this$responder19.insertHTML(paste.html);\n      this.requestRender();\n      (_this$delegate17 = this.delegate) === null || _this$delegate17 === void 0 ? void 0 : _this$delegate17.inputControllerDidPaste(paste);\n    } else if (Array.from(clipboard.types).includes(\"Files\")) {\n      var _clipboard$items, _clipboard$items$, _clipboard$items$$get;\n\n      const file = (_clipboard$items = clipboard.items) === null || _clipboard$items === void 0 ? void 0 : (_clipboard$items$ = _clipboard$items[0]) === null || _clipboard$items$ === void 0 ? void 0 : (_clipboard$items$$get = _clipboard$items$.getAsFile) === null || _clipboard$items$$get === void 0 ? void 0 : _clipboard$items$$get.call(_clipboard$items$);\n\n      if (file) {\n        var _this$delegate18, _this$responder20, _this$delegate19;\n\n        const extension = extensionForFile(file);\n\n        if (!file.name && extension) {\n          file.name = \"pasted-file-\".concat(++pastedFileCount, \".\").concat(extension);\n        }\n\n        paste.type = \"File\";\n        paste.file = file;\n        (_this$delegate18 = this.delegate) === null || _this$delegate18 === void 0 ? void 0 : _this$delegate18.inputControllerWillAttachFiles();\n        (_this$responder20 = this.responder) === null || _this$responder20 === void 0 ? void 0 : _this$responder20.insertFile(paste.file);\n        this.requestRender();\n        (_this$delegate19 = this.delegate) === null || _this$delegate19 === void 0 ? void 0 : _this$delegate19.inputControllerDidPaste(paste);\n      }\n    }\n\n    event.preventDefault();\n  },\n\n  compositionstart(event) {\n    return this.getCompositionInput().start(event.data);\n  },\n\n  compositionupdate(event) {\n    return this.getCompositionInput().update(event.data);\n  },\n\n  compositionend(event) {\n    return this.getCompositionInput().end(event.data);\n  },\n\n  beforeinput(event) {\n    this.inputSummary.didInput = true;\n  },\n\n  input(event) {\n    this.inputSummary.didInput = true;\n    return event.stopPropagation();\n  }\n\n});\n\n_defineProperty(Level0InputController, \"keys\", {\n  backspace(event) {\n    var _this$delegate20;\n\n    (_this$delegate20 = this.delegate) === null || _this$delegate20 === void 0 ? void 0 : _this$delegate20.inputControllerWillPerformTyping();\n    return this.deleteInDirection(\"backward\", event);\n  },\n\n  delete(event) {\n    var _this$delegate21;\n\n    (_this$delegate21 = this.delegate) === null || _this$delegate21 === void 0 ? void 0 : _this$delegate21.inputControllerWillPerformTyping();\n    return this.deleteInDirection(\"forward\", event);\n  },\n\n  return(event) {\n    var _this$delegate22, _this$responder21;\n\n    this.setInputSummary({\n      preferDocument: true\n    });\n    (_this$delegate22 = this.delegate) === null || _this$delegate22 === void 0 ? void 0 : _this$delegate22.inputControllerWillPerformTyping();\n    return (_this$responder21 = this.responder) === null || _this$responder21 === void 0 ? void 0 : _this$responder21.insertLineBreak();\n  },\n\n  tab(event) {\n    var _this$responder22;\n\n    if ((_this$responder22 = this.responder) !== null && _this$responder22 !== void 0 && _this$responder22.canIncreaseNestingLevel()) {\n      var _this$responder23;\n\n      (_this$responder23 = this.responder) === null || _this$responder23 === void 0 ? void 0 : _this$responder23.increaseNestingLevel();\n      this.requestRender();\n      event.preventDefault();\n    }\n  },\n\n  left(event) {\n    if (this.selectionIsInCursorTarget()) {\n      var _this$responder24;\n\n      event.preventDefault();\n      return (_this$responder24 = this.responder) === null || _this$responder24 === void 0 ? void 0 : _this$responder24.moveCursorInDirection(\"backward\");\n    }\n  },\n\n  right(event) {\n    if (this.selectionIsInCursorTarget()) {\n      var _this$responder25;\n\n      event.preventDefault();\n      return (_this$responder25 = this.responder) === null || _this$responder25 === void 0 ? void 0 : _this$responder25.moveCursorInDirection(\"forward\");\n    }\n  },\n\n  control: {\n    d(event) {\n      var _this$delegate23;\n\n      (_this$delegate23 = this.delegate) === null || _this$delegate23 === void 0 ? void 0 : _this$delegate23.inputControllerWillPerformTyping();\n      return this.deleteInDirection(\"forward\", event);\n    },\n\n    h(event) {\n      var _this$delegate24;\n\n      (_this$delegate24 = this.delegate) === null || _this$delegate24 === void 0 ? void 0 : _this$delegate24.inputControllerWillPerformTyping();\n      return this.deleteInDirection(\"backward\", event);\n    },\n\n    o(event) {\n      var _this$delegate25, _this$responder26;\n\n      event.preventDefault();\n      (_this$delegate25 = this.delegate) === null || _this$delegate25 === void 0 ? void 0 : _this$delegate25.inputControllerWillPerformTyping();\n      (_this$responder26 = this.responder) === null || _this$responder26 === void 0 ? void 0 : _this$responder26.insertString(\"\\n\", {\n        updatePosition: false\n      });\n      return this.requestRender();\n    }\n\n  },\n  shift: {\n    return(event) {\n      var _this$delegate26, _this$responder27;\n\n      (_this$delegate26 = this.delegate) === null || _this$delegate26 === void 0 ? void 0 : _this$delegate26.inputControllerWillPerformTyping();\n      (_this$responder27 = this.responder) === null || _this$responder27 === void 0 ? void 0 : _this$responder27.insertString(\"\\n\");\n      this.requestRender();\n      event.preventDefault();\n    },\n\n    tab(event) {\n      var _this$responder28;\n\n      if ((_this$responder28 = this.responder) !== null && _this$responder28 !== void 0 && _this$responder28.canDecreaseNestingLevel()) {\n        var _this$responder29;\n\n        (_this$responder29 = this.responder) === null || _this$responder29 === void 0 ? void 0 : _this$responder29.decreaseNestingLevel();\n        this.requestRender();\n        event.preventDefault();\n      }\n    },\n\n    left(event) {\n      if (this.selectionIsInCursorTarget()) {\n        event.preventDefault();\n        return this.expandSelectionInDirection(\"backward\");\n      }\n    },\n\n    right(event) {\n      if (this.selectionIsInCursorTarget()) {\n        event.preventDefault();\n        return this.expandSelectionInDirection(\"forward\");\n      }\n    }\n\n  },\n  alt: {\n    backspace(event) {\n      var _this$delegate27;\n\n      this.setInputSummary({\n        preferDocument: false\n      });\n      return (_this$delegate27 = this.delegate) === null || _this$delegate27 === void 0 ? void 0 : _this$delegate27.inputControllerWillPerformTyping();\n    }\n\n  },\n  meta: {\n    backspace(event) {\n      var _this$delegate28;\n\n      this.setInputSummary({\n        preferDocument: false\n      });\n      return (_this$delegate28 = this.delegate) === null || _this$delegate28 === void 0 ? void 0 : _this$delegate28.inputControllerWillPerformTyping();\n    }\n\n  }\n});\n\nLevel0InputController.proxyMethod(\"responder?.getSelectedRange\");\nLevel0InputController.proxyMethod(\"responder?.setSelectedRange\");\nLevel0InputController.proxyMethod(\"responder?.expandSelectionInDirection\");\nLevel0InputController.proxyMethod(\"responder?.selectionIsInCursorTarget\");\nLevel0InputController.proxyMethod(\"responder?.selectionIsExpanded\");\n\nconst extensionForFile = file => {\n  var _file$type, _file$type$match;\n\n  return (_file$type = file.type) === null || _file$type === void 0 ? void 0 : (_file$type$match = _file$type.match(/\\/(\\w+)$/)) === null || _file$type$match === void 0 ? void 0 : _file$type$match[1];\n};\n\nconst hasStringCodePointAt = !!((_$codePointAt = (_ = \" \").codePointAt) !== null && _$codePointAt !== void 0 && _$codePointAt.call(_, 0));\n\nconst stringFromKeyEvent = function (event) {\n  if (event.key && hasStringCodePointAt && event.key.codePointAt(0) === event.keyCode) {\n    return event.key;\n  } else {\n    let code;\n\n    if (event.which === null) {\n      code = event.keyCode;\n    } else if (event.which !== 0 && event.charCode !== 0) {\n      code = event.charCode;\n    }\n\n    if (code != null && keyNames$1[code] !== \"escape\") {\n      return UTF16String.fromCodepoints([code]).toString();\n    }\n  }\n};\n\nconst pasteEventIsCrippledSafariHTMLPaste = function (event) {\n  const paste = event.clipboardData;\n\n  if (paste) {\n    if (paste.types.includes(\"text/html\")) {\n      // Answer is yes if there's any possibility of Paste and Match Style in Safari,\n      // which is nearly impossible to detect confidently: https://bugs.webkit.org/show_bug.cgi?id=174165\n      for (const type of paste.types) {\n        const hasPasteboardFlavor = /^CorePasteboardFlavorType/.test(type);\n        const hasReadableDynamicData = /^dyn\\./.test(type) && paste.getData(type);\n        const mightBePasteAndMatchStyle = hasPasteboardFlavor || hasReadableDynamicData;\n\n        if (mightBePasteAndMatchStyle) {\n          return true;\n        }\n      }\n\n      return false;\n    } else {\n      const isExternalHTMLPaste = paste.types.includes(\"com.apple.webarchive\");\n      const isExternalRichTextPaste = paste.types.includes(\"com.apple.flat-rtfd\");\n      return isExternalHTMLPaste || isExternalRichTextPaste;\n    }\n  }\n};\n\nclass CompositionInput extends BasicObject {\n  constructor(inputController) {\n    super(...arguments);\n    this.inputController = inputController;\n    this.responder = this.inputController.responder;\n    this.delegate = this.inputController.delegate;\n    this.inputSummary = this.inputController.inputSummary;\n    this.data = {};\n  }\n\n  start(data) {\n    this.data.start = data;\n\n    if (this.isSignificant()) {\n      var _this$responder5;\n\n      if (this.inputSummary.eventName === \"keypress\" && this.inputSummary.textAdded) {\n        var _this$responder4;\n\n        (_this$responder4 = this.responder) === null || _this$responder4 === void 0 ? void 0 : _this$responder4.deleteInDirection(\"left\");\n      }\n\n      if (!this.selectionIsExpanded()) {\n        this.insertPlaceholder();\n        this.requestRender();\n      }\n\n      this.range = (_this$responder5 = this.responder) === null || _this$responder5 === void 0 ? void 0 : _this$responder5.getSelectedRange();\n    }\n  }\n\n  update(data) {\n    this.data.update = data;\n\n    if (this.isSignificant()) {\n      const range = this.selectPlaceholder();\n\n      if (range) {\n        this.forgetPlaceholder();\n        this.range = range;\n      }\n    }\n  }\n\n  end(data) {\n    this.data.end = data;\n\n    if (this.isSignificant()) {\n      this.forgetPlaceholder();\n\n      if (this.canApplyToDocument()) {\n        var _this$delegate2, _this$responder6, _this$responder7, _this$responder8;\n\n        this.setInputSummary({\n          preferDocument: true,\n          didInput: false\n        });\n        (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : _this$delegate2.inputControllerWillPerformTyping();\n        (_this$responder6 = this.responder) === null || _this$responder6 === void 0 ? void 0 : _this$responder6.setSelectedRange(this.range);\n        (_this$responder7 = this.responder) === null || _this$responder7 === void 0 ? void 0 : _this$responder7.insertString(this.data.end);\n        return (_this$responder8 = this.responder) === null || _this$responder8 === void 0 ? void 0 : _this$responder8.setSelectedRange(this.range[0] + this.data.end.length);\n      } else if (this.data.start != null || this.data.update != null) {\n        this.requestReparse();\n        return this.inputController.reset();\n      }\n    } else {\n      return this.inputController.reset();\n    }\n  }\n\n  getEndData() {\n    return this.data.end;\n  }\n\n  isEnded() {\n    return this.getEndData() != null;\n  }\n\n  isSignificant() {\n    if (browser.composesExistingText) {\n      return this.inputSummary.didInput;\n    } else {\n      return true;\n    }\n  } // Private\n\n\n  canApplyToDocument() {\n    var _this$data$start, _this$data$end;\n\n    return ((_this$data$start = this.data.start) === null || _this$data$start === void 0 ? void 0 : _this$data$start.length) === 0 && ((_this$data$end = this.data.end) === null || _this$data$end === void 0 ? void 0 : _this$data$end.length) > 0 && this.range;\n  }\n\n}\n\nCompositionInput.proxyMethod(\"inputController.setInputSummary\");\nCompositionInput.proxyMethod(\"inputController.requestRender\");\nCompositionInput.proxyMethod(\"inputController.requestReparse\");\nCompositionInput.proxyMethod(\"responder?.selectionIsExpanded\");\nCompositionInput.proxyMethod(\"responder?.insertPlaceholder\");\nCompositionInput.proxyMethod(\"responder?.selectPlaceholder\");\nCompositionInput.proxyMethod(\"responder?.forgetPlaceholder\");\n\nclass Level2InputController extends InputController {\n  constructor() {\n    super(...arguments);\n    this.render = this.render.bind(this);\n  }\n\n  elementDidMutate() {\n    if (this.scheduledRender) {\n      if (this.composing) {\n        var _this$delegate, _this$delegate$inputC;\n\n        return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$inputC = _this$delegate.inputControllerDidAllowUnhandledInput) === null || _this$delegate$inputC === void 0 ? void 0 : _this$delegate$inputC.call(_this$delegate);\n      }\n    } else {\n      return this.reparse();\n    }\n  }\n\n  scheduleRender() {\n    return this.scheduledRender ? this.scheduledRender : this.scheduledRender = requestAnimationFrame(this.render);\n  }\n\n  render() {\n    var _this$afterRender;\n\n    cancelAnimationFrame(this.scheduledRender);\n    this.scheduledRender = null;\n\n    if (!this.composing) {\n      var _this$delegate2;\n\n      (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : _this$delegate2.render();\n    }\n\n    (_this$afterRender = this.afterRender) === null || _this$afterRender === void 0 ? void 0 : _this$afterRender.call(this);\n    this.afterRender = null;\n  }\n\n  reparse() {\n    var _this$delegate3;\n\n    return (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : _this$delegate3.reparse();\n  } // Responder helpers\n\n\n  insertString() {\n    var _this$delegate4;\n\n    let string = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n    let options = arguments.length > 1 ? arguments[1] : undefined;\n    (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.inputControllerWillPerformTyping();\n    return this.withTargetDOMRange(function () {\n      var _this$responder;\n\n      return (_this$responder = this.responder) === null || _this$responder === void 0 ? void 0 : _this$responder.insertString(string, options);\n    });\n  }\n\n  toggleAttributeIfSupported(attributeName) {\n    if (getAllAttributeNames().includes(attributeName)) {\n      var _this$delegate5;\n\n      (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.inputControllerWillPerformFormatting(attributeName);\n      return this.withTargetDOMRange(function () {\n        var _this$responder2;\n\n        return (_this$responder2 = this.responder) === null || _this$responder2 === void 0 ? void 0 : _this$responder2.toggleCurrentAttribute(attributeName);\n      });\n    }\n  }\n\n  activateAttributeIfSupported(attributeName, value) {\n    if (getAllAttributeNames().includes(attributeName)) {\n      var _this$delegate6;\n\n      (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : _this$delegate6.inputControllerWillPerformFormatting(attributeName);\n      return this.withTargetDOMRange(function () {\n        var _this$responder3;\n\n        return (_this$responder3 = this.responder) === null || _this$responder3 === void 0 ? void 0 : _this$responder3.setCurrentAttribute(attributeName, value);\n      });\n    }\n  }\n\n  deleteInDirection(direction) {\n    let {\n      recordUndoEntry\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n      recordUndoEntry: true\n    };\n\n    if (recordUndoEntry) {\n      var _this$delegate7;\n\n      (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : _this$delegate7.inputControllerWillPerformTyping();\n    }\n\n    const perform = () => {\n      var _this$responder4;\n\n      return (_this$responder4 = this.responder) === null || _this$responder4 === void 0 ? void 0 : _this$responder4.deleteInDirection(direction);\n    };\n\n    const domRange = this.getTargetDOMRange({\n      minLength: 2\n    });\n\n    if (domRange) {\n      return this.withTargetDOMRange(domRange, perform);\n    } else {\n      return perform();\n    }\n  } // Selection helpers\n\n\n  withTargetDOMRange(domRange, fn) {\n    if (typeof domRange === \"function\") {\n      fn = domRange;\n      domRange = this.getTargetDOMRange();\n    }\n\n    if (domRange) {\n      var _this$responder5;\n\n      return (_this$responder5 = this.responder) === null || _this$responder5 === void 0 ? void 0 : _this$responder5.withTargetDOMRange(domRange, fn.bind(this));\n    } else {\n      selectionChangeObserver.reset();\n      return fn.call(this);\n    }\n  }\n\n  getTargetDOMRange() {\n    var _this$event$getTarget, _this$event;\n\n    let {\n      minLength\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n      minLength: 0\n    };\n    const targetRanges = (_this$event$getTarget = (_this$event = this.event).getTargetRanges) === null || _this$event$getTarget === void 0 ? void 0 : _this$event$getTarget.call(_this$event);\n\n    if (targetRanges) {\n      if (targetRanges.length) {\n        const domRange = staticRangeToRange(targetRanges[0]);\n\n        if (minLength === 0 || domRange.toString().length >= minLength) {\n          return domRange;\n        }\n      }\n    }\n  }\n\n  withEvent(event, fn) {\n    let result;\n    this.event = event;\n\n    try {\n      result = fn.call(this);\n    } finally {\n      this.event = null;\n    }\n\n    return result;\n  }\n\n}\n\n_defineProperty(Level2InputController, \"events\", {\n  keydown(event) {\n    if (keyEventIsKeyboardCommand(event)) {\n      var _this$delegate8;\n\n      const command = keyboardCommandFromKeyEvent(event);\n\n      if ((_this$delegate8 = this.delegate) !== null && _this$delegate8 !== void 0 && _this$delegate8.inputControllerDidReceiveKeyboardCommand(command)) {\n        event.preventDefault();\n      }\n    } else {\n      let name = event.key;\n\n      if (event.altKey) {\n        name += \"+Alt\";\n      }\n\n      if (event.shiftKey) {\n        name += \"+Shift\";\n      }\n\n      const handler = this.constructor.keys[name];\n\n      if (handler) {\n        return this.withEvent(event, handler);\n      }\n    }\n  },\n\n  // Handle paste event to work around beforeinput.insertFromPaste browser bugs.\n  // Safe to remove each condition once fixed upstream.\n  paste(event) {\n    var _event$clipboardData;\n\n    // https://bugs.webkit.org/show_bug.cgi?id=194921\n    let paste;\n    const href = (_event$clipboardData = event.clipboardData) === null || _event$clipboardData === void 0 ? void 0 : _event$clipboardData.getData(\"URL\");\n\n    if (pasteEventHasFilesOnly(event)) {\n      event.preventDefault();\n      return this.attachFiles(event.clipboardData.files); // https://bugs.chromium.org/p/chromium/issues/detail?id=934448\n    } else if (pasteEventHasPlainTextOnly(event)) {\n      var _this$delegate9, _this$responder6, _this$delegate10;\n\n      event.preventDefault();\n      paste = {\n        type: \"text/plain\",\n        string: event.clipboardData.getData(\"text/plain\")\n      };\n      (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : _this$delegate9.inputControllerWillPaste(paste);\n      (_this$responder6 = this.responder) === null || _this$responder6 === void 0 ? void 0 : _this$responder6.insertString(paste.string);\n      this.render();\n      return (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : _this$delegate10.inputControllerDidPaste(paste); // https://bugs.webkit.org/show_bug.cgi?id=196702\n    } else if (href) {\n      var _this$delegate11, _this$responder7, _this$delegate12;\n\n      event.preventDefault();\n      paste = {\n        type: \"text/html\",\n        html: this.createLinkHTML(href)\n      };\n      (_this$delegate11 = this.delegate) === null || _this$delegate11 === void 0 ? void 0 : _this$delegate11.inputControllerWillPaste(paste);\n      (_this$responder7 = this.responder) === null || _this$responder7 === void 0 ? void 0 : _this$responder7.insertHTML(paste.html);\n      this.render();\n      return (_this$delegate12 = this.delegate) === null || _this$delegate12 === void 0 ? void 0 : _this$delegate12.inputControllerDidPaste(paste);\n    }\n  },\n\n  beforeinput(event) {\n    const handler = this.constructor.inputTypes[event.inputType];\n\n    if (handler) {\n      this.withEvent(event, handler);\n      return this.scheduleRender();\n    }\n  },\n\n  input(event) {\n    return selectionChangeObserver.reset();\n  },\n\n  dragstart(event) {\n    var _this$responder8;\n\n    if ((_this$responder8 = this.responder) !== null && _this$responder8 !== void 0 && _this$responder8.selectionContainsAttachments()) {\n      var _this$responder9;\n\n      event.dataTransfer.setData(\"application/x-trix-dragging\", true);\n      this.dragging = {\n        range: (_this$responder9 = this.responder) === null || _this$responder9 === void 0 ? void 0 : _this$responder9.getSelectedRange(),\n        point: pointFromEvent(event)\n      };\n    }\n  },\n\n  dragenter(event) {\n    if (dragEventHasFiles(event)) {\n      event.preventDefault();\n    }\n  },\n\n  dragover(event) {\n    if (this.dragging) {\n      event.preventDefault();\n      const point = pointFromEvent(event);\n\n      if (!objectsAreEqual(point, this.dragging.point)) {\n        var _this$responder10;\n\n        this.dragging.point = point;\n        return (_this$responder10 = this.responder) === null || _this$responder10 === void 0 ? void 0 : _this$responder10.setLocationRangeFromPointRange(point);\n      }\n    } else if (dragEventHasFiles(event)) {\n      event.preventDefault();\n    }\n  },\n\n  drop(event) {\n    if (this.dragging) {\n      var _this$delegate13, _this$responder11;\n\n      event.preventDefault();\n      (_this$delegate13 = this.delegate) === null || _this$delegate13 === void 0 ? void 0 : _this$delegate13.inputControllerWillMoveText();\n      (_this$responder11 = this.responder) === null || _this$responder11 === void 0 ? void 0 : _this$responder11.moveTextFromRange(this.dragging.range);\n      this.dragging = null;\n      return this.scheduleRender();\n    } else if (dragEventHasFiles(event)) {\n      var _this$responder12;\n\n      event.preventDefault();\n      const point = pointFromEvent(event);\n      (_this$responder12 = this.responder) === null || _this$responder12 === void 0 ? void 0 : _this$responder12.setLocationRangeFromPointRange(point);\n      return this.attachFiles(event.dataTransfer.files);\n    }\n  },\n\n  dragend() {\n    if (this.dragging) {\n      var _this$responder13;\n\n      (_this$responder13 = this.responder) === null || _this$responder13 === void 0 ? void 0 : _this$responder13.setSelectedRange(this.dragging.range);\n      this.dragging = null;\n    }\n  },\n\n  compositionend(event) {\n    if (this.composing) {\n      this.composing = false;\n      return this.scheduleRender();\n    }\n  }\n\n});\n\n_defineProperty(Level2InputController, \"keys\", {\n  ArrowLeft() {\n    var _this$responder14;\n\n    if ((_this$responder14 = this.responder) !== null && _this$responder14 !== void 0 && _this$responder14.shouldManageMovingCursorInDirection(\"backward\")) {\n      var _this$responder15;\n\n      this.event.preventDefault();\n      return (_this$responder15 = this.responder) === null || _this$responder15 === void 0 ? void 0 : _this$responder15.moveCursorInDirection(\"backward\");\n    }\n  },\n\n  ArrowRight() {\n    var _this$responder16;\n\n    if ((_this$responder16 = this.responder) !== null && _this$responder16 !== void 0 && _this$responder16.shouldManageMovingCursorInDirection(\"forward\")) {\n      var _this$responder17;\n\n      this.event.preventDefault();\n      return (_this$responder17 = this.responder) === null || _this$responder17 === void 0 ? void 0 : _this$responder17.moveCursorInDirection(\"forward\");\n    }\n  },\n\n  Backspace() {\n    var _this$responder18;\n\n    if ((_this$responder18 = this.responder) !== null && _this$responder18 !== void 0 && _this$responder18.shouldManageDeletingInDirection(\"backward\")) {\n      var _this$delegate14, _this$responder19;\n\n      this.event.preventDefault();\n      (_this$delegate14 = this.delegate) === null || _this$delegate14 === void 0 ? void 0 : _this$delegate14.inputControllerWillPerformTyping();\n      (_this$responder19 = this.responder) === null || _this$responder19 === void 0 ? void 0 : _this$responder19.deleteInDirection(\"backward\");\n      return this.render();\n    }\n  },\n\n  Tab() {\n    var _this$responder20;\n\n    if ((_this$responder20 = this.responder) !== null && _this$responder20 !== void 0 && _this$responder20.canIncreaseNestingLevel()) {\n      var _this$responder21;\n\n      this.event.preventDefault();\n      (_this$responder21 = this.responder) === null || _this$responder21 === void 0 ? void 0 : _this$responder21.increaseNestingLevel();\n      return this.render();\n    }\n  },\n\n  \"Tab+Shift\"() {\n    var _this$responder22;\n\n    if ((_this$responder22 = this.responder) !== null && _this$responder22 !== void 0 && _this$responder22.canDecreaseNestingLevel()) {\n      var _this$responder23;\n\n      this.event.preventDefault();\n      (_this$responder23 = this.responder) === null || _this$responder23 === void 0 ? void 0 : _this$responder23.decreaseNestingLevel();\n      return this.render();\n    }\n  }\n\n});\n\n_defineProperty(Level2InputController, \"inputTypes\", {\n  deleteByComposition() {\n    return this.deleteInDirection(\"backward\", {\n      recordUndoEntry: false\n    });\n  },\n\n  deleteByCut() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteByDrag() {\n    this.event.preventDefault();\n    return this.withTargetDOMRange(function () {\n      var _this$responder24;\n\n      this.deleteByDragRange = (_this$responder24 = this.responder) === null || _this$responder24 === void 0 ? void 0 : _this$responder24.getSelectedRange();\n    });\n  },\n\n  deleteCompositionText() {\n    return this.deleteInDirection(\"backward\", {\n      recordUndoEntry: false\n    });\n  },\n\n  deleteContent() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteContentBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteContentForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  deleteEntireSoftLine() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  deleteHardLineBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteHardLineForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  deleteSoftLineBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteSoftLineForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  deleteWordBackward() {\n    return this.deleteInDirection(\"backward\");\n  },\n\n  deleteWordForward() {\n    return this.deleteInDirection(\"forward\");\n  },\n\n  formatBackColor() {\n    return this.activateAttributeIfSupported(\"backgroundColor\", this.event.data);\n  },\n\n  formatBold() {\n    return this.toggleAttributeIfSupported(\"bold\");\n  },\n\n  formatFontColor() {\n    return this.activateAttributeIfSupported(\"color\", this.event.data);\n  },\n\n  formatFontName() {\n    return this.activateAttributeIfSupported(\"font\", this.event.data);\n  },\n\n  formatIndent() {\n    var _this$responder25;\n\n    if ((_this$responder25 = this.responder) !== null && _this$responder25 !== void 0 && _this$responder25.canIncreaseNestingLevel()) {\n      return this.withTargetDOMRange(function () {\n        var _this$responder26;\n\n        return (_this$responder26 = this.responder) === null || _this$responder26 === void 0 ? void 0 : _this$responder26.increaseNestingLevel();\n      });\n    }\n  },\n\n  formatItalic() {\n    return this.toggleAttributeIfSupported(\"italic\");\n  },\n\n  formatJustifyCenter() {\n    return this.toggleAttributeIfSupported(\"justifyCenter\");\n  },\n\n  formatJustifyFull() {\n    return this.toggleAttributeIfSupported(\"justifyFull\");\n  },\n\n  formatJustifyLeft() {\n    return this.toggleAttributeIfSupported(\"justifyLeft\");\n  },\n\n  formatJustifyRight() {\n    return this.toggleAttributeIfSupported(\"justifyRight\");\n  },\n\n  formatOutdent() {\n    var _this$responder27;\n\n    if ((_this$responder27 = this.responder) !== null && _this$responder27 !== void 0 && _this$responder27.canDecreaseNestingLevel()) {\n      return this.withTargetDOMRange(function () {\n        var _this$responder28;\n\n        return (_this$responder28 = this.responder) === null || _this$responder28 === void 0 ? void 0 : _this$responder28.decreaseNestingLevel();\n      });\n    }\n  },\n\n  formatRemove() {\n    this.withTargetDOMRange(function () {\n      for (const attributeName in (_this$responder29 = this.responder) === null || _this$responder29 === void 0 ? void 0 : _this$responder29.getCurrentAttributes()) {\n        var _this$responder29, _this$responder30;\n\n        (_this$responder30 = this.responder) === null || _this$responder30 === void 0 ? void 0 : _this$responder30.removeCurrentAttribute(attributeName);\n      }\n    });\n  },\n\n  formatSetBlockTextDirection() {\n    return this.activateAttributeIfSupported(\"blockDir\", this.event.data);\n  },\n\n  formatSetInlineTextDirection() {\n    return this.activateAttributeIfSupported(\"textDir\", this.event.data);\n  },\n\n  formatStrikeThrough() {\n    return this.toggleAttributeIfSupported(\"strike\");\n  },\n\n  formatSubscript() {\n    return this.toggleAttributeIfSupported(\"sub\");\n  },\n\n  formatSuperscript() {\n    return this.toggleAttributeIfSupported(\"sup\");\n  },\n\n  formatUnderline() {\n    return this.toggleAttributeIfSupported(\"underline\");\n  },\n\n  historyRedo() {\n    var _this$delegate15;\n\n    return (_this$delegate15 = this.delegate) === null || _this$delegate15 === void 0 ? void 0 : _this$delegate15.inputControllerWillPerformRedo();\n  },\n\n  historyUndo() {\n    var _this$delegate16;\n\n    return (_this$delegate16 = this.delegate) === null || _this$delegate16 === void 0 ? void 0 : _this$delegate16.inputControllerWillPerformUndo();\n  },\n\n  insertCompositionText() {\n    this.composing = true;\n    return this.insertString(this.event.data);\n  },\n\n  insertFromComposition() {\n    this.composing = false;\n    return this.insertString(this.event.data);\n  },\n\n  insertFromDrop() {\n    const range = this.deleteByDragRange;\n\n    if (range) {\n      var _this$delegate17;\n\n      this.deleteByDragRange = null;\n      (_this$delegate17 = this.delegate) === null || _this$delegate17 === void 0 ? void 0 : _this$delegate17.inputControllerWillMoveText();\n      return this.withTargetDOMRange(function () {\n        var _this$responder31;\n\n        return (_this$responder31 = this.responder) === null || _this$responder31 === void 0 ? void 0 : _this$responder31.moveTextFromRange(range);\n      });\n    }\n  },\n\n  insertFromPaste() {\n    var _dataTransfer$files;\n\n    const {\n      dataTransfer\n    } = this.event;\n    const paste = {\n      dataTransfer\n    };\n    const href = dataTransfer.getData(\"URL\");\n    const html = dataTransfer.getData(\"text/html\");\n\n    if (href) {\n      var _this$delegate18;\n\n      let string;\n      this.event.preventDefault();\n      paste.type = \"text/html\";\n      const name = dataTransfer.getData(\"public.url-name\");\n\n      if (name) {\n        string = squishBreakableWhitespace(name).trim();\n      } else {\n        string = href;\n      }\n\n      paste.html = this.createLinkHTML(href, string);\n      (_this$delegate18 = this.delegate) === null || _this$delegate18 === void 0 ? void 0 : _this$delegate18.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder32;\n\n        return (_this$responder32 = this.responder) === null || _this$responder32 === void 0 ? void 0 : _this$responder32.insertHTML(paste.html);\n      });\n\n      this.afterRender = () => {\n        var _this$delegate19;\n\n        return (_this$delegate19 = this.delegate) === null || _this$delegate19 === void 0 ? void 0 : _this$delegate19.inputControllerDidPaste(paste);\n      };\n    } else if (dataTransferIsPlainText(dataTransfer)) {\n      var _this$delegate20;\n\n      paste.type = \"text/plain\";\n      paste.string = dataTransfer.getData(\"text/plain\");\n      (_this$delegate20 = this.delegate) === null || _this$delegate20 === void 0 ? void 0 : _this$delegate20.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder33;\n\n        return (_this$responder33 = this.responder) === null || _this$responder33 === void 0 ? void 0 : _this$responder33.insertString(paste.string);\n      });\n\n      this.afterRender = () => {\n        var _this$delegate21;\n\n        return (_this$delegate21 = this.delegate) === null || _this$delegate21 === void 0 ? void 0 : _this$delegate21.inputControllerDidPaste(paste);\n      };\n    } else if (html) {\n      var _this$delegate22;\n\n      this.event.preventDefault();\n      paste.type = \"text/html\";\n      paste.html = html;\n      (_this$delegate22 = this.delegate) === null || _this$delegate22 === void 0 ? void 0 : _this$delegate22.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder34;\n\n        return (_this$responder34 = this.responder) === null || _this$responder34 === void 0 ? void 0 : _this$responder34.insertHTML(paste.html);\n      });\n\n      this.afterRender = () => {\n        var _this$delegate23;\n\n        return (_this$delegate23 = this.delegate) === null || _this$delegate23 === void 0 ? void 0 : _this$delegate23.inputControllerDidPaste(paste);\n      };\n    } else if ((_dataTransfer$files = dataTransfer.files) !== null && _dataTransfer$files !== void 0 && _dataTransfer$files.length) {\n      var _this$delegate24;\n\n      paste.type = \"File\";\n      paste.file = dataTransfer.files[0];\n      (_this$delegate24 = this.delegate) === null || _this$delegate24 === void 0 ? void 0 : _this$delegate24.inputControllerWillPaste(paste);\n      this.withTargetDOMRange(function () {\n        var _this$responder35;\n\n        return (_this$responder35 = this.responder) === null || _this$responder35 === void 0 ? void 0 : _this$responder35.insertFile(paste.file);\n      });\n\n      this.afterRender = () => {\n        var _this$delegate25;\n\n        return (_this$delegate25 = this.delegate) === null || _this$delegate25 === void 0 ? void 0 : _this$delegate25.inputControllerDidPaste(paste);\n      };\n    }\n  },\n\n  insertFromYank() {\n    return this.insertString(this.event.data);\n  },\n\n  insertLineBreak() {\n    return this.insertString(\"\\n\");\n  },\n\n  insertLink() {\n    return this.activateAttributeIfSupported(\"href\", this.event.data);\n  },\n\n  insertOrderedList() {\n    return this.toggleAttributeIfSupported(\"number\");\n  },\n\n  insertParagraph() {\n    var _this$delegate26;\n\n    (_this$delegate26 = this.delegate) === null || _this$delegate26 === void 0 ? void 0 : _this$delegate26.inputControllerWillPerformTyping();\n    return this.withTargetDOMRange(function () {\n      var _this$responder36;\n\n      return (_this$responder36 = this.responder) === null || _this$responder36 === void 0 ? void 0 : _this$responder36.insertLineBreak();\n    });\n  },\n\n  insertReplacementText() {\n    return this.insertString(this.event.dataTransfer.getData(\"text/plain\"), {\n      updatePosition: false\n    });\n  },\n\n  insertText() {\n    var _this$event$dataTrans;\n\n    return this.insertString(this.event.data || ((_this$event$dataTrans = this.event.dataTransfer) === null || _this$event$dataTrans === void 0 ? void 0 : _this$event$dataTrans.getData(\"text/plain\")));\n  },\n\n  insertTranspose() {\n    return this.insertString(this.event.data);\n  },\n\n  insertUnorderedList() {\n    return this.toggleAttributeIfSupported(\"bullet\");\n  }\n\n});\n\nconst staticRangeToRange = function (staticRange) {\n  const range = document.createRange();\n  range.setStart(staticRange.startContainer, staticRange.startOffset);\n  range.setEnd(staticRange.endContainer, staticRange.endOffset);\n  return range;\n}; // Event helpers\n\n\nconst dragEventHasFiles = event => {\n  var _event$dataTransfer;\n\n  return Array.from(((_event$dataTransfer = event.dataTransfer) === null || _event$dataTransfer === void 0 ? void 0 : _event$dataTransfer.types) || []).includes(\"Files\");\n};\n\nconst pasteEventHasFilesOnly = function (event) {\n  const clipboard = event.clipboardData;\n\n  if (clipboard) {\n    return clipboard.types.includes(\"Files\") && clipboard.types.length === 1 && clipboard.files.length >= 1;\n  }\n};\n\nconst pasteEventHasPlainTextOnly = function (event) {\n  const clipboard = event.clipboardData;\n\n  if (clipboard) {\n    return clipboard.types.includes(\"text/plain\") && clipboard.types.length === 1;\n  }\n};\n\nconst keyboardCommandFromKeyEvent = function (event) {\n  const command = [];\n\n  if (event.altKey) {\n    command.push(\"alt\");\n  }\n\n  if (event.shiftKey) {\n    command.push(\"shift\");\n  }\n\n  command.push(event.key);\n  return command;\n};\n\nconst pointFromEvent = event => ({\n  x: event.clientX,\n  y: event.clientY\n});\n\nconst {\n  lang,\n  css,\n  keyNames\n} = config;\n\nconst undoable = function (fn) {\n  return function () {\n    const commands = fn.apply(this, arguments);\n    commands.do();\n\n    if (!this.undos) {\n      this.undos = [];\n    }\n\n    this.undos.push(commands.undo);\n  };\n};\n\nclass AttachmentEditorController extends BasicObject {\n  constructor(attachmentPiece, _element, container) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    super(...arguments);\n\n    _defineProperty(this, \"makeElementMutable\", undoable(() => {\n      return {\n        do: () => {\n          this.element.dataset.trixMutable = true;\n        },\n        undo: () => delete this.element.dataset.trixMutable\n      };\n    }));\n\n    _defineProperty(this, \"addToolbar\", undoable(() => {\n      // <div class=\"#{css.attachmentMetadataContainer}\" data-trix-mutable=\"true\">\n      //   <div class=\"trix-button-row\">\n      //     <span class=\"trix-button-group trix-button-group--actions\">\n      //       <button type=\"button\" class=\"trix-button trix-button--remove\" title=\"#{lang.remove}\" data-trix-action=\"remove\">#{lang.remove}</button>\n      //     </span>\n      //   </div>\n      // </div>\n      const element = makeElement({\n        tagName: \"div\",\n        className: css.attachmentToolbar,\n        data: {\n          trixMutable: true\n        },\n        childNodes: makeElement({\n          tagName: \"div\",\n          className: \"trix-button-row\",\n          childNodes: makeElement({\n            tagName: \"span\",\n            className: \"trix-button-group trix-button-group--actions\",\n            childNodes: makeElement({\n              tagName: \"button\",\n              className: \"trix-button trix-button--remove\",\n              textContent: lang.remove,\n              attributes: {\n                title: lang.remove\n              },\n              data: {\n                trixAction: \"remove\"\n              }\n            })\n          })\n        })\n      });\n\n      if (this.attachment.isPreviewable()) {\n        // <div class=\"#{css.attachmentMetadataContainer}\">\n        //   <span class=\"#{css.attachmentMetadata}\">\n        //     <span class=\"#{css.attachmentName}\" title=\"#{name}\">#{name}</span>\n        //     <span class=\"#{css.attachmentSize}\">#{size}</span>\n        //   </span>\n        // </div>\n        element.appendChild(makeElement({\n          tagName: \"div\",\n          className: css.attachmentMetadataContainer,\n          childNodes: makeElement({\n            tagName: \"span\",\n            className: css.attachmentMetadata,\n            childNodes: [makeElement({\n              tagName: \"span\",\n              className: css.attachmentName,\n              textContent: this.attachment.getFilename(),\n              attributes: {\n                title: this.attachment.getFilename()\n              }\n            }), makeElement({\n              tagName: \"span\",\n              className: css.attachmentSize,\n              textContent: this.attachment.getFormattedFilesize()\n            })]\n          })\n        }));\n      }\n\n      handleEvent(\"click\", {\n        onElement: element,\n        withCallback: this.didClickToolbar\n      });\n      handleEvent(\"click\", {\n        onElement: element,\n        matchingSelector: \"[data-trix-action]\",\n        withCallback: this.didClickActionButton\n      });\n      return {\n        do: () => this.element.appendChild(element),\n        undo: () => removeNode(element)\n      };\n    }));\n\n    _defineProperty(this, \"installCaptionEditor\", undoable(() => {\n      const textarea = makeElement({\n        tagName: \"textarea\",\n        className: css.attachmentCaptionEditor,\n        attributes: {\n          placeholder: lang.captionPlaceholder\n        },\n        data: {\n          trixMutable: true\n        }\n      });\n      textarea.value = this.attachmentPiece.getCaption();\n      const textareaClone = textarea.cloneNode();\n      textareaClone.classList.add(\"trix-autoresize-clone\");\n      textareaClone.tabIndex = -1;\n\n      const autoresize = function () {\n        textareaClone.value = textarea.value;\n        textarea.style.height = textareaClone.scrollHeight + \"px\";\n      };\n\n      handleEvent(\"input\", {\n        onElement: textarea,\n        withCallback: autoresize\n      });\n      handleEvent(\"input\", {\n        onElement: textarea,\n        withCallback: this.didInputCaption\n      });\n      handleEvent(\"keydown\", {\n        onElement: textarea,\n        withCallback: this.didKeyDownCaption\n      });\n      handleEvent(\"change\", {\n        onElement: textarea,\n        withCallback: this.didChangeCaption\n      });\n      handleEvent(\"blur\", {\n        onElement: textarea,\n        withCallback: this.didBlurCaption\n      });\n      const figcaption = this.element.querySelector(\"figcaption\");\n      const editingFigcaption = figcaption.cloneNode();\n      return {\n        do: () => {\n          figcaption.style.display = \"none\";\n          editingFigcaption.appendChild(textarea);\n          editingFigcaption.appendChild(textareaClone);\n          editingFigcaption.classList.add(\"\".concat(css.attachmentCaption, \"--editing\"));\n          figcaption.parentElement.insertBefore(editingFigcaption, figcaption);\n          autoresize();\n\n          if (this.options.editCaption) {\n            return defer(() => textarea.focus());\n          }\n        },\n\n        undo() {\n          removeNode(editingFigcaption);\n          figcaption.style.display = null;\n        }\n\n      };\n    }));\n\n    this.didClickToolbar = this.didClickToolbar.bind(this);\n    this.didClickActionButton = this.didClickActionButton.bind(this);\n    this.didKeyDownCaption = this.didKeyDownCaption.bind(this);\n    this.didInputCaption = this.didInputCaption.bind(this);\n    this.didChangeCaption = this.didChangeCaption.bind(this);\n    this.didBlurCaption = this.didBlurCaption.bind(this);\n    this.attachmentPiece = attachmentPiece;\n    this.element = _element;\n    this.container = container;\n    this.options = options;\n    this.attachment = this.attachmentPiece.attachment;\n\n    if (tagName(this.element) === \"a\") {\n      this.element = this.element.firstChild;\n    }\n\n    this.install();\n  }\n\n  install() {\n    this.makeElementMutable();\n    this.addToolbar();\n\n    if (this.attachment.isPreviewable()) {\n      this.installCaptionEditor();\n    }\n  }\n\n  uninstall() {\n    var _this$delegate;\n\n    let undo = this.undos.pop();\n    this.savePendingCaption();\n\n    while (undo) {\n      undo();\n      undo = this.undos.pop();\n    }\n\n    (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : _this$delegate.didUninstallAttachmentEditor(this);\n  } // Private\n\n\n  savePendingCaption() {\n    if (this.pendingCaption) {\n      const caption = this.pendingCaption;\n      this.pendingCaption = null;\n\n      if (caption) {\n        var _this$delegate2, _this$delegate2$attac;\n\n        (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$attac = _this$delegate2.attachmentEditorDidRequestUpdatingAttributesForAttachment) === null || _this$delegate2$attac === void 0 ? void 0 : _this$delegate2$attac.call(_this$delegate2, {\n          caption\n        }, this.attachment);\n      } else {\n        var _this$delegate3, _this$delegate3$attac;\n\n        (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : (_this$delegate3$attac = _this$delegate3.attachmentEditorDidRequestRemovingAttributeForAttachment) === null || _this$delegate3$attac === void 0 ? void 0 : _this$delegate3$attac.call(_this$delegate3, \"caption\", this.attachment);\n      }\n    }\n  } // Installing and uninstalling\n\n\n  // Event handlers\n  didClickToolbar(event) {\n    event.preventDefault();\n    return event.stopPropagation();\n  }\n\n  didClickActionButton(event) {\n    var _this$delegate4;\n\n    const action = event.target.getAttribute(\"data-trix-action\");\n\n    switch (action) {\n      case \"remove\":\n        return (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.attachmentEditorDidRequestRemovalOfAttachment(this.attachment);\n    }\n  }\n\n  didKeyDownCaption(event) {\n    if (keyNames[event.keyCode] === \"return\") {\n      var _this$delegate5, _this$delegate5$attac;\n\n      event.preventDefault();\n      this.savePendingCaption();\n      return (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : (_this$delegate5$attac = _this$delegate5.attachmentEditorDidRequestDeselectingAttachment) === null || _this$delegate5$attac === void 0 ? void 0 : _this$delegate5$attac.call(_this$delegate5, this.attachment);\n    }\n  }\n\n  didInputCaption(event) {\n    this.pendingCaption = event.target.value.replace(/\\s/g, \" \").trim();\n  }\n\n  didChangeCaption(event) {\n    return this.savePendingCaption();\n  }\n\n  didBlurCaption(event) {\n    return this.savePendingCaption();\n  }\n\n}\n\nclass CompositionController extends BasicObject {\n  constructor(element, composition) {\n    super(...arguments);\n    this.didFocus = this.didFocus.bind(this);\n    this.didBlur = this.didBlur.bind(this);\n    this.didClickAttachment = this.didClickAttachment.bind(this);\n    this.element = element;\n    this.composition = composition;\n    this.documentView = new DocumentView(this.composition.document, {\n      element: this.element\n    });\n    handleEvent(\"focus\", {\n      onElement: this.element,\n      withCallback: this.didFocus\n    });\n    handleEvent(\"blur\", {\n      onElement: this.element,\n      withCallback: this.didBlur\n    });\n    handleEvent(\"click\", {\n      onElement: this.element,\n      matchingSelector: \"a[contenteditable=false]\",\n      preventDefault: true\n    });\n    handleEvent(\"mousedown\", {\n      onElement: this.element,\n      matchingSelector: attachmentSelector,\n      withCallback: this.didClickAttachment\n    });\n    handleEvent(\"click\", {\n      onElement: this.element,\n      matchingSelector: \"a\".concat(attachmentSelector),\n      preventDefault: true\n    });\n  }\n\n  didFocus(event) {\n    var _this$blurPromise;\n\n    const perform = () => {\n      if (!this.focused) {\n        var _this$delegate, _this$delegate$compos;\n\n        this.focused = true;\n        return (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : (_this$delegate$compos = _this$delegate.compositionControllerDidFocus) === null || _this$delegate$compos === void 0 ? void 0 : _this$delegate$compos.call(_this$delegate);\n      }\n    };\n\n    return ((_this$blurPromise = this.blurPromise) === null || _this$blurPromise === void 0 ? void 0 : _this$blurPromise.then(perform)) || perform();\n  }\n\n  didBlur(event) {\n    this.blurPromise = new Promise(resolve => {\n      return defer(() => {\n        if (!innerElementIsActive(this.element)) {\n          var _this$delegate2, _this$delegate2$compo;\n\n          this.focused = null;\n          (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : (_this$delegate2$compo = _this$delegate2.compositionControllerDidBlur) === null || _this$delegate2$compo === void 0 ? void 0 : _this$delegate2$compo.call(_this$delegate2);\n        }\n\n        this.blurPromise = null;\n        return resolve();\n      });\n    });\n  }\n\n  didClickAttachment(event, target) {\n    var _this$delegate3, _this$delegate3$compo;\n\n    const attachment = this.findAttachmentForElement(target);\n    const editCaption = !!findClosestElementFromNode(event.target, {\n      matchingSelector: \"figcaption\"\n    });\n    return (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : (_this$delegate3$compo = _this$delegate3.compositionControllerDidSelectAttachment) === null || _this$delegate3$compo === void 0 ? void 0 : _this$delegate3$compo.call(_this$delegate3, attachment, {\n      editCaption\n    });\n  }\n\n  getSerializableElement() {\n    if (this.isEditingAttachment()) {\n      return this.documentView.shadowElement;\n    } else {\n      return this.element;\n    }\n  }\n\n  render() {\n    var _this$delegate6, _this$delegate6$compo;\n\n    if (this.revision !== this.composition.revision) {\n      this.documentView.setDocument(this.composition.document);\n      this.documentView.render();\n      this.revision = this.composition.revision;\n    }\n\n    if (this.canSyncDocumentView() && !this.documentView.isSynced()) {\n      var _this$delegate4, _this$delegate4$compo, _this$delegate5, _this$delegate5$compo;\n\n      (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : (_this$delegate4$compo = _this$delegate4.compositionControllerWillSyncDocumentView) === null || _this$delegate4$compo === void 0 ? void 0 : _this$delegate4$compo.call(_this$delegate4);\n      this.documentView.sync();\n      (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : (_this$delegate5$compo = _this$delegate5.compositionControllerDidSyncDocumentView) === null || _this$delegate5$compo === void 0 ? void 0 : _this$delegate5$compo.call(_this$delegate5);\n    }\n\n    return (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : (_this$delegate6$compo = _this$delegate6.compositionControllerDidRender) === null || _this$delegate6$compo === void 0 ? void 0 : _this$delegate6$compo.call(_this$delegate6);\n  }\n\n  rerenderViewForObject(object) {\n    this.invalidateViewForObject(object);\n    return this.render();\n  }\n\n  invalidateViewForObject(object) {\n    return this.documentView.invalidateViewForObject(object);\n  }\n\n  isViewCachingEnabled() {\n    return this.documentView.isViewCachingEnabled();\n  }\n\n  enableViewCaching() {\n    return this.documentView.enableViewCaching();\n  }\n\n  disableViewCaching() {\n    return this.documentView.disableViewCaching();\n  }\n\n  refreshViewCache() {\n    return this.documentView.garbageCollectCachedViews();\n  } // Attachment editor management\n\n\n  isEditingAttachment() {\n    return !!this.attachmentEditor;\n  }\n\n  installAttachmentEditorForAttachment(attachment, options) {\n    var _this$attachmentEdito;\n\n    if (((_this$attachmentEdito = this.attachmentEditor) === null || _this$attachmentEdito === void 0 ? void 0 : _this$attachmentEdito.attachment) === attachment) return;\n    const element = this.documentView.findElementForObject(attachment);\n    if (!element) return;\n    this.uninstallAttachmentEditor();\n    const attachmentPiece = this.composition.document.getAttachmentPieceForAttachment(attachment);\n    this.attachmentEditor = new AttachmentEditorController(attachmentPiece, element, this.element, options);\n    this.attachmentEditor.delegate = this;\n  }\n\n  uninstallAttachmentEditor() {\n    var _this$attachmentEdito2;\n\n    return (_this$attachmentEdito2 = this.attachmentEditor) === null || _this$attachmentEdito2 === void 0 ? void 0 : _this$attachmentEdito2.uninstall();\n  } // Attachment controller delegate\n\n\n  didUninstallAttachmentEditor() {\n    this.attachmentEditor = null;\n    return this.render();\n  }\n\n  attachmentEditorDidRequestUpdatingAttributesForAttachment(attributes, attachment) {\n    var _this$delegate7, _this$delegate7$compo;\n\n    (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : (_this$delegate7$compo = _this$delegate7.compositionControllerWillUpdateAttachment) === null || _this$delegate7$compo === void 0 ? void 0 : _this$delegate7$compo.call(_this$delegate7, attachment);\n    return this.composition.updateAttributesForAttachment(attributes, attachment);\n  }\n\n  attachmentEditorDidRequestRemovingAttributeForAttachment(attribute, attachment) {\n    var _this$delegate8, _this$delegate8$compo;\n\n    (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : (_this$delegate8$compo = _this$delegate8.compositionControllerWillUpdateAttachment) === null || _this$delegate8$compo === void 0 ? void 0 : _this$delegate8$compo.call(_this$delegate8, attachment);\n    return this.composition.removeAttributeForAttachment(attribute, attachment);\n  }\n\n  attachmentEditorDidRequestRemovalOfAttachment(attachment) {\n    var _this$delegate9, _this$delegate9$compo;\n\n    return (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : (_this$delegate9$compo = _this$delegate9.compositionControllerDidRequestRemovalOfAttachment) === null || _this$delegate9$compo === void 0 ? void 0 : _this$delegate9$compo.call(_this$delegate9, attachment);\n  }\n\n  attachmentEditorDidRequestDeselectingAttachment(attachment) {\n    var _this$delegate10, _this$delegate10$comp;\n\n    return (_this$delegate10 = this.delegate) === null || _this$delegate10 === void 0 ? void 0 : (_this$delegate10$comp = _this$delegate10.compositionControllerDidRequestDeselectingAttachment) === null || _this$delegate10$comp === void 0 ? void 0 : _this$delegate10$comp.call(_this$delegate10, attachment);\n  } // Private\n\n\n  canSyncDocumentView() {\n    return !this.isEditingAttachment();\n  }\n\n  findAttachmentForElement(element) {\n    return this.composition.document.getAttachmentById(parseInt(element.dataset.trixId, 10));\n  }\n\n}\n\nconst attributeButtonSelector = \"[data-trix-attribute]\";\nconst actionButtonSelector = \"[data-trix-action]\";\nconst toolbarButtonSelector = \"\".concat(attributeButtonSelector, \", \").concat(actionButtonSelector);\nconst dialogSelector = \"[data-trix-dialog]\";\nconst activeDialogSelector = \"\".concat(dialogSelector, \"[data-trix-active]\");\nconst dialogButtonSelector = \"\".concat(dialogSelector, \" [data-trix-method]\");\nconst dialogInputSelector = \"\".concat(dialogSelector, \" [data-trix-input]\");\n\nconst getInputForDialog = (element, attributeName) => {\n  if (!attributeName) {\n    attributeName = getAttributeName(element);\n  }\n\n  return element.querySelector(\"[data-trix-input][name='\".concat(attributeName, \"']\"));\n};\n\nconst getActionName = element => element.getAttribute(\"data-trix-action\");\n\nconst getAttributeName = element => {\n  return element.getAttribute(\"data-trix-attribute\") || element.getAttribute(\"data-trix-dialog-attribute\");\n};\n\nconst getDialogName = element => element.getAttribute(\"data-trix-dialog\");\n\nclass ToolbarController extends BasicObject {\n  constructor(element) {\n    super(element);\n    this.didClickActionButton = this.didClickActionButton.bind(this);\n    this.didClickAttributeButton = this.didClickAttributeButton.bind(this);\n    this.didClickDialogButton = this.didClickDialogButton.bind(this);\n    this.didKeyDownDialogInput = this.didKeyDownDialogInput.bind(this);\n    this.element = element;\n    this.attributes = {};\n    this.actions = {};\n    this.resetDialogInputs();\n    handleEvent(\"mousedown\", {\n      onElement: this.element,\n      matchingSelector: actionButtonSelector,\n      withCallback: this.didClickActionButton\n    });\n    handleEvent(\"mousedown\", {\n      onElement: this.element,\n      matchingSelector: attributeButtonSelector,\n      withCallback: this.didClickAttributeButton\n    });\n    handleEvent(\"click\", {\n      onElement: this.element,\n      matchingSelector: toolbarButtonSelector,\n      preventDefault: true\n    });\n    handleEvent(\"click\", {\n      onElement: this.element,\n      matchingSelector: dialogButtonSelector,\n      withCallback: this.didClickDialogButton\n    });\n    handleEvent(\"keydown\", {\n      onElement: this.element,\n      matchingSelector: dialogInputSelector,\n      withCallback: this.didKeyDownDialogInput\n    });\n  } // Event handlers\n\n\n  didClickActionButton(event, element) {\n    var _this$delegate;\n\n    (_this$delegate = this.delegate) === null || _this$delegate === void 0 ? void 0 : _this$delegate.toolbarDidClickButton();\n    event.preventDefault();\n    const actionName = getActionName(element);\n\n    if (this.getDialog(actionName)) {\n      return this.toggleDialog(actionName);\n    } else {\n      var _this$delegate2;\n\n      return (_this$delegate2 = this.delegate) === null || _this$delegate2 === void 0 ? void 0 : _this$delegate2.toolbarDidInvokeAction(actionName);\n    }\n  }\n\n  didClickAttributeButton(event, element) {\n    var _this$delegate3;\n\n    (_this$delegate3 = this.delegate) === null || _this$delegate3 === void 0 ? void 0 : _this$delegate3.toolbarDidClickButton();\n    event.preventDefault();\n    const attributeName = getAttributeName(element);\n\n    if (this.getDialog(attributeName)) {\n      this.toggleDialog(attributeName);\n    } else {\n      var _this$delegate4;\n\n      (_this$delegate4 = this.delegate) === null || _this$delegate4 === void 0 ? void 0 : _this$delegate4.toolbarDidToggleAttribute(attributeName);\n    }\n\n    return this.refreshAttributeButtons();\n  }\n\n  didClickDialogButton(event, element) {\n    const dialogElement = findClosestElementFromNode(element, {\n      matchingSelector: dialogSelector\n    });\n    const method = element.getAttribute(\"data-trix-method\");\n    return this[method].call(this, dialogElement);\n  }\n\n  didKeyDownDialogInput(event, element) {\n    if (event.keyCode === 13) {\n      // Enter key\n      event.preventDefault();\n      const attribute = element.getAttribute(\"name\");\n      const dialog = this.getDialog(attribute);\n      this.setAttribute(dialog);\n    }\n\n    if (event.keyCode === 27) {\n      // Escape key\n      event.preventDefault();\n      return this.hideDialog();\n    }\n  } // Action buttons\n\n\n  updateActions(actions) {\n    this.actions = actions;\n    return this.refreshActionButtons();\n  }\n\n  refreshActionButtons() {\n    return this.eachActionButton((element, actionName) => {\n      element.disabled = this.actions[actionName] === false;\n    });\n  }\n\n  eachActionButton(callback) {\n    return Array.from(this.element.querySelectorAll(actionButtonSelector)).map(element => callback(element, getActionName(element)));\n  } // Attribute buttons\n\n\n  updateAttributes(attributes) {\n    this.attributes = attributes;\n    return this.refreshAttributeButtons();\n  }\n\n  refreshAttributeButtons() {\n    return this.eachAttributeButton((element, attributeName) => {\n      element.disabled = this.attributes[attributeName] === false;\n\n      if (this.attributes[attributeName] || this.dialogIsVisible(attributeName)) {\n        element.setAttribute(\"data-trix-active\", \"\");\n        return element.classList.add(\"trix-active\");\n      } else {\n        element.removeAttribute(\"data-trix-active\");\n        return element.classList.remove(\"trix-active\");\n      }\n    });\n  }\n\n  eachAttributeButton(callback) {\n    return Array.from(this.element.querySelectorAll(attributeButtonSelector)).map(element => callback(element, getAttributeName(element)));\n  }\n\n  applyKeyboardCommand(keys) {\n    const keyString = JSON.stringify(keys.sort());\n\n    for (const button of Array.from(this.element.querySelectorAll(\"[data-trix-key]\"))) {\n      const buttonKeys = button.getAttribute(\"data-trix-key\").split(\"+\");\n      const buttonKeyString = JSON.stringify(buttonKeys.sort());\n\n      if (buttonKeyString === keyString) {\n        triggerEvent(\"mousedown\", {\n          onElement: button\n        });\n        return true;\n      }\n    }\n\n    return false;\n  } // Dialogs\n\n\n  dialogIsVisible(dialogName) {\n    const element = this.getDialog(dialogName);\n\n    if (element) {\n      return element.hasAttribute(\"data-trix-active\");\n    }\n  }\n\n  toggleDialog(dialogName) {\n    if (this.dialogIsVisible(dialogName)) {\n      return this.hideDialog();\n    } else {\n      return this.showDialog(dialogName);\n    }\n  }\n\n  showDialog(dialogName) {\n    var _this$delegate5, _this$delegate6;\n\n    this.hideDialog();\n    (_this$delegate5 = this.delegate) === null || _this$delegate5 === void 0 ? void 0 : _this$delegate5.toolbarWillShowDialog();\n    const element = this.getDialog(dialogName);\n    element.setAttribute(\"data-trix-active\", \"\");\n    element.classList.add(\"trix-active\");\n    Array.from(element.querySelectorAll(\"input[disabled]\")).forEach(disabledInput => {\n      disabledInput.removeAttribute(\"disabled\");\n    });\n    const attributeName = getAttributeName(element);\n\n    if (attributeName) {\n      const input = getInputForDialog(element, dialogName);\n\n      if (input) {\n        input.value = this.attributes[attributeName] || \"\";\n        input.select();\n      }\n    }\n\n    return (_this$delegate6 = this.delegate) === null || _this$delegate6 === void 0 ? void 0 : _this$delegate6.toolbarDidShowDialog(dialogName);\n  }\n\n  setAttribute(dialogElement) {\n    const attributeName = getAttributeName(dialogElement);\n    const input = getInputForDialog(dialogElement, attributeName);\n\n    if (input.willValidate && !input.checkValidity()) {\n      input.setAttribute(\"data-trix-validate\", \"\");\n      input.classList.add(\"trix-validate\");\n      return input.focus();\n    } else {\n      var _this$delegate7;\n\n      (_this$delegate7 = this.delegate) === null || _this$delegate7 === void 0 ? void 0 : _this$delegate7.toolbarDidUpdateAttribute(attributeName, input.value);\n      return this.hideDialog();\n    }\n  }\n\n  removeAttribute(dialogElement) {\n    var _this$delegate8;\n\n    const attributeName = getAttributeName(dialogElement);\n    (_this$delegate8 = this.delegate) === null || _this$delegate8 === void 0 ? void 0 : _this$delegate8.toolbarDidRemoveAttribute(attributeName);\n    return this.hideDialog();\n  }\n\n  hideDialog() {\n    const element = this.element.querySelector(activeDialogSelector);\n\n    if (element) {\n      var _this$delegate9;\n\n      element.removeAttribute(\"data-trix-active\");\n      element.classList.remove(\"trix-active\");\n      this.resetDialogInputs();\n      return (_this$delegate9 = this.delegate) === null || _this$delegate9 === void 0 ? void 0 : _this$delegate9.toolbarDidHideDialog(getDialogName(element));\n    }\n  }\n\n  resetDialogInputs() {\n    Array.from(this.element.querySelectorAll(dialogInputSelector)).forEach(input => {\n      input.setAttribute(\"disabled\", \"disabled\");\n      input.removeAttribute(\"data-trix-validate\");\n      input.classList.remove(\"trix-validate\");\n    });\n  }\n\n  getDialog(dialogName) {\n    return this.element.querySelector(\"[data-trix-dialog=\".concat(dialogName, \"]\"));\n  }\n\n}\n\nconst snapshotsAreEqual = (a, b) => rangesAreEqual(a.selectedRange, b.selectedRange) && a.document.isEqualTo(b.document);\n\nclass EditorController extends Controller {\n  constructor(_ref) {\n    let {\n      editorElement,\n      document,\n      html\n    } = _ref;\n    super(...arguments);\n    this.editorElement = editorElement;\n    this.selectionManager = new SelectionManager(this.editorElement);\n    this.selectionManager.delegate = this;\n    this.composition = new Composition();\n    this.composition.delegate = this;\n    this.attachmentManager = new AttachmentManager(this.composition.getAttachments());\n    this.attachmentManager.delegate = this;\n    this.inputController = config.input.getLevel() === 2 ? new Level2InputController(this.editorElement) : new Level0InputController(this.editorElement);\n    this.inputController.delegate = this;\n    this.inputController.responder = this.composition;\n    this.compositionController = new CompositionController(this.editorElement, this.composition);\n    this.compositionController.delegate = this;\n    this.toolbarController = new ToolbarController(this.editorElement.toolbarElement);\n    this.toolbarController.delegate = this;\n    this.editor = new Editor(this.composition, this.selectionManager, this.editorElement);\n\n    if (document) {\n      this.editor.loadDocument(document);\n    } else {\n      this.editor.loadHTML(html);\n    }\n  }\n\n  registerSelectionManager() {\n    return selectionChangeObserver.registerSelectionManager(this.selectionManager);\n  }\n\n  unregisterSelectionManager() {\n    return selectionChangeObserver.unregisterSelectionManager(this.selectionManager);\n  }\n\n  render() {\n    return this.compositionController.render();\n  }\n\n  reparse() {\n    return this.composition.replaceHTML(this.editorElement.innerHTML);\n  } // Composition delegate\n\n\n  compositionDidChangeDocument(document) {\n    this.notifyEditorElement(\"document-change\");\n\n    if (!this.handlingInput) {\n      return this.render();\n    }\n  }\n\n  compositionDidChangeCurrentAttributes(currentAttributes) {\n    this.currentAttributes = currentAttributes;\n    this.toolbarController.updateAttributes(this.currentAttributes);\n    this.updateCurrentActions();\n    return this.notifyEditorElement(\"attributes-change\", {\n      attributes: this.currentAttributes\n    });\n  }\n\n  compositionDidPerformInsertionAtRange(range) {\n    if (this.pasting) {\n      this.pastedRange = range;\n    }\n  }\n\n  compositionShouldAcceptFile(file) {\n    return this.notifyEditorElement(\"file-accept\", {\n      file\n    });\n  }\n\n  compositionDidAddAttachment(attachment) {\n    const managedAttachment = this.attachmentManager.manageAttachment(attachment);\n    return this.notifyEditorElement(\"attachment-add\", {\n      attachment: managedAttachment\n    });\n  }\n\n  compositionDidEditAttachment(attachment) {\n    this.compositionController.rerenderViewForObject(attachment);\n    const managedAttachment = this.attachmentManager.manageAttachment(attachment);\n    this.notifyEditorElement(\"attachment-edit\", {\n      attachment: managedAttachment\n    });\n    return this.notifyEditorElement(\"change\");\n  }\n\n  compositionDidChangeAttachmentPreviewURL(attachment) {\n    this.compositionController.invalidateViewForObject(attachment);\n    return this.notifyEditorElement(\"change\");\n  }\n\n  compositionDidRemoveAttachment(attachment) {\n    const managedAttachment = this.attachmentManager.unmanageAttachment(attachment);\n    return this.notifyEditorElement(\"attachment-remove\", {\n      attachment: managedAttachment\n    });\n  }\n\n  compositionDidStartEditingAttachment(attachment, options) {\n    this.attachmentLocationRange = this.composition.document.getLocationRangeOfAttachment(attachment);\n    this.compositionController.installAttachmentEditorForAttachment(attachment, options);\n    return this.selectionManager.setLocationRange(this.attachmentLocationRange);\n  }\n\n  compositionDidStopEditingAttachment(attachment) {\n    this.compositionController.uninstallAttachmentEditor();\n    this.attachmentLocationRange = null;\n  }\n\n  compositionDidRequestChangingSelectionToLocationRange(locationRange) {\n    if (this.loadingSnapshot && !this.isFocused()) return;\n    this.requestedLocationRange = locationRange;\n    this.compositionRevisionWhenLocationRangeRequested = this.composition.revision;\n\n    if (!this.handlingInput) {\n      return this.render();\n    }\n  }\n\n  compositionWillLoadSnapshot() {\n    this.loadingSnapshot = true;\n  }\n\n  compositionDidLoadSnapshot() {\n    this.compositionController.refreshViewCache();\n    this.render();\n    this.loadingSnapshot = false;\n  }\n\n  getSelectionManager() {\n    return this.selectionManager;\n  } // Attachment manager delegate\n\n\n  attachmentManagerDidRequestRemovalOfAttachment(attachment) {\n    return this.removeAttachment(attachment);\n  } // Document controller delegate\n\n\n  compositionControllerWillSyncDocumentView() {\n    this.inputController.editorWillSyncDocumentView();\n    this.selectionManager.lock();\n    return this.selectionManager.clearSelection();\n  }\n\n  compositionControllerDidSyncDocumentView() {\n    this.inputController.editorDidSyncDocumentView();\n    this.selectionManager.unlock();\n    this.updateCurrentActions();\n    return this.notifyEditorElement(\"sync\");\n  }\n\n  compositionControllerDidRender() {\n    if (this.requestedLocationRange) {\n      if (this.compositionRevisionWhenLocationRangeRequested === this.composition.revision) {\n        this.selectionManager.setLocationRange(this.requestedLocationRange);\n      }\n\n      this.requestedLocationRange = null;\n      this.compositionRevisionWhenLocationRangeRequested = null;\n    }\n\n    if (this.renderedCompositionRevision !== this.composition.revision) {\n      this.runEditorFilters();\n      this.composition.updateCurrentAttributes();\n      this.notifyEditorElement(\"render\");\n    }\n\n    this.renderedCompositionRevision = this.composition.revision;\n  }\n\n  compositionControllerDidFocus() {\n    if (this.isFocusedInvisibly()) {\n      this.setLocationRange({\n        index: 0,\n        offset: 0\n      });\n    }\n\n    this.toolbarController.hideDialog();\n    return this.notifyEditorElement(\"focus\");\n  }\n\n  compositionControllerDidBlur() {\n    return this.notifyEditorElement(\"blur\");\n  }\n\n  compositionControllerDidSelectAttachment(attachment, options) {\n    this.toolbarController.hideDialog();\n    return this.composition.editAttachment(attachment, options);\n  }\n\n  compositionControllerDidRequestDeselectingAttachment(attachment) {\n    const locationRange = this.attachmentLocationRange || this.composition.document.getLocationRangeOfAttachment(attachment);\n    return this.selectionManager.setLocationRange(locationRange[1]);\n  }\n\n  compositionControllerWillUpdateAttachment(attachment) {\n    return this.editor.recordUndoEntry(\"Edit Attachment\", {\n      context: attachment.id,\n      consolidatable: true\n    });\n  }\n\n  compositionControllerDidRequestRemovalOfAttachment(attachment) {\n    return this.removeAttachment(attachment);\n  } // Input controller delegate\n\n\n  inputControllerWillHandleInput() {\n    this.handlingInput = true;\n    this.requestedRender = false;\n  }\n\n  inputControllerDidRequestRender() {\n    this.requestedRender = true;\n  }\n\n  inputControllerDidHandleInput() {\n    this.handlingInput = false;\n\n    if (this.requestedRender) {\n      this.requestedRender = false;\n      return this.render();\n    }\n  }\n\n  inputControllerDidAllowUnhandledInput() {\n    return this.notifyEditorElement(\"change\");\n  }\n\n  inputControllerDidRequestReparse() {\n    return this.reparse();\n  }\n\n  inputControllerWillPerformTyping() {\n    return this.recordTypingUndoEntry();\n  }\n\n  inputControllerWillPerformFormatting(attributeName) {\n    return this.recordFormattingUndoEntry(attributeName);\n  }\n\n  inputControllerWillCutText() {\n    return this.editor.recordUndoEntry(\"Cut\");\n  }\n\n  inputControllerWillPaste(paste) {\n    this.editor.recordUndoEntry(\"Paste\");\n    this.pasting = true;\n    return this.notifyEditorElement(\"before-paste\", {\n      paste\n    });\n  }\n\n  inputControllerDidPaste(paste) {\n    paste.range = this.pastedRange;\n    this.pastedRange = null;\n    this.pasting = null;\n    return this.notifyEditorElement(\"paste\", {\n      paste\n    });\n  }\n\n  inputControllerWillMoveText() {\n    return this.editor.recordUndoEntry(\"Move\");\n  }\n\n  inputControllerWillAttachFiles() {\n    return this.editor.recordUndoEntry(\"Drop Files\");\n  }\n\n  inputControllerWillPerformUndo() {\n    return this.editor.undo();\n  }\n\n  inputControllerWillPerformRedo() {\n    return this.editor.redo();\n  }\n\n  inputControllerDidReceiveKeyboardCommand(keys) {\n    return this.toolbarController.applyKeyboardCommand(keys);\n  }\n\n  inputControllerDidStartDrag() {\n    this.locationRangeBeforeDrag = this.selectionManager.getLocationRange();\n  }\n\n  inputControllerDidReceiveDragOverPoint(point) {\n    return this.selectionManager.setLocationRangeFromPointRange(point);\n  }\n\n  inputControllerDidCancelDrag() {\n    this.selectionManager.setLocationRange(this.locationRangeBeforeDrag);\n    this.locationRangeBeforeDrag = null;\n  } // Selection manager delegate\n\n\n  locationRangeDidChange(locationRange) {\n    this.composition.updateCurrentAttributes();\n    this.updateCurrentActions();\n\n    if (this.attachmentLocationRange && !rangesAreEqual(this.attachmentLocationRange, locationRange)) {\n      this.composition.stopEditingAttachment();\n    }\n\n    return this.notifyEditorElement(\"selection-change\");\n  } // Toolbar controller delegate\n\n\n  toolbarDidClickButton() {\n    if (!this.getLocationRange()) {\n      return this.setLocationRange({\n        index: 0,\n        offset: 0\n      });\n    }\n  }\n\n  toolbarDidInvokeAction(actionName) {\n    return this.invokeAction(actionName);\n  }\n\n  toolbarDidToggleAttribute(attributeName) {\n    this.recordFormattingUndoEntry(attributeName);\n    this.composition.toggleCurrentAttribute(attributeName);\n    this.render();\n\n    if (!this.selectionFrozen) {\n      return this.editorElement.focus();\n    }\n  }\n\n  toolbarDidUpdateAttribute(attributeName, value) {\n    this.recordFormattingUndoEntry(attributeName);\n    this.composition.setCurrentAttribute(attributeName, value);\n    this.render();\n\n    if (!this.selectionFrozen) {\n      return this.editorElement.focus();\n    }\n  }\n\n  toolbarDidRemoveAttribute(attributeName) {\n    this.recordFormattingUndoEntry(attributeName);\n    this.composition.removeCurrentAttribute(attributeName);\n    this.render();\n\n    if (!this.selectionFrozen) {\n      return this.editorElement.focus();\n    }\n  }\n\n  toolbarWillShowDialog(dialogElement) {\n    this.composition.expandSelectionForEditing();\n    return this.freezeSelection();\n  }\n\n  toolbarDidShowDialog(dialogName) {\n    return this.notifyEditorElement(\"toolbar-dialog-show\", {\n      dialogName\n    });\n  }\n\n  toolbarDidHideDialog(dialogName) {\n    this.thawSelection();\n    this.editorElement.focus();\n    return this.notifyEditorElement(\"toolbar-dialog-hide\", {\n      dialogName\n    });\n  } // Selection\n\n\n  freezeSelection() {\n    if (!this.selectionFrozen) {\n      this.selectionManager.lock();\n      this.composition.freezeSelection();\n      this.selectionFrozen = true;\n      return this.render();\n    }\n  }\n\n  thawSelection() {\n    if (this.selectionFrozen) {\n      this.composition.thawSelection();\n      this.selectionManager.unlock();\n      this.selectionFrozen = false;\n      return this.render();\n    }\n  }\n\n  canInvokeAction(actionName) {\n    if (this.actionIsExternal(actionName)) {\n      return true;\n    } else {\n      var _this$actions$actionN, _this$actions$actionN2;\n\n      return !!((_this$actions$actionN = this.actions[actionName]) !== null && _this$actions$actionN !== void 0 && (_this$actions$actionN2 = _this$actions$actionN.test) !== null && _this$actions$actionN2 !== void 0 && _this$actions$actionN2.call(this));\n    }\n  }\n\n  invokeAction(actionName) {\n    if (this.actionIsExternal(actionName)) {\n      return this.notifyEditorElement(\"action-invoke\", {\n        actionName\n      });\n    } else {\n      var _this$actions$actionN3, _this$actions$actionN4;\n\n      return (_this$actions$actionN3 = this.actions[actionName]) === null || _this$actions$actionN3 === void 0 ? void 0 : (_this$actions$actionN4 = _this$actions$actionN3.perform) === null || _this$actions$actionN4 === void 0 ? void 0 : _this$actions$actionN4.call(this);\n    }\n  }\n\n  actionIsExternal(actionName) {\n    return /^x-./.test(actionName);\n  }\n\n  getCurrentActions() {\n    const result = {};\n\n    for (const actionName in this.actions) {\n      result[actionName] = this.canInvokeAction(actionName);\n    }\n\n    return result;\n  }\n\n  updateCurrentActions() {\n    const currentActions = this.getCurrentActions();\n\n    if (!objectsAreEqual(currentActions, this.currentActions)) {\n      this.currentActions = currentActions;\n      this.toolbarController.updateActions(this.currentActions);\n      return this.notifyEditorElement(\"actions-change\", {\n        actions: this.currentActions\n      });\n    }\n  } // Editor filters\n\n\n  runEditorFilters() {\n    let snapshot = this.composition.getSnapshot();\n    Array.from(this.editor.filters).forEach(filter => {\n      const {\n        document,\n        selectedRange\n      } = snapshot;\n      snapshot = filter.call(this.editor, snapshot) || {};\n\n      if (!snapshot.document) {\n        snapshot.document = document;\n      }\n\n      if (!snapshot.selectedRange) {\n        snapshot.selectedRange = selectedRange;\n      }\n    });\n\n    if (!snapshotsAreEqual(snapshot, this.composition.getSnapshot())) {\n      return this.composition.loadSnapshot(snapshot);\n    }\n  } // Private\n\n\n  updateInputElement() {\n    const element = this.compositionController.getSerializableElement();\n    const value = serializeToContentType(element, \"text/html\");\n    return this.editorElement.setInputElementValue(value);\n  }\n\n  notifyEditorElement(message, data) {\n    switch (message) {\n      case \"document-change\":\n        this.documentChangedSinceLastRender = true;\n        break;\n\n      case \"render\":\n        if (this.documentChangedSinceLastRender) {\n          this.documentChangedSinceLastRender = false;\n          this.notifyEditorElement(\"change\");\n        }\n\n        break;\n\n      case \"change\":\n      case \"attachment-add\":\n      case \"attachment-edit\":\n      case \"attachment-remove\":\n        this.updateInputElement();\n        break;\n    }\n\n    return this.editorElement.notify(message, data);\n  }\n\n  removeAttachment(attachment) {\n    this.editor.recordUndoEntry(\"Delete Attachment\");\n    this.composition.removeAttachment(attachment);\n    return this.render();\n  }\n\n  recordFormattingUndoEntry(attributeName) {\n    const blockConfig = getBlockConfig(attributeName);\n    const locationRange = this.selectionManager.getLocationRange();\n\n    if (blockConfig || !rangeIsCollapsed(locationRange)) {\n      return this.editor.recordUndoEntry(\"Formatting\", {\n        context: this.getUndoContext(),\n        consolidatable: true\n      });\n    }\n  }\n\n  recordTypingUndoEntry() {\n    return this.editor.recordUndoEntry(\"Typing\", {\n      context: this.getUndoContext(this.currentAttributes),\n      consolidatable: true\n    });\n  }\n\n  getUndoContext() {\n    for (var _len = arguments.length, context = new Array(_len), _key = 0; _key < _len; _key++) {\n      context[_key] = arguments[_key];\n    }\n\n    return [this.getLocationContext(), this.getTimeContext(), ...Array.from(context)];\n  }\n\n  getLocationContext() {\n    const locationRange = this.selectionManager.getLocationRange();\n\n    if (rangeIsCollapsed(locationRange)) {\n      return locationRange[0].index;\n    } else {\n      return locationRange;\n    }\n  }\n\n  getTimeContext() {\n    if (config.undoInterval > 0) {\n      return Math.floor(new Date().getTime() / config.undoInterval);\n    } else {\n      return 0;\n    }\n  }\n\n  isFocused() {\n    var _this$editorElement$o;\n\n    return this.editorElement === ((_this$editorElement$o = this.editorElement.ownerDocument) === null || _this$editorElement$o === void 0 ? void 0 : _this$editorElement$o.activeElement);\n  } // Detect \"Cursor disappears sporadically\" Firefox bug.\n  // - https://bugzilla.mozilla.org/show_bug.cgi?id=226301\n\n\n  isFocusedInvisibly() {\n    return this.isFocused() && !this.getLocationRange();\n  }\n\n  get actions() {\n    return this.constructor.actions;\n  }\n\n}\n\n_defineProperty(EditorController, \"actions\", {\n  undo: {\n    test() {\n      return this.editor.canUndo();\n    },\n\n    perform() {\n      return this.editor.undo();\n    }\n\n  },\n  redo: {\n    test() {\n      return this.editor.canRedo();\n    },\n\n    perform() {\n      return this.editor.redo();\n    }\n\n  },\n  link: {\n    test() {\n      return this.editor.canActivateAttribute(\"href\");\n    }\n\n  },\n  increaseNestingLevel: {\n    test() {\n      return this.editor.canIncreaseNestingLevel();\n    },\n\n    perform() {\n      return this.editor.increaseNestingLevel() && this.render();\n    }\n\n  },\n  decreaseNestingLevel: {\n    test() {\n      return this.editor.canDecreaseNestingLevel();\n    },\n\n    perform() {\n      return this.editor.decreaseNestingLevel() && this.render();\n    }\n\n  },\n  attachFiles: {\n    test() {\n      return true;\n    },\n\n    perform() {\n      return config.input.pickFiles(this.editor.insertFiles);\n    }\n\n  }\n});\n\nEditorController.proxyMethod(\"getSelectionManager().setLocationRange\");\nEditorController.proxyMethod(\"getSelectionManager().getLocationRange\");\n\ninstallDefaultCSSForTagName(\"trix-toolbar\", \"%t {\\n  display: block;\\n}\\n\\n%t {\\n  white-space: nowrap;\\n}\\n\\n%t [data-trix-dialog] {\\n  display: none;\\n}\\n\\n%t [data-trix-dialog][data-trix-active] {\\n  display: block;\\n}\\n\\n%t [data-trix-dialog] [data-trix-validate]:invalid {\\n  background-color: #ffdddd;\\n}\");\nclass TrixToolbarElement extends HTMLElement {\n  // Element lifecycle\n  connectedCallback() {\n    if (this.innerHTML === \"\") {\n      this.innerHTML = config.toolbar.getDefaultHTML();\n    }\n  }\n\n}\nwindow.customElements.define(\"trix-toolbar\", TrixToolbarElement);\n\nlet id = 0; // Contenteditable support helpers\n\nconst autofocus = function (element) {\n  if (!document.querySelector(\":focus\")) {\n    if (element.hasAttribute(\"autofocus\") && document.querySelector(\"[autofocus]\") === element) {\n      return element.focus();\n    }\n  }\n};\n\nconst makeEditable = function (element) {\n  if (element.hasAttribute(\"contenteditable\")) {\n    return;\n  }\n\n  element.setAttribute(\"contenteditable\", \"\");\n  return handleEventOnce(\"focus\", {\n    onElement: element,\n\n    withCallback() {\n      return configureContentEditable(element);\n    }\n\n  });\n};\n\nconst configureContentEditable = function (element) {\n  disableObjectResizing(element);\n  return setDefaultParagraphSeparator(element);\n};\n\nconst disableObjectResizing = function (element) {\n  var _document$queryComman, _document;\n\n  if ((_document$queryComman = (_document = document).queryCommandSupported) !== null && _document$queryComman !== void 0 && _document$queryComman.call(_document, \"enableObjectResizing\")) {\n    document.execCommand(\"enableObjectResizing\", false, false);\n    return handleEvent(\"mscontrolselect\", {\n      onElement: element,\n      preventDefault: true\n    });\n  }\n};\n\nconst setDefaultParagraphSeparator = function (element) {\n  var _document$queryComman2, _document2;\n\n  if ((_document$queryComman2 = (_document2 = document).queryCommandSupported) !== null && _document$queryComman2 !== void 0 && _document$queryComman2.call(_document2, \"DefaultParagraphSeparator\")) {\n    const {\n      tagName\n    } = config.blockAttributes.default;\n\n    if ([\"div\", \"p\"].includes(tagName)) {\n      return document.execCommand(\"DefaultParagraphSeparator\", false, tagName);\n    }\n  }\n}; // Accessibility helpers\n\n\nconst addAccessibilityRole = function (element) {\n  if (element.hasAttribute(\"role\")) {\n    return;\n  }\n\n  return element.setAttribute(\"role\", \"textbox\");\n};\n\nconst ensureAriaLabel = function (element) {\n  if (element.hasAttribute(\"aria-label\") || element.hasAttribute(\"aria-labelledby\")) {\n    return;\n  }\n\n  const update = function () {\n    const texts = Array.from(element.labels).map(label => {\n      if (!label.contains(element)) return label.textContent;\n    }).filter(text => text);\n    const text = texts.join(\" \");\n\n    if (text) {\n      return element.setAttribute(\"aria-label\", text);\n    } else {\n      return element.removeAttribute(\"aria-label\");\n    }\n  };\n\n  update();\n  return handleEvent(\"focus\", {\n    onElement: element,\n    withCallback: update\n  });\n}; // Style\n\n\nconst cursorTargetStyles = function () {\n  if (config.browser.forcesObjectResizing) {\n    return {\n      display: \"inline\",\n      width: \"auto\"\n    };\n  } else {\n    return {\n      display: \"inline-block\",\n      width: \"1px\"\n    };\n  }\n}();\n\ninstallDefaultCSSForTagName(\"trix-editor\", \"%t {\\n    display: block;\\n}\\n\\n%t:empty:not(:focus)::before {\\n    content: attr(placeholder);\\n    color: graytext;\\n    cursor: text;\\n    pointer-events: none;\\n    white-space: pre-line;\\n}\\n\\n%t a[contenteditable=false] {\\n    cursor: text;\\n}\\n\\n%t img {\\n    max-width: 100%;\\n    height: auto;\\n}\\n\\n%t \".concat(attachmentSelector, \" figcaption textarea {\\n    resize: none;\\n}\\n\\n%t \").concat(attachmentSelector, \" figcaption textarea.trix-autoresize-clone {\\n    position: absolute;\\n    left: -9999px;\\n    max-height: 0px;\\n}\\n\\n%t \").concat(attachmentSelector, \" figcaption[data-trix-placeholder]:empty::before {\\n    content: attr(data-trix-placeholder);\\n    color: graytext;\\n}\\n\\n%t [data-trix-cursor-target] {\\n    display: \").concat(cursorTargetStyles.display, \" !important;\\n    width: \").concat(cursorTargetStyles.width, \" !important;\\n    padding: 0 !important;\\n    margin: 0 !important;\\n    border: none !important;\\n}\\n\\n%t [data-trix-cursor-target=left] {\\n    vertical-align: top !important;\\n    margin-left: -1px !important;\\n}\\n\\n%t [data-trix-cursor-target=right] {\\n    vertical-align: bottom !important;\\n    margin-right: -1px !important;\\n}\"));\nclass TrixEditorElement extends HTMLElement {\n  // Properties\n  get trixId() {\n    if (this.hasAttribute(\"trix-id\")) {\n      return this.getAttribute(\"trix-id\");\n    } else {\n      this.setAttribute(\"trix-id\", ++id);\n      return this.trixId;\n    }\n  }\n\n  get labels() {\n    const labels = [];\n\n    if (this.id && this.ownerDocument) {\n      labels.push(...Array.from(this.ownerDocument.querySelectorAll(\"label[for='\".concat(this.id, \"']\")) || []));\n    }\n\n    const label = findClosestElementFromNode(this, {\n      matchingSelector: \"label\"\n    });\n\n    if (label) {\n      if ([this, null].includes(label.control)) {\n        labels.push(label);\n      }\n    }\n\n    return labels;\n  }\n\n  get toolbarElement() {\n    if (this.hasAttribute(\"toolbar\")) {\n      var _this$ownerDocument;\n\n      return (_this$ownerDocument = this.ownerDocument) === null || _this$ownerDocument === void 0 ? void 0 : _this$ownerDocument.getElementById(this.getAttribute(\"toolbar\"));\n    } else if (this.parentNode) {\n      const toolbarId = \"trix-toolbar-\".concat(this.trixId);\n      this.setAttribute(\"toolbar\", toolbarId);\n      const element = makeElement(\"trix-toolbar\", {\n        id: toolbarId\n      });\n      this.parentNode.insertBefore(element, this);\n      return element;\n    } else {\n      return undefined;\n    }\n  }\n\n  get form() {\n    var _this$inputElement;\n\n    return (_this$inputElement = this.inputElement) === null || _this$inputElement === void 0 ? void 0 : _this$inputElement.form;\n  }\n\n  get inputElement() {\n    if (this.hasAttribute(\"input\")) {\n      var _this$ownerDocument2;\n\n      return (_this$ownerDocument2 = this.ownerDocument) === null || _this$ownerDocument2 === void 0 ? void 0 : _this$ownerDocument2.getElementById(this.getAttribute(\"input\"));\n    } else if (this.parentNode) {\n      const inputId = \"trix-input-\".concat(this.trixId);\n      this.setAttribute(\"input\", inputId);\n      const element = makeElement(\"input\", {\n        type: \"hidden\",\n        id: inputId\n      });\n      this.parentNode.insertBefore(element, this.nextElementSibling);\n      return element;\n    } else {\n      return undefined;\n    }\n  }\n\n  get editor() {\n    var _this$editorControlle;\n\n    return (_this$editorControlle = this.editorController) === null || _this$editorControlle === void 0 ? void 0 : _this$editorControlle.editor;\n  }\n\n  get name() {\n    var _this$inputElement2;\n\n    return (_this$inputElement2 = this.inputElement) === null || _this$inputElement2 === void 0 ? void 0 : _this$inputElement2.name;\n  }\n\n  get value() {\n    var _this$inputElement3;\n\n    return (_this$inputElement3 = this.inputElement) === null || _this$inputElement3 === void 0 ? void 0 : _this$inputElement3.value;\n  }\n\n  set value(defaultValue) {\n    var _this$editor;\n\n    this.defaultValue = defaultValue;\n    (_this$editor = this.editor) === null || _this$editor === void 0 ? void 0 : _this$editor.loadHTML(this.defaultValue);\n  } // Controller delegate methods\n\n\n  notify(message, data) {\n    if (this.editorController) {\n      return triggerEvent(\"trix-\".concat(message), {\n        onElement: this,\n        attributes: data\n      });\n    }\n  }\n\n  setInputElementValue(value) {\n    if (this.inputElement) {\n      this.inputElement.value = value;\n    }\n  } // Element lifecycle\n\n\n  connectedCallback() {\n    if (!this.hasAttribute(\"data-trix-internal\")) {\n      makeEditable(this);\n      addAccessibilityRole(this);\n      ensureAriaLabel(this);\n\n      if (!this.editorController) {\n        triggerEvent(\"trix-before-initialize\", {\n          onElement: this\n        });\n        this.editorController = new EditorController({\n          editorElement: this,\n          html: this.defaultValue = this.value\n        });\n        requestAnimationFrame(() => triggerEvent(\"trix-initialize\", {\n          onElement: this\n        }));\n      }\n\n      this.editorController.registerSelectionManager();\n      this.registerResetListener();\n      this.registerClickListener();\n      autofocus(this);\n    }\n  }\n\n  disconnectedCallback() {\n    var _this$editorControlle2;\n\n    (_this$editorControlle2 = this.editorController) === null || _this$editorControlle2 === void 0 ? void 0 : _this$editorControlle2.unregisterSelectionManager();\n    this.unregisterResetListener();\n    return this.unregisterClickListener();\n  } // Form support\n\n\n  registerResetListener() {\n    this.resetListener = this.resetBubbled.bind(this);\n    return window.addEventListener(\"reset\", this.resetListener, false);\n  }\n\n  unregisterResetListener() {\n    return window.removeEventListener(\"reset\", this.resetListener, false);\n  }\n\n  registerClickListener() {\n    this.clickListener = this.clickBubbled.bind(this);\n    return window.addEventListener(\"click\", this.clickListener, false);\n  }\n\n  unregisterClickListener() {\n    return window.removeEventListener(\"click\", this.clickListener, false);\n  }\n\n  resetBubbled(event) {\n    if (event.defaultPrevented) return;\n    if (event.target !== this.form) return;\n    return this.reset();\n  }\n\n  clickBubbled(event) {\n    if (event.defaultPrevented) return;\n    if (this.contains(event.target)) return;\n    const label = findClosestElementFromNode(event.target, {\n      matchingSelector: \"label\"\n    });\n    if (!label) return;\n    if (!Array.from(this.labels).includes(label)) return;\n    return this.focus();\n  }\n\n  reset() {\n    this.value = this.defaultValue;\n  }\n\n}\nwindow.customElements.define(\"trix-editor\", TrixEditorElement);\n\nexport { Trix as default };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}